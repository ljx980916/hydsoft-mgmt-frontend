"use strict";(self["webpackChunkoms_frontend"]=self["webpackChunkoms_frontend"]||[]).push([[618],{8942:function(e,t,a){a.d(t,{Bn:function(){return s},CL:function(){return r},Gd:function(){return o},Sl:function(){return d},X4:function(){return n},cR:function(){return i}});var l=a(4471);function o(e){return(0,l.Z)({url:"/LinkAnalysis/queryLinkAnalysisList",method:"post",data:e,timeout:18e4})}function n(e){return(0,l.Z)({url:"/LinkAnalysis/getCustomerLink",method:"post",data:e,timeout:18e4})}function i(e){return(0,l.Z)({url:"/LinkAnalysis/getProjectLink",method:"post",data:e,timeout:18e4})}function r(e){return(0,l.Z)({url:"/yoyAnalysis/queryYoyAnalysis",method:"post",data:e,timeout:18e4})}function d(e){return(0,l.Z)({url:"/yoyAnalysis/getCustomerYoyAnalysis",method:"post",data:e,timeout:18e4})}function s(e){return(0,l.Z)({url:"/yoyAnalysis/getProjectYoyAnalysis",method:"post",data:e,timeout:18e4})}},9766:function(e,t,a){a.d(t,{Z:function(){return s}});var l=a(3396),o=a(7139),n=a(6221),i=a(4870),r={__name:"echartsContainer",props:{route:{type:Array,default:()=>[]},height:{type:Number,default:20},width:{type:Number,default:50}},setup(e){const t=e,a=(0,i.iH)(null);return(0,l.bv)((()=>{var e,l=a.value,o=n.S1(l);e={xAxis:{type:"category",show:!1},yAxis:{type:"value",show:!1},tooltip:{trigger:"item",position:"top",formatter:e=>e.data?.name?.replaceAll("-","<br/>"),appendToBody:!0},series:[{type:"line",symbol:"emptyCircle",symbolSize:3,itemStyle:{color:"#0770FF"},areaStyle:{color:new n.Q.o(0,0,0,1,[{offset:0,color:"rgba(58,77,233,0.8)"},{offset:1,color:"rgba(58,77,233,0.3)"}])},data:t.route}]},e&&o.setOption(e)})),(t,n)=>((0,l.wg)(),(0,l.iD)("div",{ref_key:"echartContainer",ref:a,style:(0,o.j5)({width:e.width+"px",height:e.height+"px",margin:"4px 0 -6px 0"})},null,4))}};const d=r;var s=d},3162:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var l=a(3396),o=(a(7658),a(7139)),n=a(9242),i=a(4842),r=a(4870),d=a(4239),s=a(8942),c=a(4722),u=a(9766),p=a(2483);const h={class:"defaultPadding"},m={class:"flex-between"},f={style:{position:"relative",top:"-1px"}},g={class:"m-t-20"},y={class:"pointer"},w={class:"flex-between"},v={style:{position:"relative",top:"-1px"}},x={key:0,href:"javaScript:void(0)",style:{color:"#165dff"}},b={key:1,class:"pointer"},k={key:0,href:"javaScript:void(0)",style:{color:"#165dff"}},N={key:1,class:"pointer"};var S={__name:"projectRingSame",setup(e){let t=(0,l.FN)().appContext.config.globalProperties.$bus;const a=(0,p.yj)(),S=(0,p.tv)();let{customerId:C,deptId:E,deptName:_,groupCustomerName:H,title:A,tab:j,radiotype:I}=a.query,W=(0,d.mA)();const $=(0,r.iH)(j||"1");let{year:L,month:Z}=(0,c.Xn)(),R=L-1,T=Z-1,z={};const U=(0,r.qj)({columns:[],data:[],defaultExpandedKeys:[],maxHeight:"200px",loading:!1}),D=(0,r.iH)("3"),K=(0,r.iH)(null),O=(0,r.qj)({columnTabs:[],up:[],down:[]}),P={"发薪人数":[],"营业收入":[],"销售毛利率":[]},F={canvasLine1:"发薪人数",canvasLine2:"营业收入",canvasLine3:"销售毛利率"};let q=[];const Y=e=>{$.value=e};(0,l.bv)((()=>{if(K.value){let e=K.value.$el;(0,l.Y3)((()=>{let t=window.innerHeight,a=e.getBoundingClientRect().top;U.maxHeight=t-a-30+"px"}))}}));const B=()=>{let e=(0,r.IU)(W.getTagColumnList)||[],t=e.filter((e=>"环比分析"===e.report))||[];t.length&&t[0].tier.forEach(((e,t)=>{let a=[],o=[],n=[],i=[],r=[],d=[];e.tags.forEach((e=>{a.push(e.tag),e.columns.forEach((e=>{let{col:t,conf:a,title:s}=e;a=a||{};let p={title:s,dataIndex:t,align:a.align,cellStyle:{"text-align":a.cellAlign},width:a.width,ellipsis:!0,headerCellClass:"noEllipsis",slotName:t,bodyCellClass:"bodyCell",fixed:a.fixed};p.isShow=a.isShow,p.render=({record:e,column:t})=>{let a=e[t.dataIndex];if(Array.isArray(a)){if(void 0!==P[F[t.dataIndex]]){let o=P[F[t.dataIndex]].map(((t,l)=>({tip:t.month+e[t.col],value:a[l]})));return(0,l.Wm)(u.Z,{route:o,height:74,width:100},null)}}else if(null!==a&&void 0!==a)return(0,l.Wm)("span",{innerHTML:(0,c.HJ)(a)},null)},1===a.canHide?0===a.parentCol?o.push(p):n.push(p):i.push(p),1===a.parentCol?r.push(p):d.push(p)}))})),z["level"+(t+1)]={tabs:a,params:e.params||[],columnTabs:o,columnHasSonTabs:n,noHiddenColumn:i,defaultColumnTabs:d,defaultColumHasSonTabs:r}})),O.columnTabs=z.level3.columnHasSonTabs},J=()=>{let{columnTabs:e,noHiddenColumn:t,defaultColumHasSonTabs:a}=z.level3,o=5;switch(D.value){case"3":let e=(0,c.Fp)(3,!0),t=[],l=a.filter((e=>1===e.isShow));e.forEach(((e,a)=>{let n={};n.title=`${e[0]}年${e[1]}月`,n.children=l.map(((e,t)=>(o++,{...e,dataIndex:`colNo${o}`,slotName:`colNo${o}`}))),t.push(n)})),o=5,q=t;break;case"6":let n=(0,c.Fp)(6,!0),i=[],r=a.filter((e=>1===e.isShow));n.forEach(((e,t)=>{let a={};a.title=`${e[0]}年${e[1]}月`,a.children=r.map(((e,t)=>(o++,{...e,dataIndex:`colNo${o}`,slotName:`colNo${o}`}))),i.push(a)})),o=5,q=i;break;case"12":let d=(0,c.Fp)(12,!0);d=d.filter((e=>2022!==e[0]));let s=[],u=a.filter((e=>1===e.isShow));d.forEach(((e,t)=>{let a={};a.title=`${e[0]}年${e[1]}月`,a.children=u.map(((e,t)=>(o++,{...e,dataIndex:`colNo${o}`,slotName:`colNo${o}`}))),s.push(a)})),o=5,q=s;break;default:break}Object.keys(P).forEach((e=>{P[e]=[]})),q.forEach((e=>{if(e.children?.length){let t=[];e.children.forEach((a=>{1===a.isShow&&t.push(a),P.hasOwnProperty(a.title)&&P[a.title].push({month:e.title,col:a.dataIndex})})),e.children=t}})),Object.keys(P).forEach((e=>P[e].reverse()));let n={title:"操作",dataIndex:"action",width:80,fixed:"right",cellStyle:{textAlign:"center"},render({record:e}){return(0,l.Wm)("a",{href:"javaScript:void(0)",onClick:()=>{te(e,"project")}},[(0,l.Uk)("看图")])}},i=[...e.filter((e=>1===e.isShow)),...t,...q,n];U.columns=i},M=e=>{U.defaultExpandedKeys=e},X=e=>{D.value=e,J(),ee()};(0,l.wF)((()=>{B(),J(),ee(),ue(),t.emit("updateStructure",[{type:"text",color:"#333",msg:"环比分析列表"},{type:"button",color:"#5370FD",msg:_,isBack:!0},{type:"text",color:"#333",msg:`${H}-${A}`}])}));const G=e=>{switch(e.isShow){case 0:e.isShow=1,Q({type:"self",title:e.title,val:1,tab:e});break;case 1:e.isShow=0,Q({type:"self",title:e.title,val:0,tab:e});break;default:break}},Q=e=>{let{columnTabs:t,defaultColumHasSonTabs:a}=z.level3,l=a.filter((e=>1===e.isShow));if(0===l.length)return i.Z.error("至少选择一项"),void(e.tab.isShow=0===e.tab.isShow?1:0);"parent"===e.type&&t.forEach((t=>{e.title===t.title&&(t.isShow=e.val)})),"self"===e.type&&a.forEach((t=>{e.title===t.title&&(t.isShow=e.val)})),J(),handleAbortRequest(),ee()},V=e=>{e.forEach((e=>{e.colNo3=JSON.parse(e.colNo3),e.colNo4=JSON.parse(e.colNo4),e.colNo5=JSON.parse(e.colNo5),e.children&&V(e.children)}))},ee=()=>{U.data=[],U.loading=!0;let e=[];var t=JSON.parse(JSON.stringify(U.columns));const a={"发薪人数":"colNo1","营业收入":"colNo2","销售毛利":"colNo3","销售毛利率":"colNo4","直接成本":"colNo5","人均营业收入":"colNo6","人均直接成本":"colNo7","未完工项目成本":"colNo8","招聘费用":"colNo9","销售费用":"colNo10","管理费用":"colNo11"};t.forEach((t=>{a[t.title]&&e.push(a[t.title]),t.children&&t.children.forEach((t=>{a[t.title]&&e.push(a[t.title])}))}));const l={interval:Number(D.value),dynamicHeaderParam:Array.from(new Set(e)),xAxis:50,yAxis:20,tagKey:"linkAnalysis3",customerId:C};(0,s.cR)(l).then((e=>{if("200"==e.code){V(e.data);let t=(0,c.th)(e.data,"key","title"),a=[];e.data.forEach((e=>a.push(e.title))),U.defaultExpandedKeys=a,U.data=t}else i.Z.error(e.message);U.loading=!1})).catch((e=>{"ERR_CANCELED"===e?.code?U.loading=!0:(i.Z.error(e?.message||"数据请求错误"),U.loading=!1)}))},te=(e,t)=>{S.push({name:"ringContrastChart",state:{deptName:_,interval:D.value,deptId:E,title:A,customerName:e.customerName,projectName:e.projectName,sourceType:t,projectId:e.finPcode,taxRate:e.taxRate}})},ae=e=>{e.isShow=0===e.isShow?1:0;let t=ie.value.filter((e=>1===e.isShow));if(0===t.length)return i.Z.error("至少选择一项"),void(e.isShow=0===e.isShow?1:0);handleAbortRequest(),"total"===ne.value?pe(ie.value):ge(ie.value)},le=e=>{ne.value=e,ue()},oe=(0,r.iH)([]),ne=(0,r.iH)(I||"total"),ie=(0,r.iH)([]),re=(0,r.XI)([]),de=(0,r.qj)({columns:[],data:[],defaultExpandedKeys:[],maxHeight:"600px",loading:!1}),se=(0,r.iH)(null),ce=e=>{de.defaultExpandedKeys=e},ue=()=>{ie.value=[],oe.value=[],re.value=[];let e=(0,r.IU)(W.getTagColumnList)||[],t=e.filter((e=>"同比分析"===e.report))||[];if(t.length){const e=t[0].tier[2].tags[0].columns;e.forEach((e=>{const{col:t,conf:a,title:l}=e;let o={title:l,dataIndex:t,align:a.align,cellStyle:{"text-align":a.cellAlign},width:a.width,ellipsis:!0,headerCellClass:"noEllipsis",slotName:t,bodyCellClass:"bodyCell",isShow:a.isShow};1==a.canHide?ie.value.push(o):re.value.push(o),void 0!==a.fixed&&(o.fixed=a.fixed),1==a.parentCol&&oe.value.push(o)})),"total"==ne.value?pe(ie.value):ge(ie.value)}},pe=e=>{let t=e.filter((e=>1===e.isShow)),a=[],o=[{title:R+"/1-12"},{title:R+`/1-${T}`},{title:L+`/1-${T}`},{title:"同比"}],n=6;t.forEach((e=>{let t={title:e.title,children:o.map(((t,a)=>{let l={title:t.title,dataIndex:`colNo${n}`,slotName:`colNo${n}`,width:110,cellStyle:{textAlign:"right"}};return a===o.length-1&&(l.title=e.title.endsWith("率")?"偏离":t.title),n++,l}))};a.push(t)}));let i={title:"操作",dataIndex:"action",width:80,fixed:"right",cellStyle:{textAlign:"center"},render({record:e}){return(0,l.Wm)("a",{href:"javaScript:void(0)",onClick:()=>{we(e,"project")}},[(0,l.Uk)("看图")])}};de.columns=[...re.value,...a,i],ye("1")},he=(0,r.qj)({columns:[],data:[],defaultExpandedKeys:[],maxHeight:"600px",loading:!1}),me=(0,r.iH)(null),fe=e=>{he.defaultExpandedKeys=e},ge=e=>{const t=[];let a=e.filter((e=>1===e.isShow));if(1==Z)for(var o=1;o<=12;o++)t.push({title:o+"月",children:[]});else for(o=1;o<=T;o++)t.push({title:o+"月",children:[]});const n=[R,L];let i=6;t.forEach((e=>{let t=[];a.forEach((e=>{n.forEach((a=>{let l={title:`${e.title}${a}`,dataIndex:`colNo${i}`,slotName:`colNo${i}`,width:e.width,cellStyle:(0,r.IU)(e.cellStyle)};t.push(l),i++}))})),e.children=t}));let d={title:"操作",dataIndex:"action",width:80,fixed:"right",cellStyle:{textAlign:"center"},render({record:e}){return(0,l.Wm)("a",{href:"javaScript:void(0)",onClick:()=>{we(e,"project")}},[(0,l.Uk)("看图")])}};he.columns=[...re.value,...t,d],ye("2")},ye=e=>{let t={interval:0==T?12:T,dynamicHeaderParam:oe.value.filter((e=>1===e.isShow)).map((e=>e.dataIndex)),xAxis:74,yAxis:100,tagKey:"yoyAnalysis3",customerId:C,type:e};"total"===ne.value?de.loading=!0:he.loading=!0,(0,s.Bn)(t).then((e=>{if("200"===e.code){(0,c.th)(e.data,"key","deptId");let t=[];e.data.forEach((e=>t.push(e.key))),"total"===ne.value&&(de.defaultExpandedKeys=t,de.data=e.data,"600px"===de.maxHeight&&(0,l.Y3)((()=>{if(se.value){let e=se.value.$el,t=window.innerHeight,a=e.getBoundingClientRect().top;de.maxHeight=Math.round(t-a-32)+"px"}}))),"detail"===ne.value&&(he.defaultExpandedKeys=t,he.data=e.data,"600px"===he.maxHeight&&(0,l.Y3)((()=>{if(me.value){let e=me.value.$el,t=window.innerHeight,a=e.getBoundingClientRect().top;he.maxHeight=Math.round(t-a-32)+"px"}})))}else i.Z.error(e.message||"请求数据失败");"total"===ne.value&&(de.loading=!1),"detail"===ne.value&&(he.loading=!1)})).catch((e=>{"total"===ne.value&&("ERR_CANCELED"===e?.code?de.loading=!0:(i.Z.error(e?.message||"数据请求错误"),de.loading=!1)),"detail"===ne.value&&("ERR_CANCELED"===e?.code?he.loading=!0:(i.Z.error(e?.message||"数据请求错误"),he.loading=!1))}))},we=(e,t)=>{S.push({name:"lookChart",state:{barChartOptions:JSON.stringify(ie.value),deptId:E,title:H,sourceType:t,taxRate:e.taxRate,projectId:e.finPcode,customerName:e.customerName,projectName:e.projectName,deptName:_}})},ve=(e,t)=>e[t.dataIndex].map(((a,l)=>({value:e[t.dataIndex][l]})));return(e,t)=>{const a=(0,l.up)("a-tag"),i=(0,l.up)("a-space"),r=(0,l.up)("a-option"),d=(0,l.up)("icon-calendar"),s=(0,l.up)("a-select"),c=(0,l.up)("a-popover"),p=(0,l.up)("a-table"),S=(0,l.up)("a-tab-pane"),C=(0,l.up)("a-radio"),E=(0,l.up)("a-radio-group"),_=(0,l.up)("a-tabs");return(0,l.wg)(),(0,l.iD)("div",h,[(0,l.Wm)(_,{"active-key":$.value,"onUpdate:active-key":t[2]||(t[2]=e=>$.value=e),class:"tabs",onChange:Y},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{key:"1",title:"环比分析",class:"p-t-10"},{default:(0,l.w5)((()=>[(0,l._)("div",m,[(0,l.Wm)(i,{size:["small",0],wrap:""},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(O.columnTabs,((e,t)=>((0,l.wg)(),(0,l.j4)(a,{key:t,color:1===e.isShow?"arcoblue":"",size:"large",class:"pointer",onClick:t=>G(e)},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.title),1)])),_:2},1032,["color","onClick"])))),128))])),_:1}),(0,l._)("div",f,[(0,l.Wm)(s,{"model-value":D.value,"onUpdate:model-value":t[0]||(t[0]=e=>D.value=e),onChange:X},{"arrow-icon":(0,l.w5)((()=>[(0,l.Wm)(d,{size:16})])),default:(0,l.w5)((()=>[(0,l.Wm)(r,{value:"3"},{default:(0,l.w5)((()=>[(0,l.Uk)("近3个月")])),_:1}),(0,l.Wm)(r,{value:"6"},{default:(0,l.w5)((()=>[(0,l.Uk)("近6个月")])),_:1}),(0,l.Wm)(r,{value:"12"},{default:(0,l.w5)((()=>[(0,l.Uk)("近12个月")])),_:1})])),_:1},8,["model-value"])])]),(0,l._)("div",g,[(0,l.Wm)(p,{columns:U.columns,data:U.data,"default-expand-all-rows":!0,bordered:{cell:!0},"column-resizable":"","expanded-keys":U.defaultExpandedKeys,scroll:{maxHeight:U.maxHeight},scrollbar:{x:!0,y:1500},pagination:!1,loading:U.loading,ref_key:"tableRef",ref:K,onExpandedChange:M},{projectName:(0,l.w5)((({record:e})=>[(0,l.Wm)(c,{"content-style":{background:"rgba(0,0,0,.8)",color:"#fff"},"arrow-style":{background:"rgba(0,0,0,.8)"}},{content:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.projectName),1)])),default:(0,l.w5)((()=>[(0,l._)("span",y,(0,o.zw)(e.projectName),1)])),_:2},1032,["content-style","arrow-style"])])),_:1},8,["columns","data","expanded-keys","scroll","loading"])])])),_:1}),(0,l.Wm)(S,{key:"2",title:"同比分析",class:"p-t-10"},{default:(0,l.w5)((()=>[(0,l._)("div",w,[(0,l.Wm)(i,{size:["small",0],wrap:""},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(oe.value,((e,t)=>((0,l.wg)(),(0,l.j4)(a,{key:t,color:1===e.isShow?"arcoblue":"",size:"large",class:"pointer",onClick:t=>ae(e)},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.title),1)])),_:2},1032,["color","onClick"])))),128))])),_:1}),(0,l._)("div",v,[(0,l.Wm)(E,{"model-value":ne.value,"onUpdate:model-value":t[1]||(t[1]=e=>ne.value=e),type:"button",onChange:le},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{value:"total"},{default:(0,l.w5)((()=>[(0,l.Uk)("汇总")])),_:1}),(0,l.Wm)(C,{value:"detail"},{default:(0,l.w5)((()=>[(0,l.Uk)("明细")])),_:1})])),_:1},8,["model-value"])])]),(0,l.wy)((0,l._)("div",null,[(0,l.Wm)(p,{columns:de.columns,data:de.data,"default-expand-all-rows":!0,bordered:{cell:!0},"column-resizable":"","expanded-keys":de.defaultExpandedKeys,scroll:{maxHeight:de.maxHeight},scrollbar:{x:!0,y:1500},pagination:!1,loading:de.loading,ref_key:"sameTotalProjectTableRef",ref:se,class:"m-t-20",onExpandedChange:ce},{lastDeptName:(0,l.w5)((({record:e})=>[(0,l.Wm)(c,{"content-style":{background:"rgba(0,0,0,.8)",color:"#fff"},"arrow-style":{background:"rgba(0,0,0,.8)"}},{content:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.deptName),1)])),default:(0,l.w5)((()=>["1"===e.leafNode?((0,l.wg)(),(0,l.iD)("a",x,(0,o.zw)(e.lastDeptName),1)):((0,l.wg)(),(0,l.iD)("span",b,(0,o.zw)(e.lastDeptName),1))])),_:2},1032,["content-style","arrow-style"])])),canvasLine1:(0,l.w5)((({record:e,column:t})=>[(0,l.Wm)(u.Z,{route:ve(e,t),height:74,width:100},null,8,["route"])])),canvasLine2:(0,l.w5)((({record:e,column:t})=>[(0,l.Wm)(u.Z,{route:ve(e,t),height:74,width:100},null,8,["route"])])),canvasLine3:(0,l.w5)((({record:e,column:t})=>[(0,l.Wm)(u.Z,{route:ve(e,t),height:74,width:100},null,8,["route"])])),_:1},8,["columns","data","expanded-keys","scroll","loading"])],512),[[n.F8,"total"===ne.value]]),(0,l.wy)((0,l._)("div",null,[(0,l.Wm)(p,{columns:he.columns,data:he.data,"default-expand-all-rows":!0,bordered:{cell:!0},"column-resizable":"","expanded-keys":he.defaultExpandedKeys,scroll:{maxHeight:he.maxHeight},scrollbar:{x:!0,y:1500},pagination:!1,loading:he.loading,ref_key:"sameDetailProjectTableRef",ref:me,class:"m-t-20",onExpandedChange:fe},{title:(0,l.w5)((({record:e})=>[(0,l.Wm)(c,{"content-style":{background:"rgba(0,0,0,.8)",color:"#fff"},"arrow-style":{background:"rgba(0,0,0,.8)"}},{content:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.title),1)])),default:(0,l.w5)((()=>["1"===e.leafNode?((0,l.wg)(),(0,l.iD)("a",k,(0,o.zw)(e.title),1)):((0,l.wg)(),(0,l.iD)("span",N,(0,o.zw)(e.title),1))])),_:2},1032,["content-style","arrow-style"])])),canvasLine1:(0,l.w5)((({record:e,column:t})=>[(0,l.Wm)(u.Z,{route:ve(e,t),height:74,width:100},null,8,["route"])])),canvasLine2:(0,l.w5)((({record:e,column:t})=>[(0,l.Wm)(u.Z,{route:ve(e,t),height:74,width:100},null,8,["route"])])),canvasLine3:(0,l.w5)((({record:e,column:t})=>[(0,l.Wm)(u.Z,{route:ve(e,t),height:74,width:100},null,8,["route"])])),_:1},8,["columns","data","expanded-keys","scroll","loading"])],512),[[n.F8,"detail"===ne.value]])])),_:1})])),_:1},8,["active-key"])])}}},C=a(89);const E=(0,C.Z)(S,[["__scopeId","data-v-e686cd34"]]);var _=E}}]);
//# sourceMappingURL=projectRingSame.f12e4e8c.js.map