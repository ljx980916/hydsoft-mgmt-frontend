"use strict";(self["webpackChunkoms_frontend"]=self["webpackChunkoms_frontend"]||[]).push([[158],{3277:function(e,t,a){a.r(t),a.d(t,{default:function(){return I}});var l=a(3396),o=a(7139),d=a(4870),n=a(6624),i=a(4842),r=a(4471);function s(e){return(0,r.Z)({url:"/staffCompositeCost/importStaffCompositeCost",method:"post",headers:{"Content-Type":"multipart/form-data"},data:e})}function u(e){return(0,r.Z)({url:"/staffCompositeCost/queryImportRecord",method:"get",params:e})}var m=a(6797),p=a.n(m);const c={class:"defaultPadding"},f={class:"form-upload-content"},w={style:{color:"#333"}},v={class:"form-upload-template flex-between"},g=(0,l._)("span",{style:{color:"#F76560"}}," 注意：美国实体公司的人员成本数据，需将美元转算成人民币 ",-1),h={style:{padding:"0 10px 0 10px"}},y={class:"m-b-10"},b={class:"m-b-26"},x={class:"txt m-b-10"},_={class:"txt m-b-10"},C={style:{"text-align":"center"}};var k={__name:"comprehensivePersonnelCost",setup(e){let t=new FormData;const a=(0,d.iH)(null);let r=(0,l.FN)().appContext.config.globalProperties.$bus;const m=(0,d.iH)("1");(0,l.m0)((()=>{r.emit("updateStructure",[{type:"text",color:"#333",msg:"人员综合成本 / 文件上传"}])}));const k=(0,d.qj)({month:p()(new Date).format("YYYY-MM"),upload:[]}),W=(0,d.qj)({columns:[{title:"录入月份",dataIndex:"periodNumber",width:100},{title:"上传文件名",dataIndex:"fileName",width:580},{title:"上传结果",dataIndex:"uploadResults",width:120},{title:"录入人员",dataIndex:"createOperator",width:116},{title:"录入时间",dataIndex:"createTime",width:226}],dataSource:[],loading:!1}),I=(0,d.iH)(!1),T=(0,d.iH)(!1),M=(0,d.qj)({fileName:"",uploadTime:"",failCount:"",resultTableInfo:{columns:[{title:"所在行",dataIndex:"row",width:80},{title:"错误信息",dataIndex:"msg",width:470}],data:[]}}),q=()=>{t.get("yearMonth")&&t.delete("yearMonth"),t.append("yearMonth",k.month.replaceAll("-","")),a.value&&a.value.validate().then((e=>{void 0===e&&n.Z.warning({title:"上传提醒",content:"上传后，将整体覆盖该月人员薪资数据，你还要继续吗？",hideCancel:!1,modalClass:"warningModal",onOk(){T.value=!0,s(t).then((e=>{if("200"===e.code&&(i.Z.success(e.desc||"上传成功"),k.upload=[],t.get("file")&&t.delete("file")),"300"===e.code){if(e?.data?.errorMsgList&&e.data.errorMsgList.length){I.value=!0;let{fileName:t,failCount:a,uploadTime:l,errorMsgList:o}=e.data;M.fileName=t,M.uploadTime=l,M.failCount=a,M.resultTableInfo.data=o}else i.Z.error(e.desc||"模板导入失败");k.upload=[],t.get("file")&&t.delete("file")}})).finally((()=>{T.value=!1}))}})}))},F=()=>{k.upload=[],I.value=!1,t=new FormData};(0,l.wF)((()=>{N()}));const N=()=>{u().then((e=>{W.dataSource=e.data}))},S=e=>!(k.upload.length>0)||(i.Z.error("只能上传一个文件"),Promise.reject()),U=()=>(t=new FormData,k.upload=[],!0),Z=e=>{k.upload=[e],a.value&&a.value.validateField("upload")},z=e=>{const{onProgress:a,onError:l,onSuccess:o,fileItem:d,name:n}=e;t.append(n||"file",d.file),o("success")};return(e,t)=>{const d=(0,l.up)("a-month-picker"),n=(0,l.up)("a-form-item"),i=(0,l.up)("a-upload"),r=(0,l.up)("a-button"),s=(0,l.up)("a-form"),u=(0,l.up)("a-tab-pane"),p=(0,l.up)("a-table"),N=(0,l.up)("a-tabs"),D=(0,l.up)("a-result"),P=(0,l.up)("a-modal");return(0,l.wg)(),(0,l.iD)("div",c,[(0,l.Wm)(N,{"active-key":m.value,"onUpdate:active-key":t[1]||(t[1]=e=>m.value=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{key:"1",title:"文件上传"},{default:(0,l.w5)((()=>[(0,l.Wm)(s,{model:k,style:{width:"700px",margin:"20px auto"},ref_key:"formRef",ref:a},{default:(0,l.w5)((()=>[(0,l.Wm)(n,{field:"month",label:"选择月份",rules:[{required:!0,message:"请选择月份"}],"validate-trigger":["change"]},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{"model-value":k.month,"onUpdate:model-value":t[0]||(t[0]=e=>k.month=e),style:{width:"120px"},"allow-clear":!1},null,8,["model-value"])])),_:1}),(0,l.Wm)(n,{field:"upload",label:"上传文件",rules:[{required:!0,type:"array",message:"请选择上传文件"}]},{default:(0,l.w5)((()=>[(0,l._)("div",f,[(0,l.Wm)(i,{draggable:"","file-list":k.upload,tip:"提示: 最多上传一个文件",class:"form-upload","custom-request":z,accept:".xlsx,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onBeforeUpload:S,onBeforeRemove:U,onSuccess:Z},{"file-name":(0,l.w5)((({fileItem:{name:e}})=>[(0,l._)("span",w,(0,o.zw)(e),1)])),_:1},8,["file-list"]),(0,l._)("div",v,[g,(0,l.Wm)(r,{type:"text"},{default:(0,l.w5)((()=>[(0,l.Uk)("下载人员数据上传模板")])),_:1})])])])),_:1}),(0,l.Wm)(n,null,{default:(0,l.w5)((()=>[(0,l.Wm)(r,{type:"primary",style:{width:"100px"},loading:T.value,onClick:q},{default:(0,l.w5)((()=>[(0,l.Uk)("提交")])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1}),(0,l.Wm)(u,{key:"2",title:"上传记录"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{class:"m-t-20",columns:W.columns,data:W.dataSource,bordered:!1,"column-resizable":"",scroll:{y:600},scrollbar:!1,pagination:!1,loading:W.loading},null,8,["columns","data","loading"])])),_:1})])),_:1},8,["active-key"]),(0,l.Wm)(P,{visible:I.value,"onUpdate:visible":t[2]||(t[2]=e=>I.value=e),title:"上传结果","title-align":"start",width:"755px"},{footer:(0,l.w5)((()=>[(0,l._)("div",C,[(0,l.Wm)(r,{type:"primary",onClick:F},{default:(0,l.w5)((()=>[(0,l.Uk)("知道了")])),_:1})])])),default:(0,l.w5)((()=>[(0,l._)("div",h,[(0,l._)("div",y,[(0,l.Wm)(D,{status:"error",title:"上传失败",style:{padding:"0"}})]),(0,l._)("div",b,[(0,l._)("div",x,"文件名称："+(0,o.zw)(M.fileName),1),(0,l._)("div",_,"上传时间："+(0,o.zw)(M.uploadTime),1)]),(0,l.Wm)(p,{columns:M.resultTableInfo.columns,data:M.resultTableInfo.data,"column-resizable":"",bordered:{wrapper:!0,cell:!0},pagination:!1,scroll:{x:"100%",y:"120px"}},null,8,["columns","data"])])])),_:1},8,["visible"])])}}};const W=k;var I=W}}]);
//# sourceMappingURL=comprehensivePersonnelCost.2dc5d02b.js.map