"use strict";(self["webpackChunkoms_frontend"]=self["webpackChunkoms_frontend"]||[]).push([[53],{5343:function(e,a,t){t.d(a,{I6:function(){return n},g1:function(){return l},vl:function(){return o}});const l=[{title:"工号",dataIndex:"workNo"},{title:"姓名",dataIndex:"name",slotName:"name"},{title:"所属部门",dataIndex:"deptName"},{title:"邮箱",dataIndex:"email"},{title:"账户状态",dataIndex:"flag",slotName:"flag_view"},{title:"操作",dataIndex:"action",slotName:"action"}],n=[{title:"菜单名称",dataIndex:"name",key:"name",width:"20%"},{title:"图标",dataIndex:"icon",key:"icon"},{title:"类型",dataIndex:"type",key:"type",slotName:"type_view"},{title:"排序号",dataIndex:"sort",key:"sort"},{title:"URL",dataIndex:"url",key:"url"},{title:"授权标识",dataIndex:"perms",key:"perms"},{title:"操作",dataIndex:"action",key:"action",slotName:"action"}],o=[{title:"角色名称",dataIndex:"name"},{title:"备注",dataIndex:"remarks"},{title:"角色编码",dataIndex:"code"},{title:"创建时间",dataIndex:"createTime",width:200},{title:"操作",dataIndex:"action",slotName:"action"}]},729:function(e,a,t){t.d(a,{Z:function(){return v}});t(7658);var l=t(3396),n=t(7139),o=t(4870),i=t(5343),d=t(4842),u=t(4239);const r=e=>((0,l.dD)("data-v-53477c82"),e=e(),(0,l.Cn)(),e),m={class:"m-b-20"},s={class:"flex-between",style:{height:"40px"}},c={class:"tool-grid"},p={key:0},g=r((()=>(0,l._)("span",null,"只看我的",-1))),k={key:0,class:"red"},w={key:1,class:"green"};var f={__name:"tableContainer",props:{tabs:{type:Array,default:()=>[]},chekedValue:{type:String,default:""},tableColumns:{type:Array,default:()=>[]},tableData:{type:Array,default:()=>[]},menuName:{type:String,default:""},loading:{type:Boolean,default:!1},scrollY:{type:String,default:"600px"},setColumns:{type:Array,default:()=>[]},switchStatus:{type:Boolean,default:!1},exportExcel:{type:String,default:""},paginationTotal:{type:Number,default:10},paginationCurrent:{type:Number,default:1},paginationPageSize:{type:Number,default:10}},emits:["switchClick","paginationCurrentChange","paginationPageSizeChange","handleEdit","handleDeleteMenu","handleUpdateFlag","columnOK","radioChange"],setup(e,{emit:a}){const t=e,r=(0,u.Ls)().getPermission,f=(0,o.qj)({tableColumns:[{title:"自定义列1",dataIndex:"customColumn1",width:200},{title:"自定义列2",dataIndex:"customColumn2",width:200},{title:"自定义列3",dataIndex:"customColumn3",width:200},{title:"自定义列4",dataIndex:"customColumn4",width:200},{title:"自定义列5",dataIndex:"customColumn5",width:200},{title:"自定义列6",dataIndex:"customColumn6",width:200}],tableData:[]}),h=(0,o.iH)(!1),y=(0,o.iH)([]),v=(0,o.iH)([]),_=(0,o.iH)(i.g1);let b=i.g1.filter((e=>"action"!==e.dataIndex))||[];const C=()=>{h.value=!0},x=e=>{v.value=e},S=()=>{let e=JSON.parse(localStorage.getItem("userListColumns"));if(e)_.value=e,y.value=e.map((e=>e.dataIndex));else{var a=[];b.forEach((e=>{a.push(e.dataIndex),y.value=a}))}};S();const I=()=>{if(1===y.value.length&&"action"===y.value[0])return d.Z.error("至少选择一项");a("columnOK",y.value),h.value=!1},U=e=>{a("switchClick",!e)},N=e=>{a("paginationCurrentChange",e)},W=e=>{a("paginationPageSizeChange",e)},q=(e,t)=>{a("handleEdit",e,t)},z=e=>{a("handleDeleteMenu",e)},j=e=>{a("handleDetail",e)},D=e=>{a("handleUpdateFlag",e)},V=e=>{a("radioChange",e)};return(a,i)=>{const d=(0,l.up)("a-radio"),u=(0,l.up)("a-radio-group"),v=(0,l.up)("a-switch"),_=(0,l.up)("icon-download"),b=(0,l.up)("a-button"),S=(0,l.up)("icon-home"),H=(0,l.up)("a-popconfirm"),Z=(0,l.up)("a-divider"),E=(0,l.up)("a-table"),P=(0,l.up)("a-checkbox"),T=(0,l.up)("a-checkbox-group"),O=(0,l.up)("a-modal");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",null,[(0,l._)("div",m,[(0,l._)("div",s,[(0,l.Wm)(u,{type:"button",size:"large","model-value":t.chekedValue,onChange:V},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.tabs,(e=>((0,l.wg)(),(0,l.j4)(d,{value:e.key},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["model-value"]),(0,l.WI)(a.$slots,"default")]),(0,l._)("div",null,[(0,l._)("div",c,["USER"===t.menuName?((0,l.wg)(),(0,l.iD)("div",p,[(0,l.Wm)(v,{value:e.switchStatus,onChange:U},{checked:(0,l.w5)((()=>[(0,l.Uk)("ON")])),unchecked:(0,l.w5)((()=>[(0,l.Uk)("OFF")])),_:1},8,["value"]),g])):(0,l.kq)("",!0),"USER"===t.menuName?((0,l.wg)(),(0,l.j4)(b,{key:1,type:"primary"},{icon:(0,l.w5)((()=>[(0,l.Wm)(_)])),default:(0,l.w5)((()=>[(0,l.Uk)("导出excel")])),_:1})):(0,l.kq)("",!0),"USER"===t.menuName?((0,l.wg)(),(0,l.j4)(b,{key:2,class:"config",type:"primary",onClick:C},{icon:(0,l.w5)((()=>[(0,l.Wm)(S)])),default:(0,l.w5)((()=>[(0,l.Uk)("配置列")])),_:1})):(0,l.kq)("",!0)])])])]),(0,l._)("div",null,[(0,l.Wm)(E,{columns:t.tableColumns.length&&t.tableColumns||f.tableColumns,data:t.tableData.length&&t.tableData||f.tableData,"column-resizable":"",bordered:!1,scroll:{x:"100%",y:t.scrollY},scrollbar:!1,loading:t.loading,pagination:{total:e.paginationTotal,current:e.paginationCurrent,pageSize:e.paginationPageSize,showTotal:!0,showPageSize:!0,showJumper:!0,onChange:N,onPageSizeChange:W}},{type_view:(0,l.w5)((({record:e})=>[(0,l._)("div",null,(0,n.zw)(0===e.type?"目录":1===e.type?"菜单":"按钮"),1)])),role_view:(0,l.w5)((({record:e})=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.roles,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},(0,n.zw)(e.name),1)))),128))])),flag_view:(0,l.w5)((({record:e})=>[0===e.flag?((0,l.wg)(),(0,l.iD)("span",k,"禁用")):(0,l.kq)("",!0),1===e.flag?((0,l.wg)(),(0,l.iD)("span",w,"启用")):(0,l.kq)("",!0)])),action:(0,l.w5)((({record:e})=>[(0,l.Wm)(H,{content:"你确定要启用这个用户吗?",type:"error",onOk:a=>D(e)},{default:(0,l.w5)((()=>["user"==t.menuName&&0===e.flag?((0,l.wg)(),(0,l.j4)(b,{key:0,type:"text"},{default:(0,l.w5)((()=>[(0,l.Uk)("启用")])),_:1})):(0,l.kq)("",!0)])),_:2},1032,["onOk"]),"user"==t.menuName&&0===e.flag?((0,l.wg)(),(0,l.j4)(Z,{key:0,direction:"vertical"})):(0,l.kq)("",!0),"user"==t.menuName&&0===e.flag?((0,l.wg)(),(0,l.j4)(b,{key:1,type:"text",style:{color:"#999999"}},{default:(0,l.w5)((()=>[(0,l.Uk)("禁用")])),_:1})):(0,l.kq)("",!0),"user"==t.menuName&&1===e.flag?((0,l.wg)(),(0,l.j4)(b,{key:2,type:"text",style:{color:"#999999"}},{default:(0,l.w5)((()=>[(0,l.Uk)("启用")])),_:1})):(0,l.kq)("",!0),"user"==t.menuName&&1===e.flag?((0,l.wg)(),(0,l.j4)(Z,{key:3,direction:"vertical"})):(0,l.kq)("",!0),(0,l.Wm)(H,{content:"你确定要禁用这个用户吗?",type:"error",onOk:a=>D(e)},{default:(0,l.w5)((()=>["user"==t.menuName&&1===e.flag?((0,l.wg)(),(0,l.j4)(b,{key:0,type:"text"},{default:(0,l.w5)((()=>[(0,l.Uk)("禁用")])),_:1})):(0,l.kq)("",!0)])),_:2},1032,["onOk"]),"USER"==t.menuName?((0,l.wg)(),(0,l.j4)(b,{key:4,type:"text",onClick:a=>j(e,"view")},{default:(0,l.w5)((()=>[(0,l.Uk)("查看")])),_:2},1032,["onClick"])):(0,l.kq)("",!0),"user"==t.menuName?((0,l.wg)(),(0,l.j4)(Z,{key:5,direction:"vertical"})):(0,l.kq)("",!0),(0,o.SU)(r).includes("menu:edit")&&"admin"!==e.code?((0,l.wg)(),(0,l.j4)(b,{key:6,type:"text",onClick:a=>q(e,"edit")},{default:(0,l.w5)((()=>[(0,l.Uk)(" 编辑 ")])),_:2},1032,["onClick"])):(0,l.kq)("",!0),"menu"==t.menuName||"role"==t.menuName&&"admin"!==e.code?((0,l.wg)(),(0,l.j4)(Z,{key:7,direction:"vertical"})):(0,l.kq)("",!0),(0,l.Wm)(H,{content:"确定要删除吗?",type:"error",onOk:a=>z(e)},{default:(0,l.w5)((()=>[(0,o.SU)(r).includes("menu:delete")&&("menu"==t.menuName||"role"==t.menuName&&"admin"!==e.code)?((0,l.wg)(),(0,l.j4)(b,{key:0,type:"text"},{default:(0,l.w5)((()=>[(0,l.Uk)(" 删除 ")])),_:1})):(0,l.kq)("",!0)])),_:2},1032,["onOk"])])),_:1},8,["columns","data","scroll","loading","pagination"])]),(0,l.Wm)(O,{visible:h.value,"onUpdate:visible":i[1]||(i[1]=e=>h.value=e),title:"选择表格项"},{footer:(0,l.w5)((()=>[(0,l.Wm)(b,{type:"primary",onClick:I},{default:(0,l.w5)((()=>[(0,l.Uk)("确定")])),_:1})])),default:(0,l.w5)((()=>[(0,l.Wm)(T,{onChange:x,modelValue:y.value,"onUpdate:modelValue":i[0]||(i[0]=e=>y.value=e)},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.setColumns,(e=>((0,l.wg)(),(0,l.j4)(P,{key:e.dataIndex,value:e.dataIndex},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.title),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["visible"])])}}},h=t(89);const y=(0,h.Z)(f,[["__scopeId","data-v-53477c82"]]);var v=y},6699:function(e,a,t){t.r(a),t.d(a,{default:function(){return _}});t(7658);var l=t(3396),n=t(4870),o=t(5343),i=t(4471);function d(e){return(0,i.Z)({url:"/system/role/list?code="+e.code+"&pageNum="+e.pageNum+"&pageSize="+e.pageSize,method:"get"})}function u(e){return(0,i.Z)({url:"/system/role/save",method:"post",data:e})}function r(e){return(0,i.Z)({url:"/system/role/update",method:"put",data:e})}function m(e){return(0,i.Z)({url:"/system/role/delete?roleId="+e.id,method:"delete"})}function s(e){return(0,i.Z)({url:"/system/role/info?roleId="+e.id,method:"get"})}var c=t(7981),p=t(4842),g=t(729),k=t(4239);const w={class:"defaultPadding"},f=(0,l._)("span",null,"角色编码：",-1),h={class:"m-t-20"};var y={__name:"roleManage",setup(e){const a=(0,k.Ls)().getPermission;let t=(0,l.FN)().appContext.config.globalProperties.$bus;(0,l.wF)((()=>{t.emit("updateStructure",[{type:"text",color:"#333",msg:"角色列表"}])}));const i=(0,n.iH)(""),y=(0,n.qj)({columns:o.vl,dataSource:[],loading:!1,pagination:{pageNum:1,pageSize:10,total:0},menuName:"role"}),v=(0,n.iH)(!1),_=(0,n.qj)({name:"",code:"",remarks:""}),b=(0,n.iH)([]),C=(0,n.iH)([]),x=(0,n.iH)(""),S=(0,n.iH)([]),I=(0,n.iH)(),U=e=>{const a=[];return e.forEach((e=>{let t={title:e.name,key:e.id};e.children&&e.children.length?(t.children=U(e.children),a.push(t)):a.push(t)})),a},N=()=>{y.loading=!0;let e={code:i.value,pageNum:y.pagination.pageNum,pageSize:y.pagination.pageSize};d(e).then((e=>{"000000000000"===e.code&&(e.data.list.forEach(((e,a)=>{e.key=a})),y.dataSource=e.data.list,y.pagination.total=Number(e.data.total)),y.loading=!1}))};N();const W=()=>{(0,c.pb)().then((e=>{if("000000000000"===e.code){let a=[];e.data.forEach((t=>{t.children=[],t.key=t.id,"000000"===t.parentId&&a.push(t),e.data.forEach((e=>{e.parentId===t.id&&t.children.push(e)}))})),C.value=U(a.slice())}}))};W();const q=()=>{N()},z=()=>{i.value="",N()},j=(e,a)=>{I.value.resetFields(),v.value=!0,x.value="new"===a?"":e.id,"edit"===a&&s(e).then((e=>{_.name=e.data.name,_.code=e.data.code,_.remarks=e.data.remarks,_.isShowTab=e.data.isShowTab;let a=[];S.value=e.data.menuIdList,e.data.menuIdList.forEach((e=>{D(e,C.value,a)})),b.value=a}))},D=(e,a,t)=>{a=(0,n.IU)(a),a.forEach((a=>{a.key===e?a.children||t.push(a.key):a.children&&a.children.length>0&&D(e,a.children,t)}))},V=e=>{m(e).then((e=>{"000000000000"===e.code?(p.Z.success("删除成功!"),N()):p.Z.error(e.message)}))},H=()=>{v.value=!1},Z=()=>{if(0===S.value.length)return void p.Z.error("请选择菜单权限");let e=(0,n.IU)(_);e.id=x.value,e.menuIdList=S.value,I.value.validate((a=>{a||(e.isShowTab=e.isShowTab?1:0,""===e.id?u(e).then((e=>{"000000000000"===e.code?(p.Z.success("新建成功!"),N()):p.Z.error(e.message)})):r(e).then((e=>{"000000000000"===e.code?(p.Z.success("更新成功!"),N()):p.Z.error(e.message)})),v.value=!1)}))},E=(e,a)=>{let t=[];t=t.concat(e).concat(a.halfCheckedKeys),S.value=t},P=e=>{y.pagination.pageNum=e,N()},T=e=>{y.pagination.pageSize=e,N()};return(e,t)=>{const o=(0,l.up)("a-input"),d=(0,l.up)("icon-search"),u=(0,l.up)("a-button"),r=(0,l.up)("icon-refresh"),m=(0,l.up)("a-space"),s=(0,l.up)("icon-plus"),c=(0,l.up)("a-form-item"),p=(0,l.up)("a-radio"),k=(0,l.up)("a-radio-group"),x=(0,l.up)("a-tree"),S=(0,l.up)("a-form"),U=(0,l.up)("a-modal");return(0,l.wg)(),(0,l.iD)("div",w,[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[f,(0,l.Wm)(o,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),placeholder:"请输入角色编码",class:"w-200"},null,8,["modelValue"]),(0,l.Wm)(u,{class:"m-l-16",type:"primary",onClick:q},{icon:(0,l.w5)((()=>[(0,l.Wm)(d)])),default:(0,l.w5)((()=>[(0,l.Uk)("搜索")])),_:1}),(0,l.Wm)(u,{class:"m-l-8",onClick:z},{icon:(0,l.w5)((()=>[(0,l.Wm)(r)])),default:(0,l.w5)((()=>[(0,l.Uk)("重置")])),_:1})])),_:1}),(0,l._)("div",h,[(0,n.SU)(a).includes("role:add")?((0,l.wg)(),(0,l.j4)(u,{key:0,type:"primary",onClick:t[1]||(t[1]=e=>j({},"new"))},{icon:(0,l.w5)((()=>[(0,l.Wm)(s)])),default:(0,l.w5)((()=>[(0,l.Uk)("新建角色")])),_:1})):(0,l.kq)("",!0)]),(0,l.Wm)(g.Z,{class:"m-t-20","column-resizable":"",scroll:{y:600},scrollbar:!1,loading:y.loading,paginationTotal:y.pagination.total,paginationPageSize:y.pagination.pageSize,paginationCurrent:y.pagination.pageNum,tableColumns:y.columns,"table-data":y.dataSource,"menu-name":y.menuName,onHandleEdit:j,onHandleDeleteMenu:V,onPaginationCurrentChange:P,onPaginationPageSizeChange:T},null,8,["loading","paginationTotal","paginationPageSize","paginationCurrent","tableColumns","table-data","menu-name"]),(0,l.Wm)(U,{mask:!0,visible:v.value,"onUpdate:visible":t[7]||(t[7]=e=>v.value=e),title:"添加角色"},{footer:(0,l.w5)((()=>[(0,l.Wm)(u,{onClick:H},{default:(0,l.w5)((()=>[(0,l.Uk)("取消")])),_:1}),(0,l.Wm)(u,{type:"primary",onClick:Z},{default:(0,l.w5)((()=>[(0,l.Uk)("确定")])),_:1})])),default:(0,l.w5)((()=>[(0,l.Wm)(S,{model:_,ref_key:"formRef",ref:I},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{field:"name",label:"角色名称",rules:[{required:!0,message:"请输入角色名称"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{type:"text",placeholder:"请输入角色名称",modelValue:_.name,"onUpdate:modelValue":t[2]||(t[2]=e=>_.name=e)},null,8,["modelValue"])])),_:1}),(0,l.Wm)(c,{field:"code",label:"角色编码",rules:[{required:!0,message:"请输入角色编码"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{type:"text",placeholder:"请输入角色编码",modelValue:_.code,"onUpdate:modelValue":t[3]||(t[3]=e=>_.code=e)},null,8,["modelValue"])])),_:1}),(0,l.Wm)(c,{field:"remarks",label:"备注",rules:[{required:!0,message:"请输入备注"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{type:"text",placeholder:"请输入备注",modelValue:_.remarks,"onUpdate:modelValue":t[4]||(t[4]=e=>_.remarks=e)},null,8,["modelValue"])])),_:1}),(0,l.Wm)(c,{field:"isShowTab",label:"显示页签",rules:[{required:!0,message:"请选择是否显示页签"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{"model-value":_.isShowTab,"onUpdate:model-value":t[5]||(t[5]=e=>_.isShowTab=e),style:{"margin-top":"10px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{value:!0},{default:(0,l.w5)((()=>[(0,l.Uk)("是")])),_:1}),(0,l.Wm)(p,{value:!1},{default:(0,l.w5)((()=>[(0,l.Uk)("否")])),_:1})])),_:1},8,["model-value"])])),_:1}),(0,l.Wm)(c,{field:"defaultCheckedList",label:"授权菜单"},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{checkable:!0,checkStrictly:!1,data:C.value,"checked-keys":b.value,"onUpdate:checked-keys":t[6]||(t[6]=e=>b.value=e),onCheck:E},null,8,["data","checked-keys"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"])])}}};const v=y;var _=v}}]);
//# sourceMappingURL=roleManage.a385ae67.js.map