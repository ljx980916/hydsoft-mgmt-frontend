{"version":3,"file":"js/comprehensivePersonnelCost.2dc5d02b.js","mappings":"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","sources":["webpack://oms-frontend/./src/api/staffCompositeCost.js","webpack://oms-frontend/./src/views/dataManagement/comprehensivePersonnelCost.vue","webpack://oms-frontend/./src/views/dataManagement/comprehensivePersonnelCost.vue?98ff"],"sourcesContent":["import request from '@/utils/request'\n\nexport function importStaffCompositeCost (parameter) {\n    return request({\n        url : '/staffCompositeCost/importStaffCompositeCost',\n        method :'post',\n        headers : {\n            'Content-Type': 'multipart/form-data',\n        },\n        data : parameter\n    })\n}\n\nexport function queryImportRecord (parameter) {\n    return request({\n        url: '/staffCompositeCost/queryImportRecord',\n        method: 'get',\n        params: parameter\n    })\n}\n","<template>\n    <div class=\"defaultPadding\">\n        <a-tabs v-model:active-key=\"activeTab\">\n            <a-tab-pane key=\"1\" title=\"文件上传\">\n                <a-form :model=\"form\" :style=\"{ width: '700px',margin :'20px auto' }\" ref=\"formRef\">\n                    <a-form-item \n                        field=\"month\" \n                        label=\"选择月份\"\n                        :rules=\"[{required:true,message:'请选择月份'}]\"\n                        :validate-trigger=\"['change']\"\n                    >\n                        <a-month-picker v-model:model-value=\"form.month\" style=\"width: 120px;\" :allow-clear=\"false\" />\n                    </a-form-item>\n                    <a-form-item \n                        field=\"upload\" \n                        label=\"上传文件\"\n                        :rules=\"[{required:true, type:'array' ,message:'请选择上传文件'}]\"\n                    >\n                        <div class=\"form-upload-content\">\n                            <a-upload \n                                draggable \n                                :file-list=\"form.upload\"\n                                tip=\"提示: 最多上传一个文件\"\n                                class=\"form-upload\"\n                                :custom-request=\"customRequest\"\n                                accept=\".xlsx,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document\"\n                                @before-upload=\"onBeforeUpload\"\n                                @before-remove=\"onBeforeRemove\"\n                                @success=\"uploadSuccess\"\n                            >\n                                <template #file-name=\"{fileItem :{name}}\">\n                                    <span style=\"color: #333;\">\n                                        {{ name }}\n                                    </span>\n                                </template>\n                            </a-upload>\n                            <div class=\"form-upload-template flex-between\">\n                                <span style=\"color: #F76560;\">\n                                    注意：美国实体公司的人员成本数据，需将美元转算成人民币\n                                </span>\n                                <a-button type=\"text\">下载人员数据上传模板</a-button>\n                            </div>\n                        </div>\n                    </a-form-item>\n                    <a-form-item>\n                        <a-button type=\"primary\" style=\"width:100px\" :loading=\"uplaodLoading\" @click=\"handleSubmit\">提交</a-button>\n                    </a-form-item>\n                </a-form>\n            </a-tab-pane>\n            <a-tab-pane key=\"2\" title=\"上传记录\">\n                <a-table\n                    class=\"m-t-20\"\n                    :columns=\"dataContent.columns\"\n                    :data=\"dataContent.dataSource\"\n                    :bordered=\"false\"\n                    column-resizable \n                    :scroll=\"{y:600}\"\n                    :scrollbar=\"false\" \n                    :pagination=\"false\"\n                    :loading = \"dataContent.loading\"\n                >\n                </a-table>\n            </a-tab-pane>\n        </a-tabs>\n        <a-modal v-model:visible=\"reslultModalVisible\" title=\"上传结果\" title-align=\"start\" width=\"755px\">\n            <div style=\"padding: 0 10px 0 10px;\">\n                <div class=\"m-b-10\">\n                    <a-result status=\"error\" title=\"上传失败\" style=\"padding: 0;\">\n                    </a-result>\n                </div>\n                <div class=\"m-b-26\">\n                    <div class=\"txt m-b-10\">文件名称：{{ resultPageInfo.fileName }}</div>\n                    <div class=\"txt m-b-10\">上传时间：{{ resultPageInfo.uploadTime }}</div>\n                    <!-- <div class=\"txt\">导入失败员工：{{ resultPageInfo.failCount }}个</div> -->\n                </div>\n                <a-table \n                    :columns=\"resultPageInfo.resultTableInfo.columns\" \n                    :data=\"resultPageInfo.resultTableInfo.data\"\n                    column-resizable \n                    :bordered=\"{wrapper: true, cell: true}\"\n                    :pagination=\"false\"\n                    :scroll=\"{x:'100%',y:'120px'}\" \n                >\n\n                </a-table>\n            </div>\n            <template #footer>\n                <div style=\"text-align: center;\">\n                    <a-button type=\"primary\" @click=\"resultModalClick\">知道了</a-button>\n                </div>\n            </template>\n        </a-modal>\n    </div>\n</template>\n\n<script setup>\nimport { reactive,ref,watchEffect,onBeforeMount } from 'vue'\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nimport { Modal,Message } from '@arco-design/web-vue';\nimport { importStaffCompositeCost,queryImportRecord } from '@/api/staffCompositeCost';\nimport moment from 'moment'\nlet formData = new FormData();\nconst formRef = ref(null)\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus\n\n/************** 页面路径********************* */\nconst activeTab = ref('1')\nwatchEffect(()=>{\n    $bus.emit('updateStructure',[{type : 'text',color : '#333',msg : '人员综合成本 / 文件上传'}])\n})\n/************** 页面路径********************* */\n\n/****************** 文件上传数据**************************** */\nconst form = reactive({\n    month : moment(new Date()).format('YYYY-MM'),\n    upload : []\n})\n/****************** 文件上传数据**************************** */\n\nconst dataContent = reactive({\n    columns : [\n        {\n            title : '录入月份',\n            dataIndex : 'periodNumber',\n            width : 100\n        },\n        {\n            title : '上传文件名',\n            dataIndex : 'fileName',\n            width : 580\n        },\n        {\n            title : '上传结果',\n            dataIndex : 'uploadResults',\n            width : 120\n        },\n        {\n            title : '录入人员',\n            dataIndex : 'createOperator',\n            width : 116\n        },\n        {\n            title : '录入时间',\n            dataIndex : 'createTime',\n            width : 226\n        },\n    ],\n    dataSource : [],\n    loading : false\n})\n\n/******************* 文件上传结果Modal***************************** */\nconst reslultModalVisible = ref(false)\nconst uplaodLoading = ref(false)\nconst resultPageInfo = reactive({\n    fileName : '',\n    uploadTime : '',\n    failCount : '',\n    resultTableInfo : {\n        columns : [\n            {\n                title : '所在行',\n                dataIndex : 'row',\n                width : 80\n            },\n            {\n                title : '错误信息',\n                dataIndex : 'msg',\n                width : 470\n            },\n        ],\n        data : []\n    }\n})\nconst handleSubmit = () => {\n    if(formData.get('yearMonth'))formData.delete('yearMonth')\n    formData.append('yearMonth',form.month.replaceAll('-',''))\n    formRef.value && formRef.value.validate().then(err=>{\n        if(err === undefined){\n            Modal.warning({\n                title: '上传提醒',\n                content: '上传后，将整体覆盖该月人员薪资数据，你还要继续吗？',\n                hideCancel :false,\n                modalClass : 'warningModal',\n                onOk(){\n                    uplaodLoading.value = true\n                    importStaffCompositeCost(formData).then(res=>{\n                        if(res.code === '200'){\n                            Message.success(res.desc || '上传成功')\n                            form.upload = []\n                            if(formData.get('file'))formData.delete('file')\n                        }\n                        if(res.code === '300'){\n                            if(res?.data?.errorMsgList && res.data.errorMsgList.length){\n                                reslultModalVisible.value = true\n                                let { fileName ,failCount,uploadTime,errorMsgList } = res.data\n                                resultPageInfo.fileName = fileName\n                                resultPageInfo.uploadTime = uploadTime\n                                resultPageInfo.failCount = failCount\n                                resultPageInfo.resultTableInfo.data = errorMsgList\n                            }else {\n                                Message.error(res.desc || '模板导入失败')\n                            }\n                            form.upload = []\n                            if(formData.get('file'))formData.delete('file')\n                        }\n                    }).finally(()=>{\n                        uplaodLoading.value = false\n                    })\n                }\n            });\n            \n        }\n    })\n    \n    \n    };\nconst resultModalClick = ()=>{\n    form.upload = []\n    reslultModalVisible.value = false\n    formData = new FormData()\n}\n/******************* 文件上传结果Modal***************************** */\n\n/******************** 请求上传记录数据************************** */\nonBeforeMount(()=>{\n    uploadRecord()\n})\nconst uploadRecord = ()=>{\n    queryImportRecord().then(res=>{\n        dataContent.dataSource = res.data\n    })\n}\n/******************** 请求上传记录数据************************** */\n\n/******************* 文件上传相关方法****************************** */\nconst onBeforeUpload = file =>{\n    if(form.upload.length > 0){\n        Message.error('只能上传一个文件')\n        return Promise.reject()\n    }\n    return true\n}\nconst onBeforeRemove = ()=>{\n    formData = new FormData()\n    form.upload = []\n    return true\n}\n\nconst uploadSuccess = fileItem =>{\n    form.upload = [fileItem]\n    formRef.value && formRef.value.validateField('upload')\n}\nconst customRequest = (option)=>{\n    const {onProgress, onError, onSuccess, fileItem, name} = option\n    formData.append(name || 'file', fileItem.file);\n    onSuccess('success')\n}\n/******************* 文件上传相关方法****************************** */\n\n</script>\n\n<style lang=\"scss\">\n.form-upload-content{\n    position: relative;\n    width: 100%;\n    .form-upload-template{\n        position: absolute;\n        left: 0;\n        top: 180px;\n        font-size: 12px;\n        width: 100%;\n    }\n}\n.form-upload .arco-upload-list.arco-upload-list-type-text, .arco-upload-list.arco-upload-list-type-picture{\n    margin-top: 38px;\n}\n.txt{\n    color: #333;\n    font-size: 14px;\n}\n.warningModal .arco-modal-header .arco-modal-title-icon svg{\n    color: rgb(var(--warning-5));\n}\n</style>","import script from \"./comprehensivePersonnelCost.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./comprehensivePersonnelCost.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./comprehensivePersonnelCost.vue?vue&type=style&index=0&id=ece1d924&lang=scss\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["importStaffCompositeCost","parameter","request","url","method","headers","data","queryImportRecord","params","formData","FormData","formRef","ref","$bus","getCurrentInstance","appContext","config","globalProperties","activeTab","watchEffect","emit","type","color","msg","form","reactive","month","moment","Date","format","upload","dataContent","columns","title","dataIndex","width","dataSource","loading","reslultModalVisible","uplaodLoading","resultPageInfo","fileName","uploadTime","failCount","resultTableInfo","handleSubmit","get","delete","append","replaceAll","value","validate","then","err","undefined","Modal","warning","content","hideCancel","modalClass","onOk","res","code","Message","success","desc","errorMsgList","length","error","finally","resultModalClick","onBeforeMount","uploadRecord","onBeforeUpload","file","Promise","reject","onBeforeRemove","uploadSuccess","fileItem","validateField","customRequest","option","onProgress","onError","onSuccess","name","__exports__"],"sourceRoot":""}