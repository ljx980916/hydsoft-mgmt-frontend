"use strict";(self["webpackChunkoms_frontend"]=self["webpackChunkoms_frontend"]||[]).push([[964],{4851:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});var l=a(3396),n=(a(7658),a(9242)),d=a(4870),i=a(7139),r=a(4471);function o(e){return(0,r.Z)({url:"/calendarEvent/getDeptTree",method:"get",params:e})}const u=e=>((0,l.dD)("data-v-16f71d42"),e=e(),(0,l.Cn)(),e),s={class:"relative"},c={ref:"treeContainer"},p=u((()=>(0,l._)("div",{class:"mask"},null,-1)));function h(e,t,a,n,d,i){return(0,l.wg)(),(0,l.iD)("div",s,[(0,l._)("div",c,null,512),p])}const m=new Map([[1,"#6587F6"],[2,"#E8ECFF"],[3,"#F6F8FC"],[4,"#FFFFFF"]]);var f=(0,l.aZ)({name:"IndentedTree",props:{treeData:{type:Object,required:!0},width:{type:Number,default:300},scale:{type:Number,default:1},nodeName:{type:String,default:"name"}},mounted(){this.createTree()},updated(){this.createTree()},methods:{createTree(){let e=this;var t=joint.dia.ElementView.extend({pointerdown:function(){},pointermove:function(){},pointerup:function(){}}),a=joint.dia.LinkView.extend({addVertex:function(e,t,a){},removeVertex:function(e){},pointerdown:function(e,t,a){}});const l=new joint.dia.Graph;let n=0;function d(t,a=0){let l=(""+t[e.nodeName]).split(/-/gi).length,i=0;if(i=14*a+8*(l-1),t.x=i,t.y=n,n+=40,t.children)for(let e=0;e<t.children.length;e++)d(t.children[e],a+1)}const i=JSON.parse(JSON.stringify(this.treeData));d(i,0,0);const r=new joint.dia.Paper({el:this.$refs.treeContainer,model:l,width:this.width,height:n*this.scale,gridSize:1,elementView:t,linkView:a});function o(t){let a=(""+t[e.nodeName]).split(/-/gi).length;const n=new joint.shapes.standard.Rectangle({position:{x:t.x,y:t.y},size:{width:60+38*(a-1),height:32},attrs:{body:{fill:m.get(a)||"lightblue",stroke:"#E0E6F1","stroke-width":1},label:{text:t[e.nodeName],fill:1===a?"#F5ECFE":"#778092","font-size":12,textVerticalAnchor:"0.4em"}}});if(l.addCell(n),t.children)for(let e=0;e<t.children.length;e++){const a=o(t.children[e]),d=new joint.shapes.standard.Link({source:{id:n.id},target:{id:a.id},router:{name:"manhattan"}});d.source(n,{selector:"body",anchor:{name:"bottomLeft",args:{dx:10,dy:0}}}),d.attr({line:{stroke:"#E0E6F1",strokeWidth:1,sourceMarker:{type:"path",stroke:"transparent",fill:"transparent",d:"M 10 -5 0 0 10 5 Z"},targetMarker:{type:"path",stroke:"transparent",fill:"transparent",d:"M 10 -5 0 0 10 5 Z"}}}),l.addCell(d)}return n}r.scale(this.scale),o(i)}}}),v=a(89);const g=(0,v.Z)(f,[["render",h],["__scopeId","data-v-16f71d42"]]);var w=g,x=a(4722);const y=e=>((0,l.dD)("data-v-09c5297f"),e=e(),(0,l.Cn)(),e),k={class:"radio-group-absolute"},b={key:0},_={key:1,class:"tree-org-node__text node-label"},F={class:"m-b-20"},N=y((()=>(0,l._)("span",null,"BG筛选 :   ",-1))),E=y((()=>(0,l._)("span",null,"展开至 :   ",-1)));var C={__name:"organizationalStructure",setup(e){(0,n.sj)((e=>({55497e3:(0,d.SU)(H),"56f3b19a":(0,d.SU)(U),"1c0cb714":(0,d.SU)(S)})));const t=(0,d.iH)(null),a=(0,d.iH)(null),r={id:1,label:"慧博云通",isSubdivision:!1,style:{color:"#FFFFFF",background:"#5370FF",width:"190px","letter-spacing":".2em","font-size":"13px",height:"30px","line-height":"10px"},children:[]},u=(0,d.qj)({data:{},width:304,scale:1}),s=(0,d.iH)("tree"),c=e=>{s.value=e;t.value;"list"===e&&(0,l.Y3)((()=>{if(a.value&&"600px"===g.maxHeight){let e=a.value.$el,t=window.innerHeight,l=e.getBoundingClientRect().top;g.maxHeight=t-l-30+"px"}}))},p=(0,d.iH)("all"),h=e=>{p.value=e,g.data=I(C.value,e)},m=e=>{if(1===e.id)return"rootNode"},f=(0,d.iH)("level1"),v=e=>{f.value=e,g.defaultExpandedKeys=M(C.value,e)},g=(0,d.qj)({columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",width:270},{title:"总裁室分管执行副总裁",dataIndex:"evpName",key:"evpName",width:206},{title:"业务主管副总裁",dataIndex:"bgName",key:"bgName",width:156},{title:"部门负责人",dataIndex:"empName",key:"empName",width:170},{title:"部门总人数",dataIndex:"deptTotal",key:"deptTotal",width:110,cellStyle:{"text-align":"right"},render:({record:e,column:t})=>{let a=e[t.dataIndex];return"number"===typeof a?0===a?"-":(0,l.Wm)("span",{innerHTML:(0,x.Z3)(a,0,!1)},null):a}},{title:"部门创建日期",dataIndex:"createTime",key:"createTime",width:258}],data:[],maxHeight:"600px",loading:!1,defaultExpandedKeys:[]}),y=e=>{g.defaultExpandedKeys=e};let C=(0,d.XI)([]),H=(0,d.iH)("190px"),S=(0,d.iH)("13px"),U=(0,d.iH)("30px"),W=(0,d.iH)("10px");const j=(0,d.iH)(!1),D=async()=>{j.value=!0;let e=await o();if("200"===e.code){let a=e.data.filter((e=>(""+e.deptName).startsWith("BG"))),l=[];a.forEach(((e,t)=>{r.children.push({id:e.deptName,label:e.deptName,isSubdivision:!0,dept:e.deptName}),e.id=t,l.push(e.id)})),C.value=a,(0,x.th)(a,"key","id"),g.data=a,g.defaultExpandedKeys=l;let n=t.value,d=n&&parseInt(getComputedStyle(n).width);if(a.length>2){let e=Math.floor(d/a.length);u.width=e-20;let t=+(u.width/242).toFixed(2);u.scale=t,H.value=Math.ceil(190*t)+"px",S.value=Math.ceil(13*t)+"px",U.value=Math.ceil(30*t)+"px",W.value=Math.ceil(10*t)+"px"}u.data=r}j.value=!1};(0,l.bv)((()=>{D()}));const I=(e,t)=>{if(e.length)return"all"===t?e:e.filter((e=>e.deptName===t))},M=(e,t)=>{if(e.length){let a=[];switch(t){case"all":function l(e){e.forEach((e=>{a.push(e.key),e?.children?.length&&l(e.children)}))}l(e);break;case"level1":e.forEach((e=>{a.push(e.key)}));break;case"level2":e.forEach((e=>{a.push(e.key),e?.children?.length&&e.children.forEach((e=>{a.push(e.key)}))}));break;default:a=[];break}return a}};return(e,r)=>{const o=(0,l.up)("a-radio"),x=(0,l.up)("a-radio-group"),H=(0,l.up)("a-spin"),S=(0,l.up)("vue3-tree-org"),U=(0,l.up)("a-table");return(0,l.wg)(),(0,l.iD)("div",{class:"defaultPadding relative",ref_key:"treeContainerRef",ref:t},[(0,l._)("div",k,[(0,l.wy)((0,l.Wm)(x,{type:"button","model-value":s.value,"onUpdate:model-value":r[0]||(r[0]=e=>s.value=e),onChange:c},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{value:"tree"},{default:(0,l.w5)((()=>[(0,l.Uk)("树状")])),_:1}),(0,l.Wm)(o,{value:"list"},{default:(0,l.w5)((()=>[(0,l.Uk)("列表")])),_:1})])),_:1},8,["model-value"]),[[n.F8,(0,d.SU)(C).length]])]),(0,l.wy)((0,l._)("div",{class:(0,i.C_)(["treeBox",j.value&&"flex-center-h100"])},[j.value?((0,l.wg)(),(0,l.j4)(H,{key:0,loading:j.value,dot:"",tip:"数据正在加载中...",class:"spin"},null,8,["loading"])):((0,l.wg)(),(0,l.j4)(S,{key:1,data:u.data,collapsable:!1,horizontal:!1,scalable:!1,draggable:!1,"define-menus":null,"node-draggable":!1,"default-expand-level":1/0,"label-class-name":m,toolBar:{scale:!1,restore:!1,expand:!1,zoom:!1,fullscreen:!1}},{default:(0,l.w5)((({node:e})=>[e.$$data.isSubdivision?((0,l.wg)(),(0,l.iD)("div",b,[(0,l.Wm)(w,{treeData:(0,d.SU)(C).filter((t=>t.deptName===e.$$data.dept))[0],nodeName:"deptName",width:u.width,scale:u.scale},null,8,["treeData","width","scale"])])):((0,l.wg)(),(0,l.iD)("div",_,(0,i.zw)(e.label),1))])),_:1},8,["data"]))],2),[[n.F8,"tree"===s.value]]),(0,l.wy)((0,l._)("div",null,[(0,l._)("div",F,[N,(0,l.Wm)(x,{type:"button",class:"m-r-70","model-value":p.value,"onUpdate:model-value":r[1]||(r[1]=e=>p.value=e),onChange:h},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{value:"all"},{default:(0,l.w5)((()=>[(0,l.Uk)("全部")])),_:1}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,d.SU)(C),((e,t)=>((0,l.wg)(),(0,l.j4)(o,{value:e.deptName},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.deptName),1)])),_:2},1032,["value"])))),256))])),_:1},8,["model-value"]),E,(0,l.Wm)(x,{type:"button","model-value":f.value,"onUpdate:model-value":r[2]||(r[2]=e=>f.value=e),onChange:v},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{value:"level1"},{default:(0,l.w5)((()=>[(0,l.Uk)("一级部门")])),_:1}),(0,l.Wm)(o,{value:"level2"},{default:(0,l.w5)((()=>[(0,l.Uk)("二级部门")])),_:1}),(0,l.Wm)(o,{value:"all"},{default:(0,l.w5)((()=>[(0,l.Uk)("末级部门")])),_:1})])),_:1},8,["model-value"])]),(0,l.Wm)(U,{columns:g.columns,data:g.data,bordered:{cell:!0},"column-resizable":"",scroll:{maxHeight:g.maxHeight},scrollbar:!1,pagination:!1,"expanded-keys":g.defaultExpandedKeys,loading:g.loading,ref_key:"tableRef",ref:a,onExpandedChange:y},null,8,["columns","data","scroll","expanded-keys","loading"])],512),[[n.F8,"list"===s.value]])],512)}}};const H=(0,v.Z)(C,[["__scopeId","data-v-09c5297f"]]);var S=H}}]);
//# sourceMappingURL=organizationalStructure.362a84b9.js.map