"use strict";(self["webpackChunkoms_frontend"]=self["webpackChunkoms_frontend"]||[]).push([[602],{1656:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var l=a(3396),d=(a(7658),a(7139)),n=a(9242),r=a(4870),o=a(4471);function u(e){return(0,o.Z)({url:"/empStatistics/exportEmpExcel",method:"get",params:e,responseType:"blob"})}function i(e){return(0,o.Z)({url:"/empStatistics/queryDeptCostDetail",method:"get",params:e})}function m(e){return(0,o.Z)({url:"/empStatistics/queryDeptsCostData",method:"get",params:e})}var c=a(4722),s=a(4842),p=a(6797),h=a.n(p);const f={class:"defaultPadding"},g={class:"m-b-20"},v=(0,l._)("span",null,"月份 :   ",-1),x=(0,l._)("span",null,"展开至 :   ",-1),y=["onClick"],k={class:"m-b-20"},w=(0,l._)("span",null,"成本类型 :   ",-1),b={style:{float:"right"}};var N={__name:"empStatistics",setup(e){let t=(0,l.FN)().appContext.config.globalProperties.$bus;const a=(0,r.iH)(new Date),o=()=>{W()},p=e=>e.valueOf()<h()("2023-01-01 00:00:00").valueOf(),N=(0,r.iH)("level1"),Y=(0,r.iH)("level1"),_=e=>{Y.value=e,S.defaultExpandedKeys=C(U,e)},C=(e,t)=>{if(e.length){let a=[];switch(t){case"all":function l(e){e.forEach((e=>{a.push(e.key),e?.children?.length&&l(e.children)}))}l(e);break;case"level1":e.forEach((e=>{a.push(e.key)}));break;case"level2":e.forEach((e=>{a.push(e.key),e?.children?.length&&e.children.forEach((e=>{a.push(e.key)}))}));break;default:a=[];break}return a}},S=(0,r.qj)({columns:[{title:"部门名称",dataIndex:"deptName",key:"deptName",fixed:"left",width:230,slotName:"deptName"},{title:"G+C2人数",dataIndex:"GC2Number",key:"GC2Number",width:110,cellStyle:{"text-align":"right"},render:({record:e,column:t})=>{let a=+e[t.dataIndex];return isNaN(a)||0!==a?a:"-"}},{title:"G+C2人数占比",dataIndex:"GC2Rate",key:"GC2Rate",width:110,cellStyle:{"text-align":"right"},render:({record:e,column:t})=>{let a=+e[t.dataIndex];return isNaN(a)?a:(100*a).toFixed(2)+"%"}},{title:"S人数",dataIndex:"SNumber",key:"SNumber",width:90,cellStyle:{"text-align":"right"},render:({record:e,column:t})=>{let a=+e[t.dataIndex];return isNaN(a)||0!==a?a:"-"}},{title:"S人数占比",dataIndex:"SRate",key:"SRate",width:110,cellStyle:{"text-align":"right"},render:({record:e,column:t})=>{let a=+e[t.dataIndex];return isNaN(a)?a:(100*a).toFixed(2)+"%"}},{title:"R人数",dataIndex:"RNumber",key:"RNumber",width:110,cellStyle:{"text-align":"right"},render:({record:e,column:t})=>{let a=+e[t.dataIndex];return isNaN(a)||0!==a?a:"-"}},{title:"R人数占比",dataIndex:"RRate",key:"RRate",width:110,cellStyle:{"text-align":"right"},render:({record:e,column:t})=>{let a=+e[t.dataIndex];return isNaN(a)?a:(100*a).toFixed(2)+"%"}}],data:[],maxHeight:"600px",loading:!1,defaultExpandedKeys:[]}),R=e=>{S.defaultExpandedKeys=e},I=(0,r.iH)(null);let H="";const M=(e,d)=>{if(H=d.deptName,N.value=e,"level2"===e){$();let e=[{type:"button",color:"#333",msg:`${h()(a.value).format("YYYY年MM月")}`,params:"level1"},{type:"text",color:"#333",msg:d.deptName}];t.emit("updateStructure",e),"600px"===G.maxHeight&&I.value&&(0,l.Y3)((()=>{let e=I.value.$el,t=window.innerHeight,a=e.getBoundingClientRect().top;G.maxHeight=t>900?t+130+"px":t-a-32+"px"}))}};let U=[];const W=()=>{let e={month:h()(a.value).format("YYYYMM")};S.loading=!0,m(e).then((e=>{if("200"===e.code){(0,c.th)(e.data,"key","id");let t=[];e.data.forEach((e=>{t.push(e.key)})),S.data=e.data,S.defaultExpandedKeys=t,U=e.data}else s.Z.error(e.message||"请求失败")})).catch((e=>{s.Z.error(e.message||"请求失败")})).finally((()=>{S.loading=!1}))};(0,l.wF)((()=>{W()}));const E=(0,r.iH)(null);(0,l.bv)((()=>{if(E.value){let e=E.value.$el;(0,l.Y3)((()=>{let t=window.innerHeight,a=e.getBoundingClientRect().top;S.maxHeight=t-a-32+"px"}))}t.on("goBack",(e=>{switch(N.value=e,e){case"level1":let e=[{type:"text",color:"#333",msg:`${h()(a.value).format("YYYY年MM月")}`}];t.emit("updateStructure",e);break;default:break}}))}));const F=(0,r.iH)("ALL"),L=e=>{F.value=e,$()},D=(0,r.iH)(!1),Z=()=>{D.value=!0;let e=H,t={costCenterName:"",deptName:e,month:h()(a.value).format("YYYYMM")};u(t).then((t=>{const l=new Blob([t]),d=new FileReader;d.readAsText(t,"utf-8"),d.onerror=function(){s.Z.error("导出文件失败")};const n=`${h()(a.value).format("YYYYMM")}_${e}招管销人员明细.xlsx`,r=document.createElement("a");r.download=n,r.style.display="none",r.href=URL.createObjectURL(l),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)})).catch((()=>{s.Z.error("导出失败")})).finally((()=>{D.value=!1}))},G=(0,r.qj)({columns:[{title:"部门",dataIndex:"deptName",key:"deptName",fixed:"left",width:190},{title:"姓名",dataIndex:"empName",key:"empName",width:170,slotName:"empName"},{title:"成本类型",dataIndex:"costCenterName",key:"costCenterName",width:100},{title:"上级领导",dataIndex:"deptManager",key:"deptManager",width:110},{title:"城市",dataIndex:"workPlace",key:"workPlace",width:100},{title:"入职日期",dataIndex:"hireDate",key:"hireDate",width:130},{title:"管理团队人数",dataIndex:"teamCount",key:"teamCount",width:120,cellStyle:{"text-align":"right"},render:({record:e,column:t})=>{let a=e[t.dataIndex];return"number"===typeof a?(0,l.Wm)("span",{innerHTML:(0,c.Z3)(a,0,!1)},null):a}}],data:[],maxHeight:"600px",loading:!1}),$=()=>{G.loading=!0;let e={costCenterName:"ALL"===F.value?"":F.value,deptName:H,month:h()(a.value).format("YYYYMM")};i(e).then((e=>{"200"===e.code?G.data=e.data:(G.data=[],s.Z.error(e.message||"请求失败"))})).catch((e=>{G.data=[],s.Z.error(e.message||"请求失败")})).finally((()=>{G.loading=!1}))};return(0,l.m0)((()=>{t.emit("updateStructure",[{type:"text",color:"#333",msg:`${h()(a.value).format("YYYY年MM月")}`}])})),(0,l.Ah)((()=>{t.off("goBack")})),(e,t)=>{const r=(0,l.up)("a-month-picker"),u=(0,l.up)("a-radio"),i=(0,l.up)("a-radio-group"),m=(0,l.up)("a-table"),c=(0,l.up)("icon-download"),s=(0,l.up)("a-button"),h=(0,l.up)("a-popconfirm"),C=(0,l.up)("a-tag");return(0,l.wg)(),(0,l.iD)("div",f,[(0,l.wy)((0,l._)("div",null,[(0,l._)("div",g,[v,(0,l.Wm)(r,{style:{width:"130px"},"model-value":a.value,"onUpdate:model-value":t[0]||(t[0]=e=>a.value=e),class:"m-r-20","value-format":"YYYYMM","allow-clear":!1,disabledDate:p,onChange:o},null,8,["model-value"]),x,(0,l.Wm)(i,{type:"button","model-value":Y.value,"onUpdate:model-value":t[1]||(t[1]=e=>Y.value=e),onChange:_},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{value:"level1"},{default:(0,l.w5)((()=>[(0,l.Uk)("一级部门")])),_:1}),(0,l.Wm)(u,{value:"level2"},{default:(0,l.w5)((()=>[(0,l.Uk)("二级部门")])),_:1}),(0,l.Wm)(u,{value:"all"},{default:(0,l.w5)((()=>[(0,l.Uk)("末级部门")])),_:1})])),_:1},8,["model-value"])]),(0,l.Wm)(m,{columns:S.columns,data:S.data,bordered:{cell:!0},"column-resizable":"",scroll:{maxHeight:S.maxHeight},scrollbar:!1,pagination:!1,"expanded-keys":S.defaultExpandedKeys,loading:S.loading,ref_key:"level1TableRef",ref:E,onExpandedChange:R},{deptName:(0,l.w5)((({record:e})=>[(0,l._)("a",{href:"javaScript:void(0)",style:{color:"#165dff"},onClick:t=>M("level2",e)},(0,d.zw)(e.deptName),9,y)])),_:1},8,["columns","data","scroll","expanded-keys","loading"])],512),[[n.F8,"level1"===N.value]]),(0,l.wy)((0,l._)("div",null,[(0,l._)("div",k,[w,(0,l.Wm)(i,{type:"button","model-value":F.value,"onUpdate:model-value":t[2]||(t[2]=e=>F.value=e),onChange:L},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{value:"ALL"},{default:(0,l.w5)((()=>[(0,l.Uk)("ALL")])),_:1}),(0,l.Wm)(u,{value:"G"},{default:(0,l.w5)((()=>[(0,l.Uk)("G")])),_:1}),(0,l.Wm)(u,{value:"C2"},{default:(0,l.w5)((()=>[(0,l.Uk)("C2")])),_:1}),(0,l.Wm)(u,{value:"S"},{default:(0,l.w5)((()=>[(0,l.Uk)("S")])),_:1}),(0,l.Wm)(u,{value:"R"},{default:(0,l.w5)((()=>[(0,l.Uk)("R")])),_:1})])),_:1},8,["model-value"]),(0,l._)("div",b,[(0,l.Wm)(h,{content:"你确定要导出吗?",onOk:Z},{default:(0,l.w5)((()=>[(0,l.Wm)(s,{type:"primary",loading:D.value,style:{"border-radius":"4px"}},{icon:(0,l.w5)((()=>[(0,l.Wm)(c)])),default:(0,l.w5)((()=>[(0,l.Uk)("导出")])),_:1},8,["loading"])])),_:1})])]),(0,l.Wm)(m,{columns:G.columns,data:G.data,bordered:{cell:!0},"column-resizable":"",scroll:{maxHeight:G.maxHeight},scrollbar:!1,pagination:!1,loading:G.loading,ref_key:"level2TableRef",ref:I,onExpandedChange:R},{empName:(0,l.w5)((({record:e})=>[(0,l.Uk)((0,d.zw)(e.empName)+" ",1),e.isDeptHead?((0,l.wg)(),(0,l.j4)(C,{key:0,color:"#5370FF",bordered:"",style:{background:"#E6F7FF",fonSize:"12px",color:"#5370FF",marginLeft:"10px"}},{default:(0,l.w5)((()=>[(0,l.Uk)(" 部门负责人 ")])),_:1})):(0,l.kq)("",!0)])),_:1},8,["columns","data","scroll","loading"])],512),[[n.F8,"level2"===N.value]])])}}};const Y=N;var _=Y}}]);
//# sourceMappingURL=empStatistics.6a05f3f4.js.map