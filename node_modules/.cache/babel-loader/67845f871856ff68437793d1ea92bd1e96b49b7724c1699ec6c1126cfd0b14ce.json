{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw, markRaw, shallowRef } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getDepartmentRingList, queryYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport { dataAddKey, getRedNum, getLastMonth, getLastYearDay, getCurrentTime, mapDataIndex } from \"../../utils/util\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { useRouter } from \"vue-router\";\nexport default {\n  __name: 'departmentRingSame',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    let {\n      lYear\n    } = getLastMonth();\n    let {\n      lastYear,\n      lastMonth\n    } = getLastYearDay();\n    let {\n      year,\n      month\n    } = getCurrentTime();\n    let tagColumnList = useTagColumnListStore();\n    let columConfig = {};\n    const tableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"200px\",\n      loading: false\n    });\n    //同比汇总表格数据\n    const sameTotalTableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"600px\",\n      loading: false\n    });\n    //同比明细表格数据\n    const sameDetailTableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"600px\",\n      loading: false\n    });\n    const selectMonth = ref(\"3\");\n    const tableRef = ref(null);\n    const tabChangeColumInfo = reactive({\n      columnTabs: []\n    });\n    let filterShowChildrenColumn = [];\n    const chartColumMap = {\n      发薪人数: [],\n      营业收入: [],\n      销售毛利率: []\n    };\n    const chartColumnNameMap = {\n      canvasLine1: \"发薪人数\",\n      canvasLine2: \"营业收入\",\n      canvasLine3: \"销售毛利率\"\n    };\n    const tabKey = ref(\"1\");\n    const raidoGroupType = ref(\"total\");\n    onBeforeMount(() => {\n      seltColumns();\n      getList();\n      initTotalColumns();\n    });\n    onMounted(() => {\n      if (tableRef.value) {\n        let head = tableRef.value.$el;\n        nextTick(() => {\n          let innerHeight = window.innerHeight;\n          let elHeight = head.getBoundingClientRect().top;\n          tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n        });\n      }\n    });\n    // 更改环比分析/同比分析\n    const changeTabs = key => {\n      tabKey.value = key;\n    };\n    // TODO环比分析-------------------------------------------------------------\n    // 初始化\n    const seltColumns = () => {\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n      if (currentPageColumn.length) {\n        currentPageColumn[0].tier.forEach((item, index) => {\n          let tabs = [];\n          let columnTabs = [];\n          let columnHasSonTabs = [];\n          let noHiddenColumn = [];\n          let defaultColumHasSonTabs = [];\n          let defaultColumnTabs = [];\n          item.tags.forEach(jtem => {\n            tabs.push(jtem.tag);\n            jtem.columns.forEach(ktem => {\n              let {\n                col,\n                conf,\n                title\n              } = ktem;\n              conf = conf || {};\n              let columnItemConfig = {\n                title,\n                dataIndex: col,\n                align: conf.align,\n                cellStyle: {\n                  \"text-align\": conf.cellAlign\n                },\n                width: conf.width,\n                ellipsis: true,\n                headerCellClass: \"noEllipsis\",\n                slotName: col,\n                bodyCellClass: \"bodyCell\",\n                fixed: conf.fixed\n              };\n              columnItemConfig.isShow = conf.isShow;\n              columnItemConfig.render = ({\n                record,\n                column\n              }) => {\n                let cellVal = record[column.dataIndex];\n                if (!Array.isArray(cellVal)) {\n                  if (column.slotName === \"lastDeptName\") {\n                    return `<a-popover\n                    content-style={{ background: \"rgba(0,0,0,.8)\", color: \"#fff\" }}\n                    arrow-style={{ background: \"rgba(0,0,0,.8)\" }}\n                  >\n                    {{\n                      default: () =>\n                        record.leafNode == \"1\" ? (\n                          <span class=\"pointer\" style={{ color: \"#165dff\" }} onclick={() => jump(record,1)}>\n                            {record.lastDeptName}\n                          </span>\n                        ) : (\n                          <span class=\"pointer\">{record.lastDeptName}</span>\n                        ),\n                      content: () => record.deptName,\n                    }}\n                  </a-popover>`;\n                  }\n                  return '<span innerHTML={getRedNum(cellVal)}></span>';\n                } else {\n                  let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n                    name: item.month + '-' + record[item.col],\n                    value: cellVal[i]\n                  }));\n                  return '<echartContainer route={route} height={74} width={100} />';\n                }\n              };\n              if (conf.canHide === 1) {\n                if (conf.parentCol === 0) {\n                  columnTabs.push(columnItemConfig);\n                } else {\n                  columnHasSonTabs.push(columnItemConfig);\n                }\n              } else {\n                noHiddenColumn.push(columnItemConfig);\n              }\n              if (conf.parentCol === 1) {\n                defaultColumHasSonTabs.push(columnItemConfig);\n              } else {\n                defaultColumnTabs.push(columnItemConfig);\n              }\n            });\n          });\n          columConfig[\"level\" + (index + 1)] = {\n            tabs,\n            params: item.params || [],\n            columnTabs,\n            columnHasSonTabs,\n            noHiddenColumn,\n            defaultColumnTabs,\n            defaultColumHasSonTabs\n          };\n        });\n      }\n      tabChangeColumInfo.columnTabs = columConfig.level1.columnHasSonTabs;\n    };\n    // 更换表头\n    const analysiisColumn = months => {\n      let {\n        columnTabs,\n        noHiddenColumn,\n        defaultColumHasSonTabs\n      } = columConfig.level1;\n      let num = 4;\n      switch (selectMonth.value) {\n        case \"3\":\n          let children1 = [];\n          let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = item;\n            columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children1.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children1;\n          break;\n        case \"6\":\n          let children2 = [];\n          let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = item;\n            columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children2.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children2;\n          break;\n        case \"12\":\n          let children3 = [];\n          let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = item;\n            columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children3.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children3;\n          break;\n        default:\n          break;\n      }\n      Object.keys(chartColumMap).forEach(key => {\n        chartColumMap[key] = [];\n      });\n      filterShowChildrenColumn.forEach(item => {\n        if (item.children?.length) {\n          let filterShowColumns = [];\n          item.children.forEach(jtem => {\n            if (jtem.isShow === 1) {\n              filterShowColumns.push(jtem);\n            }\n            if (chartColumMap.hasOwnProperty(jtem.title)) {\n              chartColumMap[jtem.title].push({\n                month: item.title,\n                col: jtem.dataIndex\n              });\n            }\n          });\n          item.children = filterShowColumns;\n        }\n      });\n      Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return `<a href=\"javaScript:void(0)\" onClick={()=>{goRingContrastChart(record,'dept')}}>看图</a>`;\n        }\n      };\n      let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn, actionColumn];\n      tableInfo.columns = filterAllShowColumn;\n    };\n    //展开环比分析\n    const expandedChange = rowKeys => {\n      tableInfo.defaultExpandedKeys = rowKeys;\n    };\n    // 切换时间区间\n    const handleMonthChange = month => {\n      selectMonth.value = month;\n      getList();\n    };\n    // 点击标签\n    const handleTabChange = tab => {\n      switch (tab.isShow) {\n        case 0:\n          tab.isShow = 1;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 1,\n            tab\n          });\n          break;\n        case 1:\n          tab.isShow = 0;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 0,\n            tab\n          });\n          break;\n        default:\n          break;\n      }\n    };\n    // 更改高亮状态并更换表头\n    const changeShowStatus = obj => {\n      let {\n        columnTabs,\n        defaultColumHasSonTabs\n      } = columConfig.level1;\n      let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      if (filterHasSonShowColumn.length === 0) {\n        Message.error(\"至少选择一项\");\n        obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n        return;\n      }\n      if (obj.type === \"parent\") {\n        columnTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      if (obj.type === \"self\") {\n        defaultColumHasSonTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      getList();\n    };\n    // 处理趋势数据\n    const construcLine = arr => {\n      arr.forEach(item => {\n        item.colNo2 = JSON.parse(item.colNo2);\n        item.colNo3 = JSON.parse(item.colNo3);\n        item.colNo4 = JSON.parse(item.colNo4);\n        if (item.children) {\n          construcLine(item.children);\n        }\n      });\n    };\n    // 获取列表数据\n    const getList = () => {\n      tableInfo.data = [];\n      tableInfo.loading = true;\n      let arr = [];\n      const mappings = {\n        发薪人数: \"colNo1\",\n        营业收入: \"colNo2\",\n        销售毛利: \"colNo3\",\n        销售毛利率: \"colNo4\",\n        直接成本: \"colNo5\",\n        人均营业收入: \"colNo6\",\n        人均直接成本: \"colNo7\",\n        未完工项目成本: \"colNo8\",\n        招聘费用: \"colNo9\",\n        销售费用: \"colNo10\",\n        管理费用: \"colNo11\"\n      };\n      tabChangeColumInfo.columnTabs.filter(item => item.isShow === 1).forEach(item => {\n        if (mappings[item.title]) {\n          arr.push(mappings[item.title]);\n        }\n        if (item.children) {\n          item.children.forEach(jtem => {\n            if (mappings[jtem.title]) {\n              arr.push(mappings[jtem.title]);\n            }\n          });\n        }\n      });\n      const params = {\n        interval: Number(selectMonth.value),\n        dynamicHeaderParam: Array.from(new Set(arr)),\n        xAxis: 74,\n        yAxis: 100,\n        tagKey: \"linkAnalysis\"\n      };\n      getDepartmentRingList(params).then(res => {\n        if (res.code == \"200\") {\n          analysiisColumn(res.data.month);\n          construcLine(res.data.data);\n          let data = dataAddKey(res.data.data, \"key\", \"deptId\");\n          let keys = [];\n          res.data.data.forEach(item => keys.push(item.deptId));\n          tableInfo.defaultExpandedKeys = keys;\n          tableInfo.data = markRaw(data);\n        } else {\n          Message.error(res.message);\n        }\n        tableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          tableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          tableInfo.loading = false;\n        }\n      });\n    };\n    const allHeadTagList = ref([]); // 所有的标签\n    const allTableList = ref([]); // 表头数据\n    const notShowList = shallowRef([]); // 初始没显示的表头数据\n    const sameDetailTableRef = ref(null); //同比明细表格dom\n    const sameTotalTableRef = ref(null); //同比汇总表格dom\n    // TODO同比分析----汇总------------------------------------------------------\n    // 初始化表头和标签数据\n    const initTotalColumns = () => {\n      allHeadTagList.value = [];\n      allTableList.value = [];\n      notShowList.value = [];\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n      if (currentPageColumn.length) {\n        const currentColumnList = currentPageColumn[0].tier[0].tags[0].columns;\n        currentColumnList.forEach(item => {\n          const {\n            col,\n            conf,\n            title\n          } = item;\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: {\n              \"text-align\": conf.cellAlign\n            },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            isShow: conf.isShow,\n            fixed: conf.fixed\n          };\n          // 需要把部门名称的canHide改成0 level1\n          // 如果canHide=1,则push到allHeadTagList,如果isShow=1push到tableList,再配标签配点击事件，对表头进行格式处理。\n          if (conf.canHide == 1) {\n            allHeadTagList.value.push(columnItemConfig);\n          } else {\n            notShowList.value.push(columnItemConfig);\n          }\n          if (conf.fixed !== undefined) {\n            columnItemConfig.fixed = conf.fixed;\n          }\n          if (conf.parentCol == 1) {\n            allTableList.value.push(columnItemConfig);\n          }\n        });\n        if (raidoGroupType.value == \"total\") {\n          constructSameTotalColumns(allHeadTagList.value);\n        } else {\n          constructSameDetailColumns(allHeadTagList.value);\n        }\n      }\n    };\n    // 点击标签\n    const handleSameContrastTabChange = value => {\n      value.isShow = value.isShow === 0 ? 1 : 0;\n      let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n      if (filterHasSonShowColumn.length === 0) {\n        Message.error(\"至少选择一项\");\n        value.isShow = value.isShow === 0 ? 1 : 0;\n        return;\n      }\n      handleAbortRequest();\n      if (raidoGroupType.value === \"total\") {\n        constructSameTotalColumns(allHeadTagList.value);\n      } else {\n        constructSameDetailColumns(allHeadTagList.value);\n      }\n    };\n    // 构造同比汇总的表头\n    const constructSameTotalColumns = list => {\n      let tableList = list.filter(item => item.isShow === 1);\n      let createColumns = [];\n      let childrenColumns = [{\n        title: lastYear + \"/1-12\"\n      }, {\n        title: lastYear + `/1-${lastMonth}`\n      }, {\n        title: year + `/1-${lastMonth}`\n      }, {\n        title: \"同比\"\n      }];\n      let colNo = 5;\n      tableList.forEach(item => {\n        let columnConfig = {\n          title: item.title,\n          children: childrenColumns.map((jtem, i) => {\n            let childrenColumnItemConfig = {\n              title: jtem.title,\n              dataIndex: `colNo${colNo}`,\n              slotName: `colNo${colNo}`,\n              width: 110,\n              cellStyle: {\n                textAlign: 'right'\n              }\n            };\n            if (i === childrenColumns.length - 1) {\n              childrenColumnItemConfig.title = item.title.endsWith('率') ? '偏离' : jtem.title;\n            }\n            colNo++;\n            return childrenColumnItemConfig;\n          })\n        };\n        createColumns.push(columnConfig);\n      });\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return `<a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'dept')}}>看图</a>`;\n        }\n      };\n      sameTotalTableInfo.columns = [...notShowList.value, ...createColumns, actionColumn];\n      getConstructSameTotalList();\n    };\n    const sameTotalTableExpandedChange = keys => {\n      sameTotalTableInfo.defaultExpandedKeys = keys;\n    };\n\n    //跳转看图页\n    const goLookChat = (record, type) => {\n      router.push({\n        name: 'lookChart',\n        state: {\n          barChartOptions: JSON.stringify(allHeadTagList.value),\n          deptId: record.deptId,\n          sourceType: type,\n          deptName: record.deptName\n        }\n      });\n    };\n    const goRingContrastChart = (record, type) => {\n      router.push({\n        name: 'ringContrastChart',\n        state: {\n          deptName: record.deptName,\n          interval: selectMonth.value,\n          deptId: record.deptId,\n          sourceType: type\n        }\n      });\n    };\n\n    // 同比分析-----明细-------------------------------------------------------------\n    // 更改汇总/明细\n    const constructSameTabChange = value => {\n      raidoGroupType.value = value;\n      initTotalColumns();\n    };\n    // 构造同比明细的表头结构\n    const constructSameDetailColumns = list => {\n      const timeData = [];\n      let activeTableList = list.filter(item => item.isShow === 1);\n      if (month == 1) {\n        for (var i = 1; i <= 12; i++) {\n          timeData.push({\n            title: i + \"月\",\n            children: []\n          });\n        }\n      } else {\n        for (var i = 1; i <= lastMonth; i++) {\n          timeData.push({\n            title: i + \"月\",\n            children: []\n          });\n        }\n      }\n      const years = [lastYear, year];\n      let colNo = 5;\n      timeData.forEach(item => {\n        let childrenColumns = [];\n        activeTableList.forEach(jtem => {\n          years.forEach(ktem => {\n            let contrastColumnConfig = {\n              title: `${jtem.title}${ktem}`,\n              dataIndex: `colNo${colNo}`,\n              slotName: `colNo${colNo}`,\n              width: jtem.width,\n              cellStyle: toRaw(jtem.cellStyle)\n            };\n            childrenColumns.push(contrastColumnConfig);\n            colNo++;\n          });\n        });\n        item.children = childrenColumns;\n      });\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return `<a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'dept')}}>看图</a>`;\n        }\n      };\n      sameDetailTableInfo.columns = [...notShowList.value, ...timeData, actionColumn];\n      getConstructSameDetailList();\n    };\n\n    //同比分析明细表格展开/折叠\n    const detailTableExpandedChange = rowKeys => {\n      sameDetailTableInfo.defaultExpandedKeys = rowKeys;\n    };\n\n    //同比分析明细接口\n    const getConstructSameDetailList = () => {\n      let params = {\n        interval: lastMonth,\n        dynamicHeaderParam: allTableList.value.filter(item => item.isShow === 1).map(item => item.dataIndex),\n        xAxis: 74,\n        yAxis: 100,\n        tagKey: \"yoyAnalysis\",\n        type: '2'\n      };\n      sameDetailTableInfo.loading = true;\n      queryYoyAnalysis(params).then(res => {\n        if (res.code === '200') {\n          dataAddKey(res.data.data, 'key', 'deptId');\n          let expandKeys = [];\n          res.data.data.forEach(item => expandKeys.push(item.key));\n          sameDetailTableInfo.defaultExpandedKeys = expandKeys;\n          sameDetailTableInfo.data = res.data.data;\n          //计算表格不出滚动条的最大高度\n          if (sameDetailTableInfo.maxHeight === '600px') {\n            nextTick(() => {\n              if (sameDetailTableRef.value) {\n                let head = sameDetailTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameDetailTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n          }\n        } else {\n          Message.error(res.desc || '请求数据失败');\n        }\n        sameDetailTableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          sameDetailTableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          sameDetailTableInfo.loading = false;\n        }\n      });\n    };\n\n    //同比分析汇总接口\n    const getConstructSameTotalList = () => {\n      let params = {\n        interval: lastMonth,\n        dynamicHeaderParam: allTableList.value.filter(item => item.isShow === 1).map(item => item.dataIndex),\n        xAxis: 74,\n        yAxis: 100,\n        tagKey: \"yoyAnalysis\",\n        type: '1'\n      };\n      sameTotalTableInfo.loading = true;\n      queryYoyAnalysis(params).then(res => {\n        if (res.code === '200') {\n          dataAddKey(res.data.data, 'key', 'deptId');\n          let expandKeys = [];\n          res.data.data.forEach(item => expandKeys.push(item.key));\n          sameTotalTableInfo.defaultExpandedKeys = expandKeys;\n          sameTotalTableInfo.data = res.data.data;\n          //计算表格不出滚动条的最大高度\n          if (sameTotalTableInfo.maxHeight === '600px') {\n            nextTick(() => {\n              if (sameTotalTableRef.value) {\n                let head = sameTotalTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameTotalTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n          }\n        } else {\n          Message.error(res.desc || '请求数据失败');\n        }\n        sameTotalTableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          sameTotalTableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          sameTotalTableInfo.loading = false;\n        }\n      });\n    };\n    //echarts缩略图的路径信息\n    const createEchartsRoute = (record, column) => {\n      return chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n        value: record[column.dataIndex][i]\n      }));\n    };\n    // 跳转到客户\n    const jump = (record, tab) => {\n      router.push({\n        path: \"/customerRingSame\",\n        query: {\n          id: record.deptId,\n          deptName: record.deptName,\n          tab\n        }\n      });\n    };\n    const __returned__ = {\n      router,\n      get lYear() {\n        return lYear;\n      },\n      set lYear(v) {\n        lYear = v;\n      },\n      get lastYear() {\n        return lastYear;\n      },\n      set lastYear(v) {\n        lastYear = v;\n      },\n      get lastMonth() {\n        return lastMonth;\n      },\n      set lastMonth(v) {\n        lastMonth = v;\n      },\n      get year() {\n        return year;\n      },\n      set year(v) {\n        year = v;\n      },\n      get month() {\n        return month;\n      },\n      set month(v) {\n        month = v;\n      },\n      get tagColumnList() {\n        return tagColumnList;\n      },\n      set tagColumnList(v) {\n        tagColumnList = v;\n      },\n      get columConfig() {\n        return columConfig;\n      },\n      set columConfig(v) {\n        columConfig = v;\n      },\n      tableInfo,\n      sameTotalTableInfo,\n      sameDetailTableInfo,\n      selectMonth,\n      tableRef,\n      tabChangeColumInfo,\n      get filterShowChildrenColumn() {\n        return filterShowChildrenColumn;\n      },\n      set filterShowChildrenColumn(v) {\n        filterShowChildrenColumn = v;\n      },\n      chartColumMap,\n      chartColumnNameMap,\n      tabKey,\n      raidoGroupType,\n      changeTabs,\n      seltColumns,\n      analysiisColumn,\n      expandedChange,\n      handleMonthChange,\n      handleTabChange,\n      changeShowStatus,\n      construcLine,\n      getList,\n      allHeadTagList,\n      allTableList,\n      notShowList,\n      sameDetailTableRef,\n      sameTotalTableRef,\n      initTotalColumns,\n      handleSameContrastTabChange,\n      constructSameTotalColumns,\n      sameTotalTableExpandedChange,\n      goLookChat,\n      goRingContrastChart,\n      constructSameTabChange,\n      constructSameDetailColumns,\n      detailTableExpandedChange,\n      getConstructSameDetailList,\n      getConstructSameTotalList,\n      createEchartsRoute,\n      jump,\n      get Message() {\n        return Message;\n      },\n      onBeforeMount,\n      reactive,\n      ref,\n      nextTick,\n      onMounted,\n      toRaw,\n      markRaw,\n      shallowRef,\n      get useTagColumnListStore() {\n        return useTagColumnListStore;\n      },\n      get getDepartmentRingList() {\n        return getDepartmentRingList;\n      },\n      get queryYoyAnalysis() {\n        return queryYoyAnalysis;\n      },\n      get dataAddKey() {\n        return dataAddKey;\n      },\n      get getRedNum() {\n        return getRedNum;\n      },\n      get getLastMonth() {\n        return getLastMonth;\n      },\n      get getLastYearDay() {\n        return getLastYearDay;\n      },\n      get getCurrentTime() {\n        return getCurrentTime;\n      },\n      get mapDataIndex() {\n        return mapDataIndex;\n      },\n      echartContainer,\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["Message","onBeforeMount","reactive","ref","nextTick","onMounted","toRaw","markRaw","shallowRef","useTagColumnListStore","getDepartmentRingList","queryYoyAnalysis","dataAddKey","getRedNum","getLastMonth","getLastYearDay","getCurrentTime","mapDataIndex","echartContainer","useRouter","router","lYear","lastYear","lastMonth","year","month","tagColumnList","columConfig","tableInfo","columns","data","defaultExpandedKeys","maxHeight","loading","sameTotalTableInfo","sameDetailTableInfo","selectMonth","tableRef","tabChangeColumInfo","columnTabs","filterShowChildrenColumn","chartColumMap","发薪人数","营业收入","销售毛利率","chartColumnNameMap","canvasLine1","canvasLine2","canvasLine3","tabKey","raidoGroupType","seltColumns","getList","initTotalColumns","value","head","$el","innerHeight","window","elHeight","getBoundingClientRect","top","changeTabs","key","tagColumns","getTagColumnList","currentPageColumn","filter","item","report","length","tier","forEach","index","tabs","columnHasSonTabs","noHiddenColumn","defaultColumHasSonTabs","defaultColumnTabs","tags","jtem","push","tag","ktem","col","conf","title","columnItemConfig","dataIndex","align","cellStyle","cellAlign","width","ellipsis","headerCellClass","slotName","bodyCellClass","fixed","isShow","render","record","column","cellVal","Array","isArray","route","map","i","name","canHide","parentCol","params","level1","analysiisColumn","months","num","children1","filterHasSonShowColumn1","columnHasSonConfig","children","j","children2","filterHasSonShowColumn2","children3","filterHasSonShowColumn3","Object","keys","filterShowColumns","hasOwnProperty","reverse","actionColumn","textAlign","filterAllShowColumn","expandedChange","rowKeys","handleMonthChange","handleTabChange","tab","changeShowStatus","type","val","obj","filterHasSonShowColumn","error","construcLine","arr","colNo2","JSON","parse","colNo3","colNo4","mappings","销售毛利","直接成本","人均营业收入","人均直接成本","未完工项目成本","招聘费用","销售费用","管理费用","interval","Number","dynamicHeaderParam","from","Set","xAxis","yAxis","tagKey","then","res","code","deptId","message","catch","err","allHeadTagList","allTableList","notShowList","sameDetailTableRef","sameTotalTableRef","currentColumnList","undefined","constructSameTotalColumns","constructSameDetailColumns","handleSameContrastTabChange","handleAbortRequest","list","tableList","createColumns","childrenColumns","colNo","columnConfig","childrenColumnItemConfig","endsWith","getConstructSameTotalList","sameTotalTableExpandedChange","goLookChat","state","barChartOptions","stringify","sourceType","deptName","goRingContrastChart","constructSameTabChange","timeData","activeTableList","years","contrastColumnConfig","getConstructSameDetailList","detailTableExpandedChange","expandKeys","Math","round","desc","createEchartsRoute","jump","path","query","id"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/src/views/ringAnalyze/departmentRingSame.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <a-tabs v-model:active-key=\"tabKey\" @change=\"changeTabs\">\n      <a-tab-pane key=\"1\" title=\"环比分析\" class=\"p-t-10\">\n        <!-- 配置表头 -->\n        <div class=\"flex-between\">\n          <a-space :size=\"['small', 0]\" wrap>\n            <a-tag\n              v-for=\"(item, index) of tabChangeColumInfo.columnTabs\"\n              :key=\"index\"\n              :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n              size=\"large\"\n              class=\"pointer\"\n              @click=\"handleTabChange(item)\"\n            >\n              {{ item.title }}\n            </a-tag>\n          </a-space>\n          <div style=\"position: relative; top: -1px\">\n            <a-select v-model:model-value=\"selectMonth\" @change=\"handleMonthChange\">\n              <a-option value=\"3\">近3个月</a-option>\n              <a-option value=\"6\">近6个月</a-option>\n              <a-option value=\"12\">近12个月</a-option>\n              <template #arrow-icon>\n                <icon-calendar :size=\"16\" />\n              </template>\n            </a-select>\n          </div>\n        </div>\n        <!-- 表格 -->\n        <div class=\"m-t-20\">\n          <a-table\n            :columns=\"tableInfo.columns\"\n            :data=\"tableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"tableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: tableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"tableInfo.loading\"\n            ref=\"tableRef\"\n            @expanded-change=\"expandedChange\"\n          >\n            <template #lastDeptName=\"{ record }\">\n              <a-popover\n                :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n              >\n                <span class=\"pointer\">{{ record.lastDeptName }}</span>\n                <template #content>\n                  {{ record.deptName }}\n                </template>\n              </a-popover>\n            </template>\n          </a-table>\n        </div>\n      </a-tab-pane>\n      <a-tab-pane key=\"2\" title=\"同比分析\" class=\"p-t-10\">\n        <div v-show=\"raidoGroupType === 'total'\">\n          <div class=\"flex-between\">\n            <a-space :size=\"['small', 0]\" wrap>\n              <a-tag\n                v-for=\"(item, index) of allTableList\"\n                :key=\"index\"\n                :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n                size=\"large\"\n                class=\"pointer\"\n                @click=\"handleSameContrastTabChange(item)\"\n              >\n                {{ item.title }}\n              </a-tag>\n            </a-space>\n            <div style=\"position: relative; top: -1px\">\n              <a-radio-group v-model:model-value=\"raidoGroupType\" type=\"button\" @change=\"constructSameTabChange\">\n                <a-radio value=\"total\">汇总</a-radio>\n                <a-radio value=\"detail\">明细</a-radio>\n              </a-radio-group>\n            </div>\n          </div>\n          <a-table\n            :columns=\"sameTotalTableInfo.columns\"\n            :data=\"sameTotalTableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"sameTotalTableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: sameTotalTableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"sameTotalTableInfo.loading\"\n            ref=\"sameTotalTableRef\"\n            class=\"m-t-20\"\n            @expanded-change=\"sameTotalTableExpandedChange\"\n          >\n            <template #lastDeptName=\"{ record }\">\n              <a-popover\n                :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n              >\n              <a href=\"javaScript:void(0)\" v-if=\"!record.children\" style=\"color: #165dff\" @click=\"jump(record,2)\">\n                {{ record.lastDeptName }}\n              </a>\n              <span class=\"pointer\" v-else>{{ record.lastDeptName }}</span>\n                <template #content>\n                  {{ record.deptName }}\n                </template>\n              </a-popover>\n            </template>\n            <template #canvasLine1=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n            <template #canvasLine2=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n            <template #canvasLine3=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n          </a-table>\n        </div>\n        <div v-show=\"raidoGroupType === 'detail'\">\n          <div class=\"flex-between\">\n            <a-space :size=\"['small', 0]\" wrap>\n              <a-tag\n                v-for=\"(item, index) of allTableList\"\n                :key=\"index\"\n                :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n                size=\"large\"\n                class=\"pointer\"\n                @click=\"handleSameContrastTabChange(item)\"\n              >\n                {{ item.title }}\n              </a-tag>\n            </a-space>\n            <div style=\"position: relative; top: -1px\">\n              <a-radio-group v-model:model-value=\"raidoGroupType\" type=\"button\" @change=\"constructSameTabChange\">\n                <a-radio value=\"total\">汇总</a-radio>\n                <a-radio value=\"detail\">明细</a-radio>\n              </a-radio-group>\n            </div>\n          </div>\n          <a-table\n            :columns=\"sameDetailTableInfo.columns\"\n            :data=\"sameDetailTableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"sameDetailTableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: sameDetailTableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"sameDetailTableInfo.loading\"\n            ref=\"sameDetailTableRef\"\n            class=\" m-t-20\"\n            @expanded-change=\"detailTableExpandedChange\"\n          >\n            <template #lastDeptName=\"{ record }\">\n              <a-popover\n                :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n              >\n              <a href=\"javaScript:void(0)\" v-if=\"!record.children\" style=\"color: #165dff\" @click=\"jump(record,2)\">\n                {{ record.lastDeptName }}\n              </a>\n              <span class=\"pointer\" v-else>{{ record.lastDeptName }}</span>\n                <template #content>\n                  {{ record.deptName }}\n                </template>\n              </a-popover>\n            </template>\n            <template #canvasLine1=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n            <template #canvasLine2=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n            <template #canvasLine3=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n          </a-table>\n        </div>\n      </a-tab-pane>\n    </a-tabs>\n  </div>\n</template>\n\n<script setup>\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw, markRaw, shallowRef } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getDepartmentRingList,queryYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport {\n  dataAddKey,\n  getRedNum,\n  getLastMonth,\n  getLastYearDay,\n  getCurrentTime,\n  mapDataIndex,\n} from \"../../utils/util\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { useRouter } from \"vue-router\";\nconst router = useRouter();\nlet { lYear } = getLastMonth();\nlet { lastYear, lastMonth } = getLastYearDay();\nlet { year, month } = getCurrentTime();\nlet tagColumnList = useTagColumnListStore();\nlet columConfig = {};\nconst tableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"200px\",\n  loading: false,\n});\n//同比汇总表格数据\nconst sameTotalTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n});\n//同比明细表格数据\nconst sameDetailTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n});\nconst selectMonth = ref(\"3\");\nconst tableRef = ref(null);\nconst tabChangeColumInfo = reactive({\n  columnTabs: [],\n});\nlet filterShowChildrenColumn = [];\nconst chartColumMap = {\n  发薪人数: [],\n  营业收入: [],\n  销售毛利率: [],\n};\nconst chartColumnNameMap = {\n  canvasLine1: \"发薪人数\",\n  canvasLine2: \"营业收入\",\n  canvasLine3: \"销售毛利率\",\n};\nconst tabKey = ref(\"1\");\nconst raidoGroupType = ref(\"total\");\nonBeforeMount(() => {\n  seltColumns();\n  getList();\n  initTotalColumns();\n});\nonMounted(() => {\n  if (tableRef.value) {\n    let head = tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\n// 更改环比分析/同比分析\nconst changeTabs = key => {\n  tabKey.value = key;\n};\n// TODO环比分析-------------------------------------------------------------\n// 初始化\nconst seltColumns = () => {\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n  if (currentPageColumn.length) {\n    currentPageColumn[0].tier.forEach((item, index) => {\n      let tabs = [];\n      let columnTabs = [];\n      let columnHasSonTabs = [];\n      let noHiddenColumn = [];\n      let defaultColumHasSonTabs = [];\n      let defaultColumnTabs = [];\n      item.tags.forEach(jtem => {\n        tabs.push(jtem.tag);\n        jtem.columns.forEach(ktem => {\n          let { col, conf, title } = ktem;\n          conf = conf || {};\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: { \"text-align\": conf.cellAlign },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            fixed : conf.fixed\n          };\n          columnItemConfig.isShow = conf.isShow;\n          columnItemConfig.render = ({ record, column }) => {\n            let cellVal = record[column.dataIndex];\n            if (!Array.isArray(cellVal)) {\n              if (column.slotName === \"lastDeptName\") {\n                return (\n                  `<a-popover\n                    content-style={{ background: \"rgba(0,0,0,.8)\", color: \"#fff\" }}\n                    arrow-style={{ background: \"rgba(0,0,0,.8)\" }}\n                  >\n                    {{\n                      default: () =>\n                        record.leafNode == \"1\" ? (\n                          <span class=\"pointer\" style={{ color: \"#165dff\" }} onclick={() => jump(record,1)}>\n                            {record.lastDeptName}\n                          </span>\n                        ) : (\n                          <span class=\"pointer\">{record.lastDeptName}</span>\n                        ),\n                      content: () => record.deptName,\n                    }}\n                  </a-popover>`\n                );\n              }\n              return '<span innerHTML={getRedNum(cellVal)}></span>';\n            } else {\n              let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item,i)=>({name:item.month+'-'+record[item.col],value:cellVal[i]}))\n              return '<echartContainer route={route} height={74} width={100} />';\n            }\n          };\n          if (conf.canHide === 1) {\n            if (conf.parentCol === 0) {\n              columnTabs.push(columnItemConfig);\n            } else {\n              columnHasSonTabs.push(columnItemConfig);\n            }\n          } else {\n            noHiddenColumn.push(columnItemConfig);\n          }\n          if (conf.parentCol === 1) {\n            defaultColumHasSonTabs.push(columnItemConfig);\n          } else {\n            defaultColumnTabs.push(columnItemConfig);\n          }\n        });\n      });\n      columConfig[\"level\" + (index + 1)] = {\n        tabs,\n        params: item.params || [],\n        columnTabs,\n        columnHasSonTabs,\n        noHiddenColumn,\n        defaultColumnTabs,\n        defaultColumHasSonTabs,\n      };\n    });\n  }\n  tabChangeColumInfo.columnTabs = columConfig.level1.columnHasSonTabs;\n};\n// 更换表头\nconst analysiisColumn = months => {\n  let { columnTabs, noHiddenColumn, defaultColumHasSonTabs } = columConfig.level1;\n  let num = 4;\n  switch (selectMonth.value) {\n    case \"3\":\n      let children1 = [];\n      let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = item;\n        columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children1.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children1;\n      break;\n    case \"6\":\n      let children2 = [];\n      let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = item;\n        columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children2.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children2;\n      break;\n    case \"12\":\n      let children3 = [];\n      let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = item;\n        columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children3.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children3;\n      break;\n    default:\n      break;\n  }\n  Object.keys(chartColumMap).forEach(key => {\n    chartColumMap[key] = [];\n  });\n  filterShowChildrenColumn.forEach(item => {\n    if (item.children?.length) {\n      let filterShowColumns = [];\n      item.children.forEach(jtem => {\n        if (jtem.isShow === 1) {\n          filterShowColumns.push(jtem);\n        }\n        if (chartColumMap.hasOwnProperty(jtem.title)) {\n          chartColumMap[jtem.title].push({\n            month: item.title,\n            col: jtem.dataIndex,\n          });\n        }\n      });\n      item.children = filterShowColumns;\n    }\n  });\n  Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return `<a href=\"javaScript:void(0)\" onClick={()=>{goRingContrastChart(record,'dept')}}>看图</a>`\n    }\n  }\n  let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn,actionColumn];\n  tableInfo.columns = filterAllShowColumn;\n};\n//展开环比分析\nconst expandedChange = rowKeys => {\n  tableInfo.defaultExpandedKeys = rowKeys;\n};\n// 切换时间区间\nconst handleMonthChange = month => {\n  selectMonth.value = month;\n  getList();\n};\n// 点击标签\nconst handleTabChange = tab => {\n  switch (tab.isShow) {\n    case 0:\n      tab.isShow = 1;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 1,\n        tab,\n      });\n      break;\n    case 1:\n      tab.isShow = 0;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 0,\n        tab,\n      });\n      break;\n    default:\n      break;\n  }\n};\n// 更改高亮状态并更换表头\nconst changeShowStatus = obj => {\n  let { columnTabs, defaultColumHasSonTabs } = columConfig.level1;\n  let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n    return;\n  }\n  if (obj.type === \"parent\") {\n    columnTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  if (obj.type === \"self\") {\n    defaultColumHasSonTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  getList();\n};\n// 处理趋势数据\nconst construcLine = arr => {\n  arr.forEach(item => {\n    item.colNo2 = JSON.parse(item.colNo2);\n    item.colNo3 = JSON.parse(item.colNo3);\n    item.colNo4 = JSON.parse(item.colNo4);\n    if (item.children) {\n      construcLine(item.children);\n    }\n  });\n};\n// 获取列表数据\nconst getList = () => {\n  tableInfo.data = [];\n  tableInfo.loading = true;\n  let arr = [];\n  const mappings = {\n    发薪人数: \"colNo1\",\n    营业收入: \"colNo2\",\n    销售毛利: \"colNo3\",\n    销售毛利率: \"colNo4\",\n    直接成本: \"colNo5\",\n    人均营业收入: \"colNo6\",\n    人均直接成本: \"colNo7\",\n    未完工项目成本: \"colNo8\",\n    招聘费用: \"colNo9\",\n    销售费用: \"colNo10\",\n    管理费用: \"colNo11\",\n  };\n  tabChangeColumInfo.columnTabs\n    .filter(item => item.isShow === 1)\n    .forEach(item => {\n      if (mappings[item.title]) {\n        arr.push(mappings[item.title]);\n      }\n      if (item.children) {\n        item.children.forEach(jtem => {\n          if (mappings[jtem.title]) {\n            arr.push(mappings[jtem.title]);\n          }\n        });\n      }\n    });\n  const params = {\n    interval: Number(selectMonth.value),\n    dynamicHeaderParam: Array.from(new Set(arr)),\n    xAxis: 74,\n    yAxis: 100,\n    tagKey: \"linkAnalysis\",\n  };\n  getDepartmentRingList(params)\n    .then(res => {\n      if (res.code == \"200\") {\n        analysiisColumn(res.data.month);\n        construcLine(res.data.data);\n        let data = dataAddKey(res.data.data, \"key\", \"deptId\");\n        let keys = [];\n        res.data.data.forEach(item => keys.push(item.deptId));\n        tableInfo.defaultExpandedKeys = keys;\n        tableInfo.data = markRaw(data);\n      } else {\n        Message.error(res.message);\n      }\n      tableInfo.loading = false;\n    })\n    .catch(err => {\n      if (err?.code === \"ERR_CANCELED\") {\n        tableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        tableInfo.loading = false;\n      }\n    });\n};\nconst allHeadTagList = ref([]); // 所有的标签\nconst allTableList = ref([]); // 表头数据\nconst notShowList = shallowRef([]); // 初始没显示的表头数据\nconst sameDetailTableRef = ref(null) //同比明细表格dom\nconst sameTotalTableRef = ref(null)//同比汇总表格dom\n// TODO同比分析----汇总------------------------------------------------------\n// 初始化表头和标签数据\nconst initTotalColumns = () => {\n  allHeadTagList.value = [];\n  allTableList.value = [];\n  notShowList.value = [];\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n  if (currentPageColumn.length) {\n    const currentColumnList = currentPageColumn[0].tier[0].tags[0].columns;\n    currentColumnList.forEach(item => {\n      const { col, conf, title } = item;\n      let columnItemConfig = {\n        title,\n        dataIndex: col,\n        align: conf.align,\n        cellStyle: { \"text-align\": conf.cellAlign },\n        width: conf.width,\n        ellipsis: true,\n        headerCellClass: \"noEllipsis\",\n        slotName: col,\n        bodyCellClass: \"bodyCell\",\n        isShow: conf.isShow,\n        fixed : conf.fixed\n      };\n      // 需要把部门名称的canHide改成0 level1\n      // 如果canHide=1,则push到allHeadTagList,如果isShow=1push到tableList,再配标签配点击事件，对表头进行格式处理。\n      if (conf.canHide == 1) {\n        allHeadTagList.value.push(columnItemConfig);\n      } else {\n        notShowList.value.push(columnItemConfig);\n      }\n      if(conf.fixed !== undefined){\n        columnItemConfig.fixed = conf.fixed\n      }\n      if (conf.parentCol == 1) {\n        allTableList.value.push(columnItemConfig);\n      }\n    });\n    if (raidoGroupType.value == \"total\") {\n      constructSameTotalColumns(allHeadTagList.value);\n    } else {\n      constructSameDetailColumns(allHeadTagList.value);\n    }\n  }\n};\n// 点击标签\nconst handleSameContrastTabChange = value => {\n  value.isShow = value.isShow === 0 ? 1 : 0;\n  let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    value.isShow = value.isShow === 0 ? 1 : 0;\n    return;\n  }\n  handleAbortRequest()\n  if (raidoGroupType.value === \"total\") {\n    constructSameTotalColumns(allHeadTagList.value);\n  } else {\n    constructSameDetailColumns(allHeadTagList.value);\n  }\n};\n// 构造同比汇总的表头\nconst constructSameTotalColumns = list => {\n  let tableList = list.filter(item => item.isShow === 1);\n  let createColumns = []\n  let childrenColumns = [\n        {\n          title: lastYear + \"/1-12\",\n        },\n        {\n          title: lastYear + `/1-${lastMonth}`,\n        },\n        {\n          title: year + `/1-${lastMonth}`,\n        },\n        {\n          title: \"同比\",\n        },\n  ]\n  let colNo = 5\n  tableList.forEach(item => {\n    let columnConfig = {\n      title : item.title,\n      children : childrenColumns.map((jtem,i)=>{\n        let childrenColumnItemConfig = {\n          title : jtem.title,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: 110,\n          cellStyle: {textAlign : 'right'},\n        }\n        if(i === (childrenColumns.length -1)){\n          childrenColumnItemConfig.title = item.title.endsWith('率')?'偏离':jtem.title\n        }\n        colNo++\n        return childrenColumnItemConfig\n      })\n    }\n    createColumns.push(columnConfig)\n  });\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return `<a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'dept')}}>看图</a>`\n    }\n  }\n  sameTotalTableInfo.columns = [...notShowList.value,...createColumns,actionColumn]\n  getConstructSameTotalList()\n};\n\nconst sameTotalTableExpandedChange = keys=>{\n  sameTotalTableInfo.defaultExpandedKeys = keys\n}\n\n//跳转看图页\nconst goLookChat = (record,type)=>{\n  router.push({\n    name : 'lookChart',\n    state : {\n      barChartOptions : JSON.stringify(allHeadTagList.value),\n      deptId : record.deptId,\n      sourceType : type,\n      deptName : record.deptName\n    }\n  })\n}\n\nconst goRingContrastChart = (record,type)=>{\n  router.push({\n    name : 'ringContrastChart',\n    state : {\n      deptName : record.deptName,\n      interval:selectMonth.value,\n      deptId : record.deptId,\n      sourceType : type\n    }\n  })\n}\n\n// 同比分析-----明细-------------------------------------------------------------\n// 更改汇总/明细\nconst constructSameTabChange = value => {\n  raidoGroupType.value = value;\n  initTotalColumns();\n};\n// 构造同比明细的表头结构\nconst constructSameDetailColumns = list => {\n  const timeData = [];\n  let activeTableList = list.filter(item => item.isShow === 1);\n  if (month == 1) {\n    for (var i = 1; i <= 12; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  } else {\n    for (var i = 1; i <= lastMonth; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  }\n  const years = [lastYear, year];\n  let colNo = 5\n  timeData.forEach(item=>{\n    let childrenColumns = []\n    activeTableList.forEach(jtem=>{\n      years.forEach(ktem=>{\n        let contrastColumnConfig = {\n          title: `${jtem.title}${ktem}`,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: jtem.width,\n          cellStyle: toRaw(jtem.cellStyle),\n        }\n        childrenColumns.push(contrastColumnConfig)\n        colNo++\n      })\n    })\n    item.children = childrenColumns\n  })\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return `<a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'dept')}}>看图</a>`\n    }\n  }\n  sameDetailTableInfo.columns = [...notShowList.value,...timeData,actionColumn]\n  getConstructSameDetailList()\n};\n\n//同比分析明细表格展开/折叠\nconst detailTableExpandedChange = rowKeys => {\n  sameDetailTableInfo.defaultExpandedKeys = rowKeys;\n};\n\n//同比分析明细接口\nconst getConstructSameDetailList = ()=>{\n  let params = {\n    interval:lastMonth,\n    dynamicHeaderParam:allTableList.value.filter(item=>item.isShow ===1).map(item=>item.dataIndex),\n    xAxis:74,\n    yAxis:100,\n    tagKey:\"yoyAnalysis\",\n    type : '2'\n  }\n  sameDetailTableInfo.loading = true\n  queryYoyAnalysis(params).then(res=>{\n    if(res.code === '200'){\n      dataAddKey(res.data.data,'key','deptId')\n      let expandKeys = []\n      res.data.data.forEach(item=>expandKeys.push(item.key))\n      sameDetailTableInfo.defaultExpandedKeys = expandKeys\n      sameDetailTableInfo.data = res.data.data\n      //计算表格不出滚动条的最大高度\n      if(sameDetailTableInfo.maxHeight === '600px'){\n        nextTick(() => {\n              if (sameDetailTableRef.value) {\n              let head = sameDetailTableRef.value.$el;\n              let innerHeight = window.innerHeight;\n              let elHeight = head.getBoundingClientRect().top;\n              sameDetailTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n            }\n          });\n        }\n    }else {\n      Message.error(res.desc || '请求数据失败')\n    }\n    sameDetailTableInfo.loading = false;\n  }).catch(err=>{\n    if (err?.code === \"ERR_CANCELED\") {\n      sameDetailTableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        sameDetailTableInfo.loading = false;\n      }\n  })\n}\n\n//同比分析汇总接口\nconst getConstructSameTotalList = ()=>{\n  let params = {\n    interval:lastMonth,\n    dynamicHeaderParam:allTableList.value.filter(item=>item.isShow ===1).map(item=>item.dataIndex),\n    xAxis:74,\n    yAxis:100,\n    tagKey:\"yoyAnalysis\",\n    type : '1'\n  }\n  sameTotalTableInfo.loading = true\n  queryYoyAnalysis(params).then(res=>{\n    if(res.code === '200'){\n      dataAddKey(res.data.data,'key','deptId')\n      let expandKeys = []\n      res.data.data.forEach(item=>expandKeys.push(item.key))\n      sameTotalTableInfo.defaultExpandedKeys = expandKeys\n      sameTotalTableInfo.data = res.data.data\n      //计算表格不出滚动条的最大高度\n      if(sameTotalTableInfo.maxHeight === '600px'){\n        nextTick(() => {\n              if (sameTotalTableRef.value) {\n                let head = sameTotalTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameTotalTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n            }\n          });\n        }\n    }else {\n      Message.error(res.desc || '请求数据失败')\n    }\n    sameTotalTableInfo.loading = false;\n  }).catch(err=>{\n    if (err?.code === \"ERR_CANCELED\") {\n      sameTotalTableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        sameTotalTableInfo.loading = false;\n      }\n  })\n}\n//echarts缩略图的路径信息\nconst createEchartsRoute = (record,column)=>{\n  return chartColumMap[chartColumnNameMap[column.dataIndex]].map((item,i)=>({value:record[column.dataIndex][i]}))\n}\n// 跳转到客户\nconst jump = (record,tab) => {\n  router.push({\n    path: \"/customerRingSame\",\n    query: {\n      id: record.deptId,\n      deptName : record.deptName,\n      tab\n    },\n  });\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.p-t-10 {\n  padding-top: 10px;\n}\n:deep(.tabs .arco-tabs-nav-type-line .arco-tabs-tab-title) {\n  font-size: 15px;\n}\n</style>\n"],"mappings":";AA4LA,SAASA,OAAO,QAAQ,sBAAsB;AAC9C,SAASC,aAAa,EAAEC,QAAQ,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,SAAS,EAAEC,KAAK,EAAEC,OAAO,EAAEC,UAAU,QAAQ,KAAK;AACnG,SAASC,qBAAqB,QAAQ,mBAAmB;AACzD,SAASC,qBAAqB,EAACC,gBAAgB,QAAQ,sBAAsB;AAC7E,SACEC,UAAU,EACVC,SAAS,EACTC,YAAY,EACZC,cAAc,EACdC,cAAc,EACdC,YAAY,QACP,kBAAkB;AACzB,OAAOC,eAAe,MAAM,mCAAmC;AAC/D,SAASC,SAAS,QAAQ,YAAY;;;;;;;IACtC,MAAMC,MAAM,GAAGD,SAAS,CAAC,CAAC;IAC1B,IAAI;MAAEE;IAAM,CAAC,GAAGP,YAAY,CAAC,CAAC;IAC9B,IAAI;MAAEQ,QAAQ;MAAEC;IAAU,CAAC,GAAGR,cAAc,CAAC,CAAC;IAC9C,IAAI;MAAES,IAAI;MAAEC;IAAM,CAAC,GAAGT,cAAc,CAAC,CAAC;IACtC,IAAIU,aAAa,GAAGjB,qBAAqB,CAAC,CAAC;IAC3C,IAAIkB,WAAW,GAAG,CAAC,CAAC;IACpB,MAAMC,SAAS,GAAG1B,QAAQ,CAAC;MACzB2B,OAAO,EAAE,EAAE;MACXC,IAAI,EAAE,EAAE;MACRC,mBAAmB,EAAE,EAAE;MACvBC,SAAS,EAAE,OAAO;MAClBC,OAAO,EAAE;IACX,CAAC,CAAC;IACF;IACA,MAAMC,kBAAkB,GAAGhC,QAAQ,CAAC;MAClC2B,OAAO,EAAE,EAAE;MACXC,IAAI,EAAE,EAAE;MACRC,mBAAmB,EAAE,EAAE;MACvBC,SAAS,EAAE,OAAO;MAClBC,OAAO,EAAE;IACX,CAAC,CAAC;IACF;IACA,MAAME,mBAAmB,GAAGjC,QAAQ,CAAC;MACnC2B,OAAO,EAAE,EAAE;MACXC,IAAI,EAAE,EAAE;MACRC,mBAAmB,EAAE,EAAE;MACvBC,SAAS,EAAE,OAAO;MAClBC,OAAO,EAAE;IACX,CAAC,CAAC;IACF,MAAMG,WAAW,GAAGjC,GAAG,CAAC,GAAG,CAAC;IAC5B,MAAMkC,QAAQ,GAAGlC,GAAG,CAAC,IAAI,CAAC;IAC1B,MAAMmC,kBAAkB,GAAGpC,QAAQ,CAAC;MAClCqC,UAAU,EAAE;IACd,CAAC,CAAC;IACF,IAAIC,wBAAwB,GAAG,EAAE;IACjC,MAAMC,aAAa,GAAG;MACpBC,IAAI,EAAE,EAAE;MACRC,IAAI,EAAE,EAAE;MACRC,KAAK,EAAE;IACT,CAAC;IACD,MAAMC,kBAAkB,GAAG;MACzBC,WAAW,EAAE,MAAM;MACnBC,WAAW,EAAE,MAAM;MACnBC,WAAW,EAAE;IACf,CAAC;IACD,MAAMC,MAAM,GAAG9C,GAAG,CAAC,GAAG,CAAC;IACvB,MAAM+C,cAAc,GAAG/C,GAAG,CAAC,OAAO,CAAC;IACnCF,aAAa,CAAC,MAAM;MAClBkD,WAAW,CAAC,CAAC;MACbC,OAAO,CAAC,CAAC;MACTC,gBAAgB,CAAC,CAAC;IACpB,CAAC,CAAC;IACFhD,SAAS,CAAC,MAAM;MACd,IAAIgC,QAAQ,CAACiB,KAAK,EAAE;QAClB,IAAIC,IAAI,GAAGlB,QAAQ,CAACiB,KAAK,CAACE,GAAG;QAC7BpD,QAAQ,CAAC,MAAM;UACb,IAAIqD,WAAW,GAAGC,MAAM,CAACD,WAAW;UACpC,IAAIE,QAAQ,GAAGJ,IAAI,CAACK,qBAAqB,CAAC,CAAC,CAACC,GAAG;UAC/CjC,SAAS,CAACI,SAAS,GAAGyB,WAAW,GAAGE,QAAQ,GAAG,EAAE,GAAG,IAAI;QAC1D,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;IACF;IACA,MAAMG,UAAU,GAAGC,GAAG,IAAI;MACxBd,MAAM,CAACK,KAAK,GAAGS,GAAG;IACpB,CAAC;IACD;IACA;IACA,MAAMZ,WAAW,GAAGA,CAAA,KAAM;MACxB,IAAIa,UAAU,GAAG1D,KAAK,CAACoB,aAAa,CAACuC,gBAAgB,CAAC,IAAI,EAAE;MAC5D,IAAIC,iBAAiB,GAAGF,UAAU,CAACG,MAAM,CAACC,IAAI,IAAIA,IAAI,CAACC,MAAM,KAAK,MAAM,CAAC,IAAI,EAAE;MAC/E,IAAIH,iBAAiB,CAACI,MAAM,EAAE;QAC5BJ,iBAAiB,CAAC,CAAC,CAAC,CAACK,IAAI,CAACC,OAAO,CAAC,CAACJ,IAAI,EAAEK,KAAK,KAAK;UACjD,IAAIC,IAAI,GAAG,EAAE;UACb,IAAInC,UAAU,GAAG,EAAE;UACnB,IAAIoC,gBAAgB,GAAG,EAAE;UACzB,IAAIC,cAAc,GAAG,EAAE;UACvB,IAAIC,sBAAsB,GAAG,EAAE;UAC/B,IAAIC,iBAAiB,GAAG,EAAE;UAC1BV,IAAI,CAACW,IAAI,CAACP,OAAO,CAACQ,IAAI,IAAI;YACxBN,IAAI,CAACO,IAAI,CAACD,IAAI,CAACE,GAAG,CAAC;YACnBF,IAAI,CAACnD,OAAO,CAAC2C,OAAO,CAACW,IAAI,IAAI;cAC3B,IAAI;gBAAEC,GAAG;gBAAEC,IAAI;gBAAEC;cAAM,CAAC,GAAGH,IAAI;cAC/BE,IAAI,GAAGA,IAAI,IAAI,CAAC,CAAC;cACjB,IAAIE,gBAAgB,GAAG;gBACrBD,KAAK;gBACLE,SAAS,EAAEJ,GAAG;gBACdK,KAAK,EAAEJ,IAAI,CAACI,KAAK;gBACjBC,SAAS,EAAE;kBAAE,YAAY,EAAEL,IAAI,CAACM;gBAAU,CAAC;gBAC3CC,KAAK,EAAEP,IAAI,CAACO,KAAK;gBACjBC,QAAQ,EAAE,IAAI;gBACdC,eAAe,EAAE,YAAY;gBAC7BC,QAAQ,EAAEX,GAAG;gBACbY,aAAa,EAAE,UAAU;gBACzBC,KAAK,EAAGZ,IAAI,CAACY;cACf,CAAC;cACDV,gBAAgB,CAACW,MAAM,GAAGb,IAAI,CAACa,MAAM;cACrCX,gBAAgB,CAACY,MAAM,GAAG,CAAC;gBAAEC,MAAM;gBAAEC;cAAO,CAAC,KAAK;gBAChD,IAAIC,OAAO,GAAGF,MAAM,CAACC,MAAM,CAACb,SAAS,CAAC;gBACtC,IAAI,CAACe,KAAK,CAACC,OAAO,CAACF,OAAO,CAAC,EAAE;kBAC3B,IAAID,MAAM,CAACN,QAAQ,KAAK,cAAc,EAAE;oBACtC,OACG;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;kBAEjB;kBACA,OAAO,8CAA8C;gBACvD,CAAC,MAAM;kBACL,IAAIU,KAAK,GAAGhE,aAAa,CAACI,kBAAkB,CAACwD,MAAM,CAACb,SAAS,CAAC,CAAC,CAACkB,GAAG,CAAC,CAACtC,IAAI,EAACuC,CAAC,MAAI;oBAACC,IAAI,EAACxC,IAAI,CAAC3C,KAAK,GAAC,GAAG,GAAC2E,MAAM,CAAChC,IAAI,CAACgB,GAAG,CAAC;oBAAC9B,KAAK,EAACgD,OAAO,CAACK,CAAC;kBAAC,CAAC,CAAC,CAAC;kBACxI,OAAO,2DAA2D;gBACpE;cACF,CAAC;cACD,IAAItB,IAAI,CAACwB,OAAO,KAAK,CAAC,EAAE;gBACtB,IAAIxB,IAAI,CAACyB,SAAS,KAAK,CAAC,EAAE;kBACxBvE,UAAU,CAAC0C,IAAI,CAACM,gBAAgB,CAAC;gBACnC,CAAC,MAAM;kBACLZ,gBAAgB,CAACM,IAAI,CAACM,gBAAgB,CAAC;gBACzC;cACF,CAAC,MAAM;gBACLX,cAAc,CAACK,IAAI,CAACM,gBAAgB,CAAC;cACvC;cACA,IAAIF,IAAI,CAACyB,SAAS,KAAK,CAAC,EAAE;gBACxBjC,sBAAsB,CAACI,IAAI,CAACM,gBAAgB,CAAC;cAC/C,CAAC,MAAM;gBACLT,iBAAiB,CAACG,IAAI,CAACM,gBAAgB,CAAC;cAC1C;YACF,CAAC,CAAC;UACJ,CAAC,CAAC;UACF5D,WAAW,CAAC,OAAO,IAAI8C,KAAK,GAAG,CAAC,CAAC,CAAC,GAAG;YACnCC,IAAI;YACJqC,MAAM,EAAE3C,IAAI,CAAC2C,MAAM,IAAI,EAAE;YACzBxE,UAAU;YACVoC,gBAAgB;YAChBC,cAAc;YACdE,iBAAiB;YACjBD;UACF,CAAC;QACH,CAAC,CAAC;MACJ;MACAvC,kBAAkB,CAACC,UAAU,GAAGZ,WAAW,CAACqF,MAAM,CAACrC,gBAAgB;IACrE,CAAC;IACD;IACA,MAAMsC,eAAe,GAAGC,MAAM,IAAI;MAChC,IAAI;QAAE3E,UAAU;QAAEqC,cAAc;QAAEC;MAAuB,CAAC,GAAGlD,WAAW,CAACqF,MAAM;MAC/E,IAAIG,GAAG,GAAG,CAAC;MACX,QAAQ/E,WAAW,CAACkB,KAAK;QACvB,KAAK,GAAG;UACN,IAAI8D,SAAS,GAAG,EAAE;UAClB,IAAIC,uBAAuB,GAAGxC,sBAAsB,CAACV,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC;UACtFgB,MAAM,CAAC1C,OAAO,CAAC,CAACJ,IAAI,EAAEuC,CAAC,KAAK;YAC1B,IAAIW,kBAAkB,GAAG,CAAC,CAAC;YAC3BA,kBAAkB,CAAChC,KAAK,GAAGlB,IAAI;YAC/BkD,kBAAkB,CAACC,QAAQ,GAAGF,uBAAuB,CAACX,GAAG,CAAC,CAAC1B,IAAI,EAAEwC,CAAC,KAAK;cACrEL,GAAG,EAAE;cACL,OAAO;gBACL,GAAGnC,IAAI;gBACPQ,SAAS,EAAG,QAAO2B,GAAI,EAAC;gBACxBpB,QAAQ,EAAG,QAAOoB,GAAI;cACxB,CAAC;YACH,CAAC,CAAC;YACFC,SAAS,CAACnC,IAAI,CAACqC,kBAAkB,CAAC;UACpC,CAAC,CAAC;UACFH,GAAG,GAAG,CAAC;UACP3E,wBAAwB,GAAG4E,SAAS;UACpC;QACF,KAAK,GAAG;UACN,IAAIK,SAAS,GAAG,EAAE;UAClB,IAAIC,uBAAuB,GAAG7C,sBAAsB,CAACV,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC;UACtFgB,MAAM,CAAC1C,OAAO,CAAC,CAACJ,IAAI,EAAEuC,CAAC,KAAK;YAC1B,IAAIW,kBAAkB,GAAG,CAAC,CAAC;YAC3BA,kBAAkB,CAAChC,KAAK,GAAGlB,IAAI;YAC/BkD,kBAAkB,CAACC,QAAQ,GAAGG,uBAAuB,CAAChB,GAAG,CAAC,CAAC1B,IAAI,EAAEwC,CAAC,KAAK;cACrEL,GAAG,EAAE;cACL,OAAO;gBACL,GAAGnC,IAAI;gBACPQ,SAAS,EAAG,QAAO2B,GAAI,EAAC;gBACxBpB,QAAQ,EAAG,QAAOoB,GAAI;cACxB,CAAC;YACH,CAAC,CAAC;YACFM,SAAS,CAACxC,IAAI,CAACqC,kBAAkB,CAAC;UACpC,CAAC,CAAC;UACFH,GAAG,GAAG,CAAC;UACP3E,wBAAwB,GAAGiF,SAAS;UACpC;QACF,KAAK,IAAI;UACP,IAAIE,SAAS,GAAG,EAAE;UAClB,IAAIC,uBAAuB,GAAG/C,sBAAsB,CAACV,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC;UACtFgB,MAAM,CAAC1C,OAAO,CAAC,CAACJ,IAAI,EAAEuC,CAAC,KAAK;YAC1B,IAAIW,kBAAkB,GAAG,CAAC,CAAC;YAC3BA,kBAAkB,CAAChC,KAAK,GAAGlB,IAAI;YAC/BkD,kBAAkB,CAACC,QAAQ,GAAGK,uBAAuB,CAAClB,GAAG,CAAC,CAAC1B,IAAI,EAAEwC,CAAC,KAAK;cACrEL,GAAG,EAAE;cACL,OAAO;gBACL,GAAGnC,IAAI;gBACPQ,SAAS,EAAG,QAAO2B,GAAI,EAAC;gBACxBpB,QAAQ,EAAG,QAAOoB,GAAI;cACxB,CAAC;YACH,CAAC,CAAC;YACFQ,SAAS,CAAC1C,IAAI,CAACqC,kBAAkB,CAAC;UACpC,CAAC,CAAC;UACFH,GAAG,GAAG,CAAC;UACP3E,wBAAwB,GAAGmF,SAAS;UACpC;QACF;UACE;MACJ;MACAE,MAAM,CAACC,IAAI,CAACrF,aAAa,CAAC,CAAC+B,OAAO,CAACT,GAAG,IAAI;QACxCtB,aAAa,CAACsB,GAAG,CAAC,GAAG,EAAE;MACzB,CAAC,CAAC;MACFvB,wBAAwB,CAACgC,OAAO,CAACJ,IAAI,IAAI;QACvC,IAAIA,IAAI,CAACmD,QAAQ,EAAEjD,MAAM,EAAE;UACzB,IAAIyD,iBAAiB,GAAG,EAAE;UAC1B3D,IAAI,CAACmD,QAAQ,CAAC/C,OAAO,CAACQ,IAAI,IAAI;YAC5B,IAAIA,IAAI,CAACkB,MAAM,KAAK,CAAC,EAAE;cACrB6B,iBAAiB,CAAC9C,IAAI,CAACD,IAAI,CAAC;YAC9B;YACA,IAAIvC,aAAa,CAACuF,cAAc,CAAChD,IAAI,CAACM,KAAK,CAAC,EAAE;cAC5C7C,aAAa,CAACuC,IAAI,CAACM,KAAK,CAAC,CAACL,IAAI,CAAC;gBAC7BxD,KAAK,EAAE2C,IAAI,CAACkB,KAAK;gBACjBF,GAAG,EAAEJ,IAAI,CAACQ;cACZ,CAAC,CAAC;YACJ;UACF,CAAC,CAAC;UACFpB,IAAI,CAACmD,QAAQ,GAAGQ,iBAAiB;QACnC;MACF,CAAC,CAAC;MACFF,MAAM,CAACC,IAAI,CAACrF,aAAa,CAAC,CAAC+B,OAAO,CAACT,GAAG,IAAItB,aAAa,CAACsB,GAAG,CAAC,CAACkE,OAAO,CAAC,CAAC,CAAC;MAEvE,IAAIC,YAAY,GAAG;QACjB5C,KAAK,EAAG,IAAI;QACZE,SAAS,EAAG,QAAQ;QACpBI,KAAK,EAAG,EAAE;QACVK,KAAK,EAAG,OAAO;QACfP,SAAS,EAAG;UAACyC,SAAS,EAAG;QAAQ,CAAC;QAClChC,MAAMA,CAAC;UAACC;QAAM,CAAC,EAAC;UACd,OAAQ,wFAAuF;QACjG;MACF,CAAC;MACD,IAAIgC,mBAAmB,GAAG,CAAC,GAAG7F,UAAU,CAAC4B,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC,EAAE,GAAGtB,cAAc,EAAE,GAAGpC,wBAAwB,EAAC0F,YAAY,CAAC;MACxItG,SAAS,CAACC,OAAO,GAAGuG,mBAAmB;IACzC,CAAC;IACD;IACA,MAAMC,cAAc,GAAGC,OAAO,IAAI;MAChC1G,SAAS,CAACG,mBAAmB,GAAGuG,OAAO;IACzC,CAAC;IACD;IACA,MAAMC,iBAAiB,GAAG9G,KAAK,IAAI;MACjCW,WAAW,CAACkB,KAAK,GAAG7B,KAAK;MACzB2B,OAAO,CAAC,CAAC;IACX,CAAC;IACD;IACA,MAAMoF,eAAe,GAAGC,GAAG,IAAI;MAC7B,QAAQA,GAAG,CAACvC,MAAM;QAChB,KAAK,CAAC;UACJuC,GAAG,CAACvC,MAAM,GAAG,CAAC;UACdwC,gBAAgB,CAAC;YACfC,IAAI,EAAE,MAAM;YACZrD,KAAK,EAAEmD,GAAG,CAACnD,KAAK;YAChBsD,GAAG,EAAE,CAAC;YACNH;UACF,CAAC,CAAC;UACF;QACF,KAAK,CAAC;UACJA,GAAG,CAACvC,MAAM,GAAG,CAAC;UACdwC,gBAAgB,CAAC;YACfC,IAAI,EAAE,MAAM;YACZrD,KAAK,EAAEmD,GAAG,CAACnD,KAAK;YAChBsD,GAAG,EAAE,CAAC;YACNH;UACF,CAAC,CAAC;UACF;QACF;UACE;MACJ;IACF,CAAC;IACD;IACA,MAAMC,gBAAgB,GAAGG,GAAG,IAAI;MAC9B,IAAI;QAAEtG,UAAU;QAAEsC;MAAuB,CAAC,GAAGlD,WAAW,CAACqF,MAAM;MAC/D,IAAI8B,sBAAsB,GAAGjE,sBAAsB,CAACV,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC;MACrF,IAAI4C,sBAAsB,CAACxE,MAAM,KAAK,CAAC,EAAE;QACvCtE,OAAO,CAAC+I,KAAK,CAAC,QAAQ,CAAC;QACvBF,GAAG,CAACJ,GAAG,CAACvC,MAAM,GAAG2C,GAAG,CAACJ,GAAG,CAACvC,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC;QAC7C;MACF;MACA,IAAI2C,GAAG,CAACF,IAAI,KAAK,QAAQ,EAAE;QACzBpG,UAAU,CAACiC,OAAO,CAACJ,IAAI,IAAI;UACzB,IAAIyE,GAAG,CAACvD,KAAK,KAAKlB,IAAI,CAACkB,KAAK,EAAE;YAC5BlB,IAAI,CAAC8B,MAAM,GAAG2C,GAAG,CAACD,GAAG;UACvB;QACF,CAAC,CAAC;MACJ;MACA,IAAIC,GAAG,CAACF,IAAI,KAAK,MAAM,EAAE;QACvB9D,sBAAsB,CAACL,OAAO,CAACJ,IAAI,IAAI;UACrC,IAAIyE,GAAG,CAACvD,KAAK,KAAKlB,IAAI,CAACkB,KAAK,EAAE;YAC5BlB,IAAI,CAAC8B,MAAM,GAAG2C,GAAG,CAACD,GAAG;UACvB;QACF,CAAC,CAAC;MACJ;MACAxF,OAAO,CAAC,CAAC;IACX,CAAC;IACD;IACA,MAAM4F,YAAY,GAAGC,GAAG,IAAI;MAC1BA,GAAG,CAACzE,OAAO,CAACJ,IAAI,IAAI;QAClBA,IAAI,CAAC8E,MAAM,GAAGC,IAAI,CAACC,KAAK,CAAChF,IAAI,CAAC8E,MAAM,CAAC;QACrC9E,IAAI,CAACiF,MAAM,GAAGF,IAAI,CAACC,KAAK,CAAChF,IAAI,CAACiF,MAAM,CAAC;QACrCjF,IAAI,CAACkF,MAAM,GAAGH,IAAI,CAACC,KAAK,CAAChF,IAAI,CAACkF,MAAM,CAAC;QACrC,IAAIlF,IAAI,CAACmD,QAAQ,EAAE;UACjByB,YAAY,CAAC5E,IAAI,CAACmD,QAAQ,CAAC;QAC7B;MACF,CAAC,CAAC;IACJ,CAAC;IACD;IACA,MAAMnE,OAAO,GAAGA,CAAA,KAAM;MACpBxB,SAAS,CAACE,IAAI,GAAG,EAAE;MACnBF,SAAS,CAACK,OAAO,GAAG,IAAI;MACxB,IAAIgH,GAAG,GAAG,EAAE;MACZ,MAAMM,QAAQ,GAAG;QACf7G,IAAI,EAAE,QAAQ;QACdC,IAAI,EAAE,QAAQ;QACd6G,IAAI,EAAE,QAAQ;QACd5G,KAAK,EAAE,QAAQ;QACf6G,IAAI,EAAE,QAAQ;QACdC,MAAM,EAAE,QAAQ;QAChBC,MAAM,EAAE,QAAQ;QAChBC,OAAO,EAAE,QAAQ;QACjBC,IAAI,EAAE,QAAQ;QACdC,IAAI,EAAE,SAAS;QACfC,IAAI,EAAE;MACR,CAAC;MACDzH,kBAAkB,CAACC,UAAU,CAC1B4B,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC,CACjC1B,OAAO,CAACJ,IAAI,IAAI;QACf,IAAImF,QAAQ,CAACnF,IAAI,CAACkB,KAAK,CAAC,EAAE;UACxB2D,GAAG,CAAChE,IAAI,CAACsE,QAAQ,CAACnF,IAAI,CAACkB,KAAK,CAAC,CAAC;QAChC;QACA,IAAIlB,IAAI,CAACmD,QAAQ,EAAE;UACjBnD,IAAI,CAACmD,QAAQ,CAAC/C,OAAO,CAACQ,IAAI,IAAI;YAC5B,IAAIuE,QAAQ,CAACvE,IAAI,CAACM,KAAK,CAAC,EAAE;cACxB2D,GAAG,CAAChE,IAAI,CAACsE,QAAQ,CAACvE,IAAI,CAACM,KAAK,CAAC,CAAC;YAChC;UACF,CAAC,CAAC;QACJ;MACF,CAAC,CAAC;MACJ,MAAMyB,MAAM,GAAG;QACbiD,QAAQ,EAAEC,MAAM,CAAC7H,WAAW,CAACkB,KAAK,CAAC;QACnC4G,kBAAkB,EAAE3D,KAAK,CAAC4D,IAAI,CAAC,IAAIC,GAAG,CAACnB,GAAG,CAAC,CAAC;QAC5CoB,KAAK,EAAE,EAAE;QACTC,KAAK,EAAE,GAAG;QACVC,MAAM,EAAE;MACV,CAAC;MACD7J,qBAAqB,CAACqG,MAAM,CAAC,CAC1ByD,IAAI,CAACC,GAAG,IAAI;QACX,IAAIA,GAAG,CAACC,IAAI,IAAI,KAAK,EAAE;UACrBzD,eAAe,CAACwD,GAAG,CAAC3I,IAAI,CAACL,KAAK,CAAC;UAC/BuH,YAAY,CAACyB,GAAG,CAAC3I,IAAI,CAACA,IAAI,CAAC;UAC3B,IAAIA,IAAI,GAAGlB,UAAU,CAAC6J,GAAG,CAAC3I,IAAI,CAACA,IAAI,EAAE,KAAK,EAAE,QAAQ,CAAC;UACrD,IAAIgG,IAAI,GAAG,EAAE;UACb2C,GAAG,CAAC3I,IAAI,CAACA,IAAI,CAAC0C,OAAO,CAACJ,IAAI,IAAI0D,IAAI,CAAC7C,IAAI,CAACb,IAAI,CAACuG,MAAM,CAAC,CAAC;UACrD/I,SAAS,CAACG,mBAAmB,GAAG+F,IAAI;UACpClG,SAAS,CAACE,IAAI,GAAGvB,OAAO,CAACuB,IAAI,CAAC;QAChC,CAAC,MAAM;UACL9B,OAAO,CAAC+I,KAAK,CAAC0B,GAAG,CAACG,OAAO,CAAC;QAC5B;QACAhJ,SAAS,CAACK,OAAO,GAAG,KAAK;MAC3B,CAAC,CAAC,CACD4I,KAAK,CAACC,GAAG,IAAI;QACZ,IAAIA,GAAG,EAAEJ,IAAI,KAAK,cAAc,EAAE;UAChC9I,SAAS,CAACK,OAAO,GAAG,IAAI;QAC1B,CAAC,MAAM;UACLjC,OAAO,CAAC+I,KAAK,CAAC+B,GAAG,EAAEF,OAAO,IAAI,QAAQ,CAAC;UACvChJ,SAAS,CAACK,OAAO,GAAG,KAAK;QAC3B;MACF,CAAC,CAAC;IACN,CAAC;IACD,MAAM8I,cAAc,GAAG5K,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;IAChC,MAAM6K,YAAY,GAAG7K,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;IAC9B,MAAM8K,WAAW,GAAGzK,UAAU,CAAC,EAAE,CAAC,CAAC,CAAC;IACpC,MAAM0K,kBAAkB,GAAG/K,GAAG,CAAC,IAAI,CAAC,EAAC;IACrC,MAAMgL,iBAAiB,GAAGhL,GAAG,CAAC,IAAI,CAAC;IACnC;IACA;IACA,MAAMkD,gBAAgB,GAAGA,CAAA,KAAM;MAC7B0H,cAAc,CAACzH,KAAK,GAAG,EAAE;MACzB0H,YAAY,CAAC1H,KAAK,GAAG,EAAE;MACvB2H,WAAW,CAAC3H,KAAK,GAAG,EAAE;MACtB,IAAIU,UAAU,GAAG1D,KAAK,CAACoB,aAAa,CAACuC,gBAAgB,CAAC,IAAI,EAAE;MAC5D,IAAIC,iBAAiB,GAAGF,UAAU,CAACG,MAAM,CAACC,IAAI,IAAIA,IAAI,CAACC,MAAM,KAAK,MAAM,CAAC,IAAI,EAAE;MAC/E,IAAIH,iBAAiB,CAACI,MAAM,EAAE;QAC5B,MAAM8G,iBAAiB,GAAGlH,iBAAiB,CAAC,CAAC,CAAC,CAACK,IAAI,CAAC,CAAC,CAAC,CAACQ,IAAI,CAAC,CAAC,CAAC,CAAClD,OAAO;QACtEuJ,iBAAiB,CAAC5G,OAAO,CAACJ,IAAI,IAAI;UAChC,MAAM;YAAEgB,GAAG;YAAEC,IAAI;YAAEC;UAAM,CAAC,GAAGlB,IAAI;UACjC,IAAImB,gBAAgB,GAAG;YACrBD,KAAK;YACLE,SAAS,EAAEJ,GAAG;YACdK,KAAK,EAAEJ,IAAI,CAACI,KAAK;YACjBC,SAAS,EAAE;cAAE,YAAY,EAAEL,IAAI,CAACM;YAAU,CAAC;YAC3CC,KAAK,EAAEP,IAAI,CAACO,KAAK;YACjBC,QAAQ,EAAE,IAAI;YACdC,eAAe,EAAE,YAAY;YAC7BC,QAAQ,EAAEX,GAAG;YACbY,aAAa,EAAE,UAAU;YACzBE,MAAM,EAAEb,IAAI,CAACa,MAAM;YACnBD,KAAK,EAAGZ,IAAI,CAACY;UACf,CAAC;UACD;UACA;UACA,IAAIZ,IAAI,CAACwB,OAAO,IAAI,CAAC,EAAE;YACrBkE,cAAc,CAACzH,KAAK,CAAC2B,IAAI,CAACM,gBAAgB,CAAC;UAC7C,CAAC,MAAM;YACL0F,WAAW,CAAC3H,KAAK,CAAC2B,IAAI,CAACM,gBAAgB,CAAC;UAC1C;UACA,IAAGF,IAAI,CAACY,KAAK,KAAKoF,SAAS,EAAC;YAC1B9F,gBAAgB,CAACU,KAAK,GAAGZ,IAAI,CAACY,KAAK;UACrC;UACA,IAAIZ,IAAI,CAACyB,SAAS,IAAI,CAAC,EAAE;YACvBkE,YAAY,CAAC1H,KAAK,CAAC2B,IAAI,CAACM,gBAAgB,CAAC;UAC3C;QACF,CAAC,CAAC;QACF,IAAIrC,cAAc,CAACI,KAAK,IAAI,OAAO,EAAE;UACnCgI,yBAAyB,CAACP,cAAc,CAACzH,KAAK,CAAC;QACjD,CAAC,MAAM;UACLiI,0BAA0B,CAACR,cAAc,CAACzH,KAAK,CAAC;QAClD;MACF;IACF,CAAC;IACD;IACA,MAAMkI,2BAA2B,GAAGlI,KAAK,IAAI;MAC3CA,KAAK,CAAC4C,MAAM,GAAG5C,KAAK,CAAC4C,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC;MACzC,IAAI4C,sBAAsB,GAAGiC,cAAc,CAACzH,KAAK,CAACa,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC;MACnF,IAAI4C,sBAAsB,CAACxE,MAAM,KAAK,CAAC,EAAE;QACvCtE,OAAO,CAAC+I,KAAK,CAAC,QAAQ,CAAC;QACvBzF,KAAK,CAAC4C,MAAM,GAAG5C,KAAK,CAAC4C,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC;QACzC;MACF;MACAuF,kBAAkB,CAAC,CAAC;MACpB,IAAIvI,cAAc,CAACI,KAAK,KAAK,OAAO,EAAE;QACpCgI,yBAAyB,CAACP,cAAc,CAACzH,KAAK,CAAC;MACjD,CAAC,MAAM;QACLiI,0BAA0B,CAACR,cAAc,CAACzH,KAAK,CAAC;MAClD;IACF,CAAC;IACD;IACA,MAAMgI,yBAAyB,GAAGI,IAAI,IAAI;MACxC,IAAIC,SAAS,GAAGD,IAAI,CAACvH,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC;MACtD,IAAI0F,aAAa,GAAG,EAAE;MACtB,IAAIC,eAAe,GAAG,CAChB;QACEvG,KAAK,EAAEhE,QAAQ,GAAG;MACpB,CAAC,EACD;QACEgE,KAAK,EAAEhE,QAAQ,GAAI,MAAKC,SAAU;MACpC,CAAC,EACD;QACE+D,KAAK,EAAE9D,IAAI,GAAI,MAAKD,SAAU;MAChC,CAAC,EACD;QACE+D,KAAK,EAAE;MACT,CAAC,CACN;MACD,IAAIwG,KAAK,GAAG,CAAC;MACbH,SAAS,CAACnH,OAAO,CAACJ,IAAI,IAAI;QACxB,IAAI2H,YAAY,GAAG;UACjBzG,KAAK,EAAGlB,IAAI,CAACkB,KAAK;UAClBiC,QAAQ,EAAGsE,eAAe,CAACnF,GAAG,CAAC,CAAC1B,IAAI,EAAC2B,CAAC,KAAG;YACvC,IAAIqF,wBAAwB,GAAG;cAC7B1G,KAAK,EAAGN,IAAI,CAACM,KAAK;cAClBE,SAAS,EAAG,QAAOsG,KAAM,EAAC;cAC1B/F,QAAQ,EAAG,QAAO+F,KAAM,EAAC;cACzBlG,KAAK,EAAE,GAAG;cACVF,SAAS,EAAE;gBAACyC,SAAS,EAAG;cAAO;YACjC,CAAC;YACD,IAAGxB,CAAC,KAAMkF,eAAe,CAACvH,MAAM,GAAE,CAAE,EAAC;cACnC0H,wBAAwB,CAAC1G,KAAK,GAAGlB,IAAI,CAACkB,KAAK,CAAC2G,QAAQ,CAAC,GAAG,CAAC,GAAC,IAAI,GAACjH,IAAI,CAACM,KAAK;YAC3E;YACAwG,KAAK,EAAE;YACP,OAAOE,wBAAwB;UACjC,CAAC;QACH,CAAC;QACDJ,aAAa,CAAC3G,IAAI,CAAC8G,YAAY,CAAC;MAClC,CAAC,CAAC;MACF,IAAI7D,YAAY,GAAG;QACjB5C,KAAK,EAAG,IAAI;QACZE,SAAS,EAAG,QAAQ;QACpBI,KAAK,EAAG,EAAE;QACVK,KAAK,EAAG,OAAO;QACfP,SAAS,EAAG;UAACyC,SAAS,EAAG;QAAQ,CAAC;QAClChC,MAAMA,CAAC;UAACC;QAAM,CAAC,EAAC;UACd,OAAQ,+EAA8E;QACxF;MACF,CAAC;MACDlE,kBAAkB,CAACL,OAAO,GAAG,CAAC,GAAGoJ,WAAW,CAAC3H,KAAK,EAAC,GAAGsI,aAAa,EAAC1D,YAAY,CAAC;MACjFgE,yBAAyB,CAAC,CAAC;IAC7B,CAAC;IAED,MAAMC,4BAA4B,GAAGrE,IAAI,IAAE;MACzC5F,kBAAkB,CAACH,mBAAmB,GAAG+F,IAAI;IAC/C,CAAC;;IAED;IACA,MAAMsE,UAAU,GAAGA,CAAChG,MAAM,EAACuC,IAAI,KAAG;MAChCvH,MAAM,CAAC6D,IAAI,CAAC;QACV2B,IAAI,EAAG,WAAW;QAClByF,KAAK,EAAG;UACNC,eAAe,EAAGnD,IAAI,CAACoD,SAAS,CAACxB,cAAc,CAACzH,KAAK,CAAC;UACtDqH,MAAM,EAAGvE,MAAM,CAACuE,MAAM;UACtB6B,UAAU,EAAG7D,IAAI;UACjB8D,QAAQ,EAAGrG,MAAM,CAACqG;QACpB;MACF,CAAC,CAAC;IACJ,CAAC;IAED,MAAMC,mBAAmB,GAAGA,CAACtG,MAAM,EAACuC,IAAI,KAAG;MACzCvH,MAAM,CAAC6D,IAAI,CAAC;QACV2B,IAAI,EAAG,mBAAmB;QAC1ByF,KAAK,EAAG;UACNI,QAAQ,EAAGrG,MAAM,CAACqG,QAAQ;UAC1BzC,QAAQ,EAAC5H,WAAW,CAACkB,KAAK;UAC1BqH,MAAM,EAAGvE,MAAM,CAACuE,MAAM;UACtB6B,UAAU,EAAG7D;QACf;MACF,CAAC,CAAC;IACJ,CAAC;;IAED;IACA;IACA,MAAMgE,sBAAsB,GAAGrJ,KAAK,IAAI;MACtCJ,cAAc,CAACI,KAAK,GAAGA,KAAK;MAC5BD,gBAAgB,CAAC,CAAC;IACpB,CAAC;IACD;IACA,MAAMkI,0BAA0B,GAAGG,IAAI,IAAI;MACzC,MAAMkB,QAAQ,GAAG,EAAE;MACnB,IAAIC,eAAe,GAAGnB,IAAI,CAACvH,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAC8B,MAAM,KAAK,CAAC,CAAC;MAC5D,IAAIzE,KAAK,IAAI,CAAC,EAAE;QACd,KAAK,IAAIkF,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAI,EAAE,EAAEA,CAAC,EAAE,EAAE;UAC5BiG,QAAQ,CAAC3H,IAAI,CAAC;YACZK,KAAK,EAAEqB,CAAC,GAAG,GAAG;YACdY,QAAQ,EAAE;UACZ,CAAC,CAAC;QACJ;MACF,CAAC,MAAM;QACL,KAAK,IAAIZ,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAIpF,SAAS,EAAEoF,CAAC,EAAE,EAAE;UACnCiG,QAAQ,CAAC3H,IAAI,CAAC;YACZK,KAAK,EAAEqB,CAAC,GAAG,GAAG;YACdY,QAAQ,EAAE;UACZ,CAAC,CAAC;QACJ;MACF;MACA,MAAMuF,KAAK,GAAG,CAACxL,QAAQ,EAAEE,IAAI,CAAC;MAC9B,IAAIsK,KAAK,GAAG,CAAC;MACbc,QAAQ,CAACpI,OAAO,CAACJ,IAAI,IAAE;QACrB,IAAIyH,eAAe,GAAG,EAAE;QACxBgB,eAAe,CAACrI,OAAO,CAACQ,IAAI,IAAE;UAC5B8H,KAAK,CAACtI,OAAO,CAACW,IAAI,IAAE;YAClB,IAAI4H,oBAAoB,GAAG;cACzBzH,KAAK,EAAG,GAAEN,IAAI,CAACM,KAAM,GAAEH,IAAK,EAAC;cAC7BK,SAAS,EAAG,QAAOsG,KAAM,EAAC;cAC1B/F,QAAQ,EAAG,QAAO+F,KAAM,EAAC;cACzBlG,KAAK,EAAEZ,IAAI,CAACY,KAAK;cACjBF,SAAS,EAAEpF,KAAK,CAAC0E,IAAI,CAACU,SAAS;YACjC,CAAC;YACDmG,eAAe,CAAC5G,IAAI,CAAC8H,oBAAoB,CAAC;YAC1CjB,KAAK,EAAE;UACT,CAAC,CAAC;QACJ,CAAC,CAAC;QACF1H,IAAI,CAACmD,QAAQ,GAAGsE,eAAe;MACjC,CAAC,CAAC;MACF,IAAI3D,YAAY,GAAG;QACjB5C,KAAK,EAAG,IAAI;QACZE,SAAS,EAAG,QAAQ;QACpBI,KAAK,EAAG,EAAE;QACVK,KAAK,EAAG,OAAO;QACfP,SAAS,EAAG;UAACyC,SAAS,EAAG;QAAQ,CAAC;QAClChC,MAAMA,CAAC;UAACC;QAAM,CAAC,EAAC;UACd,OAAQ,+EAA8E;QACxF;MACF,CAAC;MACDjE,mBAAmB,CAACN,OAAO,GAAG,CAAC,GAAGoJ,WAAW,CAAC3H,KAAK,EAAC,GAAGsJ,QAAQ,EAAC1E,YAAY,CAAC;MAC7E8E,0BAA0B,CAAC,CAAC;IAC9B,CAAC;;IAED;IACA,MAAMC,yBAAyB,GAAG3E,OAAO,IAAI;MAC3CnG,mBAAmB,CAACJ,mBAAmB,GAAGuG,OAAO;IACnD,CAAC;;IAED;IACA,MAAM0E,0BAA0B,GAAGA,CAAA,KAAI;MACrC,IAAIjG,MAAM,GAAG;QACXiD,QAAQ,EAACzI,SAAS;QAClB2I,kBAAkB,EAACc,YAAY,CAAC1H,KAAK,CAACa,MAAM,CAACC,IAAI,IAAEA,IAAI,CAAC8B,MAAM,KAAI,CAAC,CAAC,CAACQ,GAAG,CAACtC,IAAI,IAAEA,IAAI,CAACoB,SAAS,CAAC;QAC9F6E,KAAK,EAAC,EAAE;QACRC,KAAK,EAAC,GAAG;QACTC,MAAM,EAAC,aAAa;QACpB5B,IAAI,EAAG;MACT,CAAC;MACDxG,mBAAmB,CAACF,OAAO,GAAG,IAAI;MAClCtB,gBAAgB,CAACoG,MAAM,CAAC,CAACyD,IAAI,CAACC,GAAG,IAAE;QACjC,IAAGA,GAAG,CAACC,IAAI,KAAK,KAAK,EAAC;UACpB9J,UAAU,CAAC6J,GAAG,CAAC3I,IAAI,CAACA,IAAI,EAAC,KAAK,EAAC,QAAQ,CAAC;UACxC,IAAIoL,UAAU,GAAG,EAAE;UACnBzC,GAAG,CAAC3I,IAAI,CAACA,IAAI,CAAC0C,OAAO,CAACJ,IAAI,IAAE8I,UAAU,CAACjI,IAAI,CAACb,IAAI,CAACL,GAAG,CAAC,CAAC;UACtD5B,mBAAmB,CAACJ,mBAAmB,GAAGmL,UAAU;UACpD/K,mBAAmB,CAACL,IAAI,GAAG2I,GAAG,CAAC3I,IAAI,CAACA,IAAI;UACxC;UACA,IAAGK,mBAAmB,CAACH,SAAS,KAAK,OAAO,EAAC;YAC3C5B,QAAQ,CAAC,MAAM;cACT,IAAI8K,kBAAkB,CAAC5H,KAAK,EAAE;gBAC9B,IAAIC,IAAI,GAAG2H,kBAAkB,CAAC5H,KAAK,CAACE,GAAG;gBACvC,IAAIC,WAAW,GAAGC,MAAM,CAACD,WAAW;gBACpC,IAAIE,QAAQ,GAAGJ,IAAI,CAACK,qBAAqB,CAAC,CAAC,CAACC,GAAG;gBAC/C1B,mBAAmB,CAACH,SAAS,GAAGmL,IAAI,CAACC,KAAK,CAAC3J,WAAW,GAAGE,QAAQ,GAAG,EAAE,CAAC,GAAG,IAAI;cAChF;YACF,CAAC,CAAC;UACJ;QACJ,CAAC,MAAK;UACJ3D,OAAO,CAAC+I,KAAK,CAAC0B,GAAG,CAAC4C,IAAI,IAAI,QAAQ,CAAC;QACrC;QACAlL,mBAAmB,CAACF,OAAO,GAAG,KAAK;MACrC,CAAC,CAAC,CAAC4I,KAAK,CAACC,GAAG,IAAE;QACZ,IAAIA,GAAG,EAAEJ,IAAI,KAAK,cAAc,EAAE;UAChCvI,mBAAmB,CAACF,OAAO,GAAG,IAAI;QAClC,CAAC,MAAM;UACLjC,OAAO,CAAC+I,KAAK,CAAC+B,GAAG,EAAEF,OAAO,IAAI,QAAQ,CAAC;UACvCzI,mBAAmB,CAACF,OAAO,GAAG,KAAK;QACrC;MACJ,CAAC,CAAC;IACJ,CAAC;;IAED;IACA,MAAMiK,yBAAyB,GAAGA,CAAA,KAAI;MACpC,IAAInF,MAAM,GAAG;QACXiD,QAAQ,EAACzI,SAAS;QAClB2I,kBAAkB,EAACc,YAAY,CAAC1H,KAAK,CAACa,MAAM,CAACC,IAAI,IAAEA,IAAI,CAAC8B,MAAM,KAAI,CAAC,CAAC,CAACQ,GAAG,CAACtC,IAAI,IAAEA,IAAI,CAACoB,SAAS,CAAC;QAC9F6E,KAAK,EAAC,EAAE;QACRC,KAAK,EAAC,GAAG;QACTC,MAAM,EAAC,aAAa;QACpB5B,IAAI,EAAG;MACT,CAAC;MACDzG,kBAAkB,CAACD,OAAO,GAAG,IAAI;MACjCtB,gBAAgB,CAACoG,MAAM,CAAC,CAACyD,IAAI,CAACC,GAAG,IAAE;QACjC,IAAGA,GAAG,CAACC,IAAI,KAAK,KAAK,EAAC;UACpB9J,UAAU,CAAC6J,GAAG,CAAC3I,IAAI,CAACA,IAAI,EAAC,KAAK,EAAC,QAAQ,CAAC;UACxC,IAAIoL,UAAU,GAAG,EAAE;UACnBzC,GAAG,CAAC3I,IAAI,CAACA,IAAI,CAAC0C,OAAO,CAACJ,IAAI,IAAE8I,UAAU,CAACjI,IAAI,CAACb,IAAI,CAACL,GAAG,CAAC,CAAC;UACtD7B,kBAAkB,CAACH,mBAAmB,GAAGmL,UAAU;UACnDhL,kBAAkB,CAACJ,IAAI,GAAG2I,GAAG,CAAC3I,IAAI,CAACA,IAAI;UACvC;UACA,IAAGI,kBAAkB,CAACF,SAAS,KAAK,OAAO,EAAC;YAC1C5B,QAAQ,CAAC,MAAM;cACT,IAAI+K,iBAAiB,CAAC7H,KAAK,EAAE;gBAC3B,IAAIC,IAAI,GAAG4H,iBAAiB,CAAC7H,KAAK,CAACE,GAAG;gBACtC,IAAIC,WAAW,GAAGC,MAAM,CAACD,WAAW;gBACpC,IAAIE,QAAQ,GAAGJ,IAAI,CAACK,qBAAqB,CAAC,CAAC,CAACC,GAAG;gBAC/C3B,kBAAkB,CAACF,SAAS,GAAGmL,IAAI,CAACC,KAAK,CAAC3J,WAAW,GAAGE,QAAQ,GAAG,EAAE,CAAC,GAAG,IAAI;cACjF;YACF,CAAC,CAAC;UACJ;QACJ,CAAC,MAAK;UACJ3D,OAAO,CAAC+I,KAAK,CAAC0B,GAAG,CAAC4C,IAAI,IAAI,QAAQ,CAAC;QACrC;QACAnL,kBAAkB,CAACD,OAAO,GAAG,KAAK;MACpC,CAAC,CAAC,CAAC4I,KAAK,CAACC,GAAG,IAAE;QACZ,IAAIA,GAAG,EAAEJ,IAAI,KAAK,cAAc,EAAE;UAChCxI,kBAAkB,CAACD,OAAO,GAAG,IAAI;QACjC,CAAC,MAAM;UACLjC,OAAO,CAAC+I,KAAK,CAAC+B,GAAG,EAAEF,OAAO,IAAI,QAAQ,CAAC;UACvC1I,kBAAkB,CAACD,OAAO,GAAG,KAAK;QACpC;MACJ,CAAC,CAAC;IACJ,CAAC;IACD;IACA,MAAMqL,kBAAkB,GAAGA,CAAClH,MAAM,EAACC,MAAM,KAAG;MAC1C,OAAO5D,aAAa,CAACI,kBAAkB,CAACwD,MAAM,CAACb,SAAS,CAAC,CAAC,CAACkB,GAAG,CAAC,CAACtC,IAAI,EAACuC,CAAC,MAAI;QAACrD,KAAK,EAAC8C,MAAM,CAACC,MAAM,CAACb,SAAS,CAAC,CAACmB,CAAC;MAAC,CAAC,CAAC,CAAC;IACjH,CAAC;IACD;IACA,MAAM4G,IAAI,GAAGA,CAACnH,MAAM,EAACqC,GAAG,KAAK;MAC3BrH,MAAM,CAAC6D,IAAI,CAAC;QACVuI,IAAI,EAAE,mBAAmB;QACzBC,KAAK,EAAE;UACLC,EAAE,EAAEtH,MAAM,CAACuE,MAAM;UACjB8B,QAAQ,EAAGrG,MAAM,CAACqG,QAAQ;UAC1BhE;QACF;MACF,CAAC,CAAC;IACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}