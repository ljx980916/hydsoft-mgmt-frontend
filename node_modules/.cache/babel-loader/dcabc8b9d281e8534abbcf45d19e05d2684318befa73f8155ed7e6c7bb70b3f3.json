{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw, shallowRef, onBeforeUnmount } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getCustomerRingList, getCustomerYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo, dataAddKey, getRedNum, getLastYearDay, getCurrentTime } from \"../../utils/util\";\nimport { useRouter, useRoute } from \"vue-router\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nexport default {\n  __name: 'customerRingSame',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    let $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\n    let {\n      lastYear,\n      lastMonth\n    } = getLastYearDay();\n    let {\n      year,\n      month\n    } = getCurrentTime();\n    let tagColumnList = useTagColumnListStore();\n    const router = useRouter();\n    const route = useRoute();\n    const {\n      id: deptId,\n      deptName,\n      tab\n    } = route.query;\n    const tabsActive = ref(tab || '1');\n    let columConfig = {};\n    const tableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"200px\",\n      loading: false\n    });\n    const selectMonth = ref(\"3\");\n    const tableRef = ref(null);\n    const tabChangeColumInfo = reactive({\n      columnTabs: [],\n      up: [],\n      down: []\n    });\n    const chartColumMap = {\n      发薪人数: [],\n      营业收入: [],\n      销售毛利率: []\n    };\n    const chartColumnNameMap = {\n      canvasLine1: \"发薪人数\",\n      canvasLine2: \"营业收入\",\n      canvasLine3: \"销售毛利率\"\n    };\n    let filterShowChildrenColumn = [];\n    // 切换环比分析和同比分析\n    const handleTab = val => {\n      tabsActive.value = val;\n      inintTableData();\n    };\n    onMounted(() => {\n      if (tableRef.value) {\n        let head = tableRef.value.$el;\n        nextTick(() => {\n          let innerHeight = window.innerHeight;\n          let elHeight = head.getBoundingClientRect().top;\n          tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n        });\n      }\n    });\n    // 初始化\n    const seltColumns = () => {\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n      if (currentPageColumn.length) {\n        currentPageColumn[0].tier.forEach((item, index) => {\n          let tabs = [];\n          let columnTabs = [];\n          let columnHasSonTabs = [];\n          let noHiddenColumn = [];\n          let defaultColumHasSonTabs = [];\n          let defaultColumnTabs = [];\n          item.tags.forEach(jtem => {\n            tabs.push(jtem.tag);\n            jtem.columns.forEach(ktem => {\n              let {\n                col,\n                conf,\n                title\n              } = ktem;\n              conf = conf || {};\n              let columnItemConfig = {\n                title,\n                dataIndex: col,\n                align: conf.align,\n                cellStyle: {\n                  \"text-align\": conf.cellAlign\n                },\n                width: conf.width,\n                ellipsis: true,\n                headerCellClass: \"noEllipsis\",\n                slotName: col,\n                bodyCellClass: \"bodyCell\",\n                fixed: conf.fixed\n              };\n              columnItemConfig.isShow = conf.isShow;\n              columnItemConfig.render = ({\n                record,\n                column\n              }) => {\n                let cellVal = record[column.dataIndex];\n                if (!Array.isArray(cellVal)) {\n                  if (column.slotName === \"title\") {\n                    return `<a-popover\n                    content-style={{ background: \"rgba(0,0,0,.8)\", color: \"#fff\" }}\n                    arrow-style={{ background: \"rgba(0,0,0,.8)\" }}\n                  >\n                    {{\n                      default: () =>\n                        record.leafNode == \"1\" ? (\n                          <span class=\"pointer\" style={{ color: \"#165dff\" }} onclick={() => jump(record)}>\n                            {record.title}\n                          </span>\n                        ) : (\n                          <span class=\"pointer\">{record.title}</span>\n                        ),\n                      content: () => record.title,\n                    }}\n                  </a-popover>`;\n                  }\n                  return '<span innerHTML={getRedNum(cellVal)}></span>';\n                } else {\n                  let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n                    tip: item.month + record[item.col],\n                    value: cellVal[i]\n                  }));\n                  return '<echartContainer route={route} height={74} width={100} />';\n                }\n              };\n              if (conf.canHide === 1) {\n                if (conf.parentCol === 0) {\n                  columnTabs.push(columnItemConfig);\n                } else {\n                  columnHasSonTabs.push(columnItemConfig);\n                }\n              } else {\n                noHiddenColumn.push(columnItemConfig);\n              }\n              if (conf.parentCol === 1) {\n                defaultColumHasSonTabs.push(columnItemConfig);\n              } else {\n                defaultColumnTabs.push(columnItemConfig);\n              }\n            });\n          });\n          columConfig[\"level\" + (index + 1)] = {\n            tabs,\n            params: item.params || [],\n            columnTabs,\n            columnHasSonTabs,\n            noHiddenColumn,\n            defaultColumnTabs,\n            defaultColumHasSonTabs\n          };\n        });\n      }\n      tabChangeColumInfo.columnTabs = columConfig.level2.columnHasSonTabs;\n    };\n    // 更换表头\n    const analysiisColumn = () => {\n      let {\n        columnTabs,\n        noHiddenColumn,\n        defaultColumHasSonTabs\n      } = columConfig.level2;\n      let num = 4;\n      switch (selectMonth.value) {\n        case \"3\":\n          let months1 = getNMonthsAgo(3, true);\n          let children1 = [];\n          let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months1.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children1.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children1;\n          break;\n        case \"6\":\n          let months2 = getNMonthsAgo(6, true);\n          let children2 = [];\n          let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months2.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children2.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children2;\n          break;\n        case \"12\":\n          let months3 = getNMonthsAgo(12, true);\n          months3 = months3.filter(item => item[0] !== 2022);\n          let children3 = [];\n          let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months3.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children3.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children3;\n          break;\n        default:\n          break;\n      }\n      Object.keys(chartColumMap).forEach(key => {\n        chartColumMap[key] = [];\n      });\n      filterShowChildrenColumn.forEach(item => {\n        if (item.children?.length) {\n          let filterShowColumns = [];\n          item.children.forEach(jtem => {\n            if (jtem.isShow === 1) {\n              filterShowColumns.push(jtem);\n            }\n            if (chartColumMap.hasOwnProperty(jtem.title)) {\n              chartColumMap[jtem.title].push({\n                month: item.title,\n                col: jtem.dataIndex\n              });\n            }\n          });\n          item.children = filterShowColumns;\n        }\n      });\n      Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return `<a href=\"javaScript:void(0)\" onClick={()=>{goRingContrastChart(record,'customer')}}>看图</a>`;\n        }\n      };\n      let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn, actionColumn];\n      tableInfo.columns = filterAllShowColumn;\n    };\n    //部门折叠\n    const expandedChange = rowKeys => {\n      tableInfo.defaultExpandedKeys = rowKeys;\n    };\n    // 切换时间区间\n    const handleMonthChange = month => {\n      selectMonth.value = month;\n      analysiisColumn();\n      getList();\n    };\n    onBeforeMount(() => {\n      seltColumns();\n      inintTableData();\n      if (deptId && deptName && tab) {\n        deptGoCustomer();\n      }\n    });\n    const inintTableData = () => {\n      if (tabsActive.value === '1') {\n        if (tableInfo.data.length === 0) {\n          analysiisColumn();\n          getList();\n        }\n      } else {\n        if (raidoGroupType.value === 'total' && sameTotalTableInfo.data.length === 0) {\n          initTotalColumns();\n        }\n        if (raidoGroupType.value === 'detail' && sameDetailTableInfo.data.length === 0) {\n          initTotalColumns();\n        }\n      }\n    };\n    // 点击标签\n    const handleTabChange = tab => {\n      switch (tab.isShow) {\n        case 0:\n          tab.isShow = 1;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 1,\n            tab\n          });\n          break;\n        case 1:\n          tab.isShow = 0;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 0,\n            tab\n          });\n          break;\n        default:\n          break;\n      }\n    };\n    // 更改高亮状态并更换表头\n    const changeShowStatus = obj => {\n      let {\n        columnTabs,\n        defaultColumHasSonTabs\n      } = columConfig.level2;\n      let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      if (filterHasSonShowColumn.length === 0) {\n        Message.error(\"至少选择一项\");\n        obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n        return;\n      }\n      if (obj.type === \"parent\") {\n        columnTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      if (obj.type === \"self\") {\n        defaultColumHasSonTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      analysiisColumn();\n      handleAbortRequest();\n      getList();\n    };\n    // 处理趋势数据\n    const construcLine = arr => {\n      arr.forEach(item => {\n        item.colNo2 = JSON.parse(item.colNo2);\n        item.colNo3 = JSON.parse(item.colNo3);\n        item.colNo4 = JSON.parse(item.colNo4);\n        if (item.children) {\n          construcLine(item.children);\n        }\n      });\n    };\n    // 获取列表数据\n    const getList = () => {\n      tableInfo.data = [];\n      tableInfo.loading = true;\n      let arr = [];\n      var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n      const mappings = {\n        发薪人数: \"colNo1\",\n        营业收入: \"colNo2\",\n        销售毛利: \"colNo3\",\n        销售毛利率: \"colNo4\",\n        直接成本: \"colNo5\",\n        人均营业收入: \"colNo6\",\n        人均直接成本: \"colNo7\",\n        未完工项目成本: \"colNo8\",\n        招聘费用: \"colNo9\",\n        销售费用: \"colNo10\",\n        管理费用: \"colNo11\"\n      };\n      newColumns.forEach(item => {\n        if (mappings[item.title]) {\n          arr.push(mappings[item.title]);\n        }\n        if (item.children) {\n          item.children.forEach(jtem => {\n            if (mappings[jtem.title]) {\n              arr.push(mappings[jtem.title]);\n            }\n          });\n        }\n      });\n      var params = {\n        interval: Number(selectMonth.value),\n        dynamicHeaderParam: Array.from(new Set(arr)),\n        xAxis: 50,\n        yAxis: 20,\n        tagKey: \"linkAnalysis2\",\n        deptId: deptId || \"\"\n      };\n      getCustomerRingList(params).then(res => {\n        if (res.code == \"200\") {\n          construcLine(res.data);\n          let data = dataAddKey(res.data, \"key\", \"title\");\n          let keys = [];\n          res.data.forEach(item => keys.push(item.title));\n          tableInfo.defaultExpandedKeys = keys;\n          tableInfo.data = data;\n        } else {\n          Message.error(res.message);\n        }\n        tableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          tableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          tableInfo.loading = false;\n        }\n      });\n    };\n    // 跳转\n    const jump = record => {\n      router.push({\n        path: \"/projectRingSame\",\n        query: {\n          customerId: record.customerId,\n          deptId,\n          deptName,\n          groupCustomerName: record.groupCustomerName,\n          title: record.title,\n          tab: tabsActive.value,\n          radiotype: raidoGroupType.value\n        }\n      });\n    };\n\n    //同比分析\n    const raidoGroupType = ref(\"total\");\n    const allHeadTagList = ref([]); // 所有的标签\n    const allTableList = ref([]); // 表头数据\n    const notShowList = shallowRef([]); // 初始没显示的表头数据\n    const sameDetailTableRef = ref(null); //同比明细表格dom\n    const sameTotalTableRef = ref(null); //同比汇总表格dom\n\n    // 点击标签\n    const handleSameContrastTabChange = value => {\n      value.isShow = value.isShow === 0 ? 1 : 0;\n      let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n      if (filterHasSonShowColumn.length === 0) {\n        Message.error(\"至少选择一项\");\n        value.isShow = value.isShow === 0 ? 1 : 0;\n        return;\n      }\n      handleAbortRequest();\n      if (raidoGroupType.value === \"total\") {\n        constructSameTotalColumns(allHeadTagList.value);\n      } else {\n        constructSameDetailColumns(allHeadTagList.value);\n      }\n    };\n    // 更改汇总/明细\n    const constructSameTabChange = value => {\n      raidoGroupType.value = value;\n      initTotalColumns();\n    };\n\n    // 初始化表头和标签数据\n    const initTotalColumns = () => {\n      allHeadTagList.value = [];\n      allTableList.value = [];\n      notShowList.value = [];\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n      if (currentPageColumn.length) {\n        const currentColumnList = currentPageColumn[0].tier[1].tags[0].columns;\n        currentColumnList.forEach(item => {\n          const {\n            col,\n            conf,\n            title\n          } = item;\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: {\n              \"text-align\": conf.cellAlign\n            },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            isShow: conf.isShow\n          };\n          if (conf.canHide == 1) {\n            allHeadTagList.value.push(columnItemConfig);\n          } else {\n            notShowList.value.push(columnItemConfig);\n          }\n          if (conf.fixed !== undefined) {\n            columnItemConfig.fixed = conf.fixed;\n          }\n          if (conf.parentCol == 1) {\n            allTableList.value.push(columnItemConfig);\n          }\n        });\n        if (raidoGroupType.value == \"total\") {\n          constructSameTotalColumns(allHeadTagList.value);\n        } else {\n          constructSameDetailColumns(allHeadTagList.value);\n        }\n      }\n    };\n\n    //同比汇总表格数据\n    const sameTotalTableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"600px\",\n      loading: false\n    });\n    const sameTotalTableExpandedChange = keys => {\n      sameTotalTableInfo.defaultExpandedKeys = keys;\n    };\n    // 构造同比汇总的表头\n    const constructSameTotalColumns = list => {\n      let tableList = list.filter(item => item.isShow === 1);\n      let createColumns = [];\n      let childrenColumns = [{\n        title: lastYear + \"/1-12\"\n      }, {\n        title: lastYear + `/1-${lastMonth}`\n      }, {\n        title: year + `/1-${lastMonth}`\n      }, {\n        title: \"同比\"\n      }];\n      let colNo = 5;\n      tableList.forEach(item => {\n        let columnConfig = {\n          title: item.title,\n          children: childrenColumns.map((jtem, i) => {\n            let childrenColumnItemConfig = {\n              title: jtem.title,\n              dataIndex: `colNo${colNo}`,\n              slotName: `colNo${colNo}`,\n              width: 110,\n              cellStyle: {\n                textAlign: 'right'\n              }\n            };\n            if (i === childrenColumns.length - 1) {\n              childrenColumnItemConfig.title = item.title.endsWith('率') ? '偏离' : jtem.title;\n            }\n            colNo++;\n            return childrenColumnItemConfig;\n          })\n        };\n        createColumns.push(columnConfig);\n      });\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return `<a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'customer')}}>看图</a>`;\n        }\n      };\n      sameTotalTableInfo.columns = [...notShowList.value, ...createColumns, actionColumn];\n      getConstructSameTotalList();\n    };\n\n    //同比分析汇总接口\n    const getConstructSameTotalList = () => {\n      let params = {\n        interval: lastMonth,\n        dynamicHeaderParam: allTableList.value.filter(item => item.isShow === 1).map(item => item.dataIndex),\n        xAxis: 74,\n        yAxis: 100,\n        tagKey: \"yoyAnalysis2\",\n        deptId: deptId || \"\",\n        type: '1'\n      };\n      if (!deptId) {\n        Reflect.deleteProperty(params, 'deptId');\n      }\n      sameTotalTableInfo.loading = true;\n      getCustomerYoyAnalysis(params).then(res => {\n        if (res.code === '200') {\n          dataAddKey(res.data, 'key', 'deptId');\n          let expandKeys = [];\n          res.data.forEach(item => expandKeys.push(item.key));\n          sameTotalTableInfo.defaultExpandedKeys = expandKeys;\n          sameTotalTableInfo.data = res.data;\n          //计算表格不出滚动条的最大高度\n          if (sameTotalTableInfo.maxHeight === '600px') {\n            nextTick(() => {\n              if (sameTotalTableRef.value) {\n                let head = sameTotalTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameTotalTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n          }\n        } else {\n          Message.error(res.message || '请求数据失败');\n        }\n        sameTotalTableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          sameTotalTableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          sameTotalTableInfo.loading = false;\n        }\n      });\n    };\n\n    //同比明细表格数据\n    const sameDetailTableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"600px\",\n      loading: false\n    });\n    //同比分析明细表格展开/折叠\n    const detailTableExpandedChange = rowKeys => {\n      sameDetailTableInfo.defaultExpandedKeys = rowKeys;\n    };\n    // 构造同比明细的表头结构\n    const constructSameDetailColumns = list => {\n      const timeData = [];\n      let activeTableList = list.filter(item => item.isShow === 1);\n      if (month == 1) {\n        for (var i = 1; i <= 12; i++) {\n          timeData.push({\n            title: i + \"月\",\n            children: []\n          });\n        }\n      } else {\n        for (var i = 1; i <= lastMonth; i++) {\n          timeData.push({\n            title: i + \"月\",\n            children: []\n          });\n        }\n      }\n      const years = [lastYear, year];\n      let colNo = 5;\n      timeData.forEach(item => {\n        let childrenColumns = [];\n        activeTableList.forEach(jtem => {\n          years.forEach(ktem => {\n            let contrastColumnConfig = {\n              title: `${jtem.title}${ktem}`,\n              dataIndex: `colNo${colNo}`,\n              slotName: `colNo${colNo}`,\n              width: jtem.width,\n              cellStyle: toRaw(jtem.cellStyle)\n            };\n            childrenColumns.push(contrastColumnConfig);\n            colNo++;\n          });\n        });\n        item.children = childrenColumns;\n      });\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return `<a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'customer')}}>看图</a>`;\n        }\n      };\n      sameDetailTableInfo.columns = [...notShowList.value, ...timeData, actionColumn];\n      getConstructSameDetailList();\n    };\n\n    //同比分析集团客户维度明细接口\n    const getConstructSameDetailList = () => {\n      let params = {\n        interval: lastMonth,\n        dynamicHeaderParam: allTableList.value.filter(item => item.isShow === 1).map(item => item.dataIndex),\n        xAxis: 74,\n        yAxis: 100,\n        tagKey: \"yoyAnalysis2\",\n        deptId: deptId || \"\",\n        type: '2'\n      };\n      sameDetailTableInfo.loading = true;\n      getCustomerYoyAnalysis(params).then(res => {\n        if (res.code === '200') {\n          dataAddKey(res.data, 'key', 'deptId');\n          let expandKeys = [];\n          res.data.forEach(item => expandKeys.push(item.key));\n          sameDetailTableInfo.defaultExpandedKeys = expandKeys;\n          sameDetailTableInfo.data = res.data;\n          //计算表格不出滚动条的最大高度\n          if (sameDetailTableInfo.maxHeight === '600px') {\n            nextTick(() => {\n              if (sameDetailTableRef.value) {\n                let head = sameDetailTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameDetailTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n          }\n        } else {\n          Message.error(res.message || '请求数据失败');\n        }\n        sameDetailTableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          sameDetailTableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          sameDetailTableInfo.loading = false;\n        }\n      });\n    };\n\n    //跳转同比分析看图页\n    const goLookChat = (record, type) => {\n      router.push({\n        name: 'lookChart',\n        state: {\n          barChartOptions: JSON.stringify(allHeadTagList.value),\n          deptId: record.deptId,\n          title: record.title,\n          sourceType: type,\n          taxRate: record.taxRate,\n          projectId: record.finPcode,\n          groupCustomerName: record.groupCustomerName,\n          customerName: record.customerName,\n          projectName: record.projectName,\n          deptName\n        }\n      });\n    };\n\n    //跳转环比分析看图页\n    const goRingContrastChart = (record, type) => {\n      router.push({\n        name: 'ringContrastChart',\n        state: {\n          interval: selectMonth.value,\n          deptId: deptId ? record.deptId : \"\",\n          sourceType: type,\n          title: record.title,\n          deptName,\n          customerId: record.customerId\n        }\n      });\n    };\n    //echarts缩略图的路径信息\n    const createEchartsRoute = (record, column) => {\n      return record[column.dataIndex].map((item, i) => ({\n        value: record[column.dataIndex][i]\n      }));\n    };\n    const deptGoCustomer = () => {\n      let breadList;\n      switch (tab) {\n        case '1':\n          breadList = [{\n            type: \"button\",\n            color: \"#5370FD\",\n            msg: '环比分析列表',\n            isBack: true\n          }, {\n            type: \"text\",\n            color: \"#333\",\n            msg: deptName\n          }];\n          break;\n        case '2':\n          breadList = [{\n            type: \"text\",\n            color: \"#333\",\n            msg: '同比分析列表'\n          }, {\n            type: \"button\",\n            color: \"#5370FD\",\n            msg: deptName,\n            isBack: true\n          }];\n          break;\n        default:\n          break;\n      }\n      $bus.emit(\"updateStructure\", breadList);\n    };\n    const __returned__ = {\n      get $bus() {\n        return $bus;\n      },\n      set $bus(v) {\n        $bus = v;\n      },\n      get lastYear() {\n        return lastYear;\n      },\n      set lastYear(v) {\n        lastYear = v;\n      },\n      get lastMonth() {\n        return lastMonth;\n      },\n      set lastMonth(v) {\n        lastMonth = v;\n      },\n      get year() {\n        return year;\n      },\n      set year(v) {\n        year = v;\n      },\n      get month() {\n        return month;\n      },\n      set month(v) {\n        month = v;\n      },\n      get tagColumnList() {\n        return tagColumnList;\n      },\n      set tagColumnList(v) {\n        tagColumnList = v;\n      },\n      router,\n      route,\n      deptId,\n      deptName,\n      tab,\n      tabsActive,\n      get columConfig() {\n        return columConfig;\n      },\n      set columConfig(v) {\n        columConfig = v;\n      },\n      tableInfo,\n      selectMonth,\n      tableRef,\n      tabChangeColumInfo,\n      chartColumMap,\n      chartColumnNameMap,\n      get filterShowChildrenColumn() {\n        return filterShowChildrenColumn;\n      },\n      set filterShowChildrenColumn(v) {\n        filterShowChildrenColumn = v;\n      },\n      handleTab,\n      seltColumns,\n      analysiisColumn,\n      expandedChange,\n      handleMonthChange,\n      inintTableData,\n      handleTabChange,\n      changeShowStatus,\n      construcLine,\n      getList,\n      jump,\n      raidoGroupType,\n      allHeadTagList,\n      allTableList,\n      notShowList,\n      sameDetailTableRef,\n      sameTotalTableRef,\n      handleSameContrastTabChange,\n      constructSameTabChange,\n      initTotalColumns,\n      sameTotalTableInfo,\n      sameTotalTableExpandedChange,\n      constructSameTotalColumns,\n      getConstructSameTotalList,\n      sameDetailTableInfo,\n      detailTableExpandedChange,\n      constructSameDetailColumns,\n      getConstructSameDetailList,\n      goLookChat,\n      goRingContrastChart,\n      createEchartsRoute,\n      deptGoCustomer,\n      get Message() {\n        return Message;\n      },\n      onBeforeMount,\n      reactive,\n      ref,\n      nextTick,\n      onMounted,\n      toRaw,\n      shallowRef,\n      onBeforeUnmount,\n      get useTagColumnListStore() {\n        return useTagColumnListStore;\n      },\n      get getCustomerRingList() {\n        return getCustomerRingList;\n      },\n      get getCustomerYoyAnalysis() {\n        return getCustomerYoyAnalysis;\n      },\n      get getNMonthsAgo() {\n        return getNMonthsAgo;\n      },\n      get dataAddKey() {\n        return dataAddKey;\n      },\n      get getRedNum() {\n        return getRedNum;\n      },\n      get getLastYearDay() {\n        return getLastYearDay;\n      },\n      get getCurrentTime() {\n        return getCurrentTime;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get useRoute() {\n        return useRoute;\n      },\n      echartContainer,\n      get getCurrentInstance() {\n        return getCurrentInstance;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["Message","onBeforeMount","reactive","ref","nextTick","onMounted","toRaw","shallowRef","onBeforeUnmount","useTagColumnListStore","getCustomerRingList","getCustomerYoyAnalysis","getNMonthsAgo","dataAddKey","getRedNum","getLastYearDay","getCurrentTime","useRouter","useRoute","echartContainer","getCurrentInstance","$bus","appContext","config","globalProperties","lastYear","lastMonth","year","month","tagColumnList","router","route","id","deptId","deptName","tab","query","tabsActive","columConfig","tableInfo","columns","data","defaultExpandedKeys","maxHeight","loading","selectMonth","tableRef","tabChangeColumInfo","columnTabs","up","down","chartColumMap","发薪人数","营业收入","销售毛利率","chartColumnNameMap","canvasLine1","canvasLine2","canvasLine3","filterShowChildrenColumn","handleTab","val","value","inintTableData","head","$el","innerHeight","window","elHeight","getBoundingClientRect","top","seltColumns","tagColumns","getTagColumnList","currentPageColumn","filter","item","report","length","tier","forEach","index","tabs","columnHasSonTabs","noHiddenColumn","defaultColumHasSonTabs","defaultColumnTabs","tags","jtem","push","tag","ktem","col","conf","title","columnItemConfig","dataIndex","align","cellStyle","cellAlign","width","ellipsis","headerCellClass","slotName","bodyCellClass","fixed","isShow","render","record","column","cellVal","Array","isArray","map","i","tip","canHide","parentCol","params","level2","analysiisColumn","num","months1","children1","filterHasSonShowColumn1","columnHasSonConfig","children","j","months2","children2","filterHasSonShowColumn2","months3","children3","filterHasSonShowColumn3","Object","keys","key","filterShowColumns","hasOwnProperty","reverse","actionColumn","textAlign","filterAllShowColumn","expandedChange","rowKeys","handleMonthChange","getList","deptGoCustomer","raidoGroupType","sameTotalTableInfo","initTotalColumns","sameDetailTableInfo","handleTabChange","changeShowStatus","type","obj","filterHasSonShowColumn","error","handleAbortRequest","construcLine","arr","colNo2","JSON","parse","colNo3","colNo4","newColumns","stringify","mappings","销售毛利","直接成本","人均营业收入","人均直接成本","未完工项目成本","招聘费用","销售费用","管理费用","interval","Number","dynamicHeaderParam","from","Set","xAxis","yAxis","tagKey","then","res","code","message","catch","err","jump","path","customerId","groupCustomerName","radiotype","allHeadTagList","allTableList","notShowList","sameDetailTableRef","sameTotalTableRef","handleSameContrastTabChange","constructSameTotalColumns","constructSameDetailColumns","constructSameTabChange","currentColumnList","undefined","sameTotalTableExpandedChange","list","tableList","createColumns","childrenColumns","colNo","columnConfig","childrenColumnItemConfig","endsWith","getConstructSameTotalList","Reflect","deleteProperty","expandKeys","Math","round","detailTableExpandedChange","timeData","activeTableList","years","contrastColumnConfig","getConstructSameDetailList","goLookChat","name","state","barChartOptions","sourceType","taxRate","projectId","finPcode","customerName","projectName","goRingContrastChart","createEchartsRoute","breadList","color","msg","isBack","emit"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/src/views/ringAnalyze/customerRingSame.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <a-tabs v-model:active-key=\"tabsActive\" @change=\"handleTab\" class=\"tabs\">\n      <a-tab-pane key=\"1\" title=\"环比分析\" class=\"p-t-10\">\n        <!-- 配置表头 -->\n        <div class=\"flex-between\">\n          <a-space :size=\"['small', 0]\" wrap>\n            <a-tag\n              v-for=\"(item, index) of tabChangeColumInfo.columnTabs\"\n              :key=\"index\"\n              :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n              size=\"large\"\n              class=\"pointer\"\n              @click=\"handleTabChange(item)\"\n            >\n              {{ item.title }}\n            </a-tag>\n          </a-space>\n          <div style=\"position: relative; top: -1px\">\n            <a-select v-model:model-value=\"selectMonth\" @change=\"handleMonthChange\">\n              <a-option value=\"3\">近3个月</a-option>\n              <a-option value=\"6\">近6个月</a-option>\n              <a-option value=\"12\">近12个月</a-option>\n              <template #arrow-icon>\n                <icon-calendar :size=\"16\" />\n              </template>\n            </a-select>\n          </div>\n        </div>\n        <!-- 表格 -->\n        <div class=\"m-t-20\">\n          <a-table\n            :columns=\"tableInfo.columns\"\n            :data=\"tableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"tableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: tableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"tableInfo.loading\"\n            ref=\"tableRef\"\n            @expanded-change=\"expandedChange\"\n          ></a-table>\n        </div>\n      </a-tab-pane>\n      <a-tab-pane key=\"2\" title=\"同比分析\" class=\"p-t-10\">\n        <div class=\"flex-between\">\n              <a-space :size=\"['small', 0]\" wrap>\n                <a-tag\n                  v-for=\"(item, index) of allTableList\"\n                  :key=\"index\"\n                  :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n                  size=\"large\"\n                  class=\"pointer\"\n                  @click=\"handleSameContrastTabChange(item)\"\n                >\n                  {{ item.title }}\n                </a-tag>\n              </a-space>\n              <div style=\"position: relative; top: -1px\">\n                <a-radio-group v-model:model-value=\"raidoGroupType\" type=\"button\" @change=\"constructSameTabChange\">\n                  <a-radio value=\"total\">汇总</a-radio>\n                  <a-radio value=\"detail\">明细</a-radio>\n                </a-radio-group>\n              </div>\n        </div>\n        <div v-show=\"raidoGroupType === 'total'\">\n          <a-table\n            :columns=\"sameTotalTableInfo.columns\"\n            :data=\"sameTotalTableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"sameTotalTableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: sameTotalTableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"sameTotalTableInfo.loading\"\n            ref=\"sameTotalTableRef\"\n            class=\"m-t-20\"\n            @expanded-change=\"sameTotalTableExpandedChange\"\n          >\n            <template #title=\"{ record }\">\n              <a-popover\n                :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n              >\n              <a href=\"javaScript:void(0)\" v-if=\"record.leafNode === '1'\" style=\"color: #165dff\" @click=\"jump(record)\">\n                {{ record.title }}\n              </a>\n              <span class=\"pointer\" v-else>{{ record.title }}</span>\n                <template #content>\n                  {{ record.title }}\n                </template>\n              </a-popover>\n            </template>\n            <template #canvasLine1=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n            <template #canvasLine2=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n            <template #canvasLine3=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n          </a-table>\n          </div>\n        <div v-show=\"raidoGroupType === 'detail'\">\n          <a-table\n              :columns=\"sameDetailTableInfo.columns\"\n              :data=\"sameDetailTableInfo.data\"\n              :default-expand-all-rows=\"true\"\n              :bordered=\"{ cell: true }\"\n              column-resizable\n              :expanded-keys=\"sameDetailTableInfo.defaultExpandedKeys\"\n              :scroll=\"{ maxHeight: sameDetailTableInfo.maxHeight }\"\n              :scrollbar=\"{ x: true, y: 1500 }\"\n              :pagination=\"false\"\n              :loading=\"sameDetailTableInfo.loading\"\n              ref=\"sameDetailTableRef\"\n              class=\" m-t-20\"\n              @expanded-change=\"detailTableExpandedChange\"\n            >\n              <template #title=\"{ record }\">\n                <a-popover\n                  :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                  :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n                >\n                <a href=\"javaScript:void(0)\" v-if=\"record.leafNode === '1'\" style=\"color: #165dff\" @click=\"jump(record)\">\n                  {{ record.title }}\n                </a>\n                <span class=\"pointer\" v-else>{{ record.title }}</span>\n                  <template #content>\n                    {{ record.title }}\n                  </template>\n                </a-popover>\n              </template>\n              <template #canvasLine1=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine2=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine3=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n            </a-table>\n        </div>\n      </a-tab-pane>\n    </a-tabs>\n  </div>\n</template>\n\n<script setup>\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw,shallowRef,onBeforeUnmount } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getCustomerRingList, getCustomerYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo, dataAddKey, getRedNum,getLastYearDay, getCurrentTime} from \"../../utils/util\";\nimport { useRouter, useRoute } from \"vue-router\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\nlet { lastYear, lastMonth } = getLastYearDay();\nlet { year, month } = getCurrentTime();\nlet tagColumnList = useTagColumnListStore();\nconst router = useRouter();\nconst route = useRoute();\nconst { id:deptId ,deptName,tab } = route.query\nconst tabsActive = ref(tab||'1');\nlet columConfig = {};\nconst tableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"200px\",\n  loading: false,\n});\nconst selectMonth = ref(\"3\");\nconst tableRef = ref(null);\nconst tabChangeColumInfo = reactive({\n  columnTabs: [],\n  up: [],\n  down: [],\n});\nconst chartColumMap = {\n  发薪人数: [],\n  营业收入: [],\n  销售毛利率: [],\n};\nconst chartColumnNameMap = {\n  canvasLine1: \"发薪人数\",\n  canvasLine2: \"营业收入\",\n  canvasLine3: \"销售毛利率\",\n};\nlet filterShowChildrenColumn = [];\n// 切换环比分析和同比分析\nconst handleTab = val => {\n  tabsActive.value = val;\n  inintTableData()\n};\nonMounted(() => {\n  if (tableRef.value) {\n    let head = tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\n// 初始化\nconst seltColumns = () => {\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n  if (currentPageColumn.length) {\n    currentPageColumn[0].tier.forEach((item, index) => {\n      let tabs = [];\n      let columnTabs = [];\n      let columnHasSonTabs = [];\n      let noHiddenColumn = [];\n      let defaultColumHasSonTabs = [];\n      let defaultColumnTabs = [];\n      item.tags.forEach(jtem => {\n        tabs.push(jtem.tag);\n        jtem.columns.forEach(ktem => {\n          let { col, conf, title } = ktem;\n          conf = conf || {};\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: { \"text-align\": conf.cellAlign },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            fixed : conf.fixed\n          };\n          columnItemConfig.isShow = conf.isShow;\n          columnItemConfig.render = ({ record, column }) => {\n            let cellVal = record[column.dataIndex];\n            if (!Array.isArray(cellVal)) {\n              if (column.slotName === \"title\") {\n                return (\n                  `<a-popover\n                    content-style={{ background: \"rgba(0,0,0,.8)\", color: \"#fff\" }}\n                    arrow-style={{ background: \"rgba(0,0,0,.8)\" }}\n                  >\n                    {{\n                      default: () =>\n                        record.leafNode == \"1\" ? (\n                          <span class=\"pointer\" style={{ color: \"#165dff\" }} onclick={() => jump(record)}>\n                            {record.title}\n                          </span>\n                        ) : (\n                          <span class=\"pointer\">{record.title}</span>\n                        ),\n                      content: () => record.title,\n                    }}\n                  </a-popover>`\n                );\n              }\n              return '<span innerHTML={getRedNum(cellVal)}></span>';\n            } else {\n              let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n                tip: item.month + record[item.col],\n                value: cellVal[i],\n              }));\n              return '<echartContainer route={route} height={74} width={100} />';\n            }\n          };\n          if (conf.canHide === 1) {\n            if (conf.parentCol === 0) {\n              columnTabs.push(columnItemConfig);\n            } else {\n              columnHasSonTabs.push(columnItemConfig);\n            }\n          } else {\n            noHiddenColumn.push(columnItemConfig);\n          }\n          if (conf.parentCol === 1) {\n            defaultColumHasSonTabs.push(columnItemConfig);\n          } else {\n            defaultColumnTabs.push(columnItemConfig);\n          }\n        });\n      });\n      columConfig[\"level\" + (index + 1)] = {\n        tabs,\n        params: item.params || [],\n        columnTabs,\n        columnHasSonTabs,\n        noHiddenColumn,\n        defaultColumnTabs,\n        defaultColumHasSonTabs,\n      };\n    });\n  }\n  tabChangeColumInfo.columnTabs = columConfig.level2.columnHasSonTabs;\n};\n// 更换表头\nconst analysiisColumn = () => {\n  let { columnTabs, noHiddenColumn, defaultColumHasSonTabs } = columConfig.level2;\n  let num = 4;\n  switch (selectMonth.value) {\n    case \"3\":\n      let months1 = getNMonthsAgo(3, true);\n      let children1 = [];\n      let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months1.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children1.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children1;\n      break;\n    case \"6\":\n      let months2 = getNMonthsAgo(6, true);\n      let children2 = [];\n      let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months2.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children2.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children2;\n      break;\n    case \"12\":\n      let months3 = getNMonthsAgo(12, true);\n      months3 = months3.filter(item=>item[0]!==2022)\n      let children3 = [];\n      let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months3.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children3.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children3;\n      break;\n    default:\n      break;\n  }\n  Object.keys(chartColumMap).forEach(key => {\n    chartColumMap[key] = [];\n  });\n  filterShowChildrenColumn.forEach(item => {\n    if (item.children?.length) {\n      let filterShowColumns = [];\n      item.children.forEach(jtem => {\n        if (jtem.isShow === 1) {\n          filterShowColumns.push(jtem);\n        }\n        if (chartColumMap.hasOwnProperty(jtem.title)) {\n          chartColumMap[jtem.title].push({\n            month: item.title,\n            col: jtem.dataIndex,\n          });\n        }\n      });\n      item.children = filterShowColumns;\n    }\n  });\n  Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return `<a href=\"javaScript:void(0)\" onClick={()=>{goRingContrastChart(record,'customer')}}>看图</a>`\n    }\n  }\n  let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn,actionColumn];\n  tableInfo.columns = filterAllShowColumn;\n};\n//部门折叠\nconst expandedChange = rowKeys => {\n  tableInfo.defaultExpandedKeys = rowKeys;\n};\n// 切换时间区间\nconst handleMonthChange = month => {\n  selectMonth.value = month;\n  analysiisColumn();\n  getList();\n};\nonBeforeMount(() => {\n  seltColumns();\n  inintTableData()\n  if(deptId && deptName && tab){\n    deptGoCustomer()\n  }\n});\nconst inintTableData = ()=>{\n  if(tabsActive.value === '1'){\n    if(tableInfo.data.length === 0){\n      analysiisColumn();\n      getList();\n    }\n  }else {\n    if(raidoGroupType.value === 'total' && sameTotalTableInfo.data.length === 0){\n      initTotalColumns();\n    }\n    if(raidoGroupType.value === 'detail' && sameDetailTableInfo.data.length === 0){\n      initTotalColumns();\n    }\n  }\n}\n// 点击标签\nconst handleTabChange = tab => {\n  switch (tab.isShow) {\n    case 0:\n      tab.isShow = 1;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 1,\n        tab,\n      });\n      break;\n    case 1:\n      tab.isShow = 0;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 0,\n        tab,\n      });\n      break;\n    default:\n      break;\n  }\n};\n// 更改高亮状态并更换表头\nconst changeShowStatus = obj => {\n  let { columnTabs, defaultColumHasSonTabs } = columConfig.level2;\n  let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n    return;\n  }\n  if (obj.type === \"parent\") {\n    columnTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  if (obj.type === \"self\") {\n    defaultColumHasSonTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  analysiisColumn();\n  handleAbortRequest();\n  getList();\n};\n// 处理趋势数据\nconst construcLine = arr => {\n  arr.forEach(item => {\n    item.colNo2 = JSON.parse(item.colNo2);\n    item.colNo3 = JSON.parse(item.colNo3);\n    item.colNo4 = JSON.parse(item.colNo4);\n    if (item.children) {\n      construcLine(item.children);\n    }\n  });\n};\n// 获取列表数据\nconst getList = () => {\n  tableInfo.data = [];\n  tableInfo.loading = true;\n  let arr = [];\n  var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n  const mappings = {\n    发薪人数: \"colNo1\",\n    营业收入: \"colNo2\",\n    销售毛利: \"colNo3\",\n    销售毛利率: \"colNo4\",\n    直接成本: \"colNo5\",\n    人均营业收入: \"colNo6\",\n    人均直接成本: \"colNo7\",\n    未完工项目成本: \"colNo8\",\n    招聘费用: \"colNo9\",\n    销售费用: \"colNo10\",\n    管理费用: \"colNo11\",\n  };\n  newColumns.forEach(item => {\n    if (mappings[item.title]) {\n      arr.push(mappings[item.title]);\n    }\n    if (item.children) {\n      item.children.forEach(jtem => {\n        if (mappings[jtem.title]) {\n          arr.push(mappings[jtem.title]);\n        }\n      });\n    }\n  });\n  \n  var params = {\n    interval: Number(selectMonth.value),\n      dynamicHeaderParam: Array.from(new Set(arr)),\n      xAxis: 50,\n      yAxis: 20,\n      tagKey: \"linkAnalysis2\",\n      deptId : deptId || \"\",\n  };\n  getCustomerRingList(params)\n    .then(res => {\n      if (res.code == \"200\") {\n        construcLine(res.data);\n        let data = dataAddKey(res.data, \"key\", \"title\");\n        let keys = [];\n        res.data.forEach(item => keys.push(item.title));\n        tableInfo.defaultExpandedKeys = keys;\n        tableInfo.data = data;\n      } else {\n        Message.error(res.message);\n      }\n      tableInfo.loading = false;\n    })\n    .catch(err => {\n      if (err?.code === \"ERR_CANCELED\") {\n        tableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        tableInfo.loading = false;\n      }\n    });\n};\n// 跳转\nconst jump = record => {\n  router.push({\n    path: \"/projectRingSame\",\n    query: {\n      customerId: record.customerId,\n      deptId,\n      deptName,\n      groupCustomerName : record.groupCustomerName,\n      title : record.title,\n      tab : tabsActive.value,\n      radiotype : raidoGroupType.value\n    },\n  });\n  \n};\n\n//同比分析\nconst raidoGroupType = ref(\"total\");\nconst allHeadTagList = ref([]); // 所有的标签\nconst allTableList = ref([]); // 表头数据\nconst notShowList = shallowRef([]); // 初始没显示的表头数据\nconst sameDetailTableRef = ref(null) //同比明细表格dom\nconst sameTotalTableRef = ref(null)//同比汇总表格dom\n\n// 点击标签\nconst handleSameContrastTabChange = value => {\n  value.isShow = value.isShow === 0 ? 1 : 0;\n  let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    value.isShow = value.isShow === 0 ? 1 : 0;\n    return;\n  }\n  handleAbortRequest()\n  if (raidoGroupType.value === \"total\") {\n    constructSameTotalColumns(allHeadTagList.value);\n  } else {\n    constructSameDetailColumns(allHeadTagList.value);\n  }\n};\n// 更改汇总/明细\nconst constructSameTabChange = value => {\n  raidoGroupType.value = value;\n  initTotalColumns();\n};\n\n// 初始化表头和标签数据\nconst initTotalColumns = () => {\n  allHeadTagList.value = [];\n  allTableList.value = [];\n  notShowList.value = [];\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n  if (currentPageColumn.length) {\n    const currentColumnList = currentPageColumn[0].tier[1].tags[0].columns;\n    currentColumnList.forEach(item => {\n      const { col, conf, title } = item;\n      let columnItemConfig = {\n        title,\n        dataIndex: col,\n        align: conf.align,\n        cellStyle: { \"text-align\": conf.cellAlign },\n        width: conf.width,\n        ellipsis: true,\n        headerCellClass: \"noEllipsis\",\n        slotName: col,\n        bodyCellClass: \"bodyCell\",\n        isShow: conf.isShow,\n      };\n      if (conf.canHide == 1) {\n        allHeadTagList.value.push(columnItemConfig);\n      } else {\n        notShowList.value.push(columnItemConfig);\n      }\n      if(conf.fixed !== undefined){\n        columnItemConfig.fixed = conf.fixed\n      }\n      if (conf.parentCol == 1) {\n        allTableList.value.push(columnItemConfig);\n      }\n    });\n    if (raidoGroupType.value == \"total\") {\n      constructSameTotalColumns(allHeadTagList.value);\n    } else {\n      constructSameDetailColumns(allHeadTagList.value);\n    }\n  }\n};\n\n//同比汇总表格数据\nconst sameTotalTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n});\n\nconst sameTotalTableExpandedChange = keys=>{\n  sameTotalTableInfo.defaultExpandedKeys = keys\n}\n// 构造同比汇总的表头\nconst constructSameTotalColumns = list => {\n  let tableList = list.filter(item => item.isShow === 1);\n  let createColumns = []\n  let childrenColumns = [\n        {\n          title: lastYear + \"/1-12\",\n        },\n        {\n          title: lastYear + `/1-${lastMonth}`,\n        },\n        {\n          title: year + `/1-${lastMonth}`,\n        },\n        {\n          title: \"同比\",\n        },\n  ]\n  let colNo = 5\n  tableList.forEach(item => {\n    let columnConfig = {\n      title : item.title,\n      children : childrenColumns.map((jtem,i)=>{\n        let childrenColumnItemConfig = {\n          title : jtem.title,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: 110,\n          cellStyle: {textAlign : 'right'},\n        }\n        if(i === (childrenColumns.length -1)){\n          childrenColumnItemConfig.title = item.title.endsWith('率')?'偏离':jtem.title\n        }\n        colNo++\n        return childrenColumnItemConfig\n      })\n    }\n    createColumns.push(columnConfig)\n  });\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return `<a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'customer')}}>看图</a>`\n    }\n  }\n  sameTotalTableInfo.columns = [...notShowList.value,...createColumns,actionColumn]\n  getConstructSameTotalList()\n};\n\n//同比分析汇总接口\nconst getConstructSameTotalList = ()=>{\n  let params = {\n    interval:lastMonth,\n    dynamicHeaderParam:allTableList.value.filter(item=>item.isShow ===1).map(item=>item.dataIndex),\n    xAxis:74,\n    yAxis:100,\n    tagKey:\"yoyAnalysis2\",\n    deptId : deptId || \"\",\n    type : '1'\n  }\n  if(!deptId){\n    Reflect.deleteProperty(params,'deptId')\n  }\n  sameTotalTableInfo.loading = true\n  getCustomerYoyAnalysis(params).then(res=>{\n    if(res.code === '200'){\n      dataAddKey(res.data,'key','deptId')\n      let expandKeys = []\n      res.data.forEach(item=>expandKeys.push(item.key))\n      sameTotalTableInfo.defaultExpandedKeys = expandKeys\n      sameTotalTableInfo.data = res.data\n      //计算表格不出滚动条的最大高度\n      if(sameTotalTableInfo.maxHeight === '600px'){\n        nextTick(() => {\n              if (sameTotalTableRef.value) {\n                let head = sameTotalTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameTotalTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n            }\n          });\n        }\n    }else {\n      Message.error(res.message || '请求数据失败')\n    }\n    sameTotalTableInfo.loading = false;\n  }).catch(err=>{\n    if (err?.code === \"ERR_CANCELED\") {\n      sameTotalTableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        sameTotalTableInfo.loading = false;\n      }\n  })\n}\n\n//同比明细表格数据\nconst sameDetailTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n});\n//同比分析明细表格展开/折叠\nconst detailTableExpandedChange = rowKeys => {\n  sameDetailTableInfo.defaultExpandedKeys = rowKeys;\n};\n// 构造同比明细的表头结构\nconst constructSameDetailColumns = list => {\n  const timeData = [];\n  let activeTableList = list.filter(item => item.isShow === 1);\n  if (month == 1) {\n    for (var i = 1; i <= 12; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  } else {\n    for (var i = 1; i <= lastMonth; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  }\n  const years = [lastYear, year];\n  let colNo = 5\n  timeData.forEach(item=>{\n    let childrenColumns = []\n    activeTableList.forEach(jtem=>{\n      years.forEach(ktem=>{\n        let contrastColumnConfig = {\n          title: `${jtem.title}${ktem}`,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: jtem.width,\n          cellStyle: toRaw(jtem.cellStyle),\n        }\n        childrenColumns.push(contrastColumnConfig)\n        colNo++\n      })\n    })\n    item.children = childrenColumns\n  })\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return `<a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'customer')}}>看图</a>`\n    }\n  }\n  sameDetailTableInfo.columns = [...notShowList.value,...timeData,actionColumn]\n  getConstructSameDetailList()\n};\n\n//同比分析集团客户维度明细接口\nconst getConstructSameDetailList = ()=>{\n  let params = {\n    interval:lastMonth,\n    dynamicHeaderParam:allTableList.value.filter(item=>item.isShow ===1).map(item=>item.dataIndex),\n    xAxis:74,\n    yAxis:100,\n    tagKey:\"yoyAnalysis2\",\n    deptId : deptId || \"\",\n    type : '2'\n  }\n  sameDetailTableInfo.loading = true\n  getCustomerYoyAnalysis(params).then(res=>{\n    if(res.code === '200'){\n      dataAddKey(res.data,'key','deptId')\n      let expandKeys = []\n      res.data.forEach(item=>expandKeys.push(item.key))\n      sameDetailTableInfo.defaultExpandedKeys = expandKeys\n      sameDetailTableInfo.data = res.data\n      //计算表格不出滚动条的最大高度\n      if(sameDetailTableInfo.maxHeight === '600px'){\n        nextTick(() => {\n              if (sameDetailTableRef.value) {\n              let head = sameDetailTableRef.value.$el;\n              let innerHeight = window.innerHeight;\n              let elHeight = head.getBoundingClientRect().top;\n              sameDetailTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n            }\n          });\n        }\n    }else {\n      Message.error(res.message || '请求数据失败')\n    }\n    sameDetailTableInfo.loading = false;\n  }).catch(err=>{\n    if (err?.code === \"ERR_CANCELED\") {\n      sameDetailTableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        sameDetailTableInfo.loading = false;\n      }\n  })\n}\n\n//跳转同比分析看图页\nconst goLookChat = (record,type)=>{\n  router.push({\n    name : 'lookChart',\n    state : {\n      barChartOptions : JSON.stringify(allHeadTagList.value),\n      deptId : record.deptId,\n      title : record.title,\n      sourceType:type,\n      taxRate : record.taxRate,\n      projectId : record.finPcode,\n      groupCustomerName : record.groupCustomerName,\n      customerName : record.customerName,\n      projectName : record.projectName,\n      deptName\n    }\n  })\n}\n\n//跳转环比分析看图页\nconst goRingContrastChart = (record,type)=>{\n  router.push({\n    name : 'ringContrastChart',\n    state : {\n      interval:selectMonth.value,\n      deptId : deptId?record.deptId:\"\",\n      sourceType : type,\n      title : record.title,\n      deptName,\n      customerId: record.customerId,\n    }\n  })\n}\n//echarts缩略图的路径信息\nconst createEchartsRoute = (record,column)=>{\n  return record[column.dataIndex].map((item,i)=>({value:record[column.dataIndex][i]}))\n}\n\nconst deptGoCustomer = ()=>{\n  let breadList\n    switch (tab) {\n        case '1':\n            breadList = [\n                {\n                    type: \"button\",\n                    color: \"#5370FD\",\n                    msg: '环比分析列表',\n                    isBack : true\n                },\n                { type: \"text\", color: \"#333\", msg: deptName },\n            ]\n          break;\n          case '2':\n            breadList = [\n                { type: \"text\", color: \"#333\", msg: '同比分析列表' },\n                {\n                    type: \"button\",\n                    color: \"#5370FD\",\n                    msg: deptName,\n                    isBack : true\n                },\n            ]\n          break;\n          default:\n            break;\n    }\n    $bus.emit(\"updateStructure\", breadList);\n}\n\n</script>\n\n<style lang=\"scss\" scoped>\n.p-t-10 {\n  padding-top: 10px;\n}\n:deep(.tabs .arco-tabs-nav-type-line .arco-tabs-tab-title) {\n  font-size: 15px;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}