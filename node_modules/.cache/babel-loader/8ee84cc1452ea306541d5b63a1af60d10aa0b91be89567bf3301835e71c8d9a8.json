{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar util_1 = require(\"./util\");\n/*\n * Breaks any long edges in the graph into short segments that span 1 layer\n * each. This operation is undoable with the denormalize function.\n *\n * Pre-conditions:\n *\n *    1. The input graph is a DAG.\n *    2. Each node in the graph has a \"rank\" property.\n *\n * Post-condition:\n *\n *    1. All edges in the graph have a length of 1.\n *    2. Dummy nodes are added where edges have been split into segments.\n *    3. The graph is augmented with a \"dummyChains\" attribute which contains\n *       the first dummy in each chain of dummy nodes produced.\n */\nvar run = function (g) {\n  g.graph().dummyChains = [];\n  g.edges().forEach(function (edge) {\n    return normalizeEdge(g, edge);\n  });\n};\nvar normalizeEdge = function (g, e) {\n  var v = e.v;\n  var vRank = g.node(v).rank;\n  var w = e.w;\n  var wRank = g.node(w).rank;\n  var name = e.name;\n  var edgeLabel = g.edge(e);\n  var labelRank = edgeLabel.labelRank;\n  if (wRank === vRank + 1) return;\n  g.removeEdgeObj(e);\n  var graph = g.graph();\n  var dummy;\n  var attrs;\n  var i;\n  for (i = 0, ++vRank; vRank < wRank; ++i, ++vRank) {\n    edgeLabel.points = [];\n    attrs = {\n      edgeLabel: edgeLabel,\n      width: 0,\n      height: 0,\n      edgeObj: e,\n      rank: vRank\n    };\n    dummy = (0, util_1.addDummyNode)(g, \"edge\", attrs, \"_d\");\n    if (vRank === labelRank) {\n      attrs.width = edgeLabel.width;\n      attrs.height = edgeLabel.height;\n      attrs.dummy = \"edge-label\";\n      attrs.labelpos = edgeLabel.labelpos;\n    }\n    g.setEdge(v, dummy, {\n      weight: edgeLabel.weight\n    }, name);\n    if (i === 0) {\n      if (!graph.dummyChains) graph.dummyChains = [];\n      graph.dummyChains.push(dummy);\n    }\n    v = dummy;\n  }\n  g.setEdge(v, w, {\n    weight: edgeLabel.weight\n  }, name);\n};\nvar undo = function (g) {\n  var _a;\n  (_a = g.graph().dummyChains) === null || _a === void 0 ? void 0 : _a.forEach(function (v) {\n    var node = g.node(v);\n    var origLabel = node.edgeLabel;\n    var w;\n    if (node.edgeObj) {\n      g.setEdgeObj(node.edgeObj, origLabel);\n    }\n    var currentV = v;\n    while (node.dummy) {\n      w = g.successors(currentV)[0];\n      g.removeNode(currentV);\n      origLabel.points.push({\n        x: node.x,\n        y: node.y\n      });\n      if (node.dummy === \"edge-label\") {\n        origLabel.x = node.x;\n        origLabel.y = node.y;\n        origLabel.width = node.width;\n        origLabel.height = node.height;\n      }\n      currentV = w;\n      node = g.node(currentV);\n    }\n  });\n};\nexports.default = {\n  run: run,\n  undo: undo\n};","map":{"version":3,"mappings":"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","names":["run","g","graph","dummyChains","edges","forEach","edge","normalizeEdge","e","v","vRank","node","rank","w","wRank","name","edgeLabel","labelRank","removeEdgeObj","dummy","attrs","i","points","width","height","edgeObj","labelpos","setEdge","weight","push","undo","origLabel","setEdgeObj","currentV","successors","removeNode","x","y","exports"],"sourceRoot":"","sources":["../../../../src/layout/dagre/src/normalize.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}