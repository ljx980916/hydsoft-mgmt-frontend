{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"defaultPadding\"\n};\nconst _hoisted_2 = /*#__PURE__*/_createElementVNode(\"span\", null, \"部门名称：\", -1);\nconst _hoisted_3 = /*#__PURE__*/_createElementVNode(\"span\", null, \"日期：\", -1);\nconst _hoisted_4 = {\n  class: \"pointer\"\n};\nimport { getDetailData } from \"@/api/staffStatics.js\";\nimport { onBeforeMount, onMounted, reactive, ref, nextTick, watchEffect, onUnmounted } from \"vue\";\nimport { Message } from \"@arco-design/web-vue\";\nimport { useRouter, useRoute } from \"vue-router\";\nimport { staffDetailList } from \"../constColumns\";\nimport { dataAddKey, getSplitNum } from \"@/utils/util.js\";\nimport moment from \"moment\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nexport default {\n  __name: 'staticDetail',\n  setup(__props) {\n    let $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\n    const router = useRouter();\n    const route = useRoute();\n    const level1tableRef = ref(null);\n    const maxHeight = ref(\"\");\n    const dateVal = ref(new Date());\n    const deptName = ref(history.state.deptName);\n    const deptList = ref([\"全部\", \"BG1\", \"BG2\", \"BG3\", \"BG4\"]);\n    const dataContent = reactive({\n      loading: false,\n      columns: staffDetailList,\n      defaultExpandedKeys: [],\n      dataSource: []\n    });\n    watchEffect(() => {\n      $bus.emit(\"updateStructure\", [{\n        type: \"text\",\n        color: \"#333\",\n        msg: `人员分析`\n      }, {\n        type: \"button\",\n        color: \"#5370FD\",\n        msg: `人员统计`,\n        params: \"level1\"\n      }, {\n        type: \"text\",\n        color: \"#333\",\n        msg: \"人员明细\"\n      }]);\n    });\n    $bus.on(\"goBack\", val => {\n      if (val == \"level1\") {\n        let breadList1 = [{\n          type: \"text\",\n          color: \"#333\",\n          msg: `人员分析`\n        }, {\n          type: \"text\",\n          color: \"#333\",\n          msg: `人员统计`\n        }];\n        $bus.emit(\"updateStructure\", breadList1);\n        router.push({\n          path: \"/staticPicture\",\n          state: {\n            deptName: deptName.value\n          }\n        });\n      }\n    });\n    onUnmounted(() => {\n      $bus.off(\"goBack\");\n    });\n    const expandedChange = rowKeys => {\n      dataContent.defaultExpandedKeys = rowKeys;\n    };\n    //禁选日期\n    const getDisabledTime = current => {\n      return current.valueOf() < moment(\"2023-01-01 00:00:00\").valueOf() || current.valueOf() > moment().valueOf();\n    };\n    // 处理部门名称\n    const constructDeptName = deptName => {\n      const lastDashIndex = deptName.lastIndexOf(\"-\");\n      return deptName.substring(lastDashIndex + 1);\n    };\n    // 更改日期\n    const handleDatePicker = value => {\n      dateVal.value = new Date(value);\n      getData();\n    };\n    // 更改部门\n    const changeDeptName = val => {\n      deptName.value = val;\n      getData();\n    };\n    onMounted(() => {\n      if (level1tableRef.value) {\n        let head = level1tableRef.value.$el;\n        nextTick(() => {\n          let innerHeight = window.innerHeight;\n          let elHeight = head.getBoundingClientRect().top;\n          maxHeight.value = innerHeight - elHeight - 30 + \"px\";\n        });\n      }\n    });\n    onBeforeMount(() => {\n      getData();\n    });\n    const getTableNum = arr => {\n      Array.isArray(arr) && arr.forEach(item => {\n        item.c1 = getSplitNum(item.c1);\n        item.c2 = getSplitNum(item.c2);\n        item.g = getSplitNum(item.g);\n        item.r = getSplitNum(item.r);\n        item.s = getSplitNum(item.s);\n        item.entry = getSplitNum(item.entry);\n        item.official = getSplitNum(item.official);\n        item.practice = getSplitNum(item.practice);\n        item.total = getSplitNum(item.total);\n        item.dimission = getSplitNum(item.dimission);\n        item.pluralistic = getSplitNum(item.pluralistic);\n        if (item.children) {\n          getTableNum(item.children);\n        }\n      });\n      return arr;\n    };\n    const getData = () => {\n      var y = dateVal.value.getFullYear();\n      var m = dateVal.value.getMonth() + 1;\n      m = m < 10 ? \"0\" + m : m;\n      var d = dateVal.value.getDate();\n      d = d < 10 ? \"0\" + d : d;\n      const formData = new FormData();\n      if (deptName.value !== \"全部\") {\n        formData.append(\"deptName\", deptName.value);\n      }\n      formData.append(\"time\", `${y}-${m}-${d}`);\n      dataContent.loading = true;\n      getDetailData(formData).then(res => {\n        if (res.code === \"000000000000\") {\n          if (res.data && res.data.length > 0) {\n            let data = dataAddKey(res.data, \"key\", \"deptName\");\n            dataContent.dataSource = getTableNum(data);\n            let keys = [];\n            res.data.forEach(item => keys.push(item.deptName));\n            dataContent.defaultExpandedKeys = keys;\n          }\n        }\n      }).catch(e => {\n        Message.error(e.message || \"请求失败\");\n      }).finally(() => {\n        dataContent.loading = false;\n      });\n    };\n    return (_ctx, _cache) => {\n      const _component_a_option = _resolveComponent(\"a-option\");\n      const _component_a_select = _resolveComponent(\"a-select\");\n      const _component_a_space = _resolveComponent(\"a-space\");\n      const _component_a_col = _resolveComponent(\"a-col\");\n      const _component_a_date_picker = _resolveComponent(\"a-date-picker\");\n      const _component_a_row = _resolveComponent(\"a-row\");\n      const _component_a_popover = _resolveComponent(\"a-popover\");\n      const _component_a_table = _resolveComponent(\"a-table\");\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_a_row, {\n        gutter: [14, 20],\n        align: \"center\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_a_col, {\n          flex: \"230px\"\n        }, {\n          default: _withCtx(() => [_createVNode(_component_a_space, null, {\n            default: _withCtx(() => [_hoisted_2, _createVNode(_component_a_select, {\n              modelValue: deptName.value,\n              \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => deptName.value = $event),\n              placeholder: \"请选择部门\",\n              style: {\n                \"width\": \"130px\"\n              },\n              onChange: changeDeptName\n            }, {\n              default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(deptList.value, (item, index) => {\n                return _openBlock(), _createBlock(_component_a_option, {\n                  value: item,\n                  key: index\n                }, {\n                  default: _withCtx(() => [_createTextVNode(_toDisplayString(item), 1)]),\n                  _: 2\n                }, 1032, [\"value\"]);\n              }), 128))]),\n              _: 1\n            }, 8, [\"modelValue\"])]),\n            _: 1\n          })]),\n          _: 1\n        }), _createVNode(_component_a_col, {\n          flex: \"200px\"\n        }, {\n          default: _withCtx(() => [_createVNode(_component_a_space, null, {\n            default: _withCtx(() => [_hoisted_3, _createVNode(_component_a_date_picker, {\n              format: \"YYYY-MM-DD\",\n              \"allow-clear\": false,\n              disabledDate: getDisabledTime,\n              \"model-value\": dateVal.value,\n              onChange: handleDatePicker,\n              style: {\n                \"width\": \"130px\"\n              }\n            }, null, 8, [\"model-value\"])]),\n            _: 1\n          })]),\n          _: 1\n        }), _createVNode(_component_a_col, {\n          flex: \"85px\"\n        }), _createVNode(_component_a_col, {\n          flex: \"auto\"\n        })]),\n        _: 1\n      }), _createVNode(_component_a_row, null, {\n        default: _withCtx(() => [_createVNode(_component_a_col, {\n          span: 24\n        }, {\n          default: _withCtx(() => [_createVNode(_component_a_table, {\n            ref_key: \"level1tableRef\",\n            ref: level1tableRef,\n            class: \"m-t-20\",\n            \"column-resizable\": \"\",\n            columns: dataContent.columns,\n            data: dataContent.dataSource,\n            loading: dataContent.loading,\n            \"expanded-keys\": dataContent.defaultExpandedKeys,\n            scrollbar: false,\n            scroll: {\n              maxHeight: maxHeight.value\n            },\n            onExpandedChange: expandedChange,\n            pagination: false\n          }, {\n            deptName: _withCtx(({\n              record\n            }) => [_createVNode(_component_a_popover, {\n              \"content-style\": {\n                background: 'rgba(0,0,0,.8)',\n                color: '#fff'\n              },\n              \"arrow-style\": {\n                background: 'rgba(0,0,0,.8)'\n              }\n            }, {\n              content: _withCtx(() => [_createTextVNode(_toDisplayString(record.deptName), 1)]),\n              default: _withCtx(() => [_createElementVNode(\"span\", _hoisted_4, _toDisplayString(constructDeptName(record.deptName)), 1)]),\n              _: 2\n            }, 1032, [\"content-style\", \"arrow-style\"])]),\n            _: 1\n          }, 8, [\"columns\", \"data\", \"loading\", \"expanded-keys\", \"scroll\"])]),\n          _: 1\n        })]),\n        _: 1\n      })]);\n    };\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;AA4DA,SAASA,aAAa,QAAQ,uBAAuB;AACrD,SAASC,aAAa,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,WAAW,EAAEC,WAAW,QAAQ,KAAK;AACjG,SAASC,OAAO,QAAQ,sBAAsB;AAC9C,SAASC,SAAS,EAAEC,QAAQ,QAAQ,YAAY;AAChD,SAASC,eAAe,QAAQ,iBAAiB;AACjD,SAASC,UAAU,EAAEC,WAAW,QAAQ,iBAAiB;AACzD,OAAOC,MAAM,MAAM,QAAQ;AAC3B,SAASC,kBAAkB,QAAQ,mBAAmB;;;;IACtD,IAAIC,IAAI,GAAGD,kBAAkB,EAAE,CAACE,UAAU,CAACC,MAAM,CAACC,gBAAgB,CAACH,IAAI;IACvE,MAAMI,MAAM,GAAGX,SAAS,EAAE;IAC1B,MAAMY,KAAK,GAAGX,QAAQ,EAAE;IACxB,MAAMY,cAAc,GAAGlB,GAAG,CAAC,IAAI,CAAC;IAChC,MAAMmB,SAAS,GAAGnB,GAAG,CAAC,EAAE,CAAC;IACzB,MAAMoB,OAAO,GAAGpB,GAAG,CAAC,IAAIqB,IAAI,EAAE,CAAC;IAC/B,MAAMC,QAAQ,GAAGtB,GAAG,CAACuB,OAAO,CAACC,KAAK,CAACF,QAAQ,CAAC;IAC5C,MAAMG,QAAQ,GAAGzB,GAAG,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;IACxD,MAAM0B,WAAW,GAAG3B,QAAQ,CAAC;MAC3B4B,OAAO,EAAE,KAAK;MACdC,OAAO,EAAErB,eAAe;MACxBsB,mBAAmB,EAAE,EAAE;MACvBC,UAAU,EAAE;IACd,CAAC,CAAC;IACF5B,WAAW,CAAC,MAAM;MAChBU,IAAI,CAACmB,IAAI,CAAC,iBAAiB,EAAE,CAC3B;QACEC,IAAI,EAAE,MAAM;QACZC,KAAK,EAAE,MAAM;QACbC,GAAG,EAAG;MACR,CAAC,EACD;QACEF,IAAI,EAAE,QAAQ;QACdC,KAAK,EAAE,SAAS;QAChBC,GAAG,EAAG,MAAK;QACXC,MAAM,EAAE;MACV,CAAC,EACD;QACEH,IAAI,EAAE,MAAM;QACZC,KAAK,EAAE,MAAM;QACbC,GAAG,EAAE;MACP,CAAC,CACF,CAAC;IACJ,CAAC,CAAC;IACFtB,IAAI,CAACwB,EAAE,CAAC,QAAQ,EAAEC,GAAG,IAAI;MACvB,IAAIA,GAAG,IAAI,QAAQ,EAAE;QACnB,IAAIC,UAAU,GAAG,CACf;UAAEN,IAAI,EAAE,MAAM;UAAEC,KAAK,EAAE,MAAM;UAAEC,GAAG,EAAG;QAAM,CAAC,EAC5C;UAAEF,IAAI,EAAE,MAAM;UAAEC,KAAK,EAAE,MAAM;UAAEC,GAAG,EAAG;QAAM,CAAC,CAC7C;QACDtB,IAAI,CAACmB,IAAI,CAAC,iBAAiB,EAAEO,UAAU,CAAC;QACxCtB,MAAM,CAACuB,IAAI,CAAC;UACVC,IAAI,EAAE,gBAAgB;UACtBhB,KAAK,EAAE;YACLF,QAAQ,EAAEA,QAAQ,CAACmB;UACrB;QACF,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;IACFtC,WAAW,CAAC,MAAM;MAChBS,IAAI,CAAC8B,GAAG,CAAC,QAAQ,CAAC;IACpB,CAAC,CAAC;IACF,MAAMC,cAAc,GAAGC,OAAO,IAAI;MAChClB,WAAW,CAACG,mBAAmB,GAAGe,OAAO;IAC3C,CAAC;IACD;IACA,MAAMC,eAAe,GAAGC,OAAO,IAAI;MACjC,OAAOA,OAAO,CAACC,OAAO,EAAE,GAAGrC,MAAM,CAAC,qBAAqB,CAAC,CAACqC,OAAO,EAAE,IAAID,OAAO,CAACC,OAAO,EAAE,GAAGrC,MAAM,EAAE,CAACqC,OAAO,EAAE;IAC9G,CAAC;IACD;IACA,MAAMC,iBAAiB,GAAG1B,QAAQ,IAAI;MACpC,MAAM2B,aAAa,GAAG3B,QAAQ,CAAC4B,WAAW,CAAC,GAAG,CAAC;MAC/C,OAAO5B,QAAQ,CAAC6B,SAAS,CAACF,aAAa,GAAG,CAAC,CAAC;IAC9C,CAAC;IACD;IACA,MAAMG,gBAAgB,GAAGX,KAAK,IAAI;MAChCrB,OAAO,CAACqB,KAAK,GAAG,IAAIpB,IAAI,CAACoB,KAAK,CAAC;MAC/BY,OAAO,EAAE;IACX,CAAC;IACD;IACA,MAAMC,cAAc,GAAGjB,GAAG,IAAI;MAC5Bf,QAAQ,CAACmB,KAAK,GAAGJ,GAAG;MACpBgB,OAAO,EAAE;IACX,CAAC;IACDvD,SAAS,CAAC,MAAM;MACd,IAAIoB,cAAc,CAACuB,KAAK,EAAE;QACxB,IAAIc,IAAI,GAAGrC,cAAc,CAACuB,KAAK,CAACe,GAAG;QACnCvD,QAAQ,CAAC,MAAM;UACb,IAAIwD,WAAW,GAAGC,MAAM,CAACD,WAAW;UACpC,IAAIE,QAAQ,GAAGJ,IAAI,CAACK,qBAAqB,EAAE,CAACC,GAAG;UAC/C1C,SAAS,CAACsB,KAAK,GAAGgB,WAAW,GAAGE,QAAQ,GAAG,EAAE,GAAG,IAAI;QACtD,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;IACF9D,aAAa,CAAC,MAAM;MAClBwD,OAAO,EAAE;IACX,CAAC,CAAC;IACF,MAAMS,WAAW,GAAGC,GAAG,IAAI;MACzBC,KAAK,CAACC,OAAO,CAACF,GAAG,CAAC,IAChBA,GAAG,CAACG,OAAO,CAACC,IAAI,IAAI;QAClBA,IAAI,CAACC,EAAE,GAAG3D,WAAW,CAAC0D,IAAI,CAACC,EAAE,CAAC;QAC9BD,IAAI,CAACE,EAAE,GAAG5D,WAAW,CAAC0D,IAAI,CAACE,EAAE,CAAC;QAC9BF,IAAI,CAACG,CAAC,GAAG7D,WAAW,CAAC0D,IAAI,CAACG,CAAC,CAAC;QAC5BH,IAAI,CAACI,CAAC,GAAG9D,WAAW,CAAC0D,IAAI,CAACI,CAAC,CAAC;QAC5BJ,IAAI,CAACK,CAAC,GAAG/D,WAAW,CAAC0D,IAAI,CAACK,CAAC,CAAC;QAC5BL,IAAI,CAACM,KAAK,GAAGhE,WAAW,CAAC0D,IAAI,CAACM,KAAK,CAAC;QACpCN,IAAI,CAACO,QAAQ,GAAGjE,WAAW,CAAC0D,IAAI,CAACO,QAAQ,CAAC;QAC1CP,IAAI,CAACQ,QAAQ,GAAGlE,WAAW,CAAC0D,IAAI,CAACQ,QAAQ,CAAC;QAC1CR,IAAI,CAACS,KAAK,GAAGnE,WAAW,CAAC0D,IAAI,CAACS,KAAK,CAAC;QACpCT,IAAI,CAACU,SAAS,GAAGpE,WAAW,CAAC0D,IAAI,CAACU,SAAS,CAAC;QAC5CV,IAAI,CAACW,WAAW,GAAGrE,WAAW,CAAC0D,IAAI,CAACW,WAAW,CAAC;QAChD,IAAIX,IAAI,CAACY,QAAQ,EAAE;UACjBjB,WAAW,CAACK,IAAI,CAACY,QAAQ,CAAC;QAC5B;MACF,CAAC,CAAC;MACJ,OAAOhB,GAAG;IACZ,CAAC;IACD,MAAMV,OAAO,GAAG,MAAM;MACpB,IAAI2B,CAAC,GAAG5D,OAAO,CAACqB,KAAK,CAACwC,WAAW,EAAE;MACnC,IAAIC,CAAC,GAAG9D,OAAO,CAACqB,KAAK,CAAC0C,QAAQ,EAAE,GAAG,CAAC;MACpCD,CAAC,GAAGA,CAAC,GAAG,EAAE,GAAG,GAAG,GAAGA,CAAC,GAAGA,CAAC;MACxB,IAAIE,CAAC,GAAGhE,OAAO,CAACqB,KAAK,CAAC4C,OAAO,EAAE;MAC/BD,CAAC,GAAGA,CAAC,GAAG,EAAE,GAAG,GAAG,GAAGA,CAAC,GAAGA,CAAC;MACxB,MAAME,QAAQ,GAAG,IAAIC,QAAQ,EAAE;MAC/B,IAAIjE,QAAQ,CAACmB,KAAK,KAAK,IAAI,EAAE;QAC3B6C,QAAQ,CAACE,MAAM,CAAC,UAAU,EAAElE,QAAQ,CAACmB,KAAK,CAAC;MAC7C;MACA6C,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAG,GAAER,CAAE,IAAGE,CAAE,IAAGE,CAAE,EAAC,CAAC;MACzC1D,WAAW,CAACC,OAAO,GAAG,IAAI;MAC1B/B,aAAa,CAAC0F,QAAQ,CAAC,CACpBG,IAAI,CAACC,GAAG,IAAI;QACX,IAAIA,GAAG,CAACC,IAAI,KAAK,cAAc,EAAE;UAC/B,IAAID,GAAG,CAACE,IAAI,IAAIF,GAAG,CAACE,IAAI,CAACC,MAAM,GAAG,CAAC,EAAE;YACnC,IAAID,IAAI,GAAGpF,UAAU,CAACkF,GAAG,CAACE,IAAI,EAAE,KAAK,EAAE,UAAU,CAAC;YAClDlE,WAAW,CAACI,UAAU,GAAGgC,WAAW,CAAC8B,IAAI,CAAC;YAC1C,IAAIE,IAAI,GAAG,EAAE;YACbJ,GAAG,CAACE,IAAI,CAAC1B,OAAO,CAACC,IAAI,IAAI2B,IAAI,CAACvD,IAAI,CAAC4B,IAAI,CAAC7C,QAAQ,CAAC,CAAC;YAClDI,WAAW,CAACG,mBAAmB,GAAGiE,IAAI;UACxC;QACF;MACF,CAAC,CAAC,CACDC,KAAK,CAACC,CAAC,IAAI;QACV5F,OAAO,CAAC6F,KAAK,CAACD,CAAC,CAACE,OAAO,IAAI,MAAM,CAAC;MACpC,CAAC,CAAC,CACDC,OAAO,CAAC,MAAM;QACbzE,WAAW,CAACC,OAAO,GAAG,KAAK;MAC7B,CAAC,CAAC;IACN,CAAC","names":["getDetailData","onBeforeMount","onMounted","reactive","ref","nextTick","watchEffect","onUnmounted","Message","useRouter","useRoute","staffDetailList","dataAddKey","getSplitNum","moment","getCurrentInstance","$bus","appContext","config","globalProperties","router","route","level1tableRef","maxHeight","dateVal","Date","deptName","history","state","deptList","dataContent","loading","columns","defaultExpandedKeys","dataSource","emit","type","color","msg","params","on","val","breadList1","push","path","value","off","expandedChange","rowKeys","getDisabledTime","current","valueOf","constructDeptName","lastDashIndex","lastIndexOf","substring","handleDatePicker","getData","changeDeptName","head","$el","innerHeight","window","elHeight","getBoundingClientRect","top","getTableNum","arr","Array","isArray","forEach","item","c1","c2","g","r","s","entry","official","practice","total","dimission","pluralistic","children","y","getFullYear","m","getMonth","d","getDate","formData","FormData","append","then","res","code","data","length","keys","catch","e","error","message","finally"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/src/views/staffStatistics/staffStatics/staticDetail.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <a-row :gutter=\"[14, 20]\" align=\"center\">\n      <a-col flex=\"230px\">\n        <a-space>\n          <span>部门名称：</span>\n          <a-select v-model=\"deptName\" placeholder=\"请选择部门\" style=\"width: 130px\" @change=\"changeDeptName\">\n            <a-option v-for=\"(item, index) of deptList\" :value=\"item\" :key=\"index\">{{ item }}</a-option>\n          </a-select>\n        </a-space>\n      </a-col>\n      <a-col flex=\"200px\">\n        <a-space>\n          <span>日期：</span>\n          <a-date-picker\n            format=\"YYYY-MM-DD\"\n            :allow-clear=\"false\"\n            :disabledDate=\"getDisabledTime\"\n            v-bind:model-value=\"dateVal\"\n            @change=\"handleDatePicker\"\n            style=\"width: 130px\"\n          />\n        </a-space>\n      </a-col>\n      <a-col flex=\"85px\"></a-col>\n      <a-col flex=\"auto\"></a-col>\n    </a-row>\n    <a-row>\n      <a-col :span=\"24\">\n        <a-table\n          ref=\"level1tableRef\"\n          class=\"m-t-20\"\n          column-resizable\n          :columns=\"dataContent.columns\"\n          :data=\"dataContent.dataSource\"\n          :loading=\"dataContent.loading\"\n          :expanded-keys=\"dataContent.defaultExpandedKeys\"\n          :scrollbar=\"false\"\n          :scroll=\"{ maxHeight: maxHeight }\"\n          @expanded-change=\"expandedChange\"\n          :pagination=\"false\"\n        >\n          <template #deptName=\"{ record }\">\n            <a-popover\n              :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n              :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n            >\n              <span class=\"pointer\">{{ constructDeptName(record.deptName) }}</span>\n              <template #content>\n                {{ record.deptName }}\n              </template>\n            </a-popover>\n          </template>\n        </a-table>\n      </a-col>\n    </a-row>\n  </div>\n</template>\n\n<script setup>\nimport { getDetailData } from \"@/api/staffStatics.js\";\nimport { onBeforeMount, onMounted, reactive, ref, nextTick, watchEffect, onUnmounted } from \"vue\";\nimport { Message } from \"@arco-design/web-vue\";\nimport { useRouter, useRoute } from \"vue-router\";\nimport { staffDetailList } from \"../constColumns\";\nimport { dataAddKey, getSplitNum } from \"@/utils/util.js\";\nimport moment from \"moment\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\nconst router = useRouter();\nconst route = useRoute();\nconst level1tableRef = ref(null);\nconst maxHeight = ref(\"\");\nconst dateVal = ref(new Date());\nconst deptName = ref(history.state.deptName);\nconst deptList = ref([\"全部\", \"BG1\", \"BG2\", \"BG3\", \"BG4\"]);\nconst dataContent = reactive({\n  loading: false,\n  columns: staffDetailList,\n  defaultExpandedKeys: [],\n  dataSource: [],\n});\nwatchEffect(() => {\n  $bus.emit(\"updateStructure\", [\n    {\n      type: \"text\",\n      color: \"#333\",\n      msg: `人员分析`,\n    },\n    {\n      type: \"button\",\n      color: \"#5370FD\",\n      msg: `人员统计`,\n      params: \"level1\",\n    },\n    {\n      type: \"text\",\n      color: \"#333\",\n      msg: \"人员明细\",\n    },\n  ]);\n});\n$bus.on(\"goBack\", val => {\n  if (val == \"level1\") {\n    let breadList1 = [\n      { type: \"text\", color: \"#333\", msg: `人员分析` },\n      { type: \"text\", color: \"#333\", msg: `人员统计` },\n    ];\n    $bus.emit(\"updateStructure\", breadList1);\n    router.push({\n      path: \"/staticPicture\",\n      state: {\n        deptName: deptName.value,\n      },\n    });\n  }\n});\nonUnmounted(() => {\n  $bus.off(\"goBack\");\n});\nconst expandedChange = rowKeys => {\n  dataContent.defaultExpandedKeys = rowKeys;\n};\n//禁选日期\nconst getDisabledTime = current => {\n  return current.valueOf() < moment(\"2023-01-01 00:00:00\").valueOf() || current.valueOf() > moment().valueOf();\n};\n// 处理部门名称\nconst constructDeptName = deptName => {\n  const lastDashIndex = deptName.lastIndexOf(\"-\");\n  return deptName.substring(lastDashIndex + 1);\n};\n// 更改日期\nconst handleDatePicker = value => {\n  dateVal.value = new Date(value);\n  getData();\n};\n// 更改部门\nconst changeDeptName = val => {\n  deptName.value = val;\n  getData();\n};\nonMounted(() => {\n  if (level1tableRef.value) {\n    let head = level1tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      maxHeight.value = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\nonBeforeMount(() => {\n  getData();\n});\nconst getTableNum = arr => {\n  Array.isArray(arr) &&\n    arr.forEach(item => {\n      item.c1 = getSplitNum(item.c1);\n      item.c2 = getSplitNum(item.c2);\n      item.g = getSplitNum(item.g);\n      item.r = getSplitNum(item.r);\n      item.s = getSplitNum(item.s);\n      item.entry = getSplitNum(item.entry);\n      item.official = getSplitNum(item.official);\n      item.practice = getSplitNum(item.practice);\n      item.total = getSplitNum(item.total);\n      item.dimission = getSplitNum(item.dimission);\n      item.pluralistic = getSplitNum(item.pluralistic);\n      if (item.children) {\n        getTableNum(item.children);\n      }\n    });\n  return arr;\n};\nconst getData = () => {\n  var y = dateVal.value.getFullYear();\n  var m = dateVal.value.getMonth() + 1;\n  m = m < 10 ? \"0\" + m : m;\n  var d = dateVal.value.getDate();\n  d = d < 10 ? \"0\" + d : d;\n  const formData = new FormData();\n  if (deptName.value !== \"全部\") {\n    formData.append(\"deptName\", deptName.value);\n  }\n  formData.append(\"time\", `${y}-${m}-${d}`);\n  dataContent.loading = true;\n  getDetailData(formData)\n    .then(res => {\n      if (res.code === \"000000000000\") {\n        if (res.data && res.data.length > 0) {\n          let data = dataAddKey(res.data, \"key\", \"deptName\");\n          dataContent.dataSource = getTableNum(data);\n          let keys = [];\n          res.data.forEach(item => keys.push(item.deptName));\n          dataContent.defaultExpandedKeys = keys;\n        }\n      }\n    })\n    .catch(e => {\n      Message.error(e.message || \"请求失败\");\n    })\n    .finally(() => {\n      dataContent.loading = false;\n    });\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}