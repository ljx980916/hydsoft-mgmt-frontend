{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, reactive, watch } from 'vue';\nimport { differentColumns } from '@/views/demo/constColumns.js';\nimport Icon from '@/components/icon.vue';\nexport default {\n  __name: 'different',\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    },\n    columns: {\n      type: Array,\n      default: () => []\n    },\n    modalVisible: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: [\"handleClose\"],\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    expose();\n    const props = __props;\n    const dataContent = reactive({\n      columns: JSON.parse(JSON.stringify(differentColumns)),\n      dataSourse: [],\n      loading: false\n    });\n    const visible = ref(props.modalVisible);\n    const expandedRowKeys1 = ref([]);\n    const monthBeforeIcon = ref('caret-right');\n    const monthBeforeValue = ref('');\n    const monthAfterIcon = ref('caret-right');\n    const monthAfterValue = ref('');\n    const QBeforeIcon = ref('caret-right');\n    const QBeforeValue = ref('');\n    const QAfterIcon = ref('caret-right');\n    const QAfterValue = ref('');\n    watch(() => props.modalVisible, (newVal, oldVal) => {\n      if (newVal) {\n        visible.value = newVal;\n        dataContent.columns = JSON.parse(JSON.stringify(differentColumns));\n        dataContent.dataSourse = dealDifferentData(props.data).arr;\n        expandedRowKeys1.value = dealDifferentData(props.data).keyArr;\n      }\n    });\n    const expandedChange1 = rowkeys => {\n      expandedRowKeys1.value = rowkeys;\n    };\n    // 环差比数据处理\n    let keyArr = [];\n    const dealDifferentData = arr => {\n      let dataIndex1 = '';\n      let dataIndex2 = '';\n      let dataIndex3 = '';\n      let dataIndex4 = '';\n      dataContent.columns.forEach(ele => {\n        if (ele.titleSlotName == \"monthBefore\") {\n          dataIndex1 = ele.dataIndex;\n        }\n        if (ele.titleSlotName == \"monthAfter\") {\n          dataIndex2 = ele.dataIndex;\n        }\n        if (ele.titleSlotName == \"QBefore\") {\n          dataIndex3 = ele.dataIndex;\n        }\n        if (ele.titleSlotName == \"QAfter\") {\n          dataIndex4 = ele.dataIndex;\n        }\n      });\n      Array.isArray(arr) && arr.forEach((item, index) => {\n        keyArr.push(item.key);\n        if (item[dataIndex2] !== '-' && item[dataIndex1] !== '-' && !item.isRate) {\n          item.monthDifferent = Number(item[dataIndex2] - item[dataIndex1]).toFixed(2);\n          item.MonthonMonth = Number((item[dataIndex2] - item[dataIndex1]) / item[dataIndex1]).toFixed(2);\n        } else {\n          item.monthDifferent = '-';\n          item.MonthonMonth = '-';\n        }\n        // 季度数据\n        item.Q1 = Number(item.month1 + item.month2 + item.month3).toFixed(2);\n        item.Q2 = Number(item.month4 + item.month5 + item.month6).toFixed(2);\n        item.Q3 = Number(item.month7 + item.month8 + item.month9).toFixed(2);\n        item.Q4 = Number(item.month10 + item.month11 + item.month12).toFixed(2);\n        item.QDifferent = Number(item[dataIndex4] - item[dataIndex3]).toFixed(2);\n        item.QonQ = Number((item[dataIndex4] - item[dataIndex3]) / item[dataIndex3]).toFixed(2);\n        if (item.children && item.children.length) {\n          dealDifferentData(item.children);\n        }\n      });\n      return {\n        arr,\n        keyArr\n      };\n    };\n    // 时间选择器开关\n    const changeVisible = (e, flag) => {\n      if (flag == 'MB') {\n        if (e) {\n          monthBeforeIcon.value = 'caret-down';\n        } else {\n          monthBeforeIcon.value = 'caret-right';\n        }\n      }\n      if (flag == 'MA') {\n        if (e) {\n          monthAfterIcon.value = 'caret-down';\n        } else {\n          monthAfterIcon.value = 'caret-right';\n        }\n      }\n      if (flag == 'QB') {\n        if (e) {\n          QBeforeIcon.value = 'caret-down';\n        } else {\n          QBeforeIcon.value = 'caret-right';\n        }\n      }\n      if (flag == 'QA') {\n        if (e) {\n          QAfterIcon.value = 'caret-down';\n        } else {\n          QAfterIcon.value = 'caret-right';\n        }\n      }\n    };\n    // 处理月份标题\n    const dealMonthTitle = (e, flag) => {\n      let str = e.substr(e.length - 2);\n      let num = '';\n      if (str.substr(0, 1) == 0) {\n        num = str.substr(1);\n      } else {\n        num = str;\n      }\n      props.columns.forEach(item => {\n        // 确定是month表头\n        if (item.dataIndex.substr(0, 5) == 'month') {\n          // 选择的月份 == 折叠表格的某个表头\n          if (num == item.dataIndex.substr(5)) {\n            // 对应的表头更换\n            dataContent.columns.forEach(ele => {\n              if (flag == 'MB') {\n                if (ele.titleSlotName == 'monthBefore') {\n                  ele.dataIndex = item.dataIndex;\n                  ele.title = num + '月';\n                }\n                if (ele.dataIndex == 'monthDifferent') {\n                  const parts = ele.title.split('-'); // 将字符串分割为两部分  \n                  parts[1] = num; // 替换'-'后的数字  \n                  ele.title = parts.join('-') + '月'; // 将两部分重新组合为字符串，并用'-'连接\n                }\n              }\n\n              if (flag == 'MA') {\n                if (ele.titleSlotName == 'monthAfter') {\n                  ele.dataIndex = item.dataIndex;\n                  //TODO 加（21天）\n                  ele.title = num + '月';\n                }\n                if (ele.dataIndex == 'monthDifferent') {\n                  const parts = ele.title.split('-'); // 将字符串分割为两部分  \n                  parts[0] = num; // 替换'-'前的数字  \n                  //TODO 加（21天）\n                  ele.title = parts.join('-'); // 将两部分重新组合为字符串，并用'-'连接\n                }\n              }\n            });\n          }\n        }\n      });\n\n      dataContent.dataSourse = dealDifferentData(props.data).arr;\n    };\n    // 处理季度标题\n    const dealQTitle = (e, flag) => {\n      let str = e.substr(e.length - 2);\n      let num = '';\n      if (str.substr(0, 1) == 0) {\n        num = str.substr(1);\n      } else {\n        num = str;\n      }\n      const QList = [{\n        label: '1',\n        value: 'Q1'\n      }, {\n        label: '4',\n        value: 'Q2'\n      }, {\n        label: '7',\n        value: 'Q3'\n      }, {\n        label: '10',\n        value: 'Q4'\n      }];\n      // 对应的表头更换\n      dataContent.columns.forEach(ele => {\n        if (flag == 'QB') {\n          if (ele.titleSlotName == 'QBefore') {\n            //num对应的Q\n            ele.title = ele.dataIndex = QList.filter(item => item.label == num)[0].value;\n          }\n          if (ele.dataIndex == 'QDifferent') {\n            const parts = ele.title.split('-'); // 将字符串分割为两部分  \n            parts[1] = QList.filter(item => item.label == num)[0].value; // 替换'-'后的数字\n            ele.title = parts.join('-'); // 将两部分重新组合为字符串，并用'-'连接\n          }\n        }\n\n        if (flag == 'QA') {\n          if (ele.titleSlotName == 'QAfter') {\n            ele.title = ele.dataIndex = QList.filter(item => item.label == num)[0].value;\n          }\n          if (ele.dataIndex == 'QDifferent') {\n            const parts = ele.title.split('-'); // 将字符串分割为两部分  \n            parts[0] = QList.filter(item => item.label == num)[0].value; // 替换'-'前的数字  \n            ele.title = parts.join('-'); // 将两部分重新组合为字符串，并用'-'连接\n          }\n        }\n      });\n\n      dataContent.dataSourse = dealDifferentData(props.data).arr;\n    };\n    // 更改时间\n    const changeTime = (e, flag) => {\n      if (flag == 'MB') {\n        monthBeforeValue.value = e;\n        dealMonthTitle(e, flag);\n      }\n      if (flag == 'MA') {\n        monthAfterValue.value = e;\n        dealMonthTitle(e, flag);\n      }\n      if (flag == 'QA') {\n        QAfterValue.value = e;\n        dealQTitle(e, flag);\n      }\n      if (flag == 'QB') {\n        QBeforeValue.value = e;\n        dealQTitle(e, flag);\n      }\n    };\n    const handleClose = () => {\n      emit(\"handleClose\", false);\n    };\n    //单行高亮处理\n    const activeRowClass = record => {\n      if (record.raw.isGreenLight) {\n        return 'activeRowGreen';\n      } else if (record.raw.isRate) {\n        return 'activeRowPurple';\n      } else {\n        return '';\n      }\n    };\n    const __returned__ = {\n      props,\n      dataContent,\n      visible,\n      expandedRowKeys1,\n      monthBeforeIcon,\n      monthBeforeValue,\n      monthAfterIcon,\n      monthAfterValue,\n      QBeforeIcon,\n      QBeforeValue,\n      QAfterIcon,\n      QAfterValue,\n      emit,\n      expandedChange1,\n      get keyArr() {\n        return keyArr;\n      },\n      set keyArr(v) {\n        keyArr = v;\n      },\n      dealDifferentData,\n      changeVisible,\n      dealMonthTitle,\n      dealQTitle,\n      changeTime,\n      handleClose,\n      activeRowClass,\n      ref,\n      reactive,\n      watch,\n      get differentColumns() {\n        return differentColumns;\n      },\n      Icon\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["ref","reactive","watch","differentColumns","Icon","dataContent","columns","JSON","parse","stringify","dataSourse","loading","visible","props","modalVisible","expandedRowKeys1","monthBeforeIcon","monthBeforeValue","monthAfterIcon","monthAfterValue","QBeforeIcon","QBeforeValue","QAfterIcon","QAfterValue","newVal","oldVal","value","dealDifferentData","data","arr","keyArr","expandedChange1","rowkeys","dataIndex1","dataIndex2","dataIndex3","dataIndex4","forEach","ele","titleSlotName","dataIndex","Array","isArray","item","index","push","key","isRate","monthDifferent","Number","toFixed","MonthonMonth","Q1","month1","month2","month3","Q2","month4","month5","month6","Q3","month7","month8","month9","Q4","month10","month11","month12","QDifferent","QonQ","children","length","changeVisible","e","flag","dealMonthTitle","str","substr","num","title","parts","split","join","dealQTitle","QList","label","filter","changeTime","handleClose","emit","activeRowClass","record","raw","isGreenLight"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/src/components/different.vue"],"sourcesContent":["<template>\n  <div>\n    <!-- 环比配置 -->\n    <a-modal  title=\"环比配置\" width=\"auto\" title-align=\"start\" v-model:visible=\"visible\" :footer=\"null\" :body-style=\"{padding:'25px'}\" @close=\"handleClose\">\n        <div>\n            <a-table \n                class=\"arcoTable_columnsWidthAuto\" \n                :columns=\"dataContent.columns ||[]\"  \n                :data=\"(dataContent.dataSourse.length && dataContent.dataSourse) || []\"  \n                :loading=\"dataContent.loading\"\n                :pagination=\"false\" \n                :expanded-keys=\"expandedRowKeys1\"\n                @expanded-change=\"expandedChange1\"\n                show-empty-tree \n                :row-class=\"activeRowClass\"\n                :bordered=\"{wrapper: true, cell: true}\" \n            >\n                <template  v-for=\"item in dataContent.columns\" :key = \"item.dataIndex\"  #[item.titleSlotName]>\n                    {{ item.title}}\n                    <a-month-picker \n                    v-if=\"item.titleSlotName =='monthBefore'\"\n                    v-model:pickerValue=\"monthBeforeValue\" \n                    @popup-visible-change=\"changeVisible($event,'MB')\"\n                    @change=\"changeTime($event,'MB')\"\n                    size=\"mini\"\n                    position=\"bottom\"\n                    >\n                        <Icon :icon=\"monthBeforeIcon\"></Icon>\n                    </a-month-picker>\n                    <a-month-picker \n                    v-if=\"item.titleSlotName =='monthAfter'\"\n                    v-model:pickerValue=\"monthAfterValue\" \n                    @popup-visible-change=\"changeVisible($event,'MA')\"\n                    @change=\"changeTime($event,'MA')\"\n                    size=\"mini\"\n                    position=\"bottom\"\n                    >\n                        <Icon :icon=\"monthAfterIcon\"></Icon>\n                    </a-month-picker>\n                    <a-quarter-picker \n                    v-if=\"item.titleSlotName =='QBefore'\" \n                    v-model:pickerValue=\"QBeforeValue\" \n                    @popup-visible-change=\"changeVisible($event,'QB')\"\n                    @change=\"changeTime($event,'QB')\"\n                    size=\"mini\"\n                    position=\"bottom\">\n                        <Icon :icon=\"QBeforeIcon\"></Icon>\n                    </a-quarter-picker>\n                    <a-quarter-picker \n                    v-if=\"item.titleSlotName =='QAfter'\" \n                    v-model:pickerValue=\"QAfterValue\" \n                    @popup-visible-change=\"changeVisible($event,'QA')\"\n                    @change=\"changeTime($event,'QA')\"\n                    size=\"mini\"\n                    position=\"bottom\">\n                        <Icon :icon=\"QAfterIcon\"></Icon>\n                    </a-quarter-picker>\n                </template>\n            </a-table>\n        </div>\n    </a-modal>\n  </div>\n</template>\n\n<script setup>\nimport { ref,reactive,watch} from 'vue';\nimport {differentColumns} from '@/views/demo/constColumns.js';\nimport Icon from '@/components/icon.vue'\nconst props = defineProps({\n    data: {\n        type: Array,\n        default: () => [],\n    },\n    columns: {\n        type: Array,\n        default: () => [],\n    },\n    modalVisible:{\n        type:Boolean,\n        default:false\n    }\n});\n\nconst dataContent = reactive({\n    columns: JSON.parse(JSON.stringify(differentColumns)),\n    dataSourse:[],\n    loading: false\n});\nconst visible = ref(props.modalVisible);\nconst expandedRowKeys1 = ref([]);\nconst monthBeforeIcon = ref('caret-right');\nconst monthBeforeValue = ref('');\nconst monthAfterIcon = ref('caret-right');\nconst monthAfterValue = ref('');\nconst QBeforeIcon = ref('caret-right');\nconst QBeforeValue = ref('');\nconst QAfterIcon = ref('caret-right');\nconst QAfterValue = ref('');\nwatch(\n() => props.modalVisible,\n(newVal, oldVal) => {\n    if (newVal) {\n        visible.value = newVal;\n        dataContent.columns = JSON.parse(JSON.stringify(differentColumns));\n        dataContent.dataSourse = dealDifferentData(props.data).arr;\n        expandedRowKeys1.value = dealDifferentData(props.data).keyArr;\n    }\n    }\n);\nconst emit = defineEmits([\n\"handleClose\"\n]);\nconst expandedChange1 = rowkeys =>{\n    expandedRowKeys1.value = rowkeys;\n}\n// 环差比数据处理\nlet keyArr = [];\nconst dealDifferentData = (arr)=>{\n    let dataIndex1 = '';\n    let dataIndex2 = '';\n    let dataIndex3 = '';\n    let dataIndex4 = '';\n    dataContent.columns.forEach(ele=>{\n        if(ele.titleSlotName ==\"monthBefore\"){\n            dataIndex1 = ele.dataIndex\n        }\n        if(ele.titleSlotName ==\"monthAfter\"){\n            dataIndex2 = ele.dataIndex\n        }\n        if(ele.titleSlotName ==\"QBefore\"){\n            dataIndex3 = ele.dataIndex\n        }if(ele.titleSlotName ==\"QAfter\"){\n            dataIndex4 = ele.dataIndex\n        }\n    })\n    Array.isArray(arr) && arr.forEach((item,index) => {\n        keyArr.push(item.key);\n        if(item[dataIndex2] !=='-' && item[dataIndex1] !=='-' && !item.isRate){\n            item.monthDifferent = Number(item[dataIndex2]-item[dataIndex1]).toFixed(2);\n            item.MonthonMonth = Number((item[dataIndex2]-item[dataIndex1])/item[dataIndex1]).toFixed(2);\n        }else{\n            item.monthDifferent='-'\n            item.MonthonMonth='-'\n        }\n        // 季度数据\n        item.Q1 = Number(item.month1 + item.month2 + item.month3).toFixed(2);\n        item.Q2 = Number(item.month4 + item.month5 + item.month6).toFixed(2);\n        item.Q3 = Number(item.month7 + item.month8 + item.month9).toFixed(2);\n        item.Q4 = Number(item.month10 + item.month11 + item.month12).toFixed(2);\n        item.QDifferent = Number(item[dataIndex4]-item[dataIndex3]).toFixed(2);\n        item.QonQ = Number((item[dataIndex4]-item[dataIndex3])/item[dataIndex3]).toFixed(2);\n        if(item.children && item.children.length){\n            dealDifferentData(item.children)\n        }\n    })\n    \n    return {arr,keyArr}\n};\n// 时间选择器开关\nconst changeVisible = (e,flag)=>{\n    if(flag =='MB'){\n        if(e){\n                monthBeforeIcon.value = 'caret-down'\n        }else{\n            monthBeforeIcon.value = 'caret-right'\n        }\n    }\n    if(flag =='MA'){\n        if(e){\n                monthAfterIcon.value = 'caret-down'\n        }else{\n            monthAfterIcon.value = 'caret-right'\n        }\n    }\n    if(flag =='QB'){\n        if(e){\n                QBeforeIcon.value = 'caret-down'\n        }else{\n            QBeforeIcon.value = 'caret-right'\n        }\n    }\n    if(flag =='QA'){\n        if(e){\n            QAfterIcon.value = 'caret-down'\n        }else{\n            QAfterIcon.value = 'caret-right'\n        }\n    }\n}\n// 处理月份标题\nconst dealMonthTitle = (e,flag)=>{\n    let str = e.substr(e.length - 2);\n    let num =''\n    if(str.substr(0,1)==0){\n        num = str.substr(1)\n    }else{\n        num = str\n    }\n    props.columns.forEach(item=>{\n        // 确定是month表头\n        if(item.dataIndex.substr(0,5)=='month'){\n            // 选择的月份 == 折叠表格的某个表头\n            if(num == item.dataIndex.substr(5)){\n                // 对应的表头更换\n                dataContent.columns.forEach(ele=>{\n                    if(flag =='MB'){\n                        if(ele.titleSlotName == 'monthBefore'){\n                            ele.dataIndex = item.dataIndex;\n                            ele.title = num +'月';\n                        }\n                        if(ele.dataIndex =='monthDifferent'){\n                            const parts = ele.title.split('-'); // 将字符串分割为两部分  \n                            parts[1] = num; // 替换'-'后的数字  \n                            ele.title = parts.join('-')+'月'; // 将两部分重新组合为字符串，并用'-'连接\n                        }\n                    }\n                    if(flag =='MA'){\n                        if(ele.titleSlotName == 'monthAfter'){\n                            ele.dataIndex = item.dataIndex;\n                            //TODO 加（21天）\n                            ele.title = num +'月';\n                        }\n                        if(ele.dataIndex =='monthDifferent'){\n                            const parts = ele.title.split('-'); // 将字符串分割为两部分  \n                            parts[0] = num; // 替换'-'前的数字  \n                            //TODO 加（21天）\n                            ele.title = parts.join('-'); // 将两部分重新组合为字符串，并用'-'连接\n                        }\n                    }\n                })\n            }\n        }\n    })\n    dataContent.dataSourse = dealDifferentData(props.data).arr;\n};\n// 处理季度标题\nconst dealQTitle = (e,flag)=>{\n    let str = e.substr(e.length - 2);\n    let num =''\n    if(str.substr(0,1)==0){\n        num = str.substr(1)\n    }else{\n        num = str\n    }\n    const  QList = [\n        {\n            label:'1',\n            value:'Q1'\n        },\n        {\n            label:'4',\n            value:'Q2'\n        },\n        {\n            label:'7',\n            value:'Q3'\n        },\n        {\n            label:'10',\n            value:'Q4'\n        },\n    ]\n    // 对应的表头更换\n    dataContent.columns.forEach(ele=>{\n        if(flag =='QB'){\n            if(ele.titleSlotName == 'QBefore'){\n                //num对应的Q\n                ele.title = ele.dataIndex = QList.filter(item=>item.label == num)[0].value;\n            }\n            if(ele.dataIndex =='QDifferent'){\n                const parts = ele.title.split('-'); // 将字符串分割为两部分  \n                parts[1] = QList.filter(item=>item.label == num)[0].value; // 替换'-'后的数字\n                ele.title = parts.join('-'); // 将两部分重新组合为字符串，并用'-'连接\n            }\n        }\n        if(flag =='QA'){\n            if(ele.titleSlotName == 'QAfter'){\n                ele.title = ele.dataIndex = QList.filter(item=>item.label == num)[0].value;\n            }\n            if(ele.dataIndex =='QDifferent'){\n                const parts = ele.title.split('-'); // 将字符串分割为两部分  \n                parts[0] = QList.filter(item=>item.label == num)[0].value; // 替换'-'前的数字  \n                ele.title = parts.join('-'); // 将两部分重新组合为字符串，并用'-'连接\n            }\n        }\n    })\n    dataContent.dataSourse = dealDifferentData(props.data).arr;\n};\n// 更改时间\nconst changeTime=(e,flag)=>{\n    if(flag == 'MB'){\n        monthBeforeValue.value = e;\n        dealMonthTitle(e,flag);\n    }\n    if(flag == 'MA'){\n        monthAfterValue.value = e;\n        dealMonthTitle(e,flag);\n    }\n    if(flag == 'QA'){\n        QAfterValue.value = e;\n        dealQTitle(e,flag)\n    }\n    if(flag == 'QB'){\n        QBeforeValue.value = e;\n        dealQTitle(e,flag)\n    }\n};\nconst handleClose = ()=>{\n    emit(\"handleClose\", false);\n};\n//单行高亮处理\nconst activeRowClass = (record) => {\n    if(record.raw.isGreenLight){\n        return 'activeRowGreen'\n    }else if(record.raw.isRate){\n        return 'activeRowPurple'\n    }else{\n        return ''\n    }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n:deep(.activeRowGreen > .arco-table-td) {\n    background-color: rgb(234, 248, 243) !important;\n}\n:deep(.activeRowPurple > .arco-table-td) {\n    background-color: rgb(240, 237, 248) !important;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}