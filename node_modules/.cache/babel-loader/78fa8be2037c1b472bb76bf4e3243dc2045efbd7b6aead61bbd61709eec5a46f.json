{"ast":null,"code":"\"use strict\";\n\n/**\n * @fileOverview fruchterman layout\n * @author shiwu.wyy@antfin.com\n */\nrequire(\"core-js/modules/es.array.push.js\");\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Force2Layout = void 0;\nvar base_1 = require(\"../base\");\nvar util_1 = require(\"../../util\");\nvar ForceNBody_1 = require(\"./ForceNBody\");\nvar proccessToFunc = function (value, defaultV) {\n  var func;\n  if (!value) {\n    func = function (d) {\n      return defaultV || 1;\n    };\n  } else if ((0, util_1.isNumber)(value)) {\n    func = function (d) {\n      return value;\n    };\n  } else {\n    func = value;\n  }\n  return func;\n};\n/**\n * graphin 中的 force 布局\n */\nvar Force2Layout = /** @class */function (_super) {\n  __extends(Force2Layout, _super);\n  function Force2Layout(options) {\n    var _this = _super.call(this) || this;\n    /** 停止迭代的最大迭代数 */\n    _this.maxIteration = 1000;\n    /** 是否启动 worker */\n    _this.workerEnabled = false;\n    /** 弹簧引力系数 */\n    _this.edgeStrength = 200;\n    /** 斥力系数 */\n    _this.nodeStrength = 1000;\n    /** 库伦系数 */\n    _this.coulombDisScale = 0.005;\n    /** 阻尼系数 */\n    _this.damping = 0.9;\n    /** 最大速度 */\n    _this.maxSpeed = 500;\n    /** 一次迭代的平均移动距离小于该值时停止迭代 */\n    _this.minMovement = 0.4;\n    /** 迭代中衰减 */\n    _this.interval = 0.02;\n    /** 斥力的一个系数 */\n    _this.factor = 1;\n    /** 理想边长 */\n    _this.linkDistance = 200;\n    /** 重力大小 */\n    _this.gravity = 0;\n    /** 节点聚类作用力系数 */\n    _this.clusterNodeStrength = 20;\n    /** 是否防止重叠 */\n    _this.preventOverlap = true;\n    /** 阈值的使用条件，mean 代表平均移动距离小于 minMovement 时停止迭代，max 代表最大移动距离大时 minMovement 时停时迭代。默认为 mean */\n    _this.distanceThresholdMode = 'mean';\n    /** 每次迭代结束的回调函数 */\n    _this.tick = function () {};\n    _this.nodes = [];\n    _this.edges = [];\n    _this.width = 300;\n    _this.height = 300;\n    _this.nodeMap = {};\n    _this.nodeIdxMap = {};\n    _this.judgingDistance = 0;\n    /** 默认的向心配置 */\n    _this.centripetalOptions = {\n      leaf: 2,\n      single: 2,\n      others: 1,\n      // eslint-disable-next-line\n      center: function (n) {\n        return {\n          x: _this.width / 2,\n          y: _this.height / 2\n        };\n      }\n    };\n    var getMass = options.getMass;\n    _this.propsGetMass = getMass;\n    _this.updateCfg(options);\n    return _this;\n  }\n  Force2Layout.prototype.getCentripetalOptions = function () {\n    var _a = this,\n      leafCluster = _a.leafCluster,\n      clustering = _a.clustering,\n      nodeClusterBy = _a.nodeClusterBy,\n      nodes = _a.nodes,\n      nodeMap = _a.nodeMap,\n      propsClusterNodeStrength = _a.clusterNodeStrength;\n    var getClusterNodeStrength = function (node) {\n      return typeof propsClusterNodeStrength === 'function' ? propsClusterNodeStrength(node) : propsClusterNodeStrength;\n    };\n    var centripetalOptions = {};\n    var sameTypeLeafMap;\n    // 如果传入了需要叶子节点聚类\n    if (leafCluster) {\n      sameTypeLeafMap = this.getSameTypeLeafMap() || {};\n      var relativeNodesType_1 = Array.from(new Set(nodes === null || nodes === void 0 ? void 0 : nodes.map(function (node) {\n        return node[nodeClusterBy];\n      }))) || [];\n      centripetalOptions = {\n        single: 100,\n        leaf: function (node, nodes, edges) {\n          // 找出与它关联的边的起点或终点出发的所有一度节点中同类型的叶子节点\n          var _a = sameTypeLeafMap[node.id] || {},\n            relativeLeafNodes = _a.relativeLeafNodes,\n            sameTypeLeafNodes = _a.sameTypeLeafNodes;\n          // 如果都是同一类型或者每种类型只有1个，则施加默认向心力\n          if ((sameTypeLeafNodes === null || sameTypeLeafNodes === void 0 ? void 0 : sameTypeLeafNodes.length) === (relativeLeafNodes === null || relativeLeafNodes === void 0 ? void 0 : relativeLeafNodes.length) || (relativeNodesType_1 === null || relativeNodesType_1 === void 0 ? void 0 : relativeNodesType_1.length) === 1) {\n            return 1;\n          }\n          return getClusterNodeStrength(node);\n        },\n        others: 1,\n        center: function (node, nodes, edges) {\n          var _a;\n          var degree = (((_a = node.data) === null || _a === void 0 ? void 0 : _a.layout) || {}).degree;\n          // 孤点默认给1个远离的中心点\n          if (!degree) {\n            return {\n              x: 100,\n              y: 100\n            };\n          }\n          var centerNode;\n          if (degree === 1) {\n            // 如果为叶子节点\n            // 找出与它关联的边的起点出发的所有一度节点中同类型的叶子节点\n            var _b = (sameTypeLeafMap[node.id] || {}).sameTypeLeafNodes,\n              sameTypeLeafNodes = _b === void 0 ? [] : _b;\n            if (sameTypeLeafNodes.length === 1) {\n              // 如果同类型的叶子节点只有1个，中心节点置为undefined\n              centerNode = undefined;\n            } else if (sameTypeLeafNodes.length > 1) {\n              // 找出同类型节点平均位置节点的距离最近的节点作为中心节点\n              centerNode = (0, util_1.getAvgNodePosition)(sameTypeLeafNodes);\n            }\n          } else {\n            centerNode = undefined;\n          }\n          return {\n            x: centerNode === null || centerNode === void 0 ? void 0 : centerNode.x,\n            y: centerNode === null || centerNode === void 0 ? void 0 : centerNode.y\n          };\n        }\n      };\n    }\n    // 如果传入了全局节点聚类\n    if (clustering) {\n      if (!sameTypeLeafMap) sameTypeLeafMap = this.getSameTypeLeafMap();\n      var clusters = Array.from(new Set(nodes.map(function (node, i) {\n        return node[nodeClusterBy];\n      }))).filter(function (item) {\n        return item !== undefined;\n      });\n      var centerNodeInfo_1 = {};\n      clusters.forEach(function (cluster) {\n        var sameTypeNodes = nodes.filter(function (item) {\n          return item[nodeClusterBy] === cluster;\n        }).map(function (node) {\n          return nodeMap[node.id];\n        });\n        // 找出同类型节点平均位置节点的距离最近的节点作为中心节点\n        centerNodeInfo_1[cluster] = (0, util_1.getAvgNodePosition)(sameTypeNodes);\n      });\n      centripetalOptions = {\n        single: function (node) {\n          return getClusterNodeStrength(node);\n        },\n        leaf: function (node) {\n          return getClusterNodeStrength(node);\n        },\n        others: function (node) {\n          return getClusterNodeStrength(node);\n        },\n        center: function (node, nodes, edges) {\n          // 找出同类型节点平均位置节点的距离最近的节点作为中心节点\n          var centerNode = centerNodeInfo_1[node[nodeClusterBy]];\n          return {\n            x: centerNode === null || centerNode === void 0 ? void 0 : centerNode.x,\n            y: centerNode === null || centerNode === void 0 ? void 0 : centerNode.y\n          };\n        }\n      };\n    }\n    this.centripetalOptions = __assign(__assign({}, this.centripetalOptions), centripetalOptions);\n    var _b = this.centripetalOptions,\n      leaf = _b.leaf,\n      single = _b.single,\n      others = _b.others;\n    if (leaf && typeof leaf !== 'function') this.centripetalOptions.leaf = function () {\n      return leaf;\n    };\n    if (single && typeof single !== 'function') this.centripetalOptions.single = function () {\n      return single;\n    };\n    if (others && typeof others !== 'function') this.centripetalOptions.others = function () {\n      return others;\n    };\n  };\n  Force2Layout.prototype.updateCfg = function (cfg) {\n    if (cfg) Object.assign(this, cfg);\n  };\n  Force2Layout.prototype.getDefaultCfg = function () {\n    return {\n      maxIteration: 500,\n      gravity: 10,\n      enableTick: true,\n      animate: true\n    };\n  };\n  /**\n   * 执行布局\n   */\n  Force2Layout.prototype.execute = function () {\n    var self = this;\n    self.stop();\n    var nodes = self.nodes,\n      edges = self.edges,\n      defSpringLen = self.defSpringLen;\n    self.judgingDistance = 0;\n    if (!nodes || nodes.length === 0) {\n      self.onLayoutEnd([]);\n      return;\n    }\n    if (!self.width && typeof window !== \"undefined\") {\n      self.width = window.innerWidth;\n    }\n    if (!self.height && typeof window !== \"undefined\") {\n      self.height = window.innerHeight;\n    }\n    if (!self.center) {\n      self.center = [self.width / 2, self.height / 2];\n    }\n    var center = self.center;\n    if (nodes.length === 1) {\n      nodes[0].x = center[0];\n      nodes[0].y = center[1];\n      self.onLayoutEnd([__assign({}, nodes[0])]);\n      return;\n    }\n    self.degreesMap = (0, util_1.getDegreeMap)(nodes, edges);\n    if (self.propsGetMass) {\n      self.getMass = self.propsGetMass;\n    } else {\n      self.getMass = function (d) {\n        var massWeight = 1;\n        if ((0, util_1.isNumber)(d.mass)) massWeight = d.mass;\n        var degree = self.degreesMap[d.id].all;\n        return !degree || degree < 5 ? massWeight : degree * 5 * massWeight;\n      };\n    }\n    // node size function\n    var nodeSize = self.nodeSize;\n    var nodeSizeFunc;\n    if (self.preventOverlap) {\n      var nodeSpacing_1 = self.nodeSpacing;\n      var nodeSpacingFunc_1;\n      if ((0, util_1.isNumber)(nodeSpacing_1)) {\n        nodeSpacingFunc_1 = function () {\n          return nodeSpacing_1;\n        };\n      } else if ((0, util_1.isFunction)(nodeSpacing_1)) {\n        nodeSpacingFunc_1 = nodeSpacing_1;\n      } else {\n        nodeSpacingFunc_1 = function () {\n          return 0;\n        };\n      }\n      if (!nodeSize) {\n        nodeSizeFunc = function (d) {\n          if (d.size) {\n            if ((0, util_1.isArray)(d.size)) {\n              return Math.max(d.size[0], d.size[1]) + nodeSpacingFunc_1(d);\n            }\n            if ((0, util_1.isObject)(d.size)) {\n              return Math.max(d.size.width, d.size.height) + nodeSpacingFunc_1(d);\n            }\n            return d.size + nodeSpacingFunc_1(d);\n          }\n          return 10 + nodeSpacingFunc_1(d);\n        };\n      } else if ((0, util_1.isArray)(nodeSize)) {\n        nodeSizeFunc = function (d) {\n          return Math.max(nodeSize[0], nodeSize[1]) + nodeSpacingFunc_1(d);\n        };\n      } else {\n        nodeSizeFunc = function (d) {\n          return nodeSize + nodeSpacingFunc_1(d);\n        };\n      }\n    }\n    self.nodeSize = nodeSizeFunc;\n    self.linkDistance = proccessToFunc(self.linkDistance, 1);\n    self.nodeStrength = proccessToFunc(self.nodeStrength, 1);\n    self.edgeStrength = proccessToFunc(self.edgeStrength, 1);\n    var nodeMap = {};\n    var nodeIdxMap = {};\n    nodes.forEach(function (node, i) {\n      if (!(0, util_1.isNumber)(node.x)) node.x = Math.random() * self.width;\n      if (!(0, util_1.isNumber)(node.y)) node.y = Math.random() * self.height;\n      var degree = self.degreesMap[node.id];\n      nodeMap[node.id] = __assign(__assign({}, node), {\n        data: __assign(__assign({}, node.data), {\n          size: self.nodeSize(node) || 30,\n          layout: {\n            inDegree: degree.in,\n            outDegree: degree.out,\n            degree: degree.all,\n            tDegree: degree.in,\n            sDegree: degree.out,\n            force: {\n              mass: self.getMass(node),\n              nodeStrength: self.nodeStrength(node)\n            }\n          }\n        })\n      });\n      nodeIdxMap[node.id] = i;\n    });\n    self.nodeMap = nodeMap;\n    self.nodeIdxMap = nodeIdxMap;\n    self.edgeInfos = [];\n    edges === null || edges === void 0 ? void 0 : edges.forEach(function (edge) {\n      var sourceNode = nodeMap[edge.source];\n      var targetNode = nodeMap[edge.target];\n      if (!sourceNode || !targetNode) {\n        elf.edgeInfos.push({});\n      } else {\n        self.edgeInfos.push({\n          edgeStrength: self.edgeStrength(edge),\n          linkDistance: defSpringLen ? defSpringLen(__assign(__assign({}, edge), {\n            source: sourceNode,\n            target: targetNode\n          }), sourceNode, targetNode) : self.linkDistance(edge, sourceNode, targetNode) || 1 + (nodeSize(sourceNode) + nodeSize(sourceNode) || 0) / 2\n        });\n      }\n    });\n    this.getCentripetalOptions();\n    self.onLayoutEnd = self.onLayoutEnd || function () {};\n    self.run();\n  };\n  Force2Layout.prototype.run = function () {\n    var self = this;\n    var maxIteration = self.maxIteration,\n      nodes = self.nodes,\n      workerEnabled = self.workerEnabled,\n      minMovement = self.minMovement,\n      animate = self.animate,\n      nodeMap = self.nodeMap;\n    if (!nodes) return;\n    var velArray = [];\n    nodes.forEach(function (_, i) {\n      velArray[2 * i] = 0;\n      velArray[2 * i + 1] = 0;\n    });\n    var maxIter = maxIteration;\n    var silence = !animate;\n    if (workerEnabled || silence) {\n      var usedIter = 0;\n      for (var i = 0; (self.judgingDistance > minMovement || i < 1) && i < maxIter; i++) {\n        usedIter = i;\n        self.runOneStep(i, velArray);\n      }\n      self.onLayoutEnd(Object.values(nodeMap));\n    } else {\n      if (typeof window === \"undefined\") return;\n      var iter_1 = 0;\n      // interval for render the result after each iteration\n      this.timeInterval = window.setInterval(function () {\n        if (!nodes) return;\n        self.runOneStep(iter_1, velArray);\n        iter_1++;\n        if (iter_1 >= maxIter || self.judgingDistance < minMovement) {\n          self.onLayoutEnd(Object.values(nodeMap));\n          window.clearInterval(self.timeInterval);\n        }\n      }, 0);\n    }\n  };\n  Force2Layout.prototype.runOneStep = function (iter, velArray) {\n    var _a;\n    var self = this;\n    var nodes = self.nodes,\n      edges = self.edges,\n      nodeMap = self.nodeMap,\n      monitor = self.monitor;\n    var accArray = [];\n    if (!(nodes === null || nodes === void 0 ? void 0 : nodes.length)) return;\n    self.calRepulsive(accArray);\n    if (edges) self.calAttractive(accArray);\n    self.calGravity(accArray);\n    var stepInterval = self.interval; // Math.max(0.02, self.interval - iter * 0.002);\n    self.updateVelocity(accArray, velArray, stepInterval);\n    self.updatePosition(velArray, stepInterval);\n    (_a = self.tick) === null || _a === void 0 ? void 0 : _a.call(self);\n    /** 如果需要监控信息，则提供给用户 */\n    if (monitor) {\n      var energy = this.calTotalEnergy(accArray);\n      monitor({\n        energy: energy,\n        nodes: nodes,\n        edges: edges,\n        iterations: iter\n      });\n    }\n  };\n  Force2Layout.prototype.calTotalEnergy = function (accArray) {\n    var _a = this,\n      nodes = _a.nodes,\n      nodeMap = _a.nodeMap;\n    if (!(nodes === null || nodes === void 0 ? void 0 : nodes.length)) return 0;\n    var energy = 0.0;\n    nodes.forEach(function (node, i) {\n      var vx = accArray[2 * i];\n      var vy = accArray[2 * i + 1];\n      var speed2 = vx * vx + vy * vy;\n      var _a = nodeMap[node.id].data.layout.force.mass,\n        mass = _a === void 0 ? 1 : _a;\n      energy += mass * speed2 * 0.5; // p = 1/2*(mv^2)\n    });\n\n    return energy;\n  };\n  // coulombs law\n  Force2Layout.prototype.calRepulsive = function (accArray) {\n    var self = this;\n    var nodes = self.nodes,\n      nodeMap = self.nodeMap,\n      factor = self.factor,\n      coulombDisScale = self.coulombDisScale;\n    var nodeSize = self.nodeSize;\n    (0, ForceNBody_1.forceNBody)(nodes, nodeMap, factor, coulombDisScale * coulombDisScale, accArray);\n  };\n  // hooks law\n  Force2Layout.prototype.calAttractive = function (accArray) {\n    var self = this;\n    var edges = self.edges,\n      nodeMap = self.nodeMap,\n      nodeIdxMap = self.nodeIdxMap,\n      edgeInfos = self.edgeInfos;\n    var nodeSize = self.nodeSize;\n    edges.forEach(function (edge, i) {\n      var source = (0, util_1.getEdgeTerminal)(edge, 'source');\n      var target = (0, util_1.getEdgeTerminal)(edge, 'target');\n      var sourceNode = nodeMap[source];\n      var targetNode = nodeMap[target];\n      if (!sourceNode || !targetNode) return;\n      var vecX = targetNode.x - sourceNode.x;\n      var vecY = targetNode.y - sourceNode.y;\n      if (!vecX && !vecY) {\n        vecX = Math.random() * 0.01;\n        vecY = Math.random() * 0.01;\n      }\n      var vecLength = Math.sqrt(vecX * vecX + vecY * vecY);\n      var direX = vecX / vecLength;\n      var direY = vecY / vecLength;\n      // @ts-ignore\n      var _a = edgeInfos[i] || {},\n        _b = _a.linkDistance,\n        linkDistance = _b === void 0 ? 200 : _b,\n        _c = _a.edgeStrength,\n        edgeStrength = _c === void 0 ? 200 : _c;\n      var diff = linkDistance - vecLength;\n      var param = diff * edgeStrength;\n      var massSource = sourceNode.data.layout.force.mass || 1;\n      var massTarget = targetNode.data.layout.force.mass || 1;\n      // 质量占比越大，对另一端影响程度越大\n      var sourceMassRatio = 1 / massSource;\n      var targetMassRatio = 1 / massTarget;\n      var disX = direX * param;\n      var disY = direY * param;\n      var sourceIdx = 2 * nodeIdxMap[source];\n      var targetIdx = 2 * nodeIdxMap[target];\n      accArray[sourceIdx] -= disX * sourceMassRatio;\n      accArray[sourceIdx + 1] -= disY * sourceMassRatio;\n      accArray[targetIdx] += disX * targetMassRatio;\n      accArray[targetIdx + 1] += disY * targetMassRatio;\n    });\n  };\n  // attract to center\n  Force2Layout.prototype.calGravity = function (accArray) {\n    var _a;\n    var self = this;\n    var nodes = self.nodes,\n      _b = self.edges,\n      edges = _b === void 0 ? [] : _b,\n      nodeMap = self.nodeMap,\n      width = self.width,\n      height = self.height,\n      center = self.center,\n      defaultGravity = self.gravity,\n      degreesMap = self.degreesMap,\n      centripetalOptions = self.centripetalOptions;\n    if (!nodes) return;\n    var nodeLength = nodes.length;\n    for (var i = 0; i < nodeLength; i++) {\n      var idx = 2 * i;\n      var node = nodeMap[nodes[i].id];\n      var _c = node.data.layout.force.mass,\n        mass = _c === void 0 ? 1 : _c;\n      var vecX = 0;\n      var vecY = 0;\n      var gravity = defaultGravity;\n      var _d = degreesMap[node.id],\n        inDegree = _d.in,\n        outDegree = _d.out,\n        degree = _d.all;\n      var forceCenter = (_a = self.getCenter) === null || _a === void 0 ? void 0 : _a.call(self, node, degree);\n      if (forceCenter) {\n        var centerX = forceCenter[0],\n          centerY = forceCenter[1],\n          strength = forceCenter[2];\n        vecX = node.x - centerX;\n        vecY = node.y - centerY;\n        gravity = strength;\n      } else {\n        vecX = node.x - center[0];\n        vecY = node.y - center[1];\n      }\n      if (gravity) {\n        accArray[idx] -= gravity * vecX / mass;\n        accArray[idx + 1] -= gravity * vecY / mass;\n      }\n      if (centripetalOptions) {\n        var leaf = centripetalOptions.leaf,\n          single = centripetalOptions.single,\n          others = centripetalOptions.others,\n          centriCenter = centripetalOptions.center;\n        var _e = (centriCenter === null || centriCenter === void 0 ? void 0 : centriCenter(node, nodes, edges, width, height)) || {\n            x: 0,\n            y: 0,\n            centerStrength: 0\n          },\n          centriX = _e.x,\n          centriY = _e.y,\n          centerStrength = _e.centerStrength;\n        if (!(0, util_1.isNumber)(centriX) || !(0, util_1.isNumber)(centriY)) continue;\n        var vx = (node.x - centriX) / mass;\n        var vy = (node.y - centriY) / mass;\n        if (centerStrength) {\n          accArray[idx] -= centerStrength * vx;\n          accArray[idx + 1] -= centerStrength * vy;\n        }\n        // 孤点\n        if (degree === 0) {\n          var singleStrength = single(node);\n          if (!singleStrength) continue;\n          accArray[idx] -= singleStrength * vx;\n          accArray[idx + 1] -= singleStrength * vy;\n          continue;\n        }\n        // 没有出度或没有入度，都认为是叶子节点\n        if (inDegree === 0 || outDegree === 0) {\n          var leafStrength = leaf(node, nodes, edges);\n          if (!leafStrength) continue;\n          accArray[idx] -= leafStrength * vx;\n          accArray[idx + 1] -= leafStrength * vy;\n          continue;\n        }\n        /** others */\n        var othersStrength = others(node);\n        if (!othersStrength) continue;\n        accArray[idx] -= othersStrength * vx;\n        accArray[idx + 1] -= othersStrength * vy;\n      }\n    }\n  };\n  // TODO: 待 graphin 修改正确\n  // public attractToSide(accArray: number[]) {\n  //   const { defSideCoe, height, nodes } = this;\n  //   if (!defSideCoe || typeof defSideCoe !== 'function' || !nodes?.length) return;\n  //   nodes.forEach((node, i) => {\n  //     const sideCoe = defSideCoe!(node);\n  //     if (sideCoe === 0) return;\n  //     const targetY = sideCoe > 0 ? 0 : height;\n  //     const strength = Math.abs(sideCoe);\n  //     accArray[2 * i + 1] -= strength * (targetY - node.y);\n  //   });\n  // };\n  Force2Layout.prototype.updateVelocity = function (accArray, velArray, stepInterval) {\n    var self = this;\n    var nodes = self.nodes,\n      damping = self.damping,\n      maxSpeed = self.maxSpeed;\n    if (!(nodes === null || nodes === void 0 ? void 0 : nodes.length)) return;\n    nodes.forEach(function (_, i) {\n      var vx = (velArray[2 * i] + accArray[2 * i] * stepInterval) * damping || 0.01;\n      var vy = (velArray[2 * i + 1] + accArray[2 * i + 1] * stepInterval) * damping || 0.01;\n      var vLength = Math.sqrt(vx * vx + vy * vy);\n      if (vLength > maxSpeed) {\n        var param2 = maxSpeed / vLength;\n        vx = param2 * vx;\n        vy = param2 * vy;\n      }\n      velArray[2 * i] = vx;\n      velArray[2 * i + 1] = vy;\n    });\n  };\n  Force2Layout.prototype.updatePosition = function (velArray, stepInterval) {\n    var self = this;\n    var nodes = self.nodes,\n      distanceThresholdMode = self.distanceThresholdMode,\n      nodeMap = self.nodeMap;\n    if (!(nodes === null || nodes === void 0 ? void 0 : nodes.length)) {\n      this.judgingDistance = 0;\n      return;\n    }\n    var sum = 0;\n    if (distanceThresholdMode === 'max') self.judgingDistance = -Infinity;else if (distanceThresholdMode === 'min') self.judgingDistance = Infinity;\n    nodes.forEach(function (node, i) {\n      var mappedNode = nodeMap[node.id];\n      if ((0, util_1.isNumber)(node.fx) && (0, util_1.isNumber)(node.fy)) {\n        node.x = node.fx;\n        node.y = node.fy;\n        mappedNode.x = node.x;\n        mappedNode.y = node.y;\n        return;\n      }\n      var distX = velArray[2 * i] * stepInterval;\n      var distY = velArray[2 * i + 1] * stepInterval;\n      node.x += distX;\n      node.y += distY;\n      mappedNode.x = node.x;\n      mappedNode.y = node.y;\n      var distanceMagnitude = Math.sqrt(distX * distX + distY * distY);\n      switch (distanceThresholdMode) {\n        case 'max':\n          if (self.judgingDistance < distanceMagnitude) self.judgingDistance = distanceMagnitude;\n          break;\n        case 'min':\n          if (self.judgingDistance > distanceMagnitude) self.judgingDistance = distanceMagnitude;\n          break;\n        default:\n          sum = sum + distanceMagnitude;\n          break;\n      }\n    });\n    if (!distanceThresholdMode || distanceThresholdMode === 'mean') self.judgingDistance = sum / nodes.length;\n  };\n  Force2Layout.prototype.stop = function () {\n    if (this.timeInterval && typeof window !== \"undefined\") {\n      window.clearInterval(this.timeInterval);\n    }\n  };\n  Force2Layout.prototype.destroy = function () {\n    var self = this;\n    self.stop();\n    self.tick = null;\n    self.nodes = null;\n    self.edges = null;\n    self.destroyed = true;\n  };\n  Force2Layout.prototype.getType = function () {\n    return \"force2\";\n  };\n  Force2Layout.prototype.getSameTypeLeafMap = function () {\n    var _a = this,\n      nodeClusterBy = _a.nodeClusterBy,\n      nodes = _a.nodes,\n      edges = _a.edges,\n      nodeMap = _a.nodeMap,\n      degreesMap = _a.degreesMap;\n    if (!(nodes === null || nodes === void 0 ? void 0 : nodes.length)) return;\n    // eslint-disable-next-line\n    var sameTypeLeafMap = {};\n    nodes.forEach(function (node, i) {\n      var degree = degreesMap[node.id].all;\n      if (degree === 1) {\n        sameTypeLeafMap[node.id] = (0, util_1.getCoreNodeAndRelativeLeafNodes)('leaf', node, edges, nodeClusterBy, degreesMap, nodeMap);\n      }\n    });\n    return sameTypeLeafMap;\n  };\n  return Force2Layout;\n}(base_1.Base);\nexports.Force2Layout = Force2Layout;","map":{"version":3,"mappings":"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","names":["proccessToFunc","value","defaultV","func","d","__extends","options","_super","_this","judgingDistance","centripetalOptions","leaf","single","others","center","n","x","width","y","height","propsGetMass","getMass","updateCfg","Force2Layout","leafCluster","clustering","nodeClusterBy","nodes","nodeMap","propsClusterNodeStrength","getClusterNodeStrength","node","sameTypeLeafMap","getSameTypeLeafMap","relativeNodesType_1","Array","from","Set","map","edges","id","relativeLeafNodes","sameTypeLeafNodes","length","data","layout","degree","centerNode","undefined","clusters","i","filter","item","centerNodeInfo_1","forEach","cluster","sameTypeNodes","cfg","Object","assign","maxIteration","gravity","enableTick","animate","self","stop","defSpringLen","onLayoutEnd","window","innerWidth","innerHeight","degreesMap","massWeight","mass","all","nodeSize","nodeSizeFunc","preventOverlap","nodeSpacing_1","nodeSpacing","nodeSpacingFunc_1","size","Math","max","linkDistance","nodeStrength","edgeStrength","nodeIdxMap","random","inDegree","in","outDegree","out","tDegree","sDegree","force","edgeInfos","edge","sourceNode","source","targetNode","target","elf","push","getCentripetalOptions","run","workerEnabled","minMovement","velArray","_","maxIter","silence","usedIter","runOneStep","values","iter_1","timeInterval","setInterval","clearInterval","iter","monitor","accArray","calRepulsive","calAttractive","calGravity","stepInterval","interval","updateVelocity","updatePosition","tick","energy","calTotalEnergy","iterations","vx","vy","speed2","factor","coulombDisScale","vecX","vecY","vecLength","sqrt","direX","direY","_b","_c","diff","param","massSource","massTarget","sourceMassRatio","targetMassRatio","disX","disY","sourceIdx","targetIdx","defaultGravity","nodeLength","idx","forceCenter","getCenter","centerY","strength","centerX","centriCenter","centerStrength","centriX","centriY","singleStrength","leafStrength","othersStrength","damping","maxSpeed","vLength","param2","distanceThresholdMode","sum","Infinity","mappedNode","fx","fy","distX","distY","distanceMagnitude","destroyed","base_1","exports"],"sourceRoot":"","sources":["../../../src/layout/force2/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}