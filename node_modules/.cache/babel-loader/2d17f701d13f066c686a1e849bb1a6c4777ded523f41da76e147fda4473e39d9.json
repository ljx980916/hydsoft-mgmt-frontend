{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar util_1 = require(\"../util\");\nvar sort = function (entries, biasRight, usePrev, keepNodeOrder) {\n  var parts = (0, util_1.partition)(entries, function (entry) {\n    var hasFixOrder = entry.hasOwnProperty(\"fixorder\") && !isNaN(entry.fixorder);\n    if (keepNodeOrder) return !hasFixOrder && entry.hasOwnProperty(\"barycenter\");\n    // NOTE: 有fixorder的也可以排\n    return hasFixOrder || entry.hasOwnProperty(\"barycenter\");\n  });\n  var sortable = parts.lhs;\n  var unsortable = parts.rhs.sort(function (a, b) {\n    return -a.i - -b.i;\n  });\n  var vs = [];\n  var sum = 0;\n  var weight = 0;\n  var vsIndex = 0;\n  sortable === null || sortable === void 0 ? void 0 : sortable.sort(compareWithBias(!!biasRight, !!usePrev));\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  sortable === null || sortable === void 0 ? void 0 : sortable.forEach(function (entry) {\n    var _a;\n    vsIndex += (_a = entry.vs) === null || _a === void 0 ? void 0 : _a.length;\n    vs.push(entry.vs);\n    sum += entry.barycenter * entry.weight;\n    weight += entry.weight;\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  });\n  var result = {\n    vs: vs.flat()\n  };\n  if (weight) {\n    result.barycenter = sum / weight;\n    result.weight = weight;\n  }\n  return result;\n};\nvar consumeUnsortable = function (vs, unsortable, index) {\n  var iindex = index;\n  var last;\n  while (unsortable.length && (last = unsortable[unsortable.length - 1]).i <= iindex) {\n    unsortable.pop();\n    vs === null || vs === void 0 ? void 0 : vs.push(last.vs);\n    iindex++;\n  }\n  return iindex;\n};\n/**\n * 配置是否考虑使用之前的布局结果\n */\nvar compareWithBias = function (bias, usePrev) {\n  return function (entryV, entryW) {\n    // 排序的时候先判断fixorder，不行再判断重心\n    if (entryV.fixorder !== undefined && entryW.fixorder !== undefined) {\n      return entryV.fixorder - entryW.fixorder;\n    }\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1;\n    }\n    if (entryV.barycenter > entryW.barycenter) {\n      return 1;\n    }\n    // 重心相同，考虑之前排好的顺序\n    if (usePrev && entryV.order !== undefined && entryW.order !== undefined) {\n      if (entryV.order < entryW.order) {\n        return -1;\n      }\n      if (entryV.order > entryW.order) {\n        return 1;\n      }\n    }\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i;\n  };\n};\nexports.default = sort;","map":{"version":3,"mappings":"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","names":["sort","entries","biasRight","usePrev","keepNodeOrder","parts","entry","hasFixOrder","hasOwnProperty","isNaN","fixorder","sortable","lhs","unsortable","rhs","a","b","i","vs","sum","weight","vsIndex","compareWithBias","consumeUnsortable","forEach","length","push","barycenter","result","flat","index","iindex","last","pop","bias","entryV","entryW","undefined","order","exports"],"sourceRoot":"","sources":["../../../../../src/layout/dagre/src/order/sort.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}