{"ast":null,"code":"import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"defaultPadding\"\n};\nconst _hoisted_2 = /*#__PURE__*/_createElementVNode(\"span\", null, \"部门名称：\", -1 /* HOISTED */);\nconst _hoisted_3 = /*#__PURE__*/_createElementVNode(\"span\", null, \"日期：\", -1 /* HOISTED */);\nconst _hoisted_4 = {\n  class: \"pointer\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_a_option = _resolveComponent(\"a-option\");\n  const _component_a_select = _resolveComponent(\"a-select\");\n  const _component_a_space = _resolveComponent(\"a-space\");\n  const _component_a_col = _resolveComponent(\"a-col\");\n  const _component_a_date_picker = _resolveComponent(\"a-date-picker\");\n  const _component_a_row = _resolveComponent(\"a-row\");\n  const _component_a_popover = _resolveComponent(\"a-popover\");\n  const _component_a_table = _resolveComponent(\"a-table\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_a_row, {\n    gutter: [14, 20],\n    align: \"center\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_a_col, {\n      flex: \"230px\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_a_space, null, {\n        default: _withCtx(() => [_hoisted_2, _createVNode(_component_a_select, {\n          modelValue: $setup.deptName,\n          \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.deptName = $event),\n          placeholder: \"请选择部门\",\n          style: {\n            \"width\": \"130px\"\n          },\n          onChange: $setup.changeDeptName\n        }, {\n          default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.deptList, (item, index) => {\n            return _openBlock(), _createBlock(_component_a_option, {\n              value: item,\n              key: index\n            }, {\n              default: _withCtx(() => [_createTextVNode(_toDisplayString(item), 1 /* TEXT */)]),\n\n              _: 2 /* DYNAMIC */\n            }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"value\"]);\n          }), 128 /* KEYED_FRAGMENT */))]),\n\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    }), _createVNode(_component_a_col, {\n      flex: \"200px\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_a_space, null, {\n        default: _withCtx(() => [_hoisted_3, _createVNode(_component_a_date_picker, {\n          format: \"YYYY-MM-DD\",\n          \"allow-clear\": false,\n          disabledDate: $setup.getDisabledTime,\n          \"model-value\": $setup.dateVal,\n          onChange: $setup.handleDatePicker,\n          style: {\n            \"width\": \"130px\"\n          }\n        }, null, 8 /* PROPS */, [\"model-value\"])]),\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    }), _createVNode(_component_a_col, {\n      flex: \"85px\"\n    }), _createVNode(_component_a_col, {\n      flex: \"auto\"\n    })]),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_a_row, null, {\n    default: _withCtx(() => [_createVNode(_component_a_col, {\n      span: 24\n    }, {\n      default: _withCtx(() => [_createVNode(_component_a_table, {\n        ref: \"level1tableRef\",\n        class: \"m-t-20\",\n        \"column-resizable\": \"\",\n        columns: $setup.dataContent.columns,\n        data: $setup.dataContent.dataSource,\n        loading: $setup.dataContent.loading,\n        \"expanded-keys\": $setup.dataContent.defaultExpandedKeys,\n        scrollbar: false,\n        scroll: {\n          maxHeight: $setup.maxHeight\n        },\n        onExpandedChange: $setup.expandedChange,\n        pagination: false\n      }, {\n        deptName: _withCtx(({\n          record\n        }) => [_createVNode(_component_a_popover, {\n          \"content-style\": {\n            background: 'rgba(0,0,0,.8)',\n            color: '#fff'\n          },\n          \"arrow-style\": {\n            background: 'rgba(0,0,0,.8)'\n          }\n        }, {\n          content: _withCtx(() => [_createTextVNode(_toDisplayString(record.deptName), 1 /* TEXT */)]),\n\n          default: _withCtx(() => [_createElementVNode(\"span\", _hoisted_4, _toDisplayString($setup.constructDeptName(record.deptName)), 1 /* TEXT */)]),\n\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"content-style\", \"arrow-style\"])]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"columns\", \"data\", \"loading\", \"expanded-keys\", \"scroll\"])]),\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"mappings":";;EACOA,KAAK,EAAC;AAAgB;gCAInBC,oBAAkB,cAAZ,OAAK;gCAQXA,oBAAgB,cAAV,KAAG;;EAkCCD,KAAK,EAAC;AAAS;;;;;;;;;;uBA9CjCE,oBAuDM,OAvDNC,UAuDM,GAtDJC,aAwBQC;IAxBAC,MAAM,EAAE,QAAQ;IAAEC,KAAK,EAAC;;sBAC9B,MAOQ,CAPRH,aAOQI;MAPDC,IAAI,EAAC;IAAO;wBACjB,MAKU,CALVL,aAKUM;0BAJR,MAAkB,CAAlBC,UAAkB,EAClBP,aAEWQ;sBAFQC,eAAQ;qEAARA,eAAQ;UAAEC,WAAW,EAAC,OAAO;UAACC,KAAoB,EAApB;YAAA;UAAA,CAAoB;UAAEC,QAAM,EAAEH;;4BACnE,MAAiC,oBAA3CX,oBAA4Fe,6BAA1DJ,eAAQ,GAAxBK,IAAI,EAAEC,KAAK;iCAA7BC,aAA4FC;cAA/CC,KAAK,EAAEJ,IAAI;cAAGK,GAAG,EAAEJ;;gCAAO,MAAU,mCAAPD,IAAI;;;;;;;;;;;;QAIpFd,aAYQI;MAZDC,IAAI,EAAC;IAAO;wBACjB,MAUU,CAVVL,aAUUM;0BATR,MAAgB,CAAhBc,UAAgB,EAChBpB,aAOEqB;UANAC,MAAM,EAAC,YAAY;UAClB,aAAW,EAAE,KAAK;UAClBC,YAAY,EAAEd,sBAAe;UACvB,aAAW,EAAEA,cAAO;UAC1BG,QAAM,EAAEH,uBAAgB;UACzBE,KAAoB,EAApB;YAAA;UAAA;;;;;;QAINX,aAA2BI;MAApBC,IAAI,EAAC;IAAM,IAClBL,aAA2BI;MAApBC,IAAI,EAAC;IAAM;;MAEpBL,aA4BQC;sBA3BN,MA0BQ,CA1BRD,aA0BQI;MA1BAoB,IAAI,EAAE;IAAE;wBACd,MAwBU,CAxBVxB,aAwBUyB;QAvBRC,GAAG,EAAC,gBAAgB;QACpB9B,KAAK,EAAC,QAAQ;QACd,kBAAgB,EAAhB,EAAgB;QACf+B,OAAO,EAAElB,kBAAW,CAACkB,OAAO;QAC5BC,IAAI,EAAEnB,kBAAW,CAACoB,UAAU;QAC5BC,OAAO,EAAErB,kBAAW,CAACqB,OAAO;QAC5B,eAAa,EAAErB,kBAAW,CAACsB,mBAAmB;QAC9CC,SAAS,EAAE,KAAK;QAChBC,MAAM;UAAAC,WAAezB;QAAS;QAC9B0B,gBAAe,EAAE1B,qBAAc;QAC/B2B,UAAU,EAAE;;QAEFC,QAAQ,WACjB,CAQY;UATSC;QAAM,OAC3BtC,aAQYuC;UAPT,eAAa,EAAE;YAAAC;YAAAC;UAAA,CAA+C;UAC9D,aAAW,EAAE;YAAAD;UAAA;;UAGHE,OAAO,WAChB,MAAqB,mCAAlBJ,MAAM,CAACD,QAAQ;;4BAFpB,MAAqE,CAArExC,oBAAqE,QAArE8C,UAAqE,mBAA5ClC,wBAAiB,CAAC6B,MAAM,CAACD,QAAQ","names":["class","_createElementVNode","_createElementBlock","_hoisted_1","_createVNode","_component_a_row","gutter","align","_component_a_col","flex","_component_a_space","_hoisted_2","_component_a_select","$setup","placeholder","style","onChange","_Fragment","item","index","_createBlock","_component_a_option","value","key","_hoisted_3","_component_a_date_picker","format","disabledDate","span","_component_a_table","ref","columns","data","dataSource","loading","defaultExpandedKeys","scrollbar","scroll","maxHeight","onExpandedChange","pagination","deptName","record","_component_a_popover","background","color","content","_hoisted_4"],"sourceRoot":"","sources":["/Users/lijiaxin/Documents/workspace/hydsoft-mgmt-frontend/src/views/staffStatistics/staffStatics/staticDetail.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <a-row :gutter=\"[14, 20]\" align=\"center\">\n      <a-col flex=\"230px\">\n        <a-space>\n          <span>部门名称：</span>\n          <a-select v-model=\"deptName\" placeholder=\"请选择部门\" style=\"width: 130px\" @change=\"changeDeptName\">\n            <a-option v-for=\"(item, index) of deptList\" :value=\"item\" :key=\"index\">{{ item }}</a-option>\n          </a-select>\n        </a-space>\n      </a-col>\n      <a-col flex=\"200px\">\n        <a-space>\n          <span>日期：</span>\n          <a-date-picker\n            format=\"YYYY-MM-DD\"\n            :allow-clear=\"false\"\n            :disabledDate=\"getDisabledTime\"\n            v-bind:model-value=\"dateVal\"\n            @change=\"handleDatePicker\"\n            style=\"width: 130px\"\n          />\n        </a-space>\n      </a-col>\n      <a-col flex=\"85px\"></a-col>\n      <a-col flex=\"auto\"></a-col>\n    </a-row>\n    <a-row>\n      <a-col :span=\"24\">\n        <a-table\n          ref=\"level1tableRef\"\n          class=\"m-t-20\"\n          column-resizable\n          :columns=\"dataContent.columns\"\n          :data=\"dataContent.dataSource\"\n          :loading=\"dataContent.loading\"\n          :expanded-keys=\"dataContent.defaultExpandedKeys\"\n          :scrollbar=\"false\"\n          :scroll=\"{ maxHeight: maxHeight }\"\n          @expanded-change=\"expandedChange\"\n          :pagination=\"false\"\n        >\n          <template #deptName=\"{ record }\">\n            <a-popover\n              :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n              :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n            >\n              <span class=\"pointer\">{{ constructDeptName(record.deptName) }}</span>\n              <template #content>\n                {{ record.deptName }}\n              </template>\n            </a-popover>\n          </template>\n        </a-table>\n      </a-col>\n    </a-row>\n  </div>\n</template>\n\n<script setup>\nimport { getDetailData } from \"@/api/staffStatics.js\";\nimport { onBeforeMount, onMounted, reactive, ref, nextTick, watchEffect, onUnmounted } from \"vue\";\nimport { Message } from \"@arco-design/web-vue\";\nimport { useRouter, useRoute } from \"vue-router\";\nimport { staffDetailList } from \"../constColumns\";\nimport { dataAddKey, getSplitNum } from \"@/utils/util.js\";\nimport moment from \"moment\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\nconst router = useRouter();\nconst route = useRoute();\nconst level1tableRef = ref(null);\nconst maxHeight = ref(\"\");\nconst dateVal = ref(new Date());\nconst deptName = ref(history.state.deptName);\nconst deptList = ref([\"全部\", \"BG1\", \"BG2\", \"BG3\", \"BG4\"]);\nconst dataContent = reactive({\n  loading: false,\n  columns: staffDetailList,\n  defaultExpandedKeys: [],\n  dataSource: [],\n});\nwatchEffect(() => {\n  $bus.emit(\"updateStructure\", [\n    {\n      type: \"text\",\n      color: \"#333\",\n      msg: `人员分析`,\n    },\n    {\n      type: \"button\",\n      color: \"#5370FD\",\n      msg: `人员统计`,\n      params: \"level1\",\n    },\n    {\n      type: \"text\",\n      color: \"#333\",\n      msg: \"人员明细\",\n    },\n  ]);\n});\n$bus.on(\"goBack\", val => {\n  if (val == \"level1\") {\n    let breadList1 = [\n      { type: \"text\", color: \"#333\", msg: `人员分析` },\n      { type: \"text\", color: \"#333\", msg: `人员统计` },\n    ];\n    $bus.emit(\"updateStructure\", breadList1);\n    router.push({\n      path: \"/staticPicture\",\n      state: {\n        deptName: deptName.value,\n      },\n    });\n  }\n});\nonUnmounted(() => {\n  $bus.off(\"goBack\");\n});\nconst expandedChange = rowKeys => {\n  dataContent.defaultExpandedKeys = rowKeys;\n};\n//禁选日期\nconst getDisabledTime = current => {\n  return current.valueOf() < moment(\"2023-01-01 00:00:00\").valueOf() || current.valueOf() > moment().valueOf();\n};\n// 处理部门名称\nconst constructDeptName = deptName => {\n  const lastDashIndex = deptName.lastIndexOf(\"-\");\n  return deptName.substring(lastDashIndex + 1);\n};\n// 更改日期\nconst handleDatePicker = value => {\n  dateVal.value = new Date(value);\n  getData();\n};\n// 更改部门\nconst changeDeptName = val => {\n  deptName.value = val;\n  getData();\n};\nonMounted(() => {\n  if (level1tableRef.value) {\n    let head = level1tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      maxHeight.value = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\nonBeforeMount(() => {\n  getData();\n});\nconst getTableNum = arr => {\n  Array.isArray(arr) &&\n    arr.forEach(item => {\n      item.c1 = getSplitNum(item.c1);\n      item.c2 = getSplitNum(item.c2);\n      item.g = getSplitNum(item.g);\n      item.r = getSplitNum(item.r);\n      item.s = getSplitNum(item.s);\n      item.entry = getSplitNum(item.entry);\n      item.official = getSplitNum(item.official);\n      item.practice = getSplitNum(item.practice);\n      item.total = getSplitNum(item.total);\n      item.dimission = getSplitNum(item.dimission);\n      item.pluralistic = getSplitNum(item.pluralistic);\n      if (item.children) {\n        getTableNum(item.children);\n      }\n    });\n  return arr;\n};\nconst getData = () => {\n  var y = dateVal.value.getFullYear();\n  var m = dateVal.value.getMonth() + 1;\n  m = m < 10 ? \"0\" + m : m;\n  var d = dateVal.value.getDate();\n  d = d < 10 ? \"0\" + d : d;\n  const formData = new FormData();\n  if (deptName.value !== \"全部\") {\n    formData.append(\"deptName\", deptName.value);\n  }\n  formData.append(\"time\", `${y}-${m}-${d}`);\n  dataContent.loading = true;\n  getDetailData(formData)\n    .then(res => {\n      if (res.code === \"000000000000\") {\n        if (res.data && res.data.length > 0) {\n          let data = dataAddKey(res.data, \"key\", \"deptName\");\n          dataContent.dataSource = getTableNum(data);\n          let keys = [];\n          res.data.forEach(item => keys.push(item.deptName));\n          dataContent.defaultExpandedKeys = keys;\n        }\n      }\n    })\n    .catch(e => {\n      Message.error(e.message || \"请求失败\");\n    })\n    .finally(() => {\n      dataContent.loading = false;\n    });\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}