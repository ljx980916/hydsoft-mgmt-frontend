{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getDepartmentRingList } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo } from \"../../utils/util\";\nimport canvasVue from \"@/components/canvasContainer.vue\";\nimport { Message } from \"@arco-design/web-vue\";\nexport default {\n  __name: 'loopAnalyze',\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    let tagColumnList = useTagColumnListStore();\n    let columConfig = {};\n    const isFold = ref(false);\n    const tableInfo = reactive({\n      columns: [],\n      data: [],\n      maxHeight: \"200px\",\n      loading: false\n    });\n    const selectMonth = ref(\"3\");\n    const tableRef = ref(null);\n    const tabChangeColumInfo = reactive({\n      columnTabs: [],\n      up: [],\n      down: []\n    });\n    const canvasLine1 = ref(\"\");\n    const canvasLine2 = ref(\"\");\n    const canvasLine3 = ref(\"\");\n    onMounted(() => {\n      if (tableRef.value) {\n        let head = tableRef.value.$el;\n        nextTick(() => {\n          let innerHeight = window.innerHeight;\n          let elHeight = head.getBoundingClientRect().top;\n          tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n        });\n      }\n    });\n    // 初始化\n    const seltColumns = () => {\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n      if (currentPageColumn.length) {\n        currentPageColumn[0].tier.forEach((item, index) => {\n          let tabs = [];\n          let columnTabs = [];\n          let columnHasSonTabs = [];\n          let noHiddenColumn = [];\n          let defaultColumHasSonTabs = [];\n          let defaultColumnTabs = [];\n          item.tags.forEach(jtem => {\n            tabs.push(jtem.tag);\n            jtem.columns.forEach(ktem => {\n              let {\n                col,\n                conf,\n                title\n              } = ktem;\n              conf = conf || {};\n              let columnItemConfig = {\n                title,\n                dataIndex: col,\n                align: conf.align,\n                cellStyle: {\n                  \"text-align\": conf.cellAlign\n                },\n                width: conf.width,\n                ellipsis: true,\n                headerCellClass: \"noEllipsis\",\n                slotName: col\n              };\n              columnItemConfig.isShow = conf.isShow;\n              if (conf.fixed !== undefined) {\n                columnItemConfig.fixed = conf.fixed;\n              }\n              if (conf.toFixed !== undefined) {\n                if (conf.showPercent) {\n                  columnItemConfig.render = ({\n                    record\n                  }) => {\n                    return record[col];\n                  };\n                } else {\n                  columnItemConfig.render = ({\n                    record\n                  }) => {\n                    return record[col];\n                  };\n                }\n              }\n              if (conf.canHide === 1) {\n                if (conf.parentCol === 0) {\n                  columnTabs.push(columnItemConfig);\n                } else {\n                  columnHasSonTabs.push(columnItemConfig);\n                }\n              } else {\n                noHiddenColumn.push(columnItemConfig);\n              }\n              if (conf.parentCol === 1) {\n                defaultColumHasSonTabs.push(columnItemConfig);\n              } else {\n                defaultColumnTabs.push(columnItemConfig);\n              }\n            });\n          });\n          columConfig[\"level\" + (index + 1)] = {\n            tabs,\n            params: item.params || [],\n            columnTabs,\n            columnHasSonTabs,\n            noHiddenColumn,\n            defaultColumnTabs,\n            defaultColumHasSonTabs\n          };\n        });\n      }\n      tabChangeColumInfo.columnTabs = columConfig.level1.columnTabs;\n      tabChangeColumInfo.up = columConfig.level1.columnHasSonTabs.slice(0, 5);\n      tabChangeColumInfo.down = columConfig.level1.columnHasSonTabs.slice(5);\n    };\n    let filterShowChildrenColumn = [];\n    // 更换表头\n    const analysiisColumn = () => {\n      let {\n        columnTabs,\n        noHiddenColumn,\n        defaultColumHasSonTabs\n      } = columConfig.level1;\n      let num = 6;\n      switch (selectMonth.value) {\n        case \"3\":\n          let months1 = getNMonthsAgo(3);\n          let children1 = [];\n          let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months1.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n                slotName: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`\n              };\n            });\n            children1.push(columnHasSonConfig);\n          });\n          num = 0;\n          filterShowChildrenColumn = children1;\n          break;\n        case \"6\":\n          let months2 = getNMonthsAgo(6);\n          let children2 = [];\n          let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months2.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n                slotName: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`\n              };\n            });\n            children2.push(columnHasSonConfig);\n          });\n          num = 0;\n          filterShowChildrenColumn = children2;\n          break;\n        case \"12\":\n          let months3 = getNMonthsAgo(12);\n          let children3 = [];\n          let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months3.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n                slotName: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`\n              };\n            });\n            children3.push(columnHasSonConfig);\n          });\n          num = 0;\n          filterShowChildrenColumn = children3;\n          break;\n        default:\n          break;\n      }\n      filterShowChildrenColumn.forEach(item => {\n        if (item.children?.length) {\n          item.children = item.children.filter(jtem => jtem.isShow === 1);\n        }\n      });\n      let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn];\n      let number = 0;\n      filterAllShowColumn.forEach(item => {\n        number += 1;\n        if (!item.children) {\n          item.dataIndex = `colNo${number}`;\n          item.slotName = `colNo${number}`;\n        } else {\n          number = number - 1;\n          item.children.forEach(jtem => {\n            number += 1;\n            jtem.dataIndex = `colNo${number}`;\n            jtem.slotName = `colNo${number}`;\n          });\n        }\n      });\n      tableInfo.columns = filterAllShowColumn;\n      var index = tableInfo.columns.findIndex(item => item.children);\n      canvasLine3.value = tableInfo.columns[index - 1].dataIndex;\n      canvasLine2.value = tableInfo.columns[index - 2].dataIndex;\n      canvasLine1.value = tableInfo.columns[index - 3].dataIndex;\n    };\n    // 切换时间区间\n    const handleMonthChange = month => {\n      selectMonth.value = month;\n      analysiisColumn();\n      getList();\n    };\n    onBeforeMount(() => {\n      seltColumns();\n      analysiisColumn();\n      getList();\n    });\n    // 点击部门名称 客户名称\n    const handleTabChange = tab => {\n      switch (tab.isShow) {\n        case 0:\n          tab.isShow = 1;\n          changeShowStatus({\n            type: \"parent\",\n            title: tab.title,\n            val: 1\n          });\n          break;\n        case 1:\n          tab.isShow = 0;\n          changeShowStatus({\n            type: \"parent\",\n            title: tab.title,\n            val: 0\n          });\n          break;\n        default:\n          break;\n      }\n    };\n    // 点击部门名称 客户名称之外的标签\n    const handleHasSonTabChange = tab => {\n      switch (tab.isShow) {\n        case 0:\n          tab.isShow = 1;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 1\n          });\n          break;\n        case 1:\n          tab.isShow = 0;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 0\n          });\n          break;\n        default:\n          break;\n      }\n    };\n    // 更改高亮状态并更换表头\n    const changeShowStatus = obj => {\n      let {\n        columnTabs,\n        noHiddenColumn,\n        defaultColumHasSonTabs\n      } = columConfig.level1;\n      let columnsArr = [];\n      let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      if (obj.type === \"parent\") {\n        columnTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      if (obj.type === \"self\") {\n        defaultColumHasSonTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      let months = getNMonthsAgo(selectMonth.value);\n      let children = [];\n      let num = 0;\n      months.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n            slotName: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`\n          };\n        });\n        children.push(columnHasSonConfig);\n      });\n      columnsArr = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...children];\n      let number = 0;\n      columnsArr.forEach(item => {\n        number += 1;\n        if (!item.children) {\n          item.dataIndex = `colNo${number}`;\n          item.slotName = `colNo${number}`;\n        } else {\n          number = number - 1;\n          item.children.forEach(jtem => {\n            number += 1;\n            jtem.dataIndex = `colNo${number}`;\n            jtem.slotName = `colNo${number}`;\n          });\n        }\n      });\n      tableInfo.columns = columnsArr;\n      var index = tableInfo.columns.findIndex(item => item.children);\n      canvasLine3.value = tableInfo.columns[index - 1].dataIndex;\n      canvasLine2.value = tableInfo.columns[index - 2].dataIndex;\n      canvasLine1.value = tableInfo.columns[index - 3].dataIndex;\n      getList();\n    };\n    // 获取列表数据\n    const getList = () => {\n      tableInfo.data = [];\n      tableInfo.loading = true;\n      let arr = [];\n      var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n      newColumns.forEach(item => {\n        if (item.title === \"部门名称\") {\n          arr.push(\"deptName\");\n        }\n        if (item.title === \"客户名称\") {\n          arr.push(\"customerName\");\n        }\n        if (item.title === \"项目名称\") {\n          arr.push(\"projectName\");\n        }\n        if (item.title === \"收入趋势\") {\n          arr.push(\"canvasLine1\");\n        }\n        if (item.title === \"成本趋势\") {\n          arr.push(\"canvasLine2\");\n        }\n        if (item.title === \"毛利率趋势\") {\n          arr.push(\"canvasLine3\");\n        }\n        if (item.children) {\n          item.children.forEach(jtem => {\n            if (jtem.title === \"人数\") {\n              arr.push(\"colNo1\");\n            }\n            if (jtem.title === \"营业收入\") {\n              arr.push(\"colNo2\");\n            }\n            if (jtem.title === \"销售毛利\") {\n              arr.push(\"colNo3\");\n            }\n            if (jtem.title === \"销售毛利率\") {\n              arr.push(\"colNo4\");\n            }\n            if (jtem.title === \"直接成本\") {\n              arr.push(\"colNo5\");\n            }\n            if (jtem.title === \"人均营业收入\") {\n              arr.push(\"colNo6\");\n            }\n            if (jtem.title === \"人均直接成本\") {\n              arr.push(\"colNo7\");\n            }\n            if (jtem.title === \"未完工项目成本\") {\n              arr.push(\"colNo8\");\n            }\n            if (jtem.title === \"招聘费用\") {\n              arr.push(\"colNo9\");\n            }\n            if (jtem.title === \"销售费用\") {\n              arr.push(\"colNo10\");\n            }\n            if (jtem.title === \"管理费用\") {\n              arr.push(\"colNo11\");\n            }\n          });\n        }\n      });\n      const params = {\n        interval: Number(selectMonth.value),\n        dynamicHeaderParam: Array.from(new Set(arr)),\n        xAxis: 50,\n        yAxis: 20\n      };\n      getDepartmentRingList(params).then(res => {\n        if (res.code == \"200\") {\n          tableInfo.data = res.data;\n        }\n      }).catch(e => {\n        Message.error(e.message || \"请求失败\");\n      }).finally(() => {\n        tableInfo.loading = false;\n      });\n    };\n    // 查询\n    const handleSearch = () => {\n      getList();\n    };\n    // 重置\n    const handleReset = () => {};\n    // 打开\n    const handleUp = () => {\n      isFold.value = false;\n    };\n    // 关闭\n    const handleDown = () => {\n      isFold.value = true;\n    };\n    const __returned__ = {\n      get tagColumnList() {\n        return tagColumnList;\n      },\n      set tagColumnList(v) {\n        tagColumnList = v;\n      },\n      get columConfig() {\n        return columConfig;\n      },\n      set columConfig(v) {\n        columConfig = v;\n      },\n      isFold,\n      tableInfo,\n      selectMonth,\n      tableRef,\n      tabChangeColumInfo,\n      canvasLine1,\n      canvasLine2,\n      canvasLine3,\n      seltColumns,\n      get filterShowChildrenColumn() {\n        return filterShowChildrenColumn;\n      },\n      set filterShowChildrenColumn(v) {\n        filterShowChildrenColumn = v;\n      },\n      analysiisColumn,\n      handleMonthChange,\n      handleTabChange,\n      handleHasSonTabChange,\n      changeShowStatus,\n      getList,\n      handleSearch,\n      handleReset,\n      handleUp,\n      handleDown,\n      onBeforeMount,\n      reactive,\n      ref,\n      nextTick,\n      onMounted,\n      toRaw,\n      get useTagColumnListStore() {\n        return useTagColumnListStore;\n      },\n      get getDepartmentRingList() {\n        return getDepartmentRingList;\n      },\n      get getNMonthsAgo() {\n        return getNMonthsAgo;\n      },\n      canvasVue,\n      get Message() {\n        return Message;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["onBeforeMount","reactive","ref","nextTick","onMounted","toRaw","useTagColumnListStore","getDepartmentRingList","getNMonthsAgo","canvasVue","Message","tagColumnList","columConfig","isFold","tableInfo","columns","data","maxHeight","loading","selectMonth","tableRef","tabChangeColumInfo","columnTabs","up","down","canvasLine1","canvasLine2","canvasLine3","value","head","$el","innerHeight","window","elHeight","getBoundingClientRect","top","seltColumns","tagColumns","getTagColumnList","currentPageColumn","filter","item","report","length","tier","forEach","index","tabs","columnHasSonTabs","noHiddenColumn","defaultColumHasSonTabs","defaultColumnTabs","tags","jtem","push","tag","ktem","col","conf","title","columnItemConfig","dataIndex","align","cellStyle","cellAlign","width","ellipsis","headerCellClass","slotName","isShow","fixed","undefined","toFixed","showPercent","render","record","canHide","parentCol","params","level1","slice","filterShowChildrenColumn","analysiisColumn","num","months1","children1","filterHasSonShowColumn1","i","columnHasSonConfig","children","map","j","padStart","months2","children2","filterHasSonShowColumn2","months3","children3","filterHasSonShowColumn3","filterAllShowColumn","number","findIndex","handleMonthChange","month","getList","handleTabChange","tab","changeShowStatus","type","val","handleHasSonTabChange","obj","columnsArr","filterHasSonShowColumn","months","arr","newColumns","JSON","parse","stringify","interval","Number","dynamicHeaderParam","Array","from","Set","xAxis","yAxis","then","res","code","catch","e","error","message","finally","handleSearch","handleReset","handleUp","handleDown"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-mgmt-frontend/src/views/LeanAnalyze/loopAnalyze.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <div>\n      <a-space wrap>\n        <span>部门名称：</span>\n        <a-select :style=\"{ width: '230px' }\" placeholder=\"输入并选择部门名称\" allow-search>\n          <a-option>Beijing</a-option>\n          <a-option>Shanghai</a-option>\n          <a-option>Guangzhou</a-option>\n          <a-option disabled>Disabled</a-option>\n        </a-select>\n        <span class=\"m-l-16\">客户名称：</span>\n        <a-select :style=\"{ width: '230px' }\" placeholder=\"输入并选择客户名称\" allow-search>\n          <a-option>Beijing</a-option>\n          <a-option>Shanghai</a-option>\n          <a-option>Guangzhou</a-option>\n          <a-option disabled>Disabled</a-option>\n        </a-select>\n        <span class=\"m-l-16\">项目名称：</span>\n        <a-select :style=\"{ width: '230px' }\" placeholder=\"输入项目名称\" allow-search>\n          <a-option>Beijing</a-option>\n          <a-option>Shanghai</a-option>\n          <a-option>Guangzhou</a-option>\n          <a-option disabled>Disabled</a-option>\n        </a-select>\n        <a-button type=\"primary\" style=\"margin-left: 16px\" @click=\"handleSearch\">\n          <template #icon>\n            <icon-search />\n          </template>\n          <template #default>搜索</template>\n        </a-button>\n        <a-button @click=\"handleReset\">\n          <template #icon>\n            <icon-refresh />\n          </template>\n          <template #default>重置</template>\n        </a-button>\n      </a-space>\n    </div>\n    <div class=\"m-t-20 flex-between\">\n      <div style=\"align-self: flex-start\">\n        <div class=\"m-b-20\">\n          <a-space wrap>\n            <div class=\"border-r\">\n              <a-space>\n                <a-tag\n                  v-for=\"(item, index) of tabChangeColumInfo.columnTabs\"\n                  :key=\"index\"\n                  :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n                  size=\"large\"\n                  class=\"pointer\"\n                  @click=\"handleTabChange(item)\"\n                >\n                  {{ item.title }}\n                </a-tag>\n              </a-space>\n            </div>\n            <a-tag\n              v-for=\"(item, index) of tabChangeColumInfo.up\"\n              :key=\"index\"\n              :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n              size=\"large\"\n              class=\"pointer\"\n              @click=\"handleHasSonTabChange(item)\"\n            >\n              {{ item.title }}\n            </a-tag>\n            <icon-up-circle class=\"pointer\" v-if=\"isFold\" size=\"20\" @click=\"handleUp\" />\n            <icon-down-circle class=\"pointer\" v-else size=\"20\" @click=\"handleDown\" />\n          </a-space>\n        </div>\n        <transition appear>\n          <div v-show=\"isFold\">\n            <a-space wrap>\n              <a-tag\n                v-for=\"(item, index) of tabChangeColumInfo.down\"\n                :key=\"index\"\n                :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n                size=\"large\"\n                class=\"pointer\"\n                @click=\"handleHasSonTabChange(item)\"\n              >\n                {{ item.title }}\n              </a-tag>\n            </a-space>\n          </div>\n        </transition>\n      </div>\n      <div style=\"align-self: flex-start\">\n        <a-radio-group type=\"button\" v-model:model-value=\"selectMonth\" size=\"large\" @change=\"handleMonthChange\">\n          <a-radio value=\"3\">近3个月</a-radio>\n          <a-radio value=\"6\">近6个月</a-radio>\n          <a-radio value=\"12\">近12个月</a-radio>\n        </a-radio-group>\n      </div>\n    </div>\n    <div class=\"m-t-20\">\n      <a-table\n        :columns=\"tableInfo.columns\"\n        :data=\"tableInfo.data\"\n        column-resizable\n        :scroll=\"{ maxHeight: tableInfo.maxHeight }\"\n        :scrollbar=\"{ x: true, y: 1500 }\"\n        :pagination=\"false\"\n        :loading=\"tableInfo.loading\"\n        :bordered=\"{ cell: true }\"\n        ref=\"tableRef\"\n      >\n        <template #[canvasLine1]=\"{ record }\">\n          <canvasVue :route=\"record[canvasLine1]\" :height=\"20\" :width=\"50\" />\n        </template>\n        <template #[canvasLine2]=\"{ record }\">\n          <canvasVue :route=\"record[canvasLine2]\" :height=\"20\" :width=\"50\" />\n        </template>\n        <template #[canvasLine3]=\"{ record }\">\n          <canvasVue :route=\"record[canvasLine3]\" :height=\"20\" :width=\"50\" />\n        </template>\n      </a-table>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getDepartmentRingList } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo } from \"../../utils/util\";\nimport canvasVue from \"@/components/canvasContainer.vue\";\nimport { Message } from \"@arco-design/web-vue\";\nlet tagColumnList = useTagColumnListStore();\nlet columConfig = {};\nconst isFold = ref(false);\nconst tableInfo = reactive({\n  columns: [],\n  data: [],\n  maxHeight: \"200px\",\n  loading: false,\n});\nconst selectMonth = ref(\"3\");\nconst tableRef = ref(null);\nconst tabChangeColumInfo = reactive({\n  columnTabs: [],\n  up: [],\n  down: [],\n});\nconst canvasLine1 = ref(\"\");\nconst canvasLine2 = ref(\"\");\nconst canvasLine3 = ref(\"\");\nonMounted(() => {\n  if (tableRef.value) {\n    let head = tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\n// 初始化\nconst seltColumns = () => {\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n  if (currentPageColumn.length) {\n    currentPageColumn[0].tier.forEach((item, index) => {\n      let tabs = [];\n      let columnTabs = [];\n      let columnHasSonTabs = [];\n      let noHiddenColumn = [];\n      let defaultColumHasSonTabs = [];\n      let defaultColumnTabs = [];\n      item.tags.forEach(jtem => {\n        tabs.push(jtem.tag);\n        jtem.columns.forEach(ktem => {\n          let { col, conf, title } = ktem;\n          conf = conf || {};\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: { \"text-align\": conf.cellAlign },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n          };\n          columnItemConfig.isShow = conf.isShow;\n          if (conf.fixed !== undefined) {\n            columnItemConfig.fixed = conf.fixed;\n          }\n          if (conf.toFixed !== undefined) {\n            if (conf.showPercent) {\n              columnItemConfig.render = ({ record }) => {\n                return record[col];\n              };\n            } else {\n              columnItemConfig.render = ({ record }) => {\n                return record[col];\n              };\n            }\n          }\n          if (conf.canHide === 1) {\n            if (conf.parentCol === 0) {\n              columnTabs.push(columnItemConfig);\n            } else {\n              columnHasSonTabs.push(columnItemConfig);\n            }\n          } else {\n            noHiddenColumn.push(columnItemConfig);\n          }\n          if (conf.parentCol === 1) {\n            defaultColumHasSonTabs.push(columnItemConfig);\n          } else {\n            defaultColumnTabs.push(columnItemConfig);\n          }\n        });\n      });\n      columConfig[\"level\" + (index + 1)] = {\n        tabs,\n        params: item.params || [],\n        columnTabs,\n        columnHasSonTabs,\n        noHiddenColumn,\n        defaultColumnTabs,\n        defaultColumHasSonTabs,\n      };\n    });\n  }\n  tabChangeColumInfo.columnTabs = columConfig.level1.columnTabs;\n  tabChangeColumInfo.up = columConfig.level1.columnHasSonTabs.slice(0, 5);\n  tabChangeColumInfo.down = columConfig.level1.columnHasSonTabs.slice(5);\n};\nlet filterShowChildrenColumn = [];\n// 更换表头\nconst analysiisColumn = () => {\n  let { columnTabs, noHiddenColumn, defaultColumHasSonTabs } = columConfig.level1;\n  let num = 6;\n  switch (selectMonth.value) {\n    case \"3\":\n      let months1 = getNMonthsAgo(3);\n      let children1 = [];\n      let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months1.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n            slotName: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n          };\n        });\n        children1.push(columnHasSonConfig);\n      });\n      num = 0;\n      filterShowChildrenColumn = children1;\n      break;\n    case \"6\":\n      let months2 = getNMonthsAgo(6);\n      let children2 = [];\n      let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months2.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n            slotName: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n          };\n        });\n        children2.push(columnHasSonConfig);\n      });\n      num = 0;\n      filterShowChildrenColumn = children2;\n      break;\n    case \"12\":\n      let months3 = getNMonthsAgo(12);\n      let children3 = [];\n      let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months3.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n            slotName: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n          };\n        });\n        children3.push(columnHasSonConfig);\n      });\n      num = 0;\n      filterShowChildrenColumn = children3;\n      break;\n    default:\n      break;\n  }\n  filterShowChildrenColumn.forEach(item => {\n    if (item.children?.length) {\n      item.children = item.children.filter(jtem => jtem.isShow === 1);\n    }\n  });\n  let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn];\n  let number = 0;\n  filterAllShowColumn.forEach(item => {\n    number += 1;\n    if (!item.children) {\n      item.dataIndex = `colNo${number}`;\n      item.slotName = `colNo${number}`;\n    } else {\n      number = number - 1;\n      item.children.forEach(jtem => {\n        number += 1;\n        jtem.dataIndex = `colNo${number}`;\n        jtem.slotName = `colNo${number}`;\n      });\n    }\n  });\n  tableInfo.columns = filterAllShowColumn;\n  var index = tableInfo.columns.findIndex(item => item.children);\n  canvasLine3.value = tableInfo.columns[index - 1].dataIndex;\n  canvasLine2.value = tableInfo.columns[index - 2].dataIndex;\n  canvasLine1.value = tableInfo.columns[index - 3].dataIndex;\n};\n// 切换时间区间\nconst handleMonthChange = month => {\n  selectMonth.value = month;\n  analysiisColumn();\n  getList();\n};\nonBeforeMount(() => {\n  seltColumns();\n  analysiisColumn();\n  getList();\n});\n// 点击部门名称 客户名称\nconst handleTabChange = tab => {\n  switch (tab.isShow) {\n    case 0:\n      tab.isShow = 1;\n      changeShowStatus({\n        type: \"parent\",\n        title: tab.title,\n        val: 1,\n      });\n      break;\n    case 1:\n      tab.isShow = 0;\n      changeShowStatus({\n        type: \"parent\",\n        title: tab.title,\n        val: 0,\n      });\n      break;\n    default:\n      break;\n  }\n};\n// 点击部门名称 客户名称之外的标签\nconst handleHasSonTabChange = tab => {\n  switch (tab.isShow) {\n    case 0:\n      tab.isShow = 1;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 1,\n      });\n      break;\n    case 1:\n      tab.isShow = 0;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 0,\n      });\n      break;\n    default:\n      break;\n  }\n};\n// 更改高亮状态并更换表头\nconst changeShowStatus = obj => {\n  let { columnTabs, noHiddenColumn, defaultColumHasSonTabs } = columConfig.level1;\n  let columnsArr = [];\n  let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n  if (obj.type === \"parent\") {\n    columnTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  if (obj.type === \"self\") {\n    defaultColumHasSonTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  let months = getNMonthsAgo(selectMonth.value);\n  let children = [];\n  let num = 0;\n  months.forEach((item, i) => {\n    let columnHasSonConfig = {};\n    columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n    columnHasSonConfig.children = filterHasSonShowColumn.map((jtem, j) => {\n      num++;\n      return {\n        ...jtem,\n        dataIndex: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n        slotName: `${item[0]}${(\"\" + item[1]).padStart(2, \"0\")}col${num}`,\n      };\n    });\n    children.push(columnHasSonConfig);\n  });\n  columnsArr = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...children];\n  let number = 0;\n  columnsArr.forEach(item => {\n    number += 1;\n    if (!item.children) {\n      item.dataIndex = `colNo${number}`;\n      item.slotName = `colNo${number}`;\n    } else {\n      number = number - 1;\n      item.children.forEach(jtem => {\n        number += 1;\n        jtem.dataIndex = `colNo${number}`;\n        jtem.slotName = `colNo${number}`;\n      });\n    }\n  });\n  tableInfo.columns = columnsArr;\n  var index = tableInfo.columns.findIndex(item => item.children);\n  canvasLine3.value = tableInfo.columns[index - 1].dataIndex;\n  canvasLine2.value = tableInfo.columns[index - 2].dataIndex;\n  canvasLine1.value = tableInfo.columns[index - 3].dataIndex;\n  getList();\n};\n// 获取列表数据\nconst getList = () => {\n  tableInfo.data = [];\n  tableInfo.loading = true;\n  let arr = [];\n  var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n  newColumns.forEach(item => {\n    if (item.title === \"部门名称\") {\n      arr.push(\"deptName\");\n    }\n    if (item.title === \"客户名称\") {\n      arr.push(\"customerName\");\n    }\n    if (item.title === \"项目名称\") {\n      arr.push(\"projectName\");\n    }\n    if (item.title === \"收入趋势\") {\n      arr.push(\"canvasLine1\");\n    }\n    if (item.title === \"成本趋势\") {\n      arr.push(\"canvasLine2\");\n    }\n    if (item.title === \"毛利率趋势\") {\n      arr.push(\"canvasLine3\");\n    }\n    if (item.children) {\n      item.children.forEach(jtem => {\n        if (jtem.title === \"人数\") {\n          arr.push(\"colNo1\");\n        }\n        if (jtem.title === \"营业收入\") {\n          arr.push(\"colNo2\");\n        }\n        if (jtem.title === \"销售毛利\") {\n          arr.push(\"colNo3\");\n        }\n        if (jtem.title === \"销售毛利率\") {\n          arr.push(\"colNo4\");\n        }\n        if (jtem.title === \"直接成本\") {\n          arr.push(\"colNo5\");\n        }\n        if (jtem.title === \"人均营业收入\") {\n          arr.push(\"colNo6\");\n        }\n        if (jtem.title === \"人均直接成本\") {\n          arr.push(\"colNo7\");\n        }\n        if (jtem.title === \"未完工项目成本\") {\n          arr.push(\"colNo8\");\n        }\n        if (jtem.title === \"招聘费用\") {\n          arr.push(\"colNo9\");\n        }\n        if (jtem.title === \"销售费用\") {\n          arr.push(\"colNo10\");\n        }\n        if (jtem.title === \"管理费用\") {\n          arr.push(\"colNo11\");\n        }\n      });\n    }\n  });\n  const params = {\n    interval: Number(selectMonth.value),\n    dynamicHeaderParam: Array.from(new Set(arr)),\n    xAxis: 50,\n    yAxis: 20,\n  };\n  getDepartmentRingList(params)\n    .then(res => {\n      if (res.code == \"200\") {\n        tableInfo.data = res.data;\n      }\n    })\n    .catch(e => {\n      Message.error(e.message || \"请求失败\");\n    })\n    .finally(() => {\n      tableInfo.loading = false;\n    });\n};\n// 查询\nconst handleSearch = () => {\n  getList();\n};\n// 重置\nconst handleReset = () => {};\n// 打开\nconst handleUp = () => {\n  isFold.value = false;\n};\n// 关闭\nconst handleDown = () => {\n  isFold.value = true;\n};\n</script>\n\n<style lang=\"scss\">\n.draw-enter-active,\n.draw-leave-active {\n  transition: all 0.2s;\n}\n.draw-enter-from,\n.draw-leave-to {\n  max-height: 0;\n}\n.border-r {\n  padding-right: 10px;\n  border-right: 1px solid #ebebeb;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}