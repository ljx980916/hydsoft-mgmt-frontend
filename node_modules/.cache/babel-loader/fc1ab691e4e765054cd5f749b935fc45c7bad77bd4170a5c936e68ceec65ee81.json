{"ast":null,"code":"import { ref, watch, nextTick, provide, reactive } from \"vue\";\nimport { getRelativeRect } from \"../../_utils/dom.js\";\nimport { useOptions } from \"./use-options.js\";\nimport { getKeyDownHandler, KEYBOARD_KEY } from \"../../_utils/keyboard.js\";\nimport { selectInjectionKey } from \"../context.js\";\nconst useSelect = ({\n  multiple,\n  options,\n  extraOptions,\n  inputValue,\n  filterOption,\n  showExtraOptions,\n  component,\n  valueKey,\n  fieldNames,\n  loading,\n  popupVisible,\n  valueKeys,\n  dropdownRef,\n  optionRefs,\n  virtualListRef,\n  onSelect,\n  onPopupVisibleChange\n}) => {\n  const {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  } = useOptions({\n    options,\n    extraOptions,\n    inputValue,\n    filterOption,\n    showExtraOptions,\n    valueKey,\n    fieldNames\n  });\n  const activeKey = ref();\n  watch(enabledOptionKeys, enabledKeys => {\n    if (!activeKey.value || !enabledKeys.includes(activeKey.value)) {\n      activeKey.value = enabledKeys[0];\n    }\n  });\n  const setActiveKey = key => {\n    activeKey.value = key;\n  };\n  const getNextActiveKey = direction => {\n    const _length = enabledOptionKeys.value.length;\n    if (_length === 0) {\n      return void 0;\n    }\n    if (!activeKey.value) {\n      if (direction === \"down\") {\n        return enabledOptionKeys.value[0];\n      }\n      return enabledOptionKeys.value[_length - 1];\n    }\n    const activeIndex = enabledOptionKeys.value.indexOf(activeKey.value);\n    const nextIndex = (_length + activeIndex + (direction === \"up\" ? -1 : 1)) % _length;\n    return enabledOptionKeys.value[nextIndex];\n  };\n  const scrollIntoView = key => {\n    var _a, _b;\n    if (virtualListRef == null ? void 0 : virtualListRef.value) {\n      virtualListRef.value.scrollTo({\n        key\n      });\n    }\n    const optionInfo = optionInfoMap.get(key);\n    const wrapperEle = (_a = dropdownRef == null ? void 0 : dropdownRef.value) == null ? void 0 : _a.wrapperRef;\n    const optionEle = (_b = optionRefs == null ? void 0 : optionRefs.value[key]) != null ? _b : optionInfo == null ? void 0 : optionInfo.ref;\n    if (!wrapperEle || !optionEle) {\n      return;\n    }\n    if (wrapperEle.scrollHeight === wrapperEle.offsetHeight) {\n      return;\n    }\n    const optionRect = getRelativeRect(optionEle, wrapperEle);\n    const wrapperScrollTop = wrapperEle.scrollTop;\n    if (optionRect.top < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop + optionRect.top);\n    } else if (optionRect.bottom < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop - optionRect.bottom);\n    }\n  };\n  watch(popupVisible, visible => {\n    if (visible) {\n      const current = valueKeys.value[valueKeys.value.length - 1];\n      const _activeKey = enabledOptionKeys.value.includes(current) ? current : enabledOptionKeys.value[0];\n      if (_activeKey !== activeKey.value) {\n        activeKey.value = _activeKey;\n      }\n      nextTick(() => {\n        if (activeKey.value) {\n          scrollIntoView(activeKey.value);\n        }\n      });\n    }\n  });\n  const handleKeyDown = getKeyDownHandler(new Map([[KEYBOARD_KEY.ENTER, e => {\n    if (!(loading == null ? void 0 : loading.value)) {\n      if (popupVisible.value) {\n        if (activeKey.value) {\n          onSelect(activeKey.value, e);\n        }\n      } else {\n        onPopupVisibleChange(true);\n      }\n    }\n    e.preventDefault();\n  }], [KEYBOARD_KEY.ESC, e => {\n    onPopupVisibleChange(false);\n    e.preventDefault();\n  }], [KEYBOARD_KEY.ARROW_DOWN, e => {\n    const next = getNextActiveKey(\"down\");\n    if (next) {\n      activeKey.value = next;\n      scrollIntoView(next);\n    }\n    e.preventDefault();\n  }], [KEYBOARD_KEY.ARROW_UP, e => {\n    const next = getNextActiveKey(\"up\");\n    if (next) {\n      activeKey.value = next;\n      scrollIntoView(next);\n    }\n    e.preventDefault();\n  }]]));\n  provide(selectInjectionKey, reactive({\n    multiple,\n    valueKey,\n    inputValue,\n    filterOption,\n    component,\n    valueKeys,\n    activeKey,\n    setActiveKey,\n    onSelect,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  }));\n  return {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    activeKey,\n    setActiveKey,\n    addSlotOptionInfo,\n    removeSlotOptionInfo,\n    getNextActiveKey,\n    scrollIntoView,\n    handleKeyDown\n  };\n};\nexport { useSelect };","map":{"version":3,"names":["ref","watch","nextTick","provide","reactive","getRelativeRect","useOptions","getKeyDownHandler","KEYBOARD_KEY","selectInjectionKey","useSelect","multiple","options","extraOptions","inputValue","filterOption","showExtraOptions","component","valueKey","fieldNames","loading","popupVisible","valueKeys","dropdownRef","optionRefs","virtualListRef","onSelect","onPopupVisibleChange","validOptions","optionInfoMap","validOptionInfos","enabledOptionKeys","getNextSlotOptionIndex","addSlotOptionInfo","removeSlotOptionInfo","activeKey","enabledKeys","value","includes","setActiveKey","key","getNextActiveKey","direction","_length","length","activeIndex","indexOf","nextIndex","scrollIntoView","_a","_b","scrollTo","optionInfo","get","wrapperEle","wrapperRef","optionEle","scrollHeight","offsetHeight","optionRect","wrapperScrollTop","scrollTop","top","bottom","visible","current","_activeKey","handleKeyDown","Map","ENTER","e","preventDefault","ESC","ARROW_DOWN","next","ARROW_UP"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/node_modules/@arco-design/web-vue/es/select/hooks/use-select.js"],"sourcesContent":["import { ref, watch, nextTick, provide, reactive } from \"vue\";\nimport { getRelativeRect } from \"../../_utils/dom.js\";\nimport { useOptions } from \"./use-options.js\";\nimport { getKeyDownHandler, KEYBOARD_KEY } from \"../../_utils/keyboard.js\";\nimport { selectInjectionKey } from \"../context.js\";\nconst useSelect = ({\n  multiple,\n  options,\n  extraOptions,\n  inputValue,\n  filterOption,\n  showExtraOptions,\n  component,\n  valueKey,\n  fieldNames,\n  loading,\n  popupVisible,\n  valueKeys,\n  dropdownRef,\n  optionRefs,\n  virtualListRef,\n  onSelect,\n  onPopupVisibleChange\n}) => {\n  const {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  } = useOptions({\n    options,\n    extraOptions,\n    inputValue,\n    filterOption,\n    showExtraOptions,\n    valueKey,\n    fieldNames\n  });\n  const activeKey = ref();\n  watch(enabledOptionKeys, (enabledKeys) => {\n    if (!activeKey.value || !enabledKeys.includes(activeKey.value)) {\n      activeKey.value = enabledKeys[0];\n    }\n  });\n  const setActiveKey = (key) => {\n    activeKey.value = key;\n  };\n  const getNextActiveKey = (direction) => {\n    const _length = enabledOptionKeys.value.length;\n    if (_length === 0) {\n      return void 0;\n    }\n    if (!activeKey.value) {\n      if (direction === \"down\") {\n        return enabledOptionKeys.value[0];\n      }\n      return enabledOptionKeys.value[_length - 1];\n    }\n    const activeIndex = enabledOptionKeys.value.indexOf(activeKey.value);\n    const nextIndex = (_length + activeIndex + (direction === \"up\" ? -1 : 1)) % _length;\n    return enabledOptionKeys.value[nextIndex];\n  };\n  const scrollIntoView = (key) => {\n    var _a, _b;\n    if (virtualListRef == null ? void 0 : virtualListRef.value) {\n      virtualListRef.value.scrollTo({ key });\n    }\n    const optionInfo = optionInfoMap.get(key);\n    const wrapperEle = (_a = dropdownRef == null ? void 0 : dropdownRef.value) == null ? void 0 : _a.wrapperRef;\n    const optionEle = (_b = optionRefs == null ? void 0 : optionRefs.value[key]) != null ? _b : optionInfo == null ? void 0 : optionInfo.ref;\n    if (!wrapperEle || !optionEle) {\n      return;\n    }\n    if (wrapperEle.scrollHeight === wrapperEle.offsetHeight) {\n      return;\n    }\n    const optionRect = getRelativeRect(optionEle, wrapperEle);\n    const wrapperScrollTop = wrapperEle.scrollTop;\n    if (optionRect.top < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop + optionRect.top);\n    } else if (optionRect.bottom < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop - optionRect.bottom);\n    }\n  };\n  watch(popupVisible, (visible) => {\n    if (visible) {\n      const current = valueKeys.value[valueKeys.value.length - 1];\n      const _activeKey = enabledOptionKeys.value.includes(current) ? current : enabledOptionKeys.value[0];\n      if (_activeKey !== activeKey.value) {\n        activeKey.value = _activeKey;\n      }\n      nextTick(() => {\n        if (activeKey.value) {\n          scrollIntoView(activeKey.value);\n        }\n      });\n    }\n  });\n  const handleKeyDown = getKeyDownHandler(new Map([\n    [\n      KEYBOARD_KEY.ENTER,\n      (e) => {\n        if (!(loading == null ? void 0 : loading.value)) {\n          if (popupVisible.value) {\n            if (activeKey.value) {\n              onSelect(activeKey.value, e);\n            }\n          } else {\n            onPopupVisibleChange(true);\n          }\n        }\n        e.preventDefault();\n      }\n    ],\n    [\n      KEYBOARD_KEY.ESC,\n      (e) => {\n        onPopupVisibleChange(false);\n        e.preventDefault();\n      }\n    ],\n    [\n      KEYBOARD_KEY.ARROW_DOWN,\n      (e) => {\n        const next = getNextActiveKey(\"down\");\n        if (next) {\n          activeKey.value = next;\n          scrollIntoView(next);\n        }\n        e.preventDefault();\n      }\n    ],\n    [\n      KEYBOARD_KEY.ARROW_UP,\n      (e) => {\n        const next = getNextActiveKey(\"up\");\n        if (next) {\n          activeKey.value = next;\n          scrollIntoView(next);\n        }\n        e.preventDefault();\n      }\n    ]\n  ]));\n  provide(selectInjectionKey, reactive({\n    multiple,\n    valueKey,\n    inputValue,\n    filterOption,\n    component,\n    valueKeys,\n    activeKey,\n    setActiveKey,\n    onSelect,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  }));\n  return {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    activeKey,\n    setActiveKey,\n    addSlotOptionInfo,\n    removeSlotOptionInfo,\n    getNextActiveKey,\n    scrollIntoView,\n    handleKeyDown\n  };\n};\nexport { useSelect };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}