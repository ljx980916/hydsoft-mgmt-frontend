{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { Path } from '../shape';\nvar sin = Math.sin,\n  cos = Math.cos,\n  atan2 = Math.atan2,\n  PI = Math.PI;\nfunction _addDefaultArrow(shape, attrs, x1, y1, x2, y2, isStart) {\n  var stroke = attrs.stroke,\n    lineWidth = attrs.lineWidth;\n  var x = x1 - x2;\n  var y = y1 - y2;\n  var rad = atan2(y, x);\n  var arrowShape = new Path({\n    type: 'path',\n    canvas: shape.get('canvas'),\n    isArrowShape: true,\n    attrs: {\n      // 默认箭头的边长为 10，夹角为 60 度\n      path: \"M\" + 10 * cos(PI / 6) + \",\" + 10 * sin(PI / 6) + \" L0,0 L\" + 10 * cos(PI / 6) + \",-\" + 10 * sin(PI / 6),\n      // 使用 shape stroke 值\n      stroke: stroke,\n      lineWidth: lineWidth\n    }\n  });\n  arrowShape.translate(x2, y2);\n  arrowShape.rotateAtPoint(x2, y2, rad);\n  shape.set(isStart ? 'startArrowShape' : 'endArrowShape', arrowShape);\n}\n/**\n * 箭头 path 的设置要求\n * 1. 箭头顶点坐标需要为 (0, 0)\n * 2. 箭头夹角的中心分割线需要与 X 轴正方向对齐\n */\nfunction _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, isStart) {\n  var startArrow = attrs.startArrow,\n    endArrow = attrs.endArrow,\n    stroke = attrs.stroke,\n    lineWidth = attrs.lineWidth;\n  var arrowAttrs = isStart ? startArrow : endArrow;\n  var d = arrowAttrs.d,\n    arrowFill = arrowAttrs.fill,\n    arrowStroke = arrowAttrs.stroke,\n    arrowLineWidth = arrowAttrs.lineWidth,\n    restAttrs = __rest(arrowAttrs, [\"d\", \"fill\", \"stroke\", \"lineWidth\"]);\n  var x = x1 - x2;\n  var y = y1 - y2;\n  var rad = atan2(y, x);\n  if (d) {\n    x2 = x2 - cos(rad) * d;\n    y2 = y2 - sin(rad) * d;\n  }\n  var arrowShape = new Path({\n    type: 'path',\n    canvas: shape.get('canvas'),\n    isArrowShape: true,\n    attrs: __assign(__assign({}, restAttrs), {\n      // 支持单独设置箭头的 stroke 和 lineWidth，若为空则使用 shape 的值\n      stroke: arrowStroke || stroke,\n      lineWidth: arrowLineWidth || lineWidth,\n      // 箭头是否填充需要手动设置，不会继承自 shape 的值\n      fill: arrowFill\n    })\n  });\n  arrowShape.translate(x2, y2);\n  arrowShape.rotateAtPoint(x2, y2, rad);\n  shape.set(isStart ? 'startArrowShape' : 'endArrowShape', arrowShape);\n}\n/**\n * 如果自定义箭头并且有 d 需要做偏移，如果直接画，线条会超出箭头尖端，因此需要根据箭头偏移 d, 返回线需要缩短的距离\n * |----------------\n * |<|--------------\n * |\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n * @param {number} d  箭头沿线条方向的偏移距离\n * @return {{dx: number, dy: number}} 返回线条偏移距离\n */\nexport function getShortenOffset(x1, y1, x2, y2, d) {\n  var rad = atan2(y2 - y1, x2 - x1);\n  return {\n    dx: cos(rad) * d,\n    dy: sin(rad) * d\n  };\n}\n/**\n * 绘制起始箭头\n * @param {IShape} shape 图形\n * @param {ShapeAttrs} attrs shape 的绘图属性\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n */\nexport function addStartArrow(shape, attrs, x1, y1, x2, y2) {\n  if (typeof attrs.startArrow === 'object') {\n    _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, true);\n  } else if (attrs.startArrow) {\n    _addDefaultArrow(shape, attrs, x1, y1, x2, y2, true);\n  } else {\n    shape.set('startArrowShape', null);\n  }\n}\n/**\n * 绘制结束箭头\n * @param {IShape} shape 图形\n * @param {ShapeAttrs} attrs shape 的绘图属性\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n */\nexport function addEndArrow(shape, attrs, x1, y1, x2, y2) {\n  if (typeof attrs.endArrow === 'object') {\n    _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, false);\n  } else if (attrs.endArrow) {\n    _addDefaultArrow(shape, attrs, x1, y1, x2, y2, false);\n  } else {\n    shape.set('startArrowShape', null);\n  }\n}","map":{"version":3,"mappings":"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","names":["Path","Math","cos","atan2","PI","_addDefaultArrow","shape","attrs","x1","y1","x2","y2","isStart","lineWidth","x","y","rad","arrowShape","type","canvas","get","isArrowShape","path","sin","stroke","translate","rotateAtPoint","set","_addCustomizedArrow","endArrow","arrowAttrs","startArrow","arrowFill","arrowStroke","arrowLineWidth","restAttrs","d","fill","getShortenOffset","dx","dy","addStartArrow","addEndArrow"],"sourceRoot":"","sources":["../../src/util/arrow.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}