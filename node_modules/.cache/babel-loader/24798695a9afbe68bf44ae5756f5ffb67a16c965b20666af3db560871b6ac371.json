{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { __assign, __extends } from \"tslib\";\nimport { Line as LineUtil } from '@antv/g-math';\nimport { Polyline as PolylineUtil } from '@antv/g-math';\nimport { each, isNil } from '@antv/util';\nimport ShapeBase from './base';\nimport inPolyline from '../util/in-stroke/polyline';\nimport * as ArrowUtil from '../util/arrow';\nvar PolyLine = /** @class */function (_super) {\n  __extends(PolyLine, _super);\n  function PolyLine() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  PolyLine.prototype.getDefaultAttrs = function () {\n    var attrs = _super.prototype.getDefaultAttrs.call(this);\n    return __assign(__assign({}, attrs), {\n      startArrow: false,\n      endArrow: false\n    });\n  };\n  PolyLine.prototype.initAttrs = function (attrs) {\n    this.setArrow();\n  };\n  // 更新属性时，检测是否更改了 points\n  PolyLine.prototype.onAttrChange = function (name, value, originValue) {\n    _super.prototype.onAttrChange.call(this, name, value, originValue);\n    this.setArrow();\n    if (['points'].indexOf(name) !== -1) {\n      this._resetCache();\n    }\n  };\n  PolyLine.prototype._resetCache = function () {\n    this.set('totalLength', null);\n    this.set('tCache', null);\n  };\n  PolyLine.prototype.setArrow = function () {\n    var attrs = this.attr();\n    var _a = this.attrs,\n      points = _a.points,\n      startArrow = _a.startArrow,\n      endArrow = _a.endArrow;\n    var length = points.length;\n    var x1 = points[0][0];\n    var y1 = points[0][1];\n    var x2 = points[length - 1][0];\n    var y2 = points[length - 1][1];\n    if (startArrow) {\n      ArrowUtil.addStartArrow(this, attrs, points[1][0], points[1][1], x1, y1);\n    }\n    if (endArrow) {\n      ArrowUtil.addEndArrow(this, attrs, points[length - 2][0], points[length - 2][1], x2, y2);\n    }\n  };\n  // 不允许 fill\n  PolyLine.prototype.isFill = function () {\n    return false;\n  };\n  PolyLine.prototype.isInStrokeOrPath = function (x, y, isStroke, isFill, lineWidth) {\n    // 没有设置 stroke 不能被拾取, 没有线宽不能被拾取\n    if (!isStroke || !lineWidth) {\n      return false;\n    }\n    var points = this.attr().points;\n    return inPolyline(points, lineWidth, x, y, false);\n  };\n  // 始终填充\n  PolyLine.prototype.isStroke = function () {\n    return true;\n  };\n  PolyLine.prototype.createPath = function (context) {\n    var _a = this.attr(),\n      points = _a.points,\n      startArrow = _a.startArrow,\n      endArrow = _a.endArrow;\n    var length = points.length;\n    if (points.length < 2) {\n      return;\n    }\n    var x1 = points[0][0];\n    var y1 = points[0][1];\n    var x2 = points[length - 1][0];\n    var y2 = points[length - 1][1];\n    // 如果定义了箭头，并且是自定义箭头，线条相应缩进\n    if (startArrow && startArrow.d) {\n      var distance = ArrowUtil.getShortenOffset(x1, y1, points[1][0], points[1][1], startArrow.d);\n      x1 += distance.dx;\n      y1 += distance.dy;\n    }\n    if (endArrow && endArrow.d) {\n      var distance = ArrowUtil.getShortenOffset(points[length - 2][0], points[length - 2][1], x2, y2, endArrow.d);\n      x2 -= distance.dx;\n      y2 -= distance.dy;\n    }\n    context.beginPath();\n    context.moveTo(x1, y1);\n    for (var i = 0; i < length - 1; i++) {\n      var point = points[i];\n      context.lineTo(point[0], point[1]);\n    }\n    context.lineTo(x2, y2);\n  };\n  PolyLine.prototype.afterDrawPath = function (context) {\n    var startArrowShape = this.get('startArrowShape');\n    var endArrowShape = this.get('endArrowShape');\n    if (startArrowShape) {\n      startArrowShape.draw(context);\n    }\n    if (endArrowShape) {\n      endArrowShape.draw(context);\n    }\n  };\n  /**\n   * Get length of polyline\n   * @return {number} length\n   */\n  PolyLine.prototype.getTotalLength = function () {\n    var points = this.attr().points;\n    // get totalLength from cache\n    var totalLength = this.get('totalLength');\n    if (!isNil(totalLength)) {\n      return totalLength;\n    }\n    this.set('totalLength', PolylineUtil.length(points));\n    return this.get('totalLength');\n  };\n  /**\n   * Get point according to ratio\n   * @param {number} ratio\n   * @return {Point} point\n   */\n  PolyLine.prototype.getPoint = function (ratio) {\n    var points = this.attr().points;\n    // get tCache from cache\n    var tCache = this.get('tCache');\n    if (!tCache) {\n      this._setTcache();\n      tCache = this.get('tCache');\n    }\n    var subt;\n    var index;\n    each(tCache, function (v, i) {\n      if (ratio >= v[0] && ratio <= v[1]) {\n        subt = (ratio - v[0]) / (v[1] - v[0]);\n        index = i;\n      }\n    });\n    return LineUtil.pointAt(points[index][0], points[index][1], points[index + 1][0], points[index + 1][1], subt);\n  };\n  PolyLine.prototype._setTcache = function () {\n    var points = this.attr().points;\n    if (!points || points.length === 0) {\n      return;\n    }\n    var totalLength = this.getTotalLength();\n    if (totalLength <= 0) {\n      return;\n    }\n    var tempLength = 0;\n    var tCache = [];\n    var segmentT;\n    var segmentL;\n    each(points, function (p, i) {\n      if (points[i + 1]) {\n        segmentT = [];\n        segmentT[0] = tempLength / totalLength;\n        segmentL = LineUtil.length(p[0], p[1], points[i + 1][0], points[i + 1][1]);\n        tempLength += segmentL;\n        segmentT[1] = tempLength / totalLength;\n        tCache.push(segmentT);\n      }\n    });\n    this.set('tCache', tCache);\n  };\n  /**\n   * Get start tangent vector\n   * @return {Array}\n   */\n  PolyLine.prototype.getStartTangent = function () {\n    var points = this.attr().points;\n    var result = [];\n    result.push([points[1][0], points[1][1]]);\n    result.push([points[0][0], points[0][1]]);\n    return result;\n  };\n  /**\n   * Get end tangent vector\n   * @return {Array}\n   */\n  PolyLine.prototype.getEndTangent = function () {\n    var points = this.attr().points;\n    var l = points.length - 1;\n    var result = [];\n    result.push([points[l - 1][0], points[l - 1][1]]);\n    result.push([points[l][0], points[l][1]]);\n    return result;\n  };\n  return PolyLine;\n}(ShapeBase);\nexport default PolyLine;","map":{"version":3,"mappings":"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","names":["Line","LineUtil","Polyline","PolylineUtil","each","isNil","ShapeBase","inPolyline","ArrowUtil","__extends","PolyLine","attrs","_super","getDefaultAttrs","startArrow","endArrow","setArrow","name","value","originValue","onAttrChange","indexOf","_resetCache","set","attr","points","length","x1","y1","x2","y2","addStartArrow","addEndArrow","x","y","isStroke","isFill","lineWidth","context","d","distance","getShortenOffset","dx","dy","beginPath","moveTo","i","point","lineTo","startArrowShape","get","endArrowShape","draw","totalLength","ratio","tCache","_setTcache","subt","index","v","pointAt","getTotalLength","tempLength","segmentT","segmentL","p","push","result","l"],"sourceRoot":"","sources":["../../src/shape/polyline.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}