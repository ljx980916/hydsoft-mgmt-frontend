{"ast":null,"code":"import { createTextVNode as _createTextVNode, createVNode as _createVNode } from \"vue\";\nimport \"core-js/modules/es.array.push.js\";\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw, shallowRef } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getProjectRingList, getProjectYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo, dataAddKey, getRedNum, getCurrentTime } from \"../../utils/util\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nexport default {\n  __name: 'projectRingSame',\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    let $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\n    const route = useRoute();\n    const router = useRouter();\n    let {\n      customerId,\n      deptId,\n      deptName,\n      groupCustomerName,\n      title,\n      tab,\n      radiotype\n    } = route.query;\n    let tagColumnList = useTagColumnListStore();\n    const tabsActive = ref(tab || '1');\n    let {\n      year,\n      month\n    } = getCurrentTime();\n    let lastYear = year - 1;\n    let lastMonth = month - 1;\n    let columConfig = {};\n    const tableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"200px\",\n      loading: false\n    });\n    const selectMonth = ref(\"3\");\n    const tableRef = ref(null);\n    const tabChangeColumInfo = reactive({\n      columnTabs: [],\n      up: [],\n      down: []\n    });\n    const chartColumMap = {\n      发薪人数: [],\n      营业收入: [],\n      销售毛利率: []\n    };\n    const chartColumnNameMap = {\n      canvasLine1: \"发薪人数\",\n      canvasLine2: \"营业收入\",\n      canvasLine3: \"销售毛利率\"\n    };\n    let filterShowChildrenColumn = [];\n    // 切换环比分析和同比分析\n    const handleTab = val => {\n      tabsActive.value = val;\n    };\n    onMounted(() => {\n      if (tableRef.value) {\n        let head = tableRef.value.$el;\n        nextTick(() => {\n          let innerHeight = window.innerHeight;\n          let elHeight = head.getBoundingClientRect().top;\n          tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n        });\n      }\n    });\n    // 初始化\n    const seltColumns = () => {\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n      if (currentPageColumn.length) {\n        currentPageColumn[0].tier.forEach((item, index) => {\n          let tabs = [];\n          let columnTabs = [];\n          let columnHasSonTabs = [];\n          let noHiddenColumn = [];\n          let defaultColumHasSonTabs = [];\n          let defaultColumnTabs = [];\n          item.tags.forEach(jtem => {\n            tabs.push(jtem.tag);\n            jtem.columns.forEach(ktem => {\n              let {\n                col,\n                conf,\n                title\n              } = ktem;\n              conf = conf || {};\n              let columnItemConfig = {\n                title,\n                dataIndex: col,\n                align: conf.align,\n                cellStyle: {\n                  \"text-align\": conf.cellAlign\n                },\n                width: conf.width,\n                ellipsis: true,\n                headerCellClass: \"noEllipsis\",\n                slotName: col,\n                bodyCellClass: \"bodyCell\",\n                fixed: conf.fixed\n              };\n              columnItemConfig.isShow = conf.isShow;\n              columnItemConfig.render = ({\n                record,\n                column\n              }) => {\n                let cellVal = record[column.dataIndex];\n                if (!Array.isArray(cellVal)) {\n                  if (cellVal !== null && cellVal !== undefined) {\n                    return _createVNode(\"span\", {\n                      \"innerHTML\": getRedNum(cellVal)\n                    }, null);\n                  }\n                } else {\n                  if (chartColumMap[chartColumnNameMap[column.dataIndex]] !== undefined) {\n                    let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n                      tip: item.month + record[item.col],\n                      value: cellVal[i]\n                    }));\n                    return _createVNode(echartContainer, {\n                      \"route\": route,\n                      \"height\": 74,\n                      \"width\": 100\n                    }, null);\n                  }\n                }\n              };\n              if (conf.canHide === 1) {\n                if (conf.parentCol === 0) {\n                  columnTabs.push(columnItemConfig);\n                } else {\n                  columnHasSonTabs.push(columnItemConfig);\n                }\n              } else {\n                noHiddenColumn.push(columnItemConfig);\n              }\n              if (conf.parentCol === 1) {\n                defaultColumHasSonTabs.push(columnItemConfig);\n              } else {\n                defaultColumnTabs.push(columnItemConfig);\n              }\n            });\n          });\n          columConfig[\"level\" + (index + 1)] = {\n            tabs,\n            params: item.params || [],\n            columnTabs,\n            columnHasSonTabs,\n            noHiddenColumn,\n            defaultColumnTabs,\n            defaultColumHasSonTabs\n          };\n        });\n      }\n      tabChangeColumInfo.columnTabs = columConfig.level3.columnHasSonTabs;\n    };\n    // 更换表头\n    const analysiisColumn = () => {\n      let {\n        columnTabs,\n        noHiddenColumn,\n        defaultColumHasSonTabs\n      } = columConfig.level3;\n      let num = 5;\n      switch (selectMonth.value) {\n        case \"3\":\n          let months1 = getNMonthsAgo(3, true);\n          let children1 = [];\n          let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months1.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children1.push(columnHasSonConfig);\n          });\n          num = 5;\n          filterShowChildrenColumn = children1;\n          break;\n        case \"6\":\n          let months2 = getNMonthsAgo(6, true);\n          let children2 = [];\n          let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months2.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children2.push(columnHasSonConfig);\n          });\n          num = 5;\n          filterShowChildrenColumn = children2;\n          break;\n        case \"12\":\n          let months3 = getNMonthsAgo(12, true);\n          months3 = months3.filter(item => item[0] !== 2022);\n          let children3 = [];\n          let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months3.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children3.push(columnHasSonConfig);\n          });\n          num = 5;\n          filterShowChildrenColumn = children3;\n          break;\n        default:\n          break;\n      }\n      Object.keys(chartColumMap).forEach(key => {\n        chartColumMap[key] = [];\n      });\n      filterShowChildrenColumn.forEach(item => {\n        if (item.children?.length) {\n          let filterShowColumns = [];\n          item.children.forEach(jtem => {\n            if (jtem.isShow === 1) {\n              filterShowColumns.push(jtem);\n            }\n            if (chartColumMap.hasOwnProperty(jtem.title)) {\n              chartColumMap[jtem.title].push({\n                month: item.title,\n                col: jtem.dataIndex\n              });\n            }\n          });\n          item.children = filterShowColumns;\n        }\n      });\n      Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return _createVNode(\"a\", {\n            \"href\": \"javaScript:void(0)\",\n            \"onClick\": () => {\n              goRingContrastChart(record, 'project');\n            }\n          }, [_createTextVNode(\"\\u770B\\u56FE\")]);\n        }\n      };\n      let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn, actionColumn];\n      tableInfo.columns = filterAllShowColumn;\n    };\n    //部门折叠\n    const expandedChange = rowKeys => {\n      tableInfo.defaultExpandedKeys = rowKeys;\n    };\n    // 切换时间区间\n    const handleMonthChange = month => {\n      selectMonth.value = month;\n      analysiisColumn();\n      getList();\n    };\n    onBeforeMount(() => {\n      seltColumns();\n      analysiisColumn();\n      getList();\n      initTotalColumns();\n      $bus.emit(\"updateStructure\", [{\n        type: \"text\",\n        color: \"#333\",\n        msg: '环比分析列表'\n      }, {\n        type: \"button\",\n        color: \"#5370FD\",\n        msg: deptName,\n        isBack: true\n      }, {\n        type: \"text\",\n        color: \"#333\",\n        msg: `${groupCustomerName}-${title}`\n      }]);\n    });\n    // 点击标签\n    const handleTabChange = tab => {\n      switch (tab.isShow) {\n        case 0:\n          tab.isShow = 1;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 1,\n            tab\n          });\n          break;\n        case 1:\n          tab.isShow = 0;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 0,\n            tab\n          });\n          break;\n        default:\n          break;\n      }\n    };\n    // 更改高亮状态并更换表头\n    const changeShowStatus = obj => {\n      let {\n        columnTabs,\n        defaultColumHasSonTabs\n      } = columConfig.level3;\n      let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      if (filterHasSonShowColumn.length === 0) {\n        Message.error(\"至少选择一项\");\n        obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n        return;\n      }\n      if (obj.type === \"parent\") {\n        columnTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      if (obj.type === \"self\") {\n        defaultColumHasSonTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      analysiisColumn();\n      handleAbortRequest();\n      getList();\n    };\n    // 处理趋势数据\n    const construcLine = arr => {\n      arr.forEach(item => {\n        item.colNo3 = JSON.parse(item.colNo3);\n        item.colNo4 = JSON.parse(item.colNo4);\n        item.colNo5 = JSON.parse(item.colNo5);\n        if (item.children) {\n          construcLine(item.children);\n        }\n      });\n    };\n    // 获取列表数据\n    const getList = () => {\n      tableInfo.data = [];\n      tableInfo.loading = true;\n      let arr = [];\n      var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n      const mappings = {\n        发薪人数: \"colNo1\",\n        营业收入: \"colNo2\",\n        销售毛利: \"colNo3\",\n        销售毛利率: \"colNo4\",\n        直接成本: \"colNo5\",\n        人均营业收入: \"colNo6\",\n        人均直接成本: \"colNo7\",\n        未完工项目成本: \"colNo8\",\n        招聘费用: \"colNo9\",\n        销售费用: \"colNo10\",\n        管理费用: \"colNo11\"\n      };\n      newColumns.forEach(item => {\n        if (mappings[item.title]) {\n          arr.push(mappings[item.title]);\n        }\n        if (item.children) {\n          item.children.forEach(jtem => {\n            if (mappings[jtem.title]) {\n              arr.push(mappings[jtem.title]);\n            }\n          });\n        }\n      });\n      const params = {\n        interval: Number(selectMonth.value),\n        dynamicHeaderParam: Array.from(new Set(arr)),\n        xAxis: 50,\n        yAxis: 20,\n        tagKey: \"linkAnalysis3\",\n        customerId: customerId\n      };\n      getProjectRingList(params).then(res => {\n        if (res.code == \"200\") {\n          construcLine(res.data);\n          let data = dataAddKey(res.data, \"key\", \"title\");\n          let keys = [];\n          res.data.forEach(item => keys.push(item.title));\n          tableInfo.defaultExpandedKeys = keys;\n          tableInfo.data = data;\n        } else {\n          Message.error(res.message);\n        }\n        tableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          tableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          tableInfo.loading = false;\n        }\n      });\n    };\n\n    //跳转环比分析看图页\n    const goRingContrastChart = (record, type) => {\n      router.push({\n        name: 'ringContrastChart',\n        state: {\n          deptName,\n          interval: selectMonth.value,\n          deptId,\n          title,\n          customerName: record.customerName,\n          projectName: record.projectName,\n          sourceType: type,\n          projectId: record.finPcode,\n          taxRate: record.taxRate\n        }\n      });\n    };\n\n    // 同比分析点击标签\n    const handleSameContrastTabChange = value => {\n      value.isShow = value.isShow === 0 ? 1 : 0;\n      let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n      if (filterHasSonShowColumn.length === 0) {\n        Message.error(\"至少选择一项\");\n        value.isShow = value.isShow === 0 ? 1 : 0;\n        return;\n      }\n      handleAbortRequest();\n      if (raidoGroupType.value === \"total\") {\n        constructSameTotalColumns(allHeadTagList.value);\n      } else {\n        constructSameDetailColumns(allHeadTagList.value);\n      }\n    };\n    // 更改汇总/明细\n    const constructSameTabChange = value => {\n      raidoGroupType.value = value;\n      initTotalColumns();\n    };\n\n    //同比分析\n    const allTableList = ref([]); // 表头数据\n    const raidoGroupType = ref(radiotype || 'total');\n    const allHeadTagList = ref([]); // 所有的标签\n    const notShowList = shallowRef([]); // 初始没显示的表头数据\n    //同比分析项目维度汇总表格数据\n    const sameTotalProjectTableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"600px\",\n      loading: false\n    });\n    const sameTotalProjectTableRef = ref(null); //同比汇总项目维度表格dom\n    //同比分析项目维度汇总展开/折叠\n    const projectTableExpandedChange = rowKeys => {\n      sameTotalProjectTableInfo.defaultExpandedKeys = rowKeys;\n    };\n    // 初始化表头和标签数据\n    const initTotalColumns = () => {\n      allHeadTagList.value = [];\n      allTableList.value = [];\n      notShowList.value = [];\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n      if (currentPageColumn.length) {\n        const currentColumnList = currentPageColumn[0].tier[2].tags[0].columns;\n        currentColumnList.forEach(item => {\n          const {\n            col,\n            conf,\n            title\n          } = item;\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: {\n              \"text-align\": conf.cellAlign\n            },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            isShow: conf.isShow\n          };\n          if (conf.canHide == 1) {\n            allHeadTagList.value.push(columnItemConfig);\n          } else {\n            notShowList.value.push(columnItemConfig);\n          }\n          if (conf.fixed !== undefined) {\n            columnItemConfig.fixed = conf.fixed;\n          }\n          if (conf.parentCol == 1) {\n            allTableList.value.push(columnItemConfig);\n          }\n        });\n        if (raidoGroupType.value == \"total\") {\n          constructSameTotalColumns(allHeadTagList.value);\n        } else {\n          constructSameDetailColumns(allHeadTagList.value);\n        }\n      }\n    };\n    // 构造同比汇总的表头\n    const constructSameTotalColumns = list => {\n      let tableList = list.filter(item => item.isShow === 1);\n      let createColumns = [];\n      let childrenColumns = [{\n        title: lastYear + \"/1-12\"\n      }, {\n        title: lastYear + `/1-${lastMonth}`\n      }, {\n        title: year + `/1-${lastMonth}`\n      }, {\n        title: \"同比\"\n      }];\n      let colNo = 6;\n      tableList.forEach(item => {\n        let columnConfig = {\n          title: item.title,\n          children: childrenColumns.map((jtem, i) => {\n            let childrenColumnItemConfig = {\n              title: jtem.title,\n              dataIndex: `colNo${colNo}`,\n              slotName: `colNo${colNo}`,\n              width: 110,\n              cellStyle: {\n                textAlign: 'right'\n              }\n            };\n            if (i === childrenColumns.length - 1) {\n              childrenColumnItemConfig.title = item.title.endsWith('率') ? '偏离' : jtem.title;\n            }\n            colNo++;\n            return childrenColumnItemConfig;\n          })\n        };\n        createColumns.push(columnConfig);\n      });\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return _createVNode(\"a\", {\n            \"href\": \"javaScript:void(0)\",\n            \"onClick\": () => {\n              goLookChat(record, 'project');\n            }\n          }, [_createTextVNode(\"\\u770B\\u56FE\")]);\n        }\n      };\n      sameTotalProjectTableInfo.columns = [...notShowList.value, ...createColumns, actionColumn];\n      getProjectYoyAnalysisList('1');\n    };\n\n    // 同比明细项目维度表格数据\n    const sameDetailProjectTableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"600px\",\n      loading: false\n    });\n    const sameDetailProjectTableRef = ref(null); //同比明细项目维度表格dom\n\n    //同比明细项目维度展开/折叠\n    const sameDetailProjectTableExpandedChange = rowKeys => {\n      sameDetailProjectTableInfo.defaultExpandedKeys = rowKeys;\n    };\n    // 构造同比明细的表头结构\n    const constructSameDetailColumns = list => {\n      const timeData = [];\n      let activeTableList = list.filter(item => item.isShow === 1);\n      if (month == 1) {\n        for (var i = 1; i <= 12; i++) {\n          timeData.push({\n            title: i + \"月\",\n            children: []\n          });\n        }\n      } else {\n        for (var i = 1; i <= lastMonth; i++) {\n          timeData.push({\n            title: i + \"月\",\n            children: []\n          });\n        }\n      }\n      const years = [lastYear, year];\n      let colNo = 6;\n      timeData.forEach(item => {\n        let childrenColumns = [];\n        activeTableList.forEach(jtem => {\n          years.forEach(ktem => {\n            let contrastColumnConfig = {\n              title: `${jtem.title}${ktem}`,\n              dataIndex: `colNo${colNo}`,\n              slotName: `colNo${colNo}`,\n              width: jtem.width,\n              cellStyle: toRaw(jtem.cellStyle)\n            };\n            childrenColumns.push(contrastColumnConfig);\n            colNo++;\n          });\n        });\n        item.children = childrenColumns;\n      });\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return _createVNode(\"a\", {\n            \"href\": \"javaScript:void(0)\",\n            \"onClick\": () => {\n              goLookChat(record, 'project');\n            }\n          }, [_createTextVNode(\"\\u770B\\u56FE\")]);\n        }\n      };\n      sameDetailProjectTableInfo.columns = [...notShowList.value, ...timeData, actionColumn];\n      getProjectYoyAnalysisList('2');\n    };\n\n    //同比分析项目维度接口\n    const getProjectYoyAnalysisList = type => {\n      let params = {\n        interval: lastMonth == 0 ? 12 : lastMonth,\n        dynamicHeaderParam: allTableList.value.filter(item => item.isShow === 1).map(item => item.dataIndex),\n        xAxis: 74,\n        yAxis: 100,\n        tagKey: \"yoyAnalysis3\",\n        customerId,\n        type\n      };\n      raidoGroupType.value === 'total' ? sameTotalProjectTableInfo.loading = true : sameDetailProjectTableInfo.loading = true;\n      getProjectYoyAnalysis(params).then(res => {\n        if (res.code === '200') {\n          dataAddKey(res.data, 'key', 'deptId');\n          let expandKeys = [];\n          res.data.forEach(item => expandKeys.push(item.key));\n          if (raidoGroupType.value === 'total') {\n            sameTotalProjectTableInfo.defaultExpandedKeys = expandKeys;\n            sameTotalProjectTableInfo.data = res.data;\n            //计算表格不出滚动条的最大高度\n            if (sameTotalProjectTableInfo.maxHeight === '600px') {\n              nextTick(() => {\n                if (sameTotalProjectTableRef.value) {\n                  let head = sameTotalProjectTableRef.value.$el;\n                  let innerHeight = window.innerHeight;\n                  let elHeight = head.getBoundingClientRect().top;\n                  sameTotalProjectTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n                }\n              });\n            }\n          }\n          if (raidoGroupType.value === 'detail') {\n            sameDetailProjectTableInfo.defaultExpandedKeys = expandKeys;\n            sameDetailProjectTableInfo.data = res.data;\n            //计算表格不出滚动条的最大高度\n            if (sameDetailProjectTableInfo.maxHeight === '600px') {\n              nextTick(() => {\n                if (sameDetailProjectTableRef.value) {\n                  let head = sameDetailProjectTableRef.value.$el;\n                  let innerHeight = window.innerHeight;\n                  let elHeight = head.getBoundingClientRect().top;\n                  sameDetailProjectTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n                }\n              });\n            }\n          }\n        } else {\n          Message.error(res.message || '请求数据失败');\n        }\n        if (raidoGroupType.value === 'total') {\n          sameTotalProjectTableInfo.loading = false;\n        }\n        if (raidoGroupType.value === 'detail') {\n          sameDetailProjectTableInfo.loading = false;\n        }\n      }).catch(err => {\n        if (raidoGroupType.value === 'total') {\n          if (err?.code === \"ERR_CANCELED\") {\n            sameTotalProjectTableInfo.loading = true;\n          } else {\n            Message.error(err?.message || \"数据请求错误\");\n            sameTotalProjectTableInfo.loading = false;\n          }\n        }\n        if (raidoGroupType.value === 'detail') {\n          if (err?.code === \"ERR_CANCELED\") {\n            sameDetailProjectTableInfo.loading = true;\n          } else {\n            Message.error(err?.message || \"数据请求错误\");\n            sameDetailProjectTableInfo.loading = false;\n          }\n        }\n      });\n    };\n    //跳转同比分析看图页\n    const goLookChat = (record, type) => {\n      router.push({\n        name: 'lookChart',\n        state: {\n          barChartOptions: JSON.stringify(allHeadTagList.value),\n          deptId,\n          title: groupCustomerName,\n          sourceType: type,\n          taxRate: record.taxRate,\n          projectId: record.finPcode,\n          customerName: record.customerName,\n          projectName: record.projectName,\n          deptName\n        }\n      });\n    };\n\n    //echarts缩略图的路径信息\n    const createEchartsRoute = (record, column) => {\n      return record[column.dataIndex].map((item, i) => ({\n        value: record[column.dataIndex][i]\n      }));\n    };\n    const __returned__ = {\n      get $bus() {\n        return $bus;\n      },\n      set $bus(v) {\n        $bus = v;\n      },\n      route,\n      router,\n      get customerId() {\n        return customerId;\n      },\n      set customerId(v) {\n        customerId = v;\n      },\n      get deptId() {\n        return deptId;\n      },\n      set deptId(v) {\n        deptId = v;\n      },\n      get deptName() {\n        return deptName;\n      },\n      set deptName(v) {\n        deptName = v;\n      },\n      get groupCustomerName() {\n        return groupCustomerName;\n      },\n      set groupCustomerName(v) {\n        groupCustomerName = v;\n      },\n      get title() {\n        return title;\n      },\n      set title(v) {\n        title = v;\n      },\n      get tab() {\n        return tab;\n      },\n      set tab(v) {\n        tab = v;\n      },\n      get radiotype() {\n        return radiotype;\n      },\n      set radiotype(v) {\n        radiotype = v;\n      },\n      get tagColumnList() {\n        return tagColumnList;\n      },\n      set tagColumnList(v) {\n        tagColumnList = v;\n      },\n      tabsActive,\n      get year() {\n        return year;\n      },\n      set year(v) {\n        year = v;\n      },\n      get month() {\n        return month;\n      },\n      set month(v) {\n        month = v;\n      },\n      get lastYear() {\n        return lastYear;\n      },\n      set lastYear(v) {\n        lastYear = v;\n      },\n      get lastMonth() {\n        return lastMonth;\n      },\n      set lastMonth(v) {\n        lastMonth = v;\n      },\n      get columConfig() {\n        return columConfig;\n      },\n      set columConfig(v) {\n        columConfig = v;\n      },\n      tableInfo,\n      selectMonth,\n      tableRef,\n      tabChangeColumInfo,\n      chartColumMap,\n      chartColumnNameMap,\n      get filterShowChildrenColumn() {\n        return filterShowChildrenColumn;\n      },\n      set filterShowChildrenColumn(v) {\n        filterShowChildrenColumn = v;\n      },\n      handleTab,\n      seltColumns,\n      analysiisColumn,\n      expandedChange,\n      handleMonthChange,\n      handleTabChange,\n      changeShowStatus,\n      construcLine,\n      getList,\n      goRingContrastChart,\n      handleSameContrastTabChange,\n      constructSameTabChange,\n      allTableList,\n      raidoGroupType,\n      allHeadTagList,\n      notShowList,\n      sameTotalProjectTableInfo,\n      sameTotalProjectTableRef,\n      projectTableExpandedChange,\n      initTotalColumns,\n      constructSameTotalColumns,\n      sameDetailProjectTableInfo,\n      sameDetailProjectTableRef,\n      sameDetailProjectTableExpandedChange,\n      constructSameDetailColumns,\n      getProjectYoyAnalysisList,\n      goLookChat,\n      createEchartsRoute,\n      get Message() {\n        return Message;\n      },\n      onBeforeMount,\n      reactive,\n      ref,\n      nextTick,\n      onMounted,\n      toRaw,\n      shallowRef,\n      get useTagColumnListStore() {\n        return useTagColumnListStore;\n      },\n      get getProjectRingList() {\n        return getProjectRingList;\n      },\n      get getProjectYoyAnalysis() {\n        return getProjectYoyAnalysis;\n      },\n      get getNMonthsAgo() {\n        return getNMonthsAgo;\n      },\n      get dataAddKey() {\n        return dataAddKey;\n      },\n      get getRedNum() {\n        return getRedNum;\n      },\n      get getCurrentTime() {\n        return getCurrentTime;\n      },\n      echartContainer,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get getCurrentInstance() {\n        return getCurrentInstance;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["Message","onBeforeMount","reactive","ref","nextTick","onMounted","toRaw","shallowRef","useTagColumnListStore","getProjectRingList","getProjectYoyAnalysis","getNMonthsAgo","dataAddKey","getRedNum","getCurrentTime","echartContainer","useRoute","useRouter","getCurrentInstance","$bus","appContext","config","globalProperties","route","router","customerId","deptId","deptName","groupCustomerName","title","tab","radiotype","query","tagColumnList","tabsActive","year","month","lastYear","lastMonth","columConfig","tableInfo","columns","data","defaultExpandedKeys","maxHeight","loading","selectMonth","tableRef","tabChangeColumInfo","columnTabs","up","down","chartColumMap","发薪人数","营业收入","销售毛利率","chartColumnNameMap","canvasLine1","canvasLine2","canvasLine3","filterShowChildrenColumn","handleTab","val","value","head","$el","innerHeight","window","elHeight","getBoundingClientRect","top","seltColumns","tagColumns","getTagColumnList","currentPageColumn","filter","item","report","length","tier","forEach","index","tabs","columnHasSonTabs","noHiddenColumn","defaultColumHasSonTabs","defaultColumnTabs","tags","jtem","push","tag","ktem","col","conf","columnItemConfig","dataIndex","align","cellStyle","cellAlign","width","ellipsis","headerCellClass","slotName","bodyCellClass","fixed","isShow","render","record","column","cellVal","Array","isArray","undefined","map","i","tip","canHide","parentCol","params","level3","analysiisColumn","num","months1","children1","filterHasSonShowColumn1","columnHasSonConfig","children","j","months2","children2","filterHasSonShowColumn2","months3","children3","filterHasSonShowColumn3","Object","keys","key","filterShowColumns","hasOwnProperty","reverse","actionColumn","textAlign","goRingContrastChart","filterAllShowColumn","expandedChange","rowKeys","handleMonthChange","getList","initTotalColumns","emit","type","color","msg","isBack","handleTabChange","changeShowStatus","obj","filterHasSonShowColumn","error","handleAbortRequest","construcLine","arr","colNo3","JSON","parse","colNo4","colNo5","newColumns","stringify","mappings","销售毛利","直接成本","人均营业收入","人均直接成本","未完工项目成本","招聘费用","销售费用","管理费用","interval","Number","dynamicHeaderParam","from","Set","xAxis","yAxis","tagKey","then","res","code","message","catch","err","name","state","customerName","projectName","sourceType","projectId","finPcode","taxRate","handleSameContrastTabChange","allHeadTagList","raidoGroupType","constructSameTotalColumns","constructSameDetailColumns","constructSameTabChange","allTableList","notShowList","sameTotalProjectTableInfo","sameTotalProjectTableRef","projectTableExpandedChange","currentColumnList","list","tableList","createColumns","childrenColumns","colNo","columnConfig","childrenColumnItemConfig","endsWith","goLookChat","getProjectYoyAnalysisList","sameDetailProjectTableInfo","sameDetailProjectTableRef","sameDetailProjectTableExpandedChange","timeData","activeTableList","years","contrastColumnConfig","expandKeys","Math","round","barChartOptions","createEchartsRoute"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-mgmt-frontend/src/views/ringAnalyze/projectRingSame.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <a-tabs v-model:active-key=\"tabsActive\" class=\"tabs\" @change=\"handleTab\">\n      <a-tab-pane key=\"1\" title=\"环比分析\" class=\"p-t-10\">\n        <!-- 标签及月份-->\n        <div class=\"flex-between\">\n          <a-space :size=\"['small', 0]\" wrap>\n            <a-tag\n              v-for=\"(item, index) of tabChangeColumInfo.columnTabs\"\n              :key=\"index\"\n              :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n              size=\"large\"\n              class=\"pointer\"\n              @click=\"handleTabChange(item)\"\n            >\n              {{ item.title }}\n            </a-tag>\n          </a-space>\n          <div style=\"position: relative; top: -1px\">\n            <a-select v-model:model-value=\"selectMonth\" @change=\"handleMonthChange\">\n              <a-option value=\"3\">近3个月</a-option>\n              <a-option value=\"6\">近6个月</a-option>\n              <a-option value=\"12\">近12个月</a-option>\n              <template #arrow-icon>\n                <icon-calendar :size=\"16\" />\n              </template>\n            </a-select>\n          </div>\n        </div>\n        <!-- 表格 -->\n        <div class=\"m-t-20\">\n          <a-table\n            :columns=\"tableInfo.columns\"\n            :data=\"tableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"tableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: tableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"tableInfo.loading\"\n            ref=\"tableRef\"\n            @expanded-change=\"expandedChange\"\n          >\n            <template #projectName=\"{ record }\">\n              <a-popover\n                :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n              >\n                <span class=\"pointer\">{{ record.projectName }}</span>\n                <template #content>\n                  {{ record.projectName }}\n                </template>\n              </a-popover>\n            </template>\n          </a-table>\n        </div>\n      </a-tab-pane>\n      <a-tab-pane key=\"2\" title=\"同比分析\" class=\"p-t-10\">\n        <div class=\"flex-between\">\n            <a-space :size=\"['small', 0]\" wrap>\n              <a-tag\n                v-for=\"(item, index) of allTableList\"\n                :key=\"index\"\n                :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n                size=\"large\"\n                class=\"pointer\"\n                @click=\"handleSameContrastTabChange(item)\"\n              >\n                {{ item.title }}\n              </a-tag>\n            </a-space>\n            <div style=\"position: relative; top: -1px\">\n              <a-radio-group v-model:model-value=\"raidoGroupType\" type=\"button\" @change=\"constructSameTabChange\">\n                <a-radio value=\"total\">汇总</a-radio>\n                <a-radio value=\"detail\">明细</a-radio>\n              </a-radio-group>\n            </div>\n          </div>\n          <div v-show=\"raidoGroupType === 'total'\">\n            <a-table\n              :columns=\"sameTotalProjectTableInfo.columns\"\n              :data=\"sameTotalProjectTableInfo.data\"\n              :default-expand-all-rows=\"true\"\n              :bordered=\"{ cell: true }\"\n              column-resizable\n              :expanded-keys=\"sameTotalProjectTableInfo.defaultExpandedKeys\"\n              :scroll=\"{ maxHeight: sameTotalProjectTableInfo.maxHeight }\"\n              :scrollbar=\"{ x: true, y: 1500 }\"\n              :pagination=\"false\"\n              :loading=\"sameTotalProjectTableInfo.loading\"\n              ref=\"sameTotalProjectTableRef\"\n              class=\"m-t-20\"\n              @expanded-change=\"projectTableExpandedChange\"\n            >\n              <template #lastDeptName=\"{ record }\">\n                <a-popover\n                  :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                  :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n                >\n                <a href=\"javaScript:void(0)\" v-if=\"record.leafNode === '1'\" style=\"color: #165dff\">\n                  {{ record.lastDeptName }}\n                </a>\n                <span class=\"pointer\" v-else>{{ record.lastDeptName }}</span>\n                  <template #content>\n                    {{ record.deptName }}\n                  </template>\n                </a-popover>\n              </template>\n              <template #canvasLine1=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine2=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine3=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n            </a-table>\n          </div>\n          <div v-show=\"raidoGroupType === 'detail'\">\n            <a-table\n              :columns=\"sameDetailProjectTableInfo.columns\"\n              :data=\"sameDetailProjectTableInfo.data\"\n              :default-expand-all-rows=\"true\"\n              :bordered=\"{ cell: true }\"\n              column-resizable\n              :expanded-keys=\"sameDetailProjectTableInfo.defaultExpandedKeys\"\n              :scroll=\"{ maxHeight: sameDetailProjectTableInfo.maxHeight }\"\n              :scrollbar=\"{ x: true, y: 1500 }\"\n              :pagination=\"false\"\n              :loading=\"sameDetailProjectTableInfo.loading\"\n              ref=\"sameDetailProjectTableRef\"\n              class=\" m-t-20\"\n              @expanded-change=\"sameDetailProjectTableExpandedChange\"\n            >\n              <template #title=\"{ record }\">\n                <a-popover\n                  :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                  :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n                >\n                <a href=\"javaScript:void(0)\" v-if=\"record.leafNode === '1'\" style=\"color: #165dff\">\n                  {{ record.title }}\n                </a>\n                <span class=\"pointer\" v-else>{{ record.title }}</span>\n                  <template #content>\n                    {{ record.title }}\n                  </template>\n                </a-popover>\n              </template>\n              <template #canvasLine1=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine2=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine3=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n            </a-table>\n          </div>\n      </a-tab-pane>\n    </a-tabs>\n  </div>\n</template>\n\n<script setup>\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw,shallowRef } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getProjectRingList,getProjectYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo, dataAddKey, getRedNum,getCurrentTime } from \"../../utils/util\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { useRoute,useRouter } from \"vue-router\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\nconst route = useRoute();\nconst router = useRouter()\nlet {customerId,deptId,deptName,groupCustomerName,title,tab ,radiotype} = route.query;\nlet tagColumnList = useTagColumnListStore();\nconst tabsActive = ref(tab||'1');\nlet { year, month } = getCurrentTime();\nlet lastYear = year-1\nlet lastMonth = month-1\nlet columConfig = {};\nconst tableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"200px\",\n  loading: false,\n});\nconst selectMonth = ref(\"3\");\nconst tableRef = ref(null);\nconst tabChangeColumInfo = reactive({\n  columnTabs: [],\n  up: [],\n  down: [],\n});\nconst chartColumMap = {\n  发薪人数: [],\n  营业收入: [],\n  销售毛利率: [],\n};\nconst chartColumnNameMap = {\n  canvasLine1: \"发薪人数\",\n  canvasLine2: \"营业收入\",\n  canvasLine3: \"销售毛利率\",\n};\nlet filterShowChildrenColumn = [];\n// 切换环比分析和同比分析\nconst handleTab = val => {\n  tabsActive.value = val;\n};\nonMounted(() => {\n  if (tableRef.value) {\n    let head = tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\n// 初始化\nconst seltColumns = () => {\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n  if (currentPageColumn.length) {\n    currentPageColumn[0].tier.forEach((item, index) => {\n      let tabs = [];\n      let columnTabs = [];\n      let columnHasSonTabs = [];\n      let noHiddenColumn = [];\n      let defaultColumHasSonTabs = [];\n      let defaultColumnTabs = [];\n      item.tags.forEach(jtem => {\n        tabs.push(jtem.tag);\n        jtem.columns.forEach(ktem => {\n          let { col, conf, title } = ktem;\n          conf = conf || {};\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: { \"text-align\": conf.cellAlign },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            fixed : conf.fixed\n          };\n          columnItemConfig.isShow = conf.isShow;\n          columnItemConfig.render = ({ record, column }) => {\n            let cellVal = record[column.dataIndex];\n            if (!Array.isArray(cellVal)) {\n              if (cellVal !== null && cellVal !== undefined) {\n                return <span innerHTML={getRedNum(cellVal)}></span>;\n              }\n            } else {\n              if (chartColumMap[chartColumnNameMap[column.dataIndex]] !== undefined) {\n                let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n                  tip: item.month + record[item.col],\n                  value: cellVal[i],\n                }));\n                return <echartContainer route={route} height={74} width={100} />;\n              }\n            }\n          };\n          if (conf.canHide === 1) {\n            if (conf.parentCol === 0) {\n              columnTabs.push(columnItemConfig);\n            } else {\n              columnHasSonTabs.push(columnItemConfig);\n            }\n          } else {\n            noHiddenColumn.push(columnItemConfig);\n          }\n          if (conf.parentCol === 1) {\n            defaultColumHasSonTabs.push(columnItemConfig);\n          } else {\n            defaultColumnTabs.push(columnItemConfig);\n          }\n        });\n      });\n      columConfig[\"level\" + (index + 1)] = {\n        tabs,\n        params: item.params || [],\n        columnTabs,\n        columnHasSonTabs,\n        noHiddenColumn,\n        defaultColumnTabs,\n        defaultColumHasSonTabs,\n      };\n    });\n  }\n  tabChangeColumInfo.columnTabs = columConfig.level3.columnHasSonTabs;\n};\n// 更换表头\nconst analysiisColumn = () => {\n  let { columnTabs, noHiddenColumn, defaultColumHasSonTabs } = columConfig.level3;\n  let num = 5;\n  switch (selectMonth.value) {\n    case \"3\":\n      let months1 = getNMonthsAgo(3, true);\n      let children1 = [];\n      let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months1.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children1.push(columnHasSonConfig);\n      });\n      num = 5;\n      filterShowChildrenColumn = children1;\n      break;\n    case \"6\":\n      let months2 = getNMonthsAgo(6, true);\n      let children2 = [];\n      let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months2.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children2.push(columnHasSonConfig);\n      });\n      num = 5;\n      filterShowChildrenColumn = children2;\n      break;\n    case \"12\":\n      let months3 = getNMonthsAgo(12, true);\n      months3 = months3.filter(item=>item[0]!==2022)\n      let children3 = [];\n      let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months3.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children3.push(columnHasSonConfig);\n      });\n      num = 5;\n      filterShowChildrenColumn = children3;\n      break;\n    default:\n      break;\n  }\n  Object.keys(chartColumMap).forEach(key => {\n    chartColumMap[key] = [];\n  });\n  filterShowChildrenColumn.forEach(item => {\n    if (item.children?.length) {\n      let filterShowColumns = [];\n      item.children.forEach(jtem => {\n        if (jtem.isShow === 1) {\n          filterShowColumns.push(jtem);\n        }\n        if (chartColumMap.hasOwnProperty(jtem.title)) {\n          chartColumMap[jtem.title].push({\n            month: item.title,\n            col: jtem.dataIndex,\n          });\n        }\n      });\n      item.children = filterShowColumns;\n    }\n  });\n  Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goRingContrastChart(record,'project')}}>看图</a>\n    }\n  }\n  let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn,actionColumn];\n  tableInfo.columns = filterAllShowColumn;\n};\n//部门折叠\nconst expandedChange = rowKeys => {\n  tableInfo.defaultExpandedKeys = rowKeys;\n};\n// 切换时间区间\nconst handleMonthChange = month => {\n  selectMonth.value = month;\n  analysiisColumn();\n  getList();\n};\nonBeforeMount(() => {\n  seltColumns();\n  analysiisColumn();\n  getList();\n  initTotalColumns();\n  $bus.emit(\"updateStructure\", [\n    { type: \"text\", color: \"#333\", msg: '环比分析列表' },\n    {\n        type: \"button\",\n        color: \"#5370FD\",\n        msg: deptName,\n        isBack : true\n    },\n    { type: \"text\", color: \"#333\", msg: `${groupCustomerName}-${title}` },\n  ]);\n});\n// 点击标签\nconst handleTabChange = tab => {\n  switch (tab.isShow) {\n    case 0:\n      tab.isShow = 1;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 1,\n        tab,\n      });\n      break;\n    case 1:\n      tab.isShow = 0;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 0,\n        tab,\n      });\n      break;\n    default:\n      break;\n  }\n};\n// 更改高亮状态并更换表头\nconst changeShowStatus = obj => {\n  let { columnTabs, defaultColumHasSonTabs } = columConfig.level3;\n  let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n    return;\n  }\n  if (obj.type === \"parent\") {\n    columnTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  if (obj.type === \"self\") {\n    defaultColumHasSonTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  analysiisColumn();\n  handleAbortRequest();\n  getList();\n};\n// 处理趋势数据\nconst construcLine = arr => {\n  arr.forEach(item => {\n    item.colNo3 = JSON.parse(item.colNo3);\n    item.colNo4 = JSON.parse(item.colNo4);\n    item.colNo5 = JSON.parse(item.colNo5);\n    if (item.children) {\n      construcLine(item.children);\n    }\n  });\n};\n// 获取列表数据\nconst getList = () => {\n  tableInfo.data = [];\n  tableInfo.loading = true;\n  let arr = [];\n  var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n  const mappings = {\n    发薪人数: \"colNo1\",\n    营业收入: \"colNo2\",\n    销售毛利: \"colNo3\",\n    销售毛利率: \"colNo4\",\n    直接成本: \"colNo5\",\n    人均营业收入: \"colNo6\",\n    人均直接成本: \"colNo7\",\n    未完工项目成本: \"colNo8\",\n    招聘费用: \"colNo9\",\n    销售费用: \"colNo10\",\n    管理费用: \"colNo11\",\n  };\n  newColumns.forEach(item => {\n    if (mappings[item.title]) {\n      arr.push(mappings[item.title]);\n    }\n    if (item.children) {\n      item.children.forEach(jtem => {\n        if (mappings[jtem.title]) {\n          arr.push(mappings[jtem.title]);\n        }\n      });\n    }\n  });\n  const params = {\n    interval: Number(selectMonth.value),\n    dynamicHeaderParam: Array.from(new Set(arr)),\n    xAxis: 50,\n    yAxis: 20,\n    tagKey: \"linkAnalysis3\",\n    customerId: customerId,\n  };\n  getProjectRingList(params)\n    .then(res => {\n      if (res.code == \"200\") {\n        construcLine(res.data);\n        let data = dataAddKey(res.data, \"key\", \"title\");\n        let keys = [];\n        res.data.forEach(item => keys.push(item.title));\n        tableInfo.defaultExpandedKeys = keys;\n        tableInfo.data = data;\n      } else {\n        Message.error(res.message);\n      }\n      tableInfo.loading = false;\n    })\n    .catch(err => {\n      if (err?.code === \"ERR_CANCELED\") {\n        tableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        tableInfo.loading = false;\n      }\n    });\n};\n\n//跳转环比分析看图页\nconst goRingContrastChart = (record,type)=>{\n  router.push({\n    name : 'ringContrastChart',\n    state : {\n      deptName,\n      interval:selectMonth.value,\n      deptId,\n      title,\n      customerName : record.customerName,\n      projectName : record.projectName,\n      sourceType : type,\n      projectId : record.finPcode,\n      taxRate : record.taxRate,\n    }\n  })\n}\n\n// 同比分析点击标签\nconst handleSameContrastTabChange = value => {\n  value.isShow = value.isShow === 0 ? 1 : 0;\n  let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    value.isShow = value.isShow === 0 ? 1 : 0;\n    return;\n  }\n  handleAbortRequest()\n  if (raidoGroupType.value === \"total\") {\n    constructSameTotalColumns(allHeadTagList.value);\n  } else {\n    constructSameDetailColumns(allHeadTagList.value);\n  }\n};\n// 更改汇总/明细\nconst constructSameTabChange = value => {\n  raidoGroupType.value = value;\n  initTotalColumns();\n};\n\n\n//同比分析\nconst allTableList = ref([]); // 表头数据\nconst raidoGroupType = ref(radiotype || 'total')\nconst allHeadTagList = ref([]); // 所有的标签\nconst notShowList = shallowRef([]); // 初始没显示的表头数据\n//同比分析项目维度汇总表格数据\nconst sameTotalProjectTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n})\nconst sameTotalProjectTableRef = ref(null) //同比汇总项目维度表格dom\n//同比分析项目维度汇总展开/折叠\nconst projectTableExpandedChange = rowKeys => {\n  sameTotalProjectTableInfo.defaultExpandedKeys = rowKeys;\n};\n// 初始化表头和标签数据\nconst initTotalColumns = () => {\n  allHeadTagList.value = [];\n  allTableList.value = [];\n  notShowList.value = [];\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n  if (currentPageColumn.length) {\n    const currentColumnList = currentPageColumn[0].tier[2].tags[0].columns;\n    currentColumnList.forEach(item => {\n      const { col, conf, title } = item;\n      let columnItemConfig = {\n        title,\n        dataIndex: col,\n        align: conf.align,\n        cellStyle: { \"text-align\": conf.cellAlign },\n        width: conf.width,\n        ellipsis: true,\n        headerCellClass: \"noEllipsis\",\n        slotName: col,\n        bodyCellClass: \"bodyCell\",\n        isShow: conf.isShow,\n      };\n      if (conf.canHide == 1) {\n        allHeadTagList.value.push(columnItemConfig);\n      } else {\n        notShowList.value.push(columnItemConfig);\n      }\n      if(conf.fixed !== undefined){\n        columnItemConfig.fixed = conf.fixed\n      }\n      if (conf.parentCol == 1) {\n        allTableList.value.push(columnItemConfig);\n      }\n    });\n    if (raidoGroupType.value == \"total\") {\n      constructSameTotalColumns(allHeadTagList.value);\n    } else {\n      constructSameDetailColumns(allHeadTagList.value);\n    }\n  }\n};\n// 构造同比汇总的表头\nconst constructSameTotalColumns = list => {\n  let tableList = list.filter(item => item.isShow === 1);\n  let createColumns = []\n  let childrenColumns = [\n        {\n          title: lastYear + \"/1-12\",\n        },\n        {\n          title: lastYear + `/1-${lastMonth}`,\n        },\n        {\n          title: year + `/1-${lastMonth}`,\n        },\n        {\n          title: \"同比\",\n        },\n  ]\n  let colNo = 6\n  tableList.forEach(item => {\n    let columnConfig = {\n      title : item.title,\n      children : childrenColumns.map((jtem,i)=>{\n        let childrenColumnItemConfig = {\n          title : jtem.title,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: 110,\n          cellStyle: {textAlign : 'right'},\n        }\n        if(i === (childrenColumns.length -1)){\n          childrenColumnItemConfig.title = item.title.endsWith('率')?'偏离':jtem.title\n        }\n        colNo++\n        return childrenColumnItemConfig\n      })\n    }\n    createColumns.push(columnConfig)\n  });\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'project')}}>看图</a>\n    }\n  }\n  sameTotalProjectTableInfo.columns = [...notShowList.value,...createColumns,actionColumn]\n  getProjectYoyAnalysisList('1')\n};\n\n// 同比明细项目维度表格数据\nconst sameDetailProjectTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n})\nconst sameDetailProjectTableRef = ref(null) //同比明细项目维度表格dom\n\n//同比明细项目维度展开/折叠\nconst sameDetailProjectTableExpandedChange = rowKeys => {\n  sameDetailProjectTableInfo.defaultExpandedKeys = rowKeys;\n};\n// 构造同比明细的表头结构\nconst constructSameDetailColumns = list => {\n  const timeData = [];\n  let activeTableList = list.filter(item => item.isShow === 1);\n  if (month == 1) {\n    for (var i = 1; i <= 12; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  } else {\n    for (var i = 1; i <= lastMonth; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  }\n  const years = [lastYear, year];\n  let colNo = 6\n  timeData.forEach(item=>{\n    let childrenColumns = []\n    activeTableList.forEach(jtem=>{\n      years.forEach(ktem=>{\n        let contrastColumnConfig = {\n          title: `${jtem.title}${ktem}`,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: jtem.width,\n          cellStyle: toRaw(jtem.cellStyle),\n        }\n        childrenColumns.push(contrastColumnConfig)\n        colNo++\n      })\n    })\n    item.children = childrenColumns\n  })\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'project')}}>看图</a>\n    }\n  }\n  sameDetailProjectTableInfo.columns = [...notShowList.value,...timeData,actionColumn]\n  getProjectYoyAnalysisList('2')\n};\n\n//同比分析项目维度接口\nconst getProjectYoyAnalysisList = (type)=>{\n  let params = {\n    interval:lastMonth == 0? 12 : lastMonth,\n    dynamicHeaderParam:allTableList.value.filter(item=>item.isShow ===1).map(item=>item.dataIndex),\n    xAxis:74,\n    yAxis:100,\n    tagKey:\"yoyAnalysis3\",\n    customerId,\n    type \n  }\n  raidoGroupType.value === 'total'?sameTotalProjectTableInfo.loading = true:sameDetailProjectTableInfo.loading = true;\n  getProjectYoyAnalysis(params).then(res=>{\n    if(res.code === '200'){\n      dataAddKey(res.data,'key','deptId')\n      let expandKeys = []\n      res.data.forEach(item=>expandKeys.push(item.key))\n      if(raidoGroupType.value === 'total'){\n        sameTotalProjectTableInfo.defaultExpandedKeys = expandKeys\n        sameTotalProjectTableInfo.data = res.data\n        //计算表格不出滚动条的最大高度\n        if(sameTotalProjectTableInfo.maxHeight === '600px'){\n          nextTick(() => {\n                if (sameTotalProjectTableRef.value) {\n                let head = sameTotalProjectTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameTotalProjectTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n        }\n      }\n      if(raidoGroupType.value === 'detail'){\n        sameDetailProjectTableInfo.defaultExpandedKeys = expandKeys\n        sameDetailProjectTableInfo.data = res.data\n        //计算表格不出滚动条的最大高度\n        if(sameDetailProjectTableInfo.maxHeight === '600px'){\n          nextTick(() => {\n                if (sameDetailProjectTableRef.value) {\n                let head = sameDetailProjectTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameDetailProjectTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n        }\n      }\n    }else {\n      Message.error(res.message || '请求数据失败')\n    }\n    if(raidoGroupType.value === 'total'){\n      sameTotalProjectTableInfo.loading = false;\n    }\n    if(raidoGroupType.value === 'detail'){\n      sameDetailProjectTableInfo.loading = false;\n    }\n  }).catch(err=>{\n    if(raidoGroupType.value === 'total'){\n      if (err?.code === \"ERR_CANCELED\") {\n        sameTotalProjectTableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          sameTotalProjectTableInfo.loading = false;\n        }\n      }\n    if(raidoGroupType.value === 'detail'){\n      if (err?.code === \"ERR_CANCELED\") {\n        sameDetailProjectTableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        sameDetailProjectTableInfo.loading = false;\n      }\n    }\n  })\n}\n//跳转同比分析看图页\nconst goLookChat = (record,type)=>{\n  router.push({\n    name : 'lookChart',\n    state : {\n      barChartOptions : JSON.stringify(allHeadTagList.value),\n      deptId,\n      title : groupCustomerName,\n      sourceType:type,\n      taxRate : record.taxRate,\n      projectId : record.finPcode,\n      customerName : record.customerName,\n      projectName : record.projectName,\n      deptName\n    }\n  })\n}\n\n//echarts缩略图的路径信息\nconst createEchartsRoute = (record,column)=>{\n  return record[column.dataIndex].map((item,i)=>({value:record[column.dataIndex][i]}))\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.p-t-10 {\n  padding-top: 10px;\n}\n:deep(.tabs .arco-tabs-nav-type-line .arco-tabs-tab-title) {\n  font-size: 15px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}