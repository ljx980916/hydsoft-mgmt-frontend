{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, createVNode as _createVNode, createElementVNode as _createElementVNode, vShow as _vShow, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-05615bb2\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"defaultPadding\"\n};\nconst _hoisted_2 = {\n  class: \"flex-between\"\n};\nconst _hoisted_3 = {\n  style: {\n    \"position\": \"relative\",\n    \"top\": \"-1px\"\n  }\n};\nconst _hoisted_4 = {\n  class: \"m-t-20\"\n};\nconst _hoisted_5 = {\n  class: \"pointer\"\n};\nconst _hoisted_6 = {\n  class: \"flex-between\"\n};\nconst _hoisted_7 = {\n  style: {\n    \"position\": \"relative\",\n    \"top\": \"-1px\"\n  }\n};\nconst _hoisted_8 = {\n  key: 0,\n  href: \"javaScript:void(0)\",\n  style: {\n    \"color\": \"#165dff\"\n  }\n};\nconst _hoisted_9 = {\n  key: 1,\n  class: \"pointer\"\n};\nconst _hoisted_10 = {\n  key: 0,\n  href: \"javaScript:void(0)\",\n  style: {\n    \"color\": \"#165dff\"\n  }\n};\nconst _hoisted_11 = {\n  key: 1,\n  class: \"pointer\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_a_tag = _resolveComponent(\"a-tag\");\n  const _component_a_space = _resolveComponent(\"a-space\");\n  const _component_a_option = _resolveComponent(\"a-option\");\n  const _component_icon_calendar = _resolveComponent(\"icon-calendar\");\n  const _component_a_select = _resolveComponent(\"a-select\");\n  const _component_a_popover = _resolveComponent(\"a-popover\");\n  const _component_a_table = _resolveComponent(\"a-table\");\n  const _component_a_tab_pane = _resolveComponent(\"a-tab-pane\");\n  const _component_a_radio = _resolveComponent(\"a-radio\");\n  const _component_a_radio_group = _resolveComponent(\"a-radio-group\");\n  const _component_a_tabs = _resolveComponent(\"a-tabs\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_a_tabs, {\n    \"active-key\": $setup.tabsActive,\n    \"onUpdate:active-key\": _cache[2] || (_cache[2] = $event => $setup.tabsActive = $event),\n    class: \"tabs\",\n    onChange: $setup.handleTab\n  }, {\n    default: _withCtx(() => [_createVNode(_component_a_tab_pane, {\n      key: \"1\",\n      title: \"环比分析\",\n      class: \"p-t-10\"\n    }, {\n      default: _withCtx(() => [_createCommentVNode(\" 标签及月份\"), _createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_a_space, {\n        size: ['small', 0],\n        wrap: \"\"\n      }, {\n        default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.tabChangeColumInfo.columnTabs, (item, index) => {\n          return _openBlock(), _createBlock(_component_a_tag, {\n            key: index,\n            color: item.isShow === 1 ? 'arcoblue' : '',\n            size: \"large\",\n            class: \"pointer\",\n            onClick: $event => $setup.handleTabChange(item)\n          }, {\n            default: _withCtx(() => [_createTextVNode(_toDisplayString(item.title), 1 /* TEXT */)]),\n\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"color\", \"onClick\"]);\n        }), 128 /* KEYED_FRAGMENT */))]),\n\n        _: 1 /* STABLE */\n      }), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_a_select, {\n        \"model-value\": $setup.selectMonth,\n        \"onUpdate:model-value\": _cache[0] || (_cache[0] = $event => $setup.selectMonth = $event),\n        onChange: $setup.handleMonthChange\n      }, {\n        \"arrow-icon\": _withCtx(() => [_createVNode(_component_icon_calendar, {\n          size: 16\n        })]),\n        default: _withCtx(() => [_createVNode(_component_a_option, {\n          value: \"3\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(\"近3个月\")]),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_a_option, {\n          value: \"6\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(\"近6个月\")]),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_a_option, {\n          value: \"12\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(\"近12个月\")]),\n          _: 1 /* STABLE */\n        })]),\n\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"model-value\"])])]), _createCommentVNode(\" 表格 \"), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_a_table, {\n        columns: $setup.tableInfo.columns,\n        data: $setup.tableInfo.data,\n        \"default-expand-all-rows\": true,\n        bordered: {\n          cell: true\n        },\n        \"column-resizable\": \"\",\n        \"expanded-keys\": $setup.tableInfo.defaultExpandedKeys,\n        scroll: {\n          maxHeight: $setup.tableInfo.maxHeight\n        },\n        scrollbar: {\n          x: true,\n          y: 1500\n        },\n        pagination: false,\n        loading: $setup.tableInfo.loading,\n        ref: \"tableRef\",\n        onExpandedChange: $setup.expandedChange\n      }, {\n        projectName: _withCtx(({\n          record\n        }) => [_createVNode(_component_a_popover, {\n          \"content-style\": {\n            background: 'rgba(0,0,0,.8)',\n            color: '#fff'\n          },\n          \"arrow-style\": {\n            background: 'rgba(0,0,0,.8)'\n          }\n        }, {\n          content: _withCtx(() => [_createTextVNode(_toDisplayString(record.projectName), 1 /* TEXT */)]),\n\n          default: _withCtx(() => [_createElementVNode(\"span\", _hoisted_5, _toDisplayString(record.projectName), 1 /* TEXT */)]),\n\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"content-style\", \"arrow-style\"])]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"columns\", \"data\", \"expanded-keys\", \"scroll\", \"loading\"])])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_a_tab_pane, {\n      key: \"2\",\n      title: \"同比分析\",\n      class: \"p-t-10\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_6, [_createVNode(_component_a_space, {\n        size: ['small', 0],\n        wrap: \"\"\n      }, {\n        default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.allTableList, (item, index) => {\n          return _openBlock(), _createBlock(_component_a_tag, {\n            key: index,\n            color: item.isShow === 1 ? 'arcoblue' : '',\n            size: \"large\",\n            class: \"pointer\",\n            onClick: $event => $setup.handleSameContrastTabChange(item)\n          }, {\n            default: _withCtx(() => [_createTextVNode(_toDisplayString(item.title), 1 /* TEXT */)]),\n\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"color\", \"onClick\"]);\n        }), 128 /* KEYED_FRAGMENT */))]),\n\n        _: 1 /* STABLE */\n      }), _createElementVNode(\"div\", _hoisted_7, [_createVNode(_component_a_radio_group, {\n        \"model-value\": $setup.raidoGroupType,\n        \"onUpdate:model-value\": _cache[1] || (_cache[1] = $event => $setup.raidoGroupType = $event),\n        type: \"button\",\n        onChange: $setup.constructSameTabChange\n      }, {\n        default: _withCtx(() => [_createVNode(_component_a_radio, {\n          value: \"total\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(\"汇总\")]),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_a_radio, {\n          value: \"detail\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(\"明细\")]),\n          _: 1 /* STABLE */\n        })]),\n\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"model-value\"])])]), _withDirectives(_createElementVNode(\"div\", null, [_createVNode(_component_a_table, {\n        columns: $setup.sameTotalProjectTableInfo.columns,\n        data: $setup.sameTotalProjectTableInfo.data,\n        \"default-expand-all-rows\": true,\n        bordered: {\n          cell: true\n        },\n        \"column-resizable\": \"\",\n        \"expanded-keys\": $setup.sameTotalProjectTableInfo.defaultExpandedKeys,\n        scroll: {\n          maxHeight: $setup.sameTotalProjectTableInfo.maxHeight\n        },\n        scrollbar: {\n          x: true,\n          y: 1500\n        },\n        pagination: false,\n        loading: $setup.sameTotalProjectTableInfo.loading,\n        ref: \"sameTotalProjectTableRef\",\n        class: \"m-t-20\",\n        onExpandedChange: $setup.projectTableExpandedChange\n      }, {\n        lastDeptName: _withCtx(({\n          record\n        }) => [_createVNode(_component_a_popover, {\n          \"content-style\": {\n            background: 'rgba(0,0,0,.8)',\n            color: '#fff'\n          },\n          \"arrow-style\": {\n            background: 'rgba(0,0,0,.8)'\n          }\n        }, {\n          content: _withCtx(() => [_createTextVNode(_toDisplayString(record.deptName), 1 /* TEXT */)]),\n\n          default: _withCtx(() => [record.leafNode === '1' ? (_openBlock(), _createElementBlock(\"a\", _hoisted_8, _toDisplayString(record.lastDeptName), 1 /* TEXT */)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_9, _toDisplayString(record.lastDeptName), 1 /* TEXT */))]),\n\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"content-style\", \"arrow-style\"])]),\n        canvasLine1: _withCtx(({\n          record,\n          column\n        }) => [_createVNode($setup[\"echartContainer\"], {\n          route: $setup.createEchartsRoute(record, column),\n          height: 74,\n          width: 100\n        }, null, 8 /* PROPS */, [\"route\"])]),\n        canvasLine2: _withCtx(({\n          record,\n          column\n        }) => [_createVNode($setup[\"echartContainer\"], {\n          route: $setup.createEchartsRoute(record, column),\n          height: 74,\n          width: 100\n        }, null, 8 /* PROPS */, [\"route\"])]),\n        canvasLine3: _withCtx(({\n          record,\n          column\n        }) => [_createVNode($setup[\"echartContainer\"], {\n          route: $setup.createEchartsRoute(record, column),\n          height: 74,\n          width: 100\n        }, null, 8 /* PROPS */, [\"route\"])]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"columns\", \"data\", \"expanded-keys\", \"scroll\", \"loading\"])], 512 /* NEED_PATCH */), [[_vShow, $setup.raidoGroupType === 'total']]), _withDirectives(_createElementVNode(\"div\", null, [_createVNode(_component_a_table, {\n        columns: $setup.sameDetailProjectTableInfo.columns,\n        data: $setup.sameDetailProjectTableInfo.data,\n        \"default-expand-all-rows\": true,\n        bordered: {\n          cell: true\n        },\n        \"column-resizable\": \"\",\n        \"expanded-keys\": $setup.sameDetailProjectTableInfo.defaultExpandedKeys,\n        scroll: {\n          maxHeight: $setup.sameDetailProjectTableInfo.maxHeight\n        },\n        scrollbar: {\n          x: true,\n          y: 1500\n        },\n        pagination: false,\n        loading: $setup.sameDetailProjectTableInfo.loading,\n        ref: \"sameDetailProjectTableRef\",\n        class: \"m-t-20\",\n        onExpandedChange: $setup.sameDetailProjectTableExpandedChange\n      }, {\n        title: _withCtx(({\n          record\n        }) => [_createVNode(_component_a_popover, {\n          \"content-style\": {\n            background: 'rgba(0,0,0,.8)',\n            color: '#fff'\n          },\n          \"arrow-style\": {\n            background: 'rgba(0,0,0,.8)'\n          }\n        }, {\n          content: _withCtx(() => [_createTextVNode(_toDisplayString(record.title), 1 /* TEXT */)]),\n\n          default: _withCtx(() => [record.leafNode === '1' ? (_openBlock(), _createElementBlock(\"a\", _hoisted_10, _toDisplayString(record.title), 1 /* TEXT */)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_11, _toDisplayString(record.title), 1 /* TEXT */))]),\n\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"content-style\", \"arrow-style\"])]),\n        canvasLine1: _withCtx(({\n          record,\n          column\n        }) => [_createVNode($setup[\"echartContainer\"], {\n          route: $setup.createEchartsRoute(record, column),\n          height: 74,\n          width: 100\n        }, null, 8 /* PROPS */, [\"route\"])]),\n        canvasLine2: _withCtx(({\n          record,\n          column\n        }) => [_createVNode($setup[\"echartContainer\"], {\n          route: $setup.createEchartsRoute(record, column),\n          height: 74,\n          width: 100\n        }, null, 8 /* PROPS */, [\"route\"])]),\n        canvasLine3: _withCtx(({\n          record,\n          column\n        }) => [_createVNode($setup[\"echartContainer\"], {\n          route: $setup.createEchartsRoute(record, column),\n          height: 74,\n          width: 100\n        }, null, 8 /* PROPS */, [\"route\"])]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"columns\", \"data\", \"expanded-keys\", \"scroll\", \"loading\"])], 512 /* NEED_PATCH */), [[_vShow, $setup.raidoGroupType === 'detail']])]),\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"active-key\"])]);\n}","map":{"version":3,"mappings":"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","names":["class","style","href","_createElementBlock","_hoisted_1","_createVNode","_component_a_tabs","$setup","onChange","_component_a_tab_pane","key","title","_createCommentVNode","_createElementVNode","_hoisted_2","_component_a_space","size","wrap","_Fragment","columnTabs","item","index","_createBlock","_component_a_tag","color","isShow","onClick","_hoisted_3","_component_a_select","_component_icon_calendar","_component_a_option","value","_hoisted_4","_component_a_table","columns","data","bordered","cell","defaultExpandedKeys","scroll","maxHeight","scrollbar","x","y","pagination","loading","ref","onExpandedChange","projectName","record","_component_a_popover","background","content","_hoisted_5","_hoisted_6","_hoisted_7","_component_a_radio_group","type","_component_a_radio","lastDeptName","deptName","leafNode","_hoisted_8","_hoisted_9","canvasLine1","column","route","height","width","canvasLine2","canvasLine3","_hoisted_10","_hoisted_11"],"sourceRoot":"","sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/src/views/ringAnalyze/projectRingSame.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <a-tabs v-model:active-key=\"tabsActive\" class=\"tabs\" @change=\"handleTab\">\n      <a-tab-pane key=\"1\" title=\"环比分析\" class=\"p-t-10\">\n        <!-- 标签及月份-->\n        <div class=\"flex-between\">\n          <a-space :size=\"['small', 0]\" wrap>\n            <a-tag\n              v-for=\"(item, index) of tabChangeColumInfo.columnTabs\"\n              :key=\"index\"\n              :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n              size=\"large\"\n              class=\"pointer\"\n              @click=\"handleTabChange(item)\"\n            >\n              {{ item.title }}\n            </a-tag>\n          </a-space>\n          <div style=\"position: relative; top: -1px\">\n            <a-select v-model:model-value=\"selectMonth\" @change=\"handleMonthChange\">\n              <a-option value=\"3\">近3个月</a-option>\n              <a-option value=\"6\">近6个月</a-option>\n              <a-option value=\"12\">近12个月</a-option>\n              <template #arrow-icon>\n                <icon-calendar :size=\"16\" />\n              </template>\n            </a-select>\n          </div>\n        </div>\n        <!-- 表格 -->\n        <div class=\"m-t-20\">\n          <a-table\n            :columns=\"tableInfo.columns\"\n            :data=\"tableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"tableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: tableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"tableInfo.loading\"\n            ref=\"tableRef\"\n            @expanded-change=\"expandedChange\"\n          >\n            <template #projectName=\"{ record }\">\n              <a-popover\n                :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n              >\n                <span class=\"pointer\">{{ record.projectName }}</span>\n                <template #content>\n                  {{ record.projectName }}\n                </template>\n              </a-popover>\n            </template>\n          </a-table>\n        </div>\n      </a-tab-pane>\n      <a-tab-pane key=\"2\" title=\"同比分析\" class=\"p-t-10\">\n        <div class=\"flex-between\">\n            <a-space :size=\"['small', 0]\" wrap>\n              <a-tag\n                v-for=\"(item, index) of allTableList\"\n                :key=\"index\"\n                :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n                size=\"large\"\n                class=\"pointer\"\n                @click=\"handleSameContrastTabChange(item)\"\n              >\n                {{ item.title }}\n              </a-tag>\n            </a-space>\n            <div style=\"position: relative; top: -1px\">\n              <a-radio-group v-model:model-value=\"raidoGroupType\" type=\"button\" @change=\"constructSameTabChange\">\n                <a-radio value=\"total\">汇总</a-radio>\n                <a-radio value=\"detail\">明细</a-radio>\n              </a-radio-group>\n            </div>\n          </div>\n          <div v-show=\"raidoGroupType === 'total'\">\n            <a-table\n              :columns=\"sameTotalProjectTableInfo.columns\"\n              :data=\"sameTotalProjectTableInfo.data\"\n              :default-expand-all-rows=\"true\"\n              :bordered=\"{ cell: true }\"\n              column-resizable\n              :expanded-keys=\"sameTotalProjectTableInfo.defaultExpandedKeys\"\n              :scroll=\"{ maxHeight: sameTotalProjectTableInfo.maxHeight }\"\n              :scrollbar=\"{ x: true, y: 1500 }\"\n              :pagination=\"false\"\n              :loading=\"sameTotalProjectTableInfo.loading\"\n              ref=\"sameTotalProjectTableRef\"\n              class=\"m-t-20\"\n              @expanded-change=\"projectTableExpandedChange\"\n            >\n              <template #lastDeptName=\"{ record }\">\n                <a-popover\n                  :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                  :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n                >\n                <a href=\"javaScript:void(0)\" v-if=\"record.leafNode === '1'\" style=\"color: #165dff\">\n                  {{ record.lastDeptName }}\n                </a>\n                <span class=\"pointer\" v-else>{{ record.lastDeptName }}</span>\n                  <template #content>\n                    {{ record.deptName }}\n                  </template>\n                </a-popover>\n              </template>\n              <template #canvasLine1=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine2=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine3=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n            </a-table>\n          </div>\n          <div v-show=\"raidoGroupType === 'detail'\">\n            <a-table\n              :columns=\"sameDetailProjectTableInfo.columns\"\n              :data=\"sameDetailProjectTableInfo.data\"\n              :default-expand-all-rows=\"true\"\n              :bordered=\"{ cell: true }\"\n              column-resizable\n              :expanded-keys=\"sameDetailProjectTableInfo.defaultExpandedKeys\"\n              :scroll=\"{ maxHeight: sameDetailProjectTableInfo.maxHeight }\"\n              :scrollbar=\"{ x: true, y: 1500 }\"\n              :pagination=\"false\"\n              :loading=\"sameDetailProjectTableInfo.loading\"\n              ref=\"sameDetailProjectTableRef\"\n              class=\" m-t-20\"\n              @expanded-change=\"sameDetailProjectTableExpandedChange\"\n            >\n              <template #title=\"{ record }\">\n                <a-popover\n                  :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                  :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n                >\n                <a href=\"javaScript:void(0)\" v-if=\"record.leafNode === '1'\" style=\"color: #165dff\">\n                  {{ record.title }}\n                </a>\n                <span class=\"pointer\" v-else>{{ record.title }}</span>\n                  <template #content>\n                    {{ record.title }}\n                  </template>\n                </a-popover>\n              </template>\n              <template #canvasLine1=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine2=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine3=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n            </a-table>\n          </div>\n      </a-tab-pane>\n    </a-tabs>\n  </div>\n</template>\n\n<script setup>\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw,shallowRef } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getProjectRingList,getProjectYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo, dataAddKey, getRedNum,getCurrentTime } from \"../../utils/util\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { useRoute,useRouter } from \"vue-router\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\nconst route = useRoute();\nconst router = useRouter()\nlet {customerId,deptId,deptName,groupCustomerName,title,tab ,radiotype} = route.query;\nlet tagColumnList = useTagColumnListStore();\nconst tabsActive = ref(tab||'1');\nlet { year, month } = getCurrentTime();\nlet lastYear = year-1\nlet lastMonth = month-1\nlet columConfig = {};\nconst tableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"200px\",\n  loading: false,\n});\nconst selectMonth = ref(\"3\");\nconst tableRef = ref(null);\nconst tabChangeColumInfo = reactive({\n  columnTabs: [],\n  up: [],\n  down: [],\n});\nconst chartColumMap = {\n  发薪人数: [],\n  营业收入: [],\n  销售毛利率: [],\n};\nconst chartColumnNameMap = {\n  canvasLine1: \"发薪人数\",\n  canvasLine2: \"营业收入\",\n  canvasLine3: \"销售毛利率\",\n};\nlet filterShowChildrenColumn = [];\n// 切换环比分析和同比分析\nconst handleTab = val => {\n  tabsActive.value = val;\n};\nonMounted(() => {\n  if (tableRef.value) {\n    let head = tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\n// 初始化\nconst seltColumns = () => {\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n  if (currentPageColumn.length) {\n    currentPageColumn[0].tier.forEach((item, index) => {\n      let tabs = [];\n      let columnTabs = [];\n      let columnHasSonTabs = [];\n      let noHiddenColumn = [];\n      let defaultColumHasSonTabs = [];\n      let defaultColumnTabs = [];\n      item.tags.forEach(jtem => {\n        tabs.push(jtem.tag);\n        jtem.columns.forEach(ktem => {\n          let { col, conf, title } = ktem;\n          conf = conf || {};\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: { \"text-align\": conf.cellAlign },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            fixed : conf.fixed\n          };\n          columnItemConfig.isShow = conf.isShow;\n          columnItemConfig.render = ({ record, column }) => {\n            let cellVal = record[column.dataIndex];\n            if (!Array.isArray(cellVal)) {\n              if (cellVal !== null && cellVal !== undefined) {\n                return <span innerHTML={getRedNum(cellVal)}></span>;\n              }\n            } else {\n              if (chartColumMap[chartColumnNameMap[column.dataIndex]] !== undefined) {\n                let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n                  tip: item.month + record[item.col],\n                  value: cellVal[i],\n                }));\n                return <echartContainer route={route} height={74} width={100} />;\n              }\n            }\n          };\n          if (conf.canHide === 1) {\n            if (conf.parentCol === 0) {\n              columnTabs.push(columnItemConfig);\n            } else {\n              columnHasSonTabs.push(columnItemConfig);\n            }\n          } else {\n            noHiddenColumn.push(columnItemConfig);\n          }\n          if (conf.parentCol === 1) {\n            defaultColumHasSonTabs.push(columnItemConfig);\n          } else {\n            defaultColumnTabs.push(columnItemConfig);\n          }\n        });\n      });\n      columConfig[\"level\" + (index + 1)] = {\n        tabs,\n        params: item.params || [],\n        columnTabs,\n        columnHasSonTabs,\n        noHiddenColumn,\n        defaultColumnTabs,\n        defaultColumHasSonTabs,\n      };\n    });\n  }\n  tabChangeColumInfo.columnTabs = columConfig.level3.columnHasSonTabs;\n};\n// 更换表头\nconst analysiisColumn = () => {\n  let { columnTabs, noHiddenColumn, defaultColumHasSonTabs } = columConfig.level3;\n  let num = 5;\n  switch (selectMonth.value) {\n    case \"3\":\n      let months1 = getNMonthsAgo(3, true);\n      let children1 = [];\n      let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months1.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children1.push(columnHasSonConfig);\n      });\n      num = 5;\n      filterShowChildrenColumn = children1;\n      break;\n    case \"6\":\n      let months2 = getNMonthsAgo(6, true);\n      let children2 = [];\n      let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months2.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children2.push(columnHasSonConfig);\n      });\n      num = 5;\n      filterShowChildrenColumn = children2;\n      break;\n    case \"12\":\n      let months3 = getNMonthsAgo(12, true);\n      months3 = months3.filter(item=>item[0]!==2022)\n      let children3 = [];\n      let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months3.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children3.push(columnHasSonConfig);\n      });\n      num = 5;\n      filterShowChildrenColumn = children3;\n      break;\n    default:\n      break;\n  }\n  Object.keys(chartColumMap).forEach(key => {\n    chartColumMap[key] = [];\n  });\n  filterShowChildrenColumn.forEach(item => {\n    if (item.children?.length) {\n      let filterShowColumns = [];\n      item.children.forEach(jtem => {\n        if (jtem.isShow === 1) {\n          filterShowColumns.push(jtem);\n        }\n        if (chartColumMap.hasOwnProperty(jtem.title)) {\n          chartColumMap[jtem.title].push({\n            month: item.title,\n            col: jtem.dataIndex,\n          });\n        }\n      });\n      item.children = filterShowColumns;\n    }\n  });\n  Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goRingContrastChart(record,'project')}}>看图</a>\n    }\n  }\n  let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn,actionColumn];\n  tableInfo.columns = filterAllShowColumn;\n};\n//部门折叠\nconst expandedChange = rowKeys => {\n  tableInfo.defaultExpandedKeys = rowKeys;\n};\n// 切换时间区间\nconst handleMonthChange = month => {\n  selectMonth.value = month;\n  analysiisColumn();\n  getList();\n};\nonBeforeMount(() => {\n  seltColumns();\n  analysiisColumn();\n  getList();\n  initTotalColumns();\n  $bus.emit(\"updateStructure\", [\n    { type: \"text\", color: \"#333\", msg: '环比分析列表' },\n    {\n        type: \"button\",\n        color: \"#5370FD\",\n        msg: deptName,\n        isBack : true\n    },\n    { type: \"text\", color: \"#333\", msg: `${groupCustomerName}-${title}` },\n  ]);\n});\n// 点击标签\nconst handleTabChange = tab => {\n  switch (tab.isShow) {\n    case 0:\n      tab.isShow = 1;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 1,\n        tab,\n      });\n      break;\n    case 1:\n      tab.isShow = 0;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 0,\n        tab,\n      });\n      break;\n    default:\n      break;\n  }\n};\n// 更改高亮状态并更换表头\nconst changeShowStatus = obj => {\n  let { columnTabs, defaultColumHasSonTabs } = columConfig.level3;\n  let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n    return;\n  }\n  if (obj.type === \"parent\") {\n    columnTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  if (obj.type === \"self\") {\n    defaultColumHasSonTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  analysiisColumn();\n  handleAbortRequest();\n  getList();\n};\n// 处理趋势数据\nconst construcLine = arr => {\n  arr.forEach(item => {\n    item.colNo3 = JSON.parse(item.colNo3);\n    item.colNo4 = JSON.parse(item.colNo4);\n    item.colNo5 = JSON.parse(item.colNo5);\n    if (item.children) {\n      construcLine(item.children);\n    }\n  });\n};\n// 获取列表数据\nconst getList = () => {\n  tableInfo.data = [];\n  tableInfo.loading = true;\n  let arr = [];\n  var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n  const mappings = {\n    发薪人数: \"colNo1\",\n    营业收入: \"colNo2\",\n    销售毛利: \"colNo3\",\n    销售毛利率: \"colNo4\",\n    直接成本: \"colNo5\",\n    人均营业收入: \"colNo6\",\n    人均直接成本: \"colNo7\",\n    未完工项目成本: \"colNo8\",\n    招聘费用: \"colNo9\",\n    销售费用: \"colNo10\",\n    管理费用: \"colNo11\",\n  };\n  newColumns.forEach(item => {\n    if (mappings[item.title]) {\n      arr.push(mappings[item.title]);\n    }\n    if (item.children) {\n      item.children.forEach(jtem => {\n        if (mappings[jtem.title]) {\n          arr.push(mappings[jtem.title]);\n        }\n      });\n    }\n  });\n  const params = {\n    interval: Number(selectMonth.value),\n    dynamicHeaderParam: Array.from(new Set(arr)),\n    xAxis: 50,\n    yAxis: 20,\n    tagKey: \"linkAnalysis3\",\n    customerId: customerId,\n  };\n  getProjectRingList(params)\n    .then(res => {\n      if (res.code == \"200\") {\n        construcLine(res.data);\n        let data = dataAddKey(res.data, \"key\", \"title\");\n        let keys = [];\n        res.data.forEach(item => keys.push(item.title));\n        tableInfo.defaultExpandedKeys = keys;\n        tableInfo.data = data;\n      } else {\n        Message.error(res.message);\n      }\n      tableInfo.loading = false;\n    })\n    .catch(err => {\n      if (err?.code === \"ERR_CANCELED\") {\n        tableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        tableInfo.loading = false;\n      }\n    });\n};\n\n//跳转环比分析看图页\nconst goRingContrastChart = (record,type)=>{\n  router.push({\n    name : 'ringContrastChart',\n    state : {\n      deptName,\n      interval:selectMonth.value,\n      deptId,\n      title,\n      customerName : record.customerName,\n      projectName : record.projectName,\n      sourceType : type,\n      projectId : record.finPcode,\n      taxRate : record.taxRate,\n    }\n  })\n}\n\n// 同比分析点击标签\nconst handleSameContrastTabChange = value => {\n  value.isShow = value.isShow === 0 ? 1 : 0;\n  let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    value.isShow = value.isShow === 0 ? 1 : 0;\n    return;\n  }\n  handleAbortRequest()\n  if (raidoGroupType.value === \"total\") {\n    constructSameTotalColumns(allHeadTagList.value);\n  } else {\n    constructSameDetailColumns(allHeadTagList.value);\n  }\n};\n// 更改汇总/明细\nconst constructSameTabChange = value => {\n  raidoGroupType.value = value;\n  initTotalColumns();\n};\n\n\n//同比分析\nconst allTableList = ref([]); // 表头数据\nconst raidoGroupType = ref(radiotype || 'total')\nconst allHeadTagList = ref([]); // 所有的标签\nconst notShowList = shallowRef([]); // 初始没显示的表头数据\n//同比分析项目维度汇总表格数据\nconst sameTotalProjectTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n})\nconst sameTotalProjectTableRef = ref(null) //同比汇总项目维度表格dom\n//同比分析项目维度汇总展开/折叠\nconst projectTableExpandedChange = rowKeys => {\n  sameTotalProjectTableInfo.defaultExpandedKeys = rowKeys;\n};\n// 初始化表头和标签数据\nconst initTotalColumns = () => {\n  allHeadTagList.value = [];\n  allTableList.value = [];\n  notShowList.value = [];\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n  if (currentPageColumn.length) {\n    const currentColumnList = currentPageColumn[0].tier[2].tags[0].columns;\n    currentColumnList.forEach(item => {\n      const { col, conf, title } = item;\n      let columnItemConfig = {\n        title,\n        dataIndex: col,\n        align: conf.align,\n        cellStyle: { \"text-align\": conf.cellAlign },\n        width: conf.width,\n        ellipsis: true,\n        headerCellClass: \"noEllipsis\",\n        slotName: col,\n        bodyCellClass: \"bodyCell\",\n        isShow: conf.isShow,\n      };\n      if (conf.canHide == 1) {\n        allHeadTagList.value.push(columnItemConfig);\n      } else {\n        notShowList.value.push(columnItemConfig);\n      }\n      if(conf.fixed !== undefined){\n        columnItemConfig.fixed = conf.fixed\n      }\n      if (conf.parentCol == 1) {\n        allTableList.value.push(columnItemConfig);\n      }\n    });\n    if (raidoGroupType.value == \"total\") {\n      constructSameTotalColumns(allHeadTagList.value);\n    } else {\n      constructSameDetailColumns(allHeadTagList.value);\n    }\n  }\n};\n// 构造同比汇总的表头\nconst constructSameTotalColumns = list => {\n  let tableList = list.filter(item => item.isShow === 1);\n  let createColumns = []\n  let childrenColumns = [\n        {\n          title: lastYear + \"/1-12\",\n        },\n        {\n          title: lastYear + `/1-${lastMonth}`,\n        },\n        {\n          title: year + `/1-${lastMonth}`,\n        },\n        {\n          title: \"同比\",\n        },\n  ]\n  let colNo = 6\n  tableList.forEach(item => {\n    let columnConfig = {\n      title : item.title,\n      children : childrenColumns.map((jtem,i)=>{\n        let childrenColumnItemConfig = {\n          title : jtem.title,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: 110,\n          cellStyle: {textAlign : 'right'},\n        }\n        if(i === (childrenColumns.length -1)){\n          childrenColumnItemConfig.title = item.title.endsWith('率')?'偏离':jtem.title\n        }\n        colNo++\n        return childrenColumnItemConfig\n      })\n    }\n    createColumns.push(columnConfig)\n  });\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'project')}}>看图</a>\n    }\n  }\n  sameTotalProjectTableInfo.columns = [...notShowList.value,...createColumns,actionColumn]\n  getProjectYoyAnalysisList('1')\n};\n\n// 同比明细项目维度表格数据\nconst sameDetailProjectTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n})\nconst sameDetailProjectTableRef = ref(null) //同比明细项目维度表格dom\n\n//同比明细项目维度展开/折叠\nconst sameDetailProjectTableExpandedChange = rowKeys => {\n  sameDetailProjectTableInfo.defaultExpandedKeys = rowKeys;\n};\n// 构造同比明细的表头结构\nconst constructSameDetailColumns = list => {\n  const timeData = [];\n  let activeTableList = list.filter(item => item.isShow === 1);\n  if (month == 1) {\n    for (var i = 1; i <= 12; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  } else {\n    for (var i = 1; i <= lastMonth; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  }\n  const years = [lastYear, year];\n  let colNo = 6\n  timeData.forEach(item=>{\n    let childrenColumns = []\n    activeTableList.forEach(jtem=>{\n      years.forEach(ktem=>{\n        let contrastColumnConfig = {\n          title: `${jtem.title}${ktem}`,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: jtem.width,\n          cellStyle: toRaw(jtem.cellStyle),\n        }\n        childrenColumns.push(contrastColumnConfig)\n        colNo++\n      })\n    })\n    item.children = childrenColumns\n  })\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'project')}}>看图</a>\n    }\n  }\n  sameDetailProjectTableInfo.columns = [...notShowList.value,...timeData,actionColumn]\n  getProjectYoyAnalysisList('2')\n};\n\n//同比分析项目维度接口\nconst getProjectYoyAnalysisList = (type)=>{\n  let params = {\n    interval:lastMonth == 0? 12 : lastMonth,\n    dynamicHeaderParam:allTableList.value.filter(item=>item.isShow ===1).map(item=>item.dataIndex),\n    xAxis:74,\n    yAxis:100,\n    tagKey:\"yoyAnalysis3\",\n    customerId,\n    type \n  }\n  raidoGroupType.value === 'total'?sameTotalProjectTableInfo.loading = true:sameDetailProjectTableInfo.loading = true;\n  getProjectYoyAnalysis(params).then(res=>{\n    if(res.code === '200'){\n      dataAddKey(res.data,'key','deptId')\n      let expandKeys = []\n      res.data.forEach(item=>expandKeys.push(item.key))\n      if(raidoGroupType.value === 'total'){\n        sameTotalProjectTableInfo.defaultExpandedKeys = expandKeys\n        sameTotalProjectTableInfo.data = res.data\n        //计算表格不出滚动条的最大高度\n        if(sameTotalProjectTableInfo.maxHeight === '600px'){\n          nextTick(() => {\n                if (sameTotalProjectTableRef.value) {\n                let head = sameTotalProjectTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameTotalProjectTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n        }\n      }\n      if(raidoGroupType.value === 'detail'){\n        sameDetailProjectTableInfo.defaultExpandedKeys = expandKeys\n        sameDetailProjectTableInfo.data = res.data\n        //计算表格不出滚动条的最大高度\n        if(sameDetailProjectTableInfo.maxHeight === '600px'){\n          nextTick(() => {\n                if (sameDetailProjectTableRef.value) {\n                let head = sameDetailProjectTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameDetailProjectTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n        }\n      }\n    }else {\n      Message.error(res.message || '请求数据失败')\n    }\n    if(raidoGroupType.value === 'total'){\n      sameTotalProjectTableInfo.loading = false;\n    }\n    if(raidoGroupType.value === 'detail'){\n      sameDetailProjectTableInfo.loading = false;\n    }\n  }).catch(err=>{\n    if(raidoGroupType.value === 'total'){\n      if (err?.code === \"ERR_CANCELED\") {\n        sameTotalProjectTableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          sameTotalProjectTableInfo.loading = false;\n        }\n      }\n    if(raidoGroupType.value === 'detail'){\n      if (err?.code === \"ERR_CANCELED\") {\n        sameDetailProjectTableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        sameDetailProjectTableInfo.loading = false;\n      }\n    }\n  })\n}\n//跳转同比分析看图页\nconst goLookChat = (record,type)=>{\n  router.push({\n    name : 'lookChart',\n    state : {\n      barChartOptions : JSON.stringify(allHeadTagList.value),\n      deptId,\n      title : groupCustomerName,\n      sourceType:type,\n      taxRate : record.taxRate,\n      projectId : record.finPcode,\n      customerName : record.customerName,\n      projectName : record.projectName,\n      deptName\n    }\n  })\n}\n\n//echarts缩略图的路径信息\nconst createEchartsRoute = (record,column)=>{\n  return record[column.dataIndex].map((item,i)=>({value:record[column.dataIndex][i]}))\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.p-t-10 {\n  padding-top: 10px;\n}\n:deep(.tabs .arco-tabs-nav-type-line .arco-tabs-tab-title) {\n  font-size: 15px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}