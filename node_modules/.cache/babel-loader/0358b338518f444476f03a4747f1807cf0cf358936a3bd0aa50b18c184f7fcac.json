{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { unref as _unref, resolveComponent as _resolveComponent, createVNode as _createVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"defaultPadding\"\n};\nimport { reactive, ref, toRaw, onBeforeMount } from \"vue\";\nimport { useMenuStore } from \"../../store/index\";\nimport { menuListColumns } from \"./constColumns\";\nimport { list, addList, editMenu, delMenu } from \"@/api/menu\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nimport { Message } from \"@arco-design/web-vue\";\nimport TableContainer from \"@/components/tableContainer.vue\";\nexport default {\n  __name: 'menuManage',\n  setup(__props) {\n    let $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\n    const menuStore = useMenuStore();\n    const permissions = menuStore.getPermission;\n    onBeforeMount(() => {\n      $bus.emit(\"updateStructure\", [{\n        type: \"text\",\n        color: \"#333\",\n        msg: \"菜单列表\"\n      }]);\n    });\n    // 表格配置信息\n    const dataContent = reactive({\n      columns: menuListColumns,\n      dataSource: [],\n      loading: false,\n      pagination: {\n        pageNum: 1,\n        pageSize: 10,\n        total: 0\n      },\n      menuName: \"menu\"\n    });\n    const addMenuModal = ref(false);\n    const form = reactive({\n      type: \"\",\n      name: \"\",\n      parentId: \"\",\n      url: \"\",\n      perms: \"\",\n      sort: undefined,\n      icon: \"\"\n    });\n    const menuId = ref(\"\");\n    const casList = ref([]);\n    const treeData = arr => {\n      const treeArr = [];\n      arr.forEach(item => {\n        let obj = {\n          label: item.name,\n          value: item.id\n        };\n        if (item.children && item.children.length) {\n          obj.children = treeData(item.children);\n          treeArr.push(obj);\n        } else {\n          treeArr.push(obj);\n        }\n      });\n      return treeArr;\n    };\n    // 获取列表数据\n    const getList = () => {\n      list().then(res => {\n        if (res.code === \"000000000000\") {\n          let arr = [];\n          res.data.forEach(item => {\n            item.children = [];\n            item.key = item.id;\n            if (item.parentId === \"000000\") {\n              arr.push(item);\n            }\n            res.data.forEach(val => {\n              if (val.parentId === item.id) {\n                item.children.push(val);\n              }\n            });\n          });\n          dataContent.dataSource = arr;\n          dataContent.pagination.total = Number(dataContent.dataSource.length);\n          casList.value = [{\n            label: \"一级菜单\",\n            value: \"000000\",\n            children: treeData(arr.slice())\n          }];\n        }\n      });\n    };\n    getList();\n    // 更改当前页码\n    const paginationCurrentChange = current => {\n      dataContent.pagination.pageNum = current;\n      getList();\n    };\n    // 更改页容量\n    const paginationPageSizeChange = pageSize => {\n      dataContent.pagination.pageSize = pageSize;\n      getList();\n    };\n    // 添加菜单\n    const handleAddMenu = () => {\n      addMenuModal.value = true;\n      form.type = \"\", form.name = \"\", form.parentId = \"\", form.url = \"\", form.perms = \"\", form.sort = undefined, form.icon = \"\";\n    };\n    // 编辑\n    const handleEditMenu = record => {\n      addMenuModal.value = true;\n      menuId.value = record.id;\n      form.type = record.type, form.name = record.name, form.parentId = record.parentId, form.url = record.url, form.perms = record.perms, form.sort = record.sort, form.icon = record.icon;\n    };\n    // 删除\n    const handleDeleteMenu = record => {\n      delMenu(record).then(res => {\n        if (res.code === \"000000000000\") {\n          Message.success(\"删除成功\");\n          getList();\n          $bus.emit(\"updateMenu\");\n          menuStore.menuSideBar().then(() => {\n            Message.success(\"菜单已更新\");\n          });\n        } else {\n          Message.error(res.message);\n        }\n      });\n    };\n    // 添加菜单 确定\n    const handleFormOk = () => {\n      let values = toRaw(form);\n      values.id = menuId.value;\n      if (menuId.value === \"\") {\n        addList(values).then(res => {\n          if (res.code === \"000000000000\") {\n            Message.success(\"新建成功!\");\n            getList();\n            $bus.emit(\"updateMenu\");\n          } else {\n            Message.error(res.message);\n          }\n        });\n      } else {\n        editMenu(values).then(res => {\n          if (res.code === \"000000000000\") {\n            Message.success(\"更新成功!\");\n            getList();\n            $bus.emit(\"updateMenu\");\n          } else {\n            Message.error(res.message);\n          }\n        });\n        menuId.value = \"\";\n      }\n      menuStore.menuSideBar().then(() => {\n        Message.success(\"菜单已更新\");\n      });\n    };\n    return (_ctx, _cache) => {\n      const _component_icon_plus = _resolveComponent(\"icon-plus\");\n      const _component_a_button = _resolveComponent(\"a-button\");\n      const _component_a_radio = _resolveComponent(\"a-radio\");\n      const _component_a_radio_group = _resolveComponent(\"a-radio-group\");\n      const _component_a_form_item = _resolveComponent(\"a-form-item\");\n      const _component_a_input = _resolveComponent(\"a-input\");\n      const _component_a_cascader = _resolveComponent(\"a-cascader\");\n      const _component_a_input_number = _resolveComponent(\"a-input-number\");\n      const _component_a_form = _resolveComponent(\"a-form\");\n      const _component_a_modal = _resolveComponent(\"a-modal\");\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_unref(permissions).includes('menu:add') ? (_openBlock(), _createBlock(_component_a_button, {\n        key: 0,\n        type: \"primary\",\n        onClick: handleAddMenu\n      }, {\n        icon: _withCtx(() => [_createVNode(_component_icon_plus)]),\n        default: _withCtx(() => [_createTextVNode(\"添加菜单\")]),\n        _: 1\n      })) : _createCommentVNode(\"\", true), _createVNode(TableContainer, {\n        class: \"m-t-20\",\n        \"column-resizable\": \"\",\n        scroll: {\n          y: 600\n        },\n        scrollbar: false,\n        paginationTotal: dataContent.pagination.total,\n        paginationPageSize: dataContent.pagination.pageSize,\n        paginationCurrent: dataContent.pagination.pageNum,\n        loading: dataContent.loading,\n        tableColumns: dataContent.columns,\n        \"table-data\": dataContent.dataSource,\n        \"menu-name\": dataContent.menuName,\n        onHandleEdit: handleEditMenu,\n        onHandleDeleteMenu: handleDeleteMenu,\n        onPaginationCurrentChange: paginationCurrentChange,\n        onPaginationPageSizeChange: paginationPageSizeChange\n      }, null, 8, [\"paginationTotal\", \"paginationPageSize\", \"paginationCurrent\", \"loading\", \"tableColumns\", \"table-data\", \"menu-name\"]), _createVNode(_component_a_modal, {\n        mask: true,\n        visible: addMenuModal.value,\n        \"onUpdate:visible\": _cache[7] || (_cache[7] = $event => addMenuModal.value = $event),\n        title: \"添加菜单\",\n        onOk: handleFormOk\n      }, {\n        default: _withCtx(() => [_createVNode(_component_a_form, {\n          model: form\n        }, {\n          default: _withCtx(() => [_createVNode(_component_a_form_item, {\n            field: \"类型\",\n            label: \"类型\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_a_radio_group, {\n              modelValue: form.type,\n              \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => form.type = $event)\n            }, {\n              default: _withCtx(() => [_createVNode(_component_a_radio, {\n                value: 0\n              }, {\n                default: _withCtx(() => [_createTextVNode(\"目录\")]),\n                _: 1\n              }), _createVNode(_component_a_radio, {\n                value: 1\n              }, {\n                default: _withCtx(() => [_createTextVNode(\"菜单\")]),\n                _: 1\n              }), _createVNode(_component_a_radio, {\n                value: 2\n              }, {\n                default: _withCtx(() => [_createTextVNode(\"按钮\")]),\n                _: 1\n              })]),\n              _: 1\n            }, 8, [\"modelValue\"])]),\n            _: 1\n          }), _createVNode(_component_a_form_item, {\n            field: \"菜单名称\",\n            label: \"菜单名称\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_a_input, {\n              type: \"text\",\n              placeholder: \"请输入菜单名称\",\n              modelValue: form.name,\n              \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => form.name = $event)\n            }, null, 8, [\"modelValue\"])]),\n            _: 1\n          }), _createVNode(_component_a_form_item, {\n            field: \"上级菜单\",\n            label: \"上级菜单\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_a_cascader, {\n              modelValue: form.parentId,\n              \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => form.parentId = $event),\n              options: casList.value,\n              expandTrigger: 'hover',\n              \"check-strictly\": \"\",\n              placeholder: \"请选择上级菜单\"\n            }, null, 8, [\"modelValue\", \"options\"])]),\n            _: 1\n          }), _createVNode(_component_a_form_item, {\n            field: \"菜单URL\",\n            label: \"菜单URL\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_a_input, {\n              type: \"text\",\n              placeholder: \"请输入菜单路径\",\n              modelValue: form.url,\n              \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => form.url = $event)\n            }, null, 8, [\"modelValue\"])]),\n            _: 1\n          }), _createVNode(_component_a_form_item, {\n            field: \"授权标识\",\n            label: \"授权标识\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_a_input, {\n              type: \"text\",\n              placeholder: \"请输入授权标识\",\n              modelValue: form.perms,\n              \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => form.perms = $event)\n            }, null, 8, [\"modelValue\"])]),\n            _: 1\n          }), _createVNode(_component_a_form_item, {\n            field: \"排序号\",\n            label: \"排序号\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_a_input_number, {\n              placeholder: \"请输入排序号\",\n              modelValue: form.sort,\n              \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => form.sort = $event)\n            }, null, 8, [\"modelValue\"])]),\n            _: 1\n          }), _createVNode(_component_a_form_item, {\n            field: \"图标\",\n            label: \"图标\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_a_input, {\n              type: \"text\",\n              placeholder: \"请输入图标\",\n              modelValue: form.icon,\n              \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => form.icon = $event)\n            }, null, 8, [\"modelValue\"])]),\n            _: 1\n          })]),\n          _: 1\n        }, 8, [\"model\"])]),\n        _: 1\n      }, 8, [\"visible\"])]);\n    };\n  }\n};","map":{"version":3,"mappings":"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","names":["reactive","ref","toRaw","onBeforeMount","useMenuStore","menuListColumns","list","addList","editMenu","delMenu","getCurrentInstance","Message","TableContainer","$bus","appContext","config","globalProperties","menuStore","permissions","getPermission","emit","type","color","msg","dataContent","columns","dataSource","loading","pagination","pageNum","pageSize","total","menuName","addMenuModal","form","name","parentId","url","perms","sort","undefined","icon","menuId","casList","treeData","arr","treeArr","forEach","item","obj","label","value","id","children","length","push","getList","then","res","code","data","key","val","Number","slice","paginationCurrentChange","current","paginationPageSizeChange","handleAddMenu","handleEditMenu","record","handleDeleteMenu","success","menuSideBar","error","message","handleFormOk","values"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/src/views/system/menuManage.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <!-- 添加菜单 -->\n    <a-button type=\"primary\" v-if=\"permissions.includes('menu:add')\" @click=\"handleAddMenu\">\n      <template #icon>\n        <icon-plus />\n      </template>\n      <template #default>添加菜单</template>\n    </a-button>\n    <!-- 表格内容 -->\n    <TableContainer\n      class=\"m-t-20\"\n      column-resizable\n      :scroll=\"{ y: 600 }\"\n      :scrollbar=\"false\"\n      :paginationTotal=\"dataContent.pagination.total\"\n      :paginationPageSize=\"dataContent.pagination.pageSize\"\n      :paginationCurrent=\"dataContent.pagination.pageNum\"\n      :loading=\"dataContent.loading\"\n      :tableColumns=\"dataContent.columns\"\n      :table-data=\"dataContent.dataSource\"\n      :menu-name=\"dataContent.menuName\"\n      @handleEdit=\"handleEditMenu\"\n      @handleDeleteMenu=\"handleDeleteMenu\"\n      @paginationCurrentChange=\"paginationCurrentChange\"\n      @paginationPageSizeChange=\"paginationPageSizeChange\"\n    ></TableContainer>\n    <!-- 添加菜单表单 -->\n    <a-modal :mask=\"true\" v-model:visible=\"addMenuModal\" title=\"添加菜单\" @ok=\"handleFormOk\">\n      <a-form :model=\"form\">\n        <a-form-item field=\"类型\" label=\"类型\">\n          <a-radio-group v-model=\"form.type\">\n            <a-radio :value=\"0\">目录</a-radio>\n            <a-radio :value=\"1\">菜单</a-radio>\n            <a-radio :value=\"2\">按钮</a-radio>\n          </a-radio-group>\n        </a-form-item>\n        <a-form-item field=\"菜单名称\" label=\"菜单名称\">\n          <a-input type=\"text\" placeholder=\"请输入菜单名称\" v-model=\"form.name\"></a-input>\n        </a-form-item>\n        <a-form-item field=\"上级菜单\" label=\"上级菜单\">\n          <a-cascader\n            v-model=\"form.parentId\"\n            :options=\"casList\"\n            :expandTrigger=\"'hover'\"\n            check-strictly\n            placeholder=\"请选择上级菜单\"\n          />\n        </a-form-item>\n        <a-form-item field=\"菜单URL\" label=\"菜单URL\">\n          <a-input type=\"text\" placeholder=\"请输入菜单路径\" v-model=\"form.url\"></a-input>\n        </a-form-item>\n        <a-form-item field=\"授权标识\" label=\"授权标识\">\n          <a-input type=\"text\" placeholder=\"请输入授权标识\" v-model=\"form.perms\"></a-input>\n        </a-form-item>\n        <a-form-item field=\"排序号\" label=\"排序号\">\n          <a-input-number placeholder=\"请输入排序号\" v-model=\"form.sort\"></a-input-number>\n        </a-form-item>\n        <a-form-item field=\"图标\" label=\"图标\">\n          <a-input type=\"text\" placeholder=\"请输入图标\" v-model=\"form.icon\"></a-input>\n        </a-form-item>\n      </a-form>\n    </a-modal>\n  </div>\n</template>\n\n<script setup>\nimport { reactive, ref, toRaw, onBeforeMount } from \"vue\";\nimport { useMenuStore } from \"../../store/index\";\nimport { menuListColumns } from \"./constColumns\";\nimport { list, addList, editMenu, delMenu } from \"@/api/menu\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nimport { Message } from \"@arco-design/web-vue\";\nimport TableContainer from \"@/components/tableContainer.vue\";\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\nconst menuStore = useMenuStore()\nconst permissions = menuStore.getPermission;\nonBeforeMount(() => {\n  $bus.emit(\"updateStructure\", [{ type: \"text\", color: \"#333\", msg: \"菜单列表\" }]);\n});\n// 表格配置信息\nconst dataContent = reactive({\n  columns: menuListColumns,\n  dataSource: [],\n  loading: false,\n  pagination: {\n    pageNum: 1,\n    pageSize: 10,\n    total: 0,\n  },\n  menuName: \"menu\",\n});\nconst addMenuModal = ref(false);\nconst form = reactive({\n  type: \"\",\n  name: \"\",\n  parentId: \"\",\n  url: \"\",\n  perms: \"\",\n  sort: undefined,\n  icon: \"\",\n});\nconst menuId = ref(\"\");\nconst casList = ref([]);\nconst treeData = arr => {\n  const treeArr = [];\n  arr.forEach(item => {\n    let obj = { label: item.name, value: item.id };\n    if (item.children && item.children.length) {\n      obj.children = treeData(item.children);\n      treeArr.push(obj);\n    } else {\n      treeArr.push(obj);\n    }\n  });\n  return treeArr;\n};\n// 获取列表数据\nconst getList = () => {\n  list().then(res => {\n    if (res.code === \"000000000000\") {\n      let arr = [];\n      res.data.forEach(item => {\n        item.children = [];\n        item.key = item.id;\n        if (item.parentId === \"000000\") {\n          arr.push(item);\n        }\n        res.data.forEach(val => {\n          if (val.parentId === item.id) {\n            item.children.push(val);\n          }\n        });\n      });\n      dataContent.dataSource = arr;\n      dataContent.pagination.total = Number(dataContent.dataSource.length);\n      casList.value = [\n        {\n          label: \"一级菜单\",\n          value: \"000000\",\n          children: treeData(arr.slice()),\n        },\n      ];\n    }\n  });\n};\ngetList();\n// 更改当前页码\nconst paginationCurrentChange = current => {\n  dataContent.pagination.pageNum = current;\n  getList();\n};\n// 更改页容量\nconst paginationPageSizeChange = pageSize => {\n  dataContent.pagination.pageSize = pageSize;\n  getList();\n};\n// 添加菜单\nconst handleAddMenu = () => {\n  addMenuModal.value = true;\n  (form.type = \"\"),\n    (form.name = \"\"),\n    (form.parentId = \"\"),\n    (form.url = \"\"),\n    (form.perms = \"\"),\n    (form.sort = undefined),\n    (form.icon = \"\");\n};\n// 编辑\nconst handleEditMenu = record => {\n  addMenuModal.value = true;\n  menuId.value = record.id;\n  (form.type = record.type),\n    (form.name = record.name),\n    (form.parentId = record.parentId),\n    (form.url = record.url),\n    (form.perms = record.perms),\n    (form.sort = record.sort),\n    (form.icon = record.icon);\n};\n// 删除\nconst handleDeleteMenu = record => {\n  delMenu(record).then(res => {\n    if (res.code === \"000000000000\") {\n      Message.success(\"删除成功\");\n      getList();\n      $bus.emit(\"updateMenu\");\n      menuStore.menuSideBar().then(()=>{\n        Message.success(\"菜单已更新\");\n      })\n    } else {\n      Message.error(res.message);\n    }\n  });\n};\n// 添加菜单 确定\nconst handleFormOk = () => {\n  let values = toRaw(form);\n  values.id = menuId.value;\n  if (menuId.value === \"\") {\n    addList(values).then(res => {\n      if (res.code === \"000000000000\") {\n        Message.success(\"新建成功!\");\n        getList();\n        $bus.emit(\"updateMenu\");\n      } else {\n        Message.error(res.message);\n      }\n    });\n  } else {\n    editMenu(values).then(res => {\n      if (res.code === \"000000000000\") {\n        Message.success(\"更新成功!\");\n        getList();\n        $bus.emit(\"updateMenu\");\n      } else {\n        Message.error(res.message);\n      }\n    });\n    menuId.value = \"\";\n  }\n  menuStore.menuSideBar().then(()=>{\n    Message.success(\"菜单已更新\");\n  })\n};\n</script>\n\n<style lang=\"scss\">\n.m-t-20 {\n  margin-top: 20px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}