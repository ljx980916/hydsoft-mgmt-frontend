{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport NP from \"number-precision\";\nimport { NOOP } from \"../_utils/dom.js\";\nimport { isFunction, isArray } from \"../_utils/is.js\";\nconst getResponse = xhr => {\n  const res = xhr.responseText || xhr.response;\n  if (!res) {\n    return void 0;\n  }\n  const contentType = xhr.getResponseHeader(\"Content-Type\");\n  if (contentType && contentType.includes(\"json\")) {\n    try {\n      return JSON.parse(res);\n    } catch {\n      return res;\n    }\n  }\n  return res;\n};\nconst getProgressStatus = status => {\n  switch (status) {\n    case \"done\":\n      return \"success\";\n    case \"error\":\n      return \"danger\";\n    default:\n      return \"normal\";\n  }\n};\nconst getValue = (obj, fileItem) => {\n  if (isFunction(obj)) {\n    return obj(fileItem);\n  }\n  return obj;\n};\nconst uploadRequest = ({\n  fileItem,\n  action,\n  name: originName,\n  data: originData,\n  headers = {},\n  withCredentials = false,\n  onProgress = NOOP,\n  onSuccess = NOOP,\n  onError = NOOP\n}) => {\n  const name = getValue(originName, fileItem) || \"file\";\n  const data = getValue(originData, fileItem);\n  const xhr = new XMLHttpRequest();\n  if (withCredentials) {\n    xhr.withCredentials = true;\n  }\n  xhr.upload.onprogress = e => {\n    const percent = e.total > 0 ? NP.round(e.loaded / e.total, 2) : 0;\n    onProgress(percent, e);\n  };\n  xhr.onerror = function error(e) {\n    onError(e);\n  };\n  xhr.onload = () => {\n    if (xhr.status < 200 || xhr.status >= 300) {\n      onError(getResponse(xhr));\n      return;\n    }\n    onSuccess(getResponse(xhr));\n  };\n  const formData = new FormData();\n  if (data) {\n    for (const key of Object.keys(data)) {\n      formData.append(key, data[key]);\n    }\n  }\n  if (fileItem.file) {\n    formData.append(name, fileItem.file);\n  }\n  xhr.open(\"post\", action != null ? action : \"\", true);\n  for (const key of Object.keys(headers)) {\n    xhr.setRequestHeader(key, headers[key]);\n  }\n  xhr.send(formData);\n  return {\n    abort() {\n      xhr.abort();\n    }\n  };\n};\nconst isAcceptFile = (file, accept) => {\n  if (accept && file) {\n    const accepts = isArray(accept) ? accept : accept.split(\",\").map(x => x.trim()).filter(x => x);\n    const fileExtension = file.name.indexOf(\".\") > -1 ? `.${file.name.split(\".\").pop()}` : \"\";\n    return accepts.some(type => {\n      const typeText = type && type.toLowerCase();\n      const fileType = (file.type || \"\").toLowerCase();\n      if (typeText === fileType) {\n        return true;\n      }\n      if (/^\\*(\\/\\*)?$/.test(typeText)) {\n        return true;\n      }\n      if (/\\/\\*/.test(typeText)) {\n        return fileType.replace(/\\/.*$/, \"\") === typeText.replace(/\\/.*$/, \"\");\n      }\n      if (/\\..*/.test(typeText)) {\n        let suffixList = [typeText];\n        if (typeText === \".jpg\" || typeText === \".jpeg\") {\n          suffixList = [\".jpg\", \".jpeg\"];\n        }\n        return suffixList.indexOf(fileExtension) > -1;\n      }\n      return false;\n    });\n  }\n  return Boolean(file);\n};\nconst loopDirectory = (itemList, accept, callback) => {\n  const files = [];\n  let restFileCount = 0;\n  const onFinish = () => {\n    !restFileCount && callback(files);\n  };\n  const _loopDirectory = item => {\n    restFileCount += 1;\n    if (item == null ? void 0 : item.isFile) {\n      item.file(file => {\n        restFileCount -= 1;\n        if (isAcceptFile(file, accept)) {\n          Object.defineProperty(file, \"webkitRelativePath\", {\n            value: item.fullPath.replace(/^\\//, \"\")\n          });\n          files.push(file);\n        }\n        onFinish();\n      });\n      return;\n    }\n    if (item == null ? void 0 : item.isDirectory) {\n      const reader = item.createReader();\n      let flag = false;\n      const readEntries = () => {\n        reader.readEntries(entries => {\n          if (!flag) {\n            restFileCount -= 1;\n            flag = true;\n          }\n          if (entries.length === 0) {\n            onFinish();\n          } else {\n            readEntries();\n            entries.forEach(_loopDirectory);\n          }\n        });\n      };\n      readEntries();\n      return;\n    }\n    restFileCount -= 1;\n    onFinish();\n  };\n  [].slice.call(itemList).forEach(item => item.webkitGetAsEntry && _loopDirectory(item.webkitGetAsEntry()));\n};\nconst isImage = file => {\n  var _a;\n  return (_a = file.type) == null ? void 0 : _a.includes(\"image\");\n};\nconst getFiles = (fileList, accept) => {\n  if (!fileList) {\n    return [];\n  }\n  const files = Array.from(fileList);\n  if (accept) {\n    return files.filter(file => {\n      return isAcceptFile(file, accept);\n    });\n  }\n  return files;\n};\nexport { getFiles, getProgressStatus, isImage, loopDirectory, uploadRequest };","map":{"version":3,"names":["NP","NOOP","isFunction","isArray","getResponse","xhr","res","responseText","response","contentType","getResponseHeader","includes","JSON","parse","getProgressStatus","status","getValue","obj","fileItem","uploadRequest","action","name","originName","data","originData","headers","withCredentials","onProgress","onSuccess","onError","XMLHttpRequest","upload","onprogress","e","percent","total","round","loaded","onerror","error","onload","formData","FormData","key","Object","keys","append","file","open","setRequestHeader","send","abort","isAcceptFile","accept","accepts","split","map","x","trim","filter","fileExtension","indexOf","pop","some","type","typeText","toLowerCase","fileType","test","replace","suffixList","Boolean","loopDirectory","itemList","callback","files","restFileCount","onFinish","_loopDirectory","item","isFile","defineProperty","value","fullPath","push","isDirectory","reader","createReader","flag","readEntries","entries","length","forEach","slice","call","webkitGetAsEntry","isImage","_a","getFiles","fileList","Array","from"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-mgmt-frontend/node_modules/@arco-design/web-vue/es/upload/utils.js"],"sourcesContent":["import NP from \"number-precision\";\nimport { NOOP } from \"../_utils/dom.js\";\nimport { isFunction, isArray } from \"../_utils/is.js\";\nconst getResponse = (xhr) => {\n  const res = xhr.responseText || xhr.response;\n  if (!res) {\n    return void 0;\n  }\n  const contentType = xhr.getResponseHeader(\"Content-Type\");\n  if (contentType && contentType.includes(\"json\")) {\n    try {\n      return JSON.parse(res);\n    } catch {\n      return res;\n    }\n  }\n  return res;\n};\nconst getProgressStatus = (status) => {\n  switch (status) {\n    case \"done\":\n      return \"success\";\n    case \"error\":\n      return \"danger\";\n    default:\n      return \"normal\";\n  }\n};\nconst getValue = (obj, fileItem) => {\n  if (isFunction(obj)) {\n    return obj(fileItem);\n  }\n  return obj;\n};\nconst uploadRequest = ({\n  fileItem,\n  action,\n  name: originName,\n  data: originData,\n  headers = {},\n  withCredentials = false,\n  onProgress = NOOP,\n  onSuccess = NOOP,\n  onError = NOOP\n}) => {\n  const name = getValue(originName, fileItem) || \"file\";\n  const data = getValue(originData, fileItem);\n  const xhr = new XMLHttpRequest();\n  if (withCredentials) {\n    xhr.withCredentials = true;\n  }\n  xhr.upload.onprogress = (e) => {\n    const percent = e.total > 0 ? NP.round(e.loaded / e.total, 2) : 0;\n    onProgress(percent, e);\n  };\n  xhr.onerror = function error(e) {\n    onError(e);\n  };\n  xhr.onload = () => {\n    if (xhr.status < 200 || xhr.status >= 300) {\n      onError(getResponse(xhr));\n      return;\n    }\n    onSuccess(getResponse(xhr));\n  };\n  const formData = new FormData();\n  if (data) {\n    for (const key of Object.keys(data)) {\n      formData.append(key, data[key]);\n    }\n  }\n  if (fileItem.file) {\n    formData.append(name, fileItem.file);\n  }\n  xhr.open(\"post\", action != null ? action : \"\", true);\n  for (const key of Object.keys(headers)) {\n    xhr.setRequestHeader(key, headers[key]);\n  }\n  xhr.send(formData);\n  return {\n    abort() {\n      xhr.abort();\n    }\n  };\n};\nconst isAcceptFile = (file, accept) => {\n  if (accept && file) {\n    const accepts = isArray(accept) ? accept : accept.split(\",\").map((x) => x.trim()).filter((x) => x);\n    const fileExtension = file.name.indexOf(\".\") > -1 ? `.${file.name.split(\".\").pop()}` : \"\";\n    return accepts.some((type) => {\n      const typeText = type && type.toLowerCase();\n      const fileType = (file.type || \"\").toLowerCase();\n      if (typeText === fileType) {\n        return true;\n      }\n      if (/^\\*(\\/\\*)?$/.test(typeText)) {\n        return true;\n      }\n      if (/\\/\\*/.test(typeText)) {\n        return fileType.replace(/\\/.*$/, \"\") === typeText.replace(/\\/.*$/, \"\");\n      }\n      if (/\\..*/.test(typeText)) {\n        let suffixList = [typeText];\n        if (typeText === \".jpg\" || typeText === \".jpeg\") {\n          suffixList = [\".jpg\", \".jpeg\"];\n        }\n        return suffixList.indexOf(fileExtension) > -1;\n      }\n      return false;\n    });\n  }\n  return Boolean(file);\n};\nconst loopDirectory = (itemList, accept, callback) => {\n  const files = [];\n  let restFileCount = 0;\n  const onFinish = () => {\n    !restFileCount && callback(files);\n  };\n  const _loopDirectory = (item) => {\n    restFileCount += 1;\n    if (item == null ? void 0 : item.isFile) {\n      item.file((file) => {\n        restFileCount -= 1;\n        if (isAcceptFile(file, accept)) {\n          Object.defineProperty(file, \"webkitRelativePath\", {\n            value: item.fullPath.replace(/^\\//, \"\")\n          });\n          files.push(file);\n        }\n        onFinish();\n      });\n      return;\n    }\n    if (item == null ? void 0 : item.isDirectory) {\n      const reader = item.createReader();\n      let flag = false;\n      const readEntries = () => {\n        reader.readEntries((entries) => {\n          if (!flag) {\n            restFileCount -= 1;\n            flag = true;\n          }\n          if (entries.length === 0) {\n            onFinish();\n          } else {\n            readEntries();\n            entries.forEach(_loopDirectory);\n          }\n        });\n      };\n      readEntries();\n      return;\n    }\n    restFileCount -= 1;\n    onFinish();\n  };\n  [].slice.call(itemList).forEach((item) => item.webkitGetAsEntry && _loopDirectory(item.webkitGetAsEntry()));\n};\nconst isImage = (file) => {\n  var _a;\n  return (_a = file.type) == null ? void 0 : _a.includes(\"image\");\n};\nconst getFiles = (fileList, accept) => {\n  if (!fileList) {\n    return [];\n  }\n  const files = Array.from(fileList);\n  if (accept) {\n    return files.filter((file) => {\n      return isAcceptFile(file, accept);\n    });\n  }\n  return files;\n};\nexport { getFiles, getProgressStatus, isImage, loopDirectory, uploadRequest };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}