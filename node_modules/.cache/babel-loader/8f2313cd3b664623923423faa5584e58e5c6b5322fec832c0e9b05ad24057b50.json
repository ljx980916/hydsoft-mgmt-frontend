{"ast":null,"code":"import { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, createVNode as _createVNode } from \"vue\";\nimport \"core-js/modules/es.array.push.js\";\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw, shallowRef, onBeforeUnmount } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getCustomerRingList, getCustomerYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo, dataAddKey, getRedNum, getLastYearDay, getCurrentTime } from \"../../utils/util\";\nimport { useRouter, useRoute } from \"vue-router\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nexport default {\n  __name: 'customerRingSame',\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    let $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\n    let {\n      lastYear,\n      lastMonth\n    } = getLastYearDay();\n    let {\n      year,\n      month\n    } = getCurrentTime();\n    let tagColumnList = useTagColumnListStore();\n    const router = useRouter();\n    const route = useRoute();\n    const {\n      id: deptId,\n      deptName,\n      tab\n    } = route.query;\n    const tabsActive = ref(tab || '1');\n    let columConfig = {};\n    const tableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"200px\",\n      loading: false\n    });\n    const selectMonth = ref(\"3\");\n    const tableRef = ref(null);\n    const tabChangeColumInfo = reactive({\n      columnTabs: [],\n      up: [],\n      down: []\n    });\n    const chartColumMap = {\n      发薪人数: [],\n      营业收入: [],\n      销售毛利率: []\n    };\n    const chartColumnNameMap = {\n      canvasLine1: \"发薪人数\",\n      canvasLine2: \"营业收入\",\n      canvasLine3: \"销售毛利率\"\n    };\n    let filterShowChildrenColumn = [];\n    // 切换环比分析和同比分析\n    const handleTab = val => {\n      tabsActive.value = val;\n      inintTableData();\n    };\n    onMounted(() => {\n      if (tableRef.value) {\n        let head = tableRef.value.$el;\n        nextTick(() => {\n          let innerHeight = window.innerHeight;\n          let elHeight = head.getBoundingClientRect().top;\n          tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n        });\n      }\n    });\n    // 初始化\n    const seltColumns = () => {\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n      if (currentPageColumn.length) {\n        currentPageColumn[0].tier.forEach((item, index) => {\n          let tabs = [];\n          let columnTabs = [];\n          let columnHasSonTabs = [];\n          let noHiddenColumn = [];\n          let defaultColumHasSonTabs = [];\n          let defaultColumnTabs = [];\n          item.tags.forEach(jtem => {\n            tabs.push(jtem.tag);\n            jtem.columns.forEach(ktem => {\n              let {\n                col,\n                conf,\n                title\n              } = ktem;\n              conf = conf || {};\n              let columnItemConfig = {\n                title,\n                dataIndex: col,\n                align: conf.align,\n                cellStyle: {\n                  \"text-align\": conf.cellAlign\n                },\n                width: conf.width,\n                ellipsis: true,\n                headerCellClass: \"noEllipsis\",\n                slotName: col,\n                bodyCellClass: \"bodyCell\",\n                fixed: conf.fixed\n              };\n              columnItemConfig.isShow = conf.isShow;\n              columnItemConfig.render = ({\n                record,\n                column\n              }) => {\n                let cellVal = record[column.dataIndex];\n                if (!Array.isArray(cellVal)) {\n                  if (column.slotName === \"title\") {\n                    return _createVNode(_resolveComponent(\"a-popover\"), {\n                      \"content-style\": {\n                        background: \"rgba(0,0,0,.8)\",\n                        color: \"#fff\"\n                      },\n                      \"arrow-style\": {\n                        background: \"rgba(0,0,0,.8)\"\n                      }\n                    }, {\n                      default: () => record.leafNode == \"1\" ? _createVNode(\"span\", {\n                        \"class\": \"pointer\",\n                        \"style\": {\n                          color: \"#165dff\"\n                        },\n                        \"onclick\": () => jump(record)\n                      }, [record.title]) : _createVNode(\"span\", {\n                        \"class\": \"pointer\"\n                      }, [record.title]),\n                      content: () => record.title\n                    });\n                  }\n                  return _createVNode(\"span\", {\n                    \"innerHTML\": getRedNum(cellVal)\n                  }, null);\n                } else {\n                  let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n                    tip: item.month + record[item.col],\n                    value: cellVal[i]\n                  }));\n                  return _createVNode(echartContainer, {\n                    \"route\": route,\n                    \"height\": 74,\n                    \"width\": 100\n                  }, null);\n                }\n              };\n              if (conf.canHide === 1) {\n                if (conf.parentCol === 0) {\n                  columnTabs.push(columnItemConfig);\n                } else {\n                  columnHasSonTabs.push(columnItemConfig);\n                }\n              } else {\n                noHiddenColumn.push(columnItemConfig);\n              }\n              if (conf.parentCol === 1) {\n                defaultColumHasSonTabs.push(columnItemConfig);\n              } else {\n                defaultColumnTabs.push(columnItemConfig);\n              }\n            });\n          });\n          console.log(columnHasSonTabs, 'columnHasSonTabs');\n          columConfig[\"level\" + (index + 1)] = {\n            tabs,\n            params: item.params || [],\n            columnTabs,\n            columnHasSonTabs,\n            noHiddenColumn,\n            defaultColumnTabs,\n            defaultColumHasSonTabs\n          };\n        });\n      }\n      tabChangeColumInfo.columnTabs = columConfig.level2.columnHasSonTabs;\n    };\n    // 更换表头\n    const analysiisColumn = () => {\n      let {\n        columnTabs,\n        noHiddenColumn,\n        defaultColumHasSonTabs\n      } = columConfig.level2;\n      let num = 4;\n      switch (selectMonth.value) {\n        case \"3\":\n          let months1 = getNMonthsAgo(3, true);\n          let children1 = [];\n          let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months1.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children1.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children1;\n          break;\n        case \"6\":\n          let months2 = getNMonthsAgo(6, true);\n          let children2 = [];\n          let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months2.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children2.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children2;\n          break;\n        case \"12\":\n          let months3 = getNMonthsAgo(12, true);\n          months3 = months3.filter(item => item[0] !== 2022);\n          let children3 = [];\n          let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n          months3.forEach((item, i) => {\n            let columnHasSonConfig = {};\n            columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n            columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n              num++;\n              return {\n                ...jtem,\n                dataIndex: `colNo${num}`,\n                slotName: `colNo${num}`\n              };\n            });\n            children3.push(columnHasSonConfig);\n          });\n          num = 4;\n          filterShowChildrenColumn = children3;\n          break;\n        default:\n          break;\n      }\n      Object.keys(chartColumMap).forEach(key => {\n        chartColumMap[key] = [];\n      });\n      filterShowChildrenColumn.forEach(item => {\n        if (item.children?.length) {\n          let filterShowColumns = [];\n          item.children.forEach(jtem => {\n            if (jtem.isShow === 1) {\n              filterShowColumns.push(jtem);\n            }\n            if (chartColumMap.hasOwnProperty(jtem.title)) {\n              chartColumMap[jtem.title].push({\n                month: item.title,\n                col: jtem.dataIndex\n              });\n            }\n          });\n          item.children = filterShowColumns;\n        }\n      });\n      Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return _createVNode(\"a\", {\n            \"href\": \"javaScript:void(0)\",\n            \"onClick\": () => {\n              goRingContrastChart(record, 'customer');\n            }\n          }, [_createTextVNode(\"\\u770B\\u56FE\")]);\n        }\n      };\n      let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn, actionColumn];\n      tableInfo.columns = filterAllShowColumn;\n    };\n    //部门折叠\n    const expandedChange = rowKeys => {\n      tableInfo.defaultExpandedKeys = rowKeys;\n    };\n    // 切换时间区间\n    const handleMonthChange = month => {\n      selectMonth.value = month;\n      analysiisColumn();\n      getList();\n    };\n    onBeforeMount(() => {\n      seltColumns();\n      inintTableData();\n      if (deptId && deptName && tab) {\n        deptGoCustomer();\n      }\n    });\n    const inintTableData = () => {\n      if (tabsActive.value === '1') {\n        if (tableInfo.data.length === 0) {\n          analysiisColumn();\n          getList();\n        }\n      } else {\n        if (raidoGroupType.value === 'total' && sameTotalTableInfo.data.length === 0) {\n          initTotalColumns();\n        }\n        if (raidoGroupType.value === 'detail' && sameDetailTableInfo.data.length === 0) {\n          initTotalColumns();\n        }\n      }\n    };\n    // 点击标签\n    const handleTabChange = tab => {\n      switch (tab.isShow) {\n        case 0:\n          tab.isShow = 1;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 1,\n            tab\n          });\n          break;\n        case 1:\n          tab.isShow = 0;\n          changeShowStatus({\n            type: \"self\",\n            title: tab.title,\n            val: 0,\n            tab\n          });\n          break;\n        default:\n          break;\n      }\n    };\n    // 更改高亮状态并更换表头\n    const changeShowStatus = obj => {\n      let {\n        columnTabs,\n        defaultColumHasSonTabs\n      } = columConfig.level2;\n      let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      if (filterHasSonShowColumn.length === 0) {\n        Message.error(\"至少选择一项\");\n        obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n        return;\n      }\n      if (obj.type === \"parent\") {\n        columnTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      if (obj.type === \"self\") {\n        defaultColumHasSonTabs.forEach(item => {\n          if (obj.title === item.title) {\n            item.isShow = obj.val;\n          }\n        });\n      }\n      analysiisColumn();\n      handleAbortRequest();\n      getList();\n    };\n    // 处理趋势数据\n    const construcLine = arr => {\n      arr.forEach(item => {\n        item.colNo2 = JSON.parse(item.colNo2);\n        item.colNo3 = JSON.parse(item.colNo3);\n        item.colNo4 = JSON.parse(item.colNo4);\n        if (item.children) {\n          construcLine(item.children);\n        }\n      });\n    };\n    // 获取列表数据\n    const getList = () => {\n      tableInfo.data = [];\n      tableInfo.loading = true;\n      let arr = [];\n      var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n      const mappings = {\n        发薪人数: \"colNo1\",\n        营业收入: \"colNo2\",\n        销售毛利: \"colNo3\",\n        销售毛利率: \"colNo4\",\n        直接成本: \"colNo5\",\n        人均营业收入: \"colNo6\",\n        人均直接成本: \"colNo7\",\n        未完工项目成本: \"colNo8\",\n        招聘费用: \"colNo9\",\n        销售费用: \"colNo10\",\n        管理费用: \"colNo11\"\n      };\n      newColumns.forEach(item => {\n        if (mappings[item.title]) {\n          arr.push(mappings[item.title]);\n        }\n        if (item.children) {\n          item.children.forEach(jtem => {\n            if (mappings[jtem.title]) {\n              arr.push(mappings[jtem.title]);\n            }\n          });\n        }\n      });\n      var params = {\n        interval: Number(selectMonth.value),\n        dynamicHeaderParam: Array.from(new Set(arr)),\n        xAxis: 50,\n        yAxis: 20,\n        tagKey: \"linkAnalysis2\",\n        deptId: deptId || \"\"\n      };\n      getCustomerRingList(params).then(res => {\n        if (res.code == \"200\") {\n          construcLine(res.data);\n          let data = dataAddKey(res.data, \"key\", \"title\");\n          let keys = [];\n          res.data.forEach(item => keys.push(item.title));\n          tableInfo.defaultExpandedKeys = keys;\n          tableInfo.data = data;\n        } else {\n          Message.error(res.message);\n        }\n        tableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          tableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          tableInfo.loading = false;\n        }\n      });\n    };\n    // 跳转\n    const jump = record => {\n      router.push({\n        path: \"/projectRingSame\",\n        query: {\n          customerId: record.customerId,\n          deptId,\n          deptName,\n          groupCustomerName: record.groupCustomerName,\n          title: record.title,\n          tab: tabsActive.value,\n          radiotype: raidoGroupType.value\n        }\n      });\n    };\n\n    //同比分析\n    const raidoGroupType = ref(\"total\");\n    const allHeadTagList = ref([]); // 所有的标签\n    const allTableList = ref([]); // 表头数据\n    const notShowList = shallowRef([]); // 初始没显示的表头数据\n    const sameDetailTableRef = ref(null); //同比明细表格dom\n    const sameTotalTableRef = ref(null); //同比汇总表格dom\n\n    // 点击标签\n    const handleSameContrastTabChange = value => {\n      value.isShow = value.isShow === 0 ? 1 : 0;\n      let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n      if (filterHasSonShowColumn.length === 0) {\n        Message.error(\"至少选择一项\");\n        value.isShow = value.isShow === 0 ? 1 : 0;\n        return;\n      }\n      handleAbortRequest();\n      if (raidoGroupType.value === \"total\") {\n        constructSameTotalColumns(allHeadTagList.value);\n      } else {\n        constructSameDetailColumns(allHeadTagList.value);\n      }\n    };\n    // 更改汇总/明细\n    const constructSameTabChange = value => {\n      raidoGroupType.value = value;\n      initTotalColumns();\n    };\n\n    // 初始化表头和标签数据\n    const initTotalColumns = () => {\n      allHeadTagList.value = [];\n      allTableList.value = [];\n      notShowList.value = [];\n      let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n      let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n      if (currentPageColumn.length) {\n        const currentColumnList = currentPageColumn[0].tier[1].tags[0].columns;\n        currentColumnList.forEach(item => {\n          const {\n            col,\n            conf,\n            title\n          } = item;\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: {\n              \"text-align\": conf.cellAlign\n            },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            isShow: conf.isShow\n          };\n          if (conf.canHide == 1) {\n            allHeadTagList.value.push(columnItemConfig);\n          } else {\n            notShowList.value.push(columnItemConfig);\n          }\n          if (conf.fixed !== undefined) {\n            columnItemConfig.fixed = conf.fixed;\n          }\n          if (conf.parentCol == 1) {\n            allTableList.value.push(columnItemConfig);\n          }\n        });\n        if (raidoGroupType.value == \"total\") {\n          constructSameTotalColumns(allHeadTagList.value);\n        } else {\n          constructSameDetailColumns(allHeadTagList.value);\n        }\n      }\n    };\n\n    //同比汇总表格数据\n    const sameTotalTableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"600px\",\n      loading: false\n    });\n    const sameTotalTableExpandedChange = keys => {\n      sameTotalTableInfo.defaultExpandedKeys = keys;\n    };\n    // 构造同比汇总的表头\n    const constructSameTotalColumns = list => {\n      let tableList = list.filter(item => item.isShow === 1);\n      let createColumns = [];\n      let childrenColumns = [{\n        title: lastYear + \"/1-12\"\n      }, {\n        title: lastYear + `/1-${lastMonth}`\n      }, {\n        title: year + `/1-${lastMonth}`\n      }, {\n        title: \"同比\"\n      }];\n      let colNo = 5;\n      tableList.forEach(item => {\n        let columnConfig = {\n          title: item.title,\n          children: childrenColumns.map((jtem, i) => {\n            let childrenColumnItemConfig = {\n              title: jtem.title,\n              dataIndex: `colNo${colNo}`,\n              slotName: `colNo${colNo}`,\n              width: 110,\n              cellStyle: {\n                textAlign: 'right'\n              }\n            };\n            if (i === childrenColumns.length - 1) {\n              childrenColumnItemConfig.title = item.title.endsWith('率') ? '偏离' : jtem.title;\n            }\n            colNo++;\n            return childrenColumnItemConfig;\n          })\n        };\n        createColumns.push(columnConfig);\n      });\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return _createVNode(\"a\", {\n            \"href\": \"javaScript:void(0)\",\n            \"onClick\": () => {\n              goLookChat(record, 'customer');\n            }\n          }, [_createTextVNode(\"\\u770B\\u56FE\")]);\n        }\n      };\n      sameTotalTableInfo.columns = [...notShowList.value, ...createColumns, actionColumn];\n      getConstructSameTotalList();\n    };\n\n    //同比分析汇总接口\n    const getConstructSameTotalList = () => {\n      let params = {\n        interval: lastMonth,\n        dynamicHeaderParam: allTableList.value.filter(item => item.isShow === 1).map(item => item.dataIndex),\n        xAxis: 74,\n        yAxis: 100,\n        tagKey: \"yoyAnalysis2\",\n        deptId: deptId || \"\",\n        type: '1'\n      };\n      if (!deptId) {\n        Reflect.deleteProperty(params, 'deptId');\n      }\n      sameTotalTableInfo.loading = true;\n      getCustomerYoyAnalysis(params).then(res => {\n        if (res.code === '200') {\n          dataAddKey(res.data, 'key', 'deptId');\n          let expandKeys = [];\n          res.data.forEach(item => expandKeys.push(item.key));\n          sameTotalTableInfo.defaultExpandedKeys = expandKeys;\n          sameTotalTableInfo.data = res.data;\n          //计算表格不出滚动条的最大高度\n          if (sameTotalTableInfo.maxHeight === '600px') {\n            nextTick(() => {\n              if (sameTotalTableRef.value) {\n                let head = sameTotalTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameTotalTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n          }\n        } else {\n          Message.error(res.message || '请求数据失败');\n        }\n        sameTotalTableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          sameTotalTableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          sameTotalTableInfo.loading = false;\n        }\n      });\n    };\n\n    //同比明细表格数据\n    const sameDetailTableInfo = reactive({\n      columns: [],\n      data: [],\n      defaultExpandedKeys: [],\n      maxHeight: \"600px\",\n      loading: false\n    });\n    //同比分析明细表格展开/折叠\n    const detailTableExpandedChange = rowKeys => {\n      sameDetailTableInfo.defaultExpandedKeys = rowKeys;\n    };\n    // 构造同比明细的表头结构\n    const constructSameDetailColumns = list => {\n      const timeData = [];\n      let activeTableList = list.filter(item => item.isShow === 1);\n      if (month == 1) {\n        for (var i = 1; i <= 12; i++) {\n          timeData.push({\n            title: i + \"月\",\n            children: []\n          });\n        }\n      } else {\n        for (var i = 1; i <= lastMonth; i++) {\n          timeData.push({\n            title: i + \"月\",\n            children: []\n          });\n        }\n      }\n      const years = [lastYear, year];\n      let colNo = 5;\n      timeData.forEach(item => {\n        let childrenColumns = [];\n        activeTableList.forEach(jtem => {\n          years.forEach(ktem => {\n            let contrastColumnConfig = {\n              title: `${jtem.title}${ktem}`,\n              dataIndex: `colNo${colNo}`,\n              slotName: `colNo${colNo}`,\n              width: jtem.width,\n              cellStyle: toRaw(jtem.cellStyle)\n            };\n            childrenColumns.push(contrastColumnConfig);\n            colNo++;\n          });\n        });\n        item.children = childrenColumns;\n      });\n      let actionColumn = {\n        title: '操作',\n        dataIndex: 'action',\n        width: 80,\n        fixed: 'right',\n        cellStyle: {\n          textAlign: 'center'\n        },\n        render({\n          record\n        }) {\n          return _createVNode(\"a\", {\n            \"href\": \"javaScript:void(0)\",\n            \"onClick\": () => {\n              goLookChat(record, 'customer');\n            }\n          }, [_createTextVNode(\"\\u770B\\u56FE\")]);\n        }\n      };\n      sameDetailTableInfo.columns = [...notShowList.value, ...timeData, actionColumn];\n      getConstructSameDetailList();\n    };\n\n    //同比分析集团客户维度明细接口\n    const getConstructSameDetailList = () => {\n      let params = {\n        interval: lastMonth,\n        dynamicHeaderParam: allTableList.value.filter(item => item.isShow === 1).map(item => item.dataIndex),\n        xAxis: 74,\n        yAxis: 100,\n        tagKey: \"yoyAnalysis2\",\n        deptId: deptId || \"\",\n        type: '2'\n      };\n      sameDetailTableInfo.loading = true;\n      getCustomerYoyAnalysis(params).then(res => {\n        if (res.code === '200') {\n          dataAddKey(res.data, 'key', 'deptId');\n          let expandKeys = [];\n          res.data.forEach(item => expandKeys.push(item.key));\n          sameDetailTableInfo.defaultExpandedKeys = expandKeys;\n          sameDetailTableInfo.data = res.data;\n          //计算表格不出滚动条的最大高度\n          if (sameDetailTableInfo.maxHeight === '600px') {\n            nextTick(() => {\n              if (sameDetailTableRef.value) {\n                let head = sameDetailTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameDetailTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n              }\n            });\n          }\n        } else {\n          Message.error(res.message || '请求数据失败');\n        }\n        sameDetailTableInfo.loading = false;\n      }).catch(err => {\n        if (err?.code === \"ERR_CANCELED\") {\n          sameDetailTableInfo.loading = true;\n        } else {\n          Message.error(err?.message || \"数据请求错误\");\n          sameDetailTableInfo.loading = false;\n        }\n      });\n    };\n\n    //跳转同比分析看图页\n    const goLookChat = (record, type) => {\n      router.push({\n        name: 'lookChart',\n        state: {\n          barChartOptions: JSON.stringify(allHeadTagList.value),\n          deptId: record.deptId,\n          title: record.title,\n          sourceType: type,\n          taxRate: record.taxRate,\n          projectId: record.finPcode,\n          groupCustomerName: record.groupCustomerName,\n          customerName: record.customerName,\n          projectName: record.projectName,\n          deptName\n        }\n      });\n    };\n\n    //跳转环比分析看图页\n    const goRingContrastChart = (record, type) => {\n      router.push({\n        name: 'ringContrastChart',\n        state: {\n          interval: selectMonth.value,\n          deptId: deptId ? record.deptId : \"\",\n          sourceType: type,\n          title: record.title,\n          deptName,\n          customerId: record.customerId\n        }\n      });\n    };\n    //echarts缩略图的路径信息\n    const createEchartsRoute = (record, column) => {\n      return record[column.dataIndex].map((item, i) => ({\n        value: record[column.dataIndex][i]\n      }));\n    };\n    const deptGoCustomer = () => {\n      let breadList;\n      switch (tab) {\n        case '1':\n          breadList = [{\n            type: \"button\",\n            color: \"#5370FD\",\n            msg: '环比分析列表',\n            isBack: true\n          }, {\n            type: \"text\",\n            color: \"#333\",\n            msg: deptName\n          }];\n          break;\n        case '2':\n          breadList = [{\n            type: \"text\",\n            color: \"#333\",\n            msg: '同比分析列表'\n          }, {\n            type: \"button\",\n            color: \"#5370FD\",\n            msg: deptName,\n            isBack: true\n          }];\n          break;\n        default:\n          break;\n      }\n      $bus.emit(\"updateStructure\", breadList);\n    };\n    const __returned__ = {\n      get $bus() {\n        return $bus;\n      },\n      set $bus(v) {\n        $bus = v;\n      },\n      get lastYear() {\n        return lastYear;\n      },\n      set lastYear(v) {\n        lastYear = v;\n      },\n      get lastMonth() {\n        return lastMonth;\n      },\n      set lastMonth(v) {\n        lastMonth = v;\n      },\n      get year() {\n        return year;\n      },\n      set year(v) {\n        year = v;\n      },\n      get month() {\n        return month;\n      },\n      set month(v) {\n        month = v;\n      },\n      get tagColumnList() {\n        return tagColumnList;\n      },\n      set tagColumnList(v) {\n        tagColumnList = v;\n      },\n      router,\n      route,\n      deptId,\n      deptName,\n      tab,\n      tabsActive,\n      get columConfig() {\n        return columConfig;\n      },\n      set columConfig(v) {\n        columConfig = v;\n      },\n      tableInfo,\n      selectMonth,\n      tableRef,\n      tabChangeColumInfo,\n      chartColumMap,\n      chartColumnNameMap,\n      get filterShowChildrenColumn() {\n        return filterShowChildrenColumn;\n      },\n      set filterShowChildrenColumn(v) {\n        filterShowChildrenColumn = v;\n      },\n      handleTab,\n      seltColumns,\n      analysiisColumn,\n      expandedChange,\n      handleMonthChange,\n      inintTableData,\n      handleTabChange,\n      changeShowStatus,\n      construcLine,\n      getList,\n      jump,\n      raidoGroupType,\n      allHeadTagList,\n      allTableList,\n      notShowList,\n      sameDetailTableRef,\n      sameTotalTableRef,\n      handleSameContrastTabChange,\n      constructSameTabChange,\n      initTotalColumns,\n      sameTotalTableInfo,\n      sameTotalTableExpandedChange,\n      constructSameTotalColumns,\n      getConstructSameTotalList,\n      sameDetailTableInfo,\n      detailTableExpandedChange,\n      constructSameDetailColumns,\n      getConstructSameDetailList,\n      goLookChat,\n      goRingContrastChart,\n      createEchartsRoute,\n      deptGoCustomer,\n      get Message() {\n        return Message;\n      },\n      onBeforeMount,\n      reactive,\n      ref,\n      nextTick,\n      onMounted,\n      toRaw,\n      shallowRef,\n      onBeforeUnmount,\n      get useTagColumnListStore() {\n        return useTagColumnListStore;\n      },\n      get getCustomerRingList() {\n        return getCustomerRingList;\n      },\n      get getCustomerYoyAnalysis() {\n        return getCustomerYoyAnalysis;\n      },\n      get getNMonthsAgo() {\n        return getNMonthsAgo;\n      },\n      get dataAddKey() {\n        return dataAddKey;\n      },\n      get getRedNum() {\n        return getRedNum;\n      },\n      get getLastYearDay() {\n        return getLastYearDay;\n      },\n      get getCurrentTime() {\n        return getCurrentTime;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get useRoute() {\n        return useRoute;\n      },\n      echartContainer,\n      get getCurrentInstance() {\n        return getCurrentInstance;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["Message","onBeforeMount","reactive","ref","nextTick","onMounted","toRaw","shallowRef","onBeforeUnmount","useTagColumnListStore","getCustomerRingList","getCustomerYoyAnalysis","getNMonthsAgo","dataAddKey","getRedNum","getLastYearDay","getCurrentTime","useRouter","useRoute","echartContainer","getCurrentInstance","$bus","appContext","config","globalProperties","lastYear","lastMonth","year","month","tagColumnList","router","route","id","deptId","deptName","tab","query","tabsActive","columConfig","tableInfo","columns","data","defaultExpandedKeys","maxHeight","loading","selectMonth","tableRef","tabChangeColumInfo","columnTabs","up","down","chartColumMap","发薪人数","营业收入","销售毛利率","chartColumnNameMap","canvasLine1","canvasLine2","canvasLine3","filterShowChildrenColumn","handleTab","val","value","inintTableData","head","$el","innerHeight","window","elHeight","getBoundingClientRect","top","seltColumns","tagColumns","getTagColumnList","currentPageColumn","filter","item","report","length","tier","forEach","index","tabs","columnHasSonTabs","noHiddenColumn","defaultColumHasSonTabs","defaultColumnTabs","tags","jtem","push","tag","ktem","col","conf","title","columnItemConfig","dataIndex","align","cellStyle","cellAlign","width","ellipsis","headerCellClass","slotName","bodyCellClass","fixed","isShow","render","record","column","cellVal","Array","isArray","background","color","default","leafNode","jump","content","map","i","tip","canHide","parentCol","console","log","params","level2","analysiisColumn","num","months1","children1","filterHasSonShowColumn1","columnHasSonConfig","children","j","months2","children2","filterHasSonShowColumn2","months3","children3","filterHasSonShowColumn3","Object","keys","key","filterShowColumns","hasOwnProperty","reverse","actionColumn","textAlign","goRingContrastChart","filterAllShowColumn","expandedChange","rowKeys","handleMonthChange","getList","deptGoCustomer","raidoGroupType","sameTotalTableInfo","initTotalColumns","sameDetailTableInfo","handleTabChange","changeShowStatus","type","obj","filterHasSonShowColumn","error","handleAbortRequest","construcLine","arr","colNo2","JSON","parse","colNo3","colNo4","newColumns","stringify","mappings","销售毛利","直接成本","人均营业收入","人均直接成本","未完工项目成本","招聘费用","销售费用","管理费用","interval","Number","dynamicHeaderParam","from","Set","xAxis","yAxis","tagKey","then","res","code","message","catch","err","path","customerId","groupCustomerName","radiotype","allHeadTagList","allTableList","notShowList","sameDetailTableRef","sameTotalTableRef","handleSameContrastTabChange","constructSameTotalColumns","constructSameDetailColumns","constructSameTabChange","currentColumnList","undefined","sameTotalTableExpandedChange","list","tableList","createColumns","childrenColumns","colNo","columnConfig","childrenColumnItemConfig","endsWith","goLookChat","getConstructSameTotalList","Reflect","deleteProperty","expandKeys","Math","round","detailTableExpandedChange","timeData","activeTableList","years","contrastColumnConfig","getConstructSameDetailList","name","state","barChartOptions","sourceType","taxRate","projectId","finPcode","customerName","projectName","createEchartsRoute","breadList","msg","isBack","emit"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/src/views/ringAnalyze/customerRingSame.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <a-tabs v-model:active-key=\"tabsActive\" @change=\"handleTab\" class=\"tabs\">\n      <a-tab-pane key=\"1\" title=\"环比分析\" class=\"p-t-10\">\n        <!-- 配置表头 -->\n        <div class=\"flex-between\">\n          <a-space :size=\"['small', 0]\" wrap>\n            <a-tag\n              v-for=\"(item, index) of tabChangeColumInfo.columnTabs\"\n              :key=\"index\"\n              :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n              size=\"large\"\n              class=\"pointer\"\n              @click=\"handleTabChange(item)\"\n            >\n              {{ item.title }}\n            </a-tag>\n          </a-space>\n          <div style=\"position: relative; top: -1px\">\n            <a-select v-model:model-value=\"selectMonth\" @change=\"handleMonthChange\">\n              <a-option value=\"3\">近3个月</a-option>\n              <a-option value=\"6\">近6个月</a-option>\n              <a-option value=\"12\">近12个月</a-option>\n              <template #arrow-icon>\n                <icon-calendar :size=\"16\" />\n              </template>\n            </a-select>\n          </div>\n        </div>\n        <!-- 表格 -->\n        <div class=\"m-t-20\">\n          <a-table\n            :columns=\"tableInfo.columns\"\n            :data=\"tableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"tableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: tableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"tableInfo.loading\"\n            ref=\"tableRef\"\n            @expanded-change=\"expandedChange\"\n          ></a-table>\n        </div>\n      </a-tab-pane>\n      <a-tab-pane key=\"2\" title=\"同比分析\" class=\"p-t-10\">\n        <div class=\"flex-between\">\n              <a-space :size=\"['small', 0]\" wrap>\n                <a-tag\n                  v-for=\"(item, index) of allTableList\"\n                  :key=\"index\"\n                  :color=\"item.isShow === 1 ? 'arcoblue' : ''\"\n                  size=\"large\"\n                  class=\"pointer\"\n                  @click=\"handleSameContrastTabChange(item)\"\n                >\n                  {{ item.title }}\n                </a-tag>\n              </a-space>\n              <div style=\"position: relative; top: -1px\">\n                <a-radio-group v-model:model-value=\"raidoGroupType\" type=\"button\" @change=\"constructSameTabChange\">\n                  <a-radio value=\"total\">汇总</a-radio>\n                  <a-radio value=\"detail\">明细</a-radio>\n                </a-radio-group>\n              </div>\n        </div>\n        <div v-show=\"raidoGroupType === 'total'\">\n          <a-table\n            :columns=\"sameTotalTableInfo.columns\"\n            :data=\"sameTotalTableInfo.data\"\n            :default-expand-all-rows=\"true\"\n            :bordered=\"{ cell: true }\"\n            column-resizable\n            :expanded-keys=\"sameTotalTableInfo.defaultExpandedKeys\"\n            :scroll=\"{ maxHeight: sameTotalTableInfo.maxHeight }\"\n            :scrollbar=\"{ x: true, y: 1500 }\"\n            :pagination=\"false\"\n            :loading=\"sameTotalTableInfo.loading\"\n            ref=\"sameTotalTableRef\"\n            class=\"m-t-20\"\n            @expanded-change=\"sameTotalTableExpandedChange\"\n          >\n            <template #title=\"{ record }\">\n              <a-popover\n                :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n              >\n              <a href=\"javaScript:void(0)\" v-if=\"record.leafNode === '1'\" style=\"color: #165dff\" @click=\"jump(record)\">\n                {{ record.title }}\n              </a>\n              <span class=\"pointer\" v-else>{{ record.title }}</span>\n                <template #content>\n                  {{ record.title }}\n                </template>\n              </a-popover>\n            </template>\n            <template #canvasLine1=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n            <template #canvasLine2=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n            <template #canvasLine3=\"{record,column}\">\n              <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n            </template>\n          </a-table>\n          </div>\n        <div v-show=\"raidoGroupType === 'detail'\">\n          <a-table\n              :columns=\"sameDetailTableInfo.columns\"\n              :data=\"sameDetailTableInfo.data\"\n              :default-expand-all-rows=\"true\"\n              :bordered=\"{ cell: true }\"\n              column-resizable\n              :expanded-keys=\"sameDetailTableInfo.defaultExpandedKeys\"\n              :scroll=\"{ maxHeight: sameDetailTableInfo.maxHeight }\"\n              :scrollbar=\"{ x: true, y: 1500 }\"\n              :pagination=\"false\"\n              :loading=\"sameDetailTableInfo.loading\"\n              ref=\"sameDetailTableRef\"\n              class=\" m-t-20\"\n              @expanded-change=\"detailTableExpandedChange\"\n            >\n              <template #title=\"{ record }\">\n                <a-popover\n                  :content-style=\"{ background: 'rgba(0,0,0,.8)', color: '#fff' }\"\n                  :arrow-style=\"{ background: 'rgba(0,0,0,.8)' }\"\n                >\n                <a href=\"javaScript:void(0)\" v-if=\"record.leafNode === '1'\" style=\"color: #165dff\" @click=\"jump(record)\">\n                  {{ record.title }}\n                </a>\n                <span class=\"pointer\" v-else>{{ record.title }}</span>\n                  <template #content>\n                    {{ record.title }}\n                  </template>\n                </a-popover>\n              </template>\n              <template #canvasLine1=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine2=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n              <template #canvasLine3=\"{record,column}\">\n                <echart-container :route=\"createEchartsRoute(record,column)\" :height=74 :width=100 />\n              </template>\n            </a-table>\n        </div>\n      </a-tab-pane>\n    </a-tabs>\n  </div>\n</template>\n\n<script setup>\nimport { Message } from \"@arco-design/web-vue\";\nimport { onBeforeMount, reactive, ref, nextTick, onMounted, toRaw,shallowRef,onBeforeUnmount } from \"vue\";\nimport { useTagColumnListStore } from \"../../store/index\";\nimport { getCustomerRingList, getCustomerYoyAnalysis } from \"@/api/loopAnalyze.js\";\nimport { getNMonthsAgo, dataAddKey, getRedNum,getLastYearDay, getCurrentTime} from \"../../utils/util\";\nimport { useRouter, useRoute } from \"vue-router\";\nimport echartContainer from \"@/components/echartsContainer.vue\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\nlet { lastYear, lastMonth } = getLastYearDay();\nlet { year, month } = getCurrentTime();\nlet tagColumnList = useTagColumnListStore();\nconst router = useRouter();\nconst route = useRoute();\nconst { id:deptId ,deptName,tab } = route.query\nconst tabsActive = ref(tab||'1');\nlet columConfig = {};\nconst tableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"200px\",\n  loading: false,\n});\nconst selectMonth = ref(\"3\");\nconst tableRef = ref(null);\nconst tabChangeColumInfo = reactive({\n  columnTabs: [],\n  up: [],\n  down: [],\n});\nconst chartColumMap = {\n  发薪人数: [],\n  营业收入: [],\n  销售毛利率: [],\n};\nconst chartColumnNameMap = {\n  canvasLine1: \"发薪人数\",\n  canvasLine2: \"营业收入\",\n  canvasLine3: \"销售毛利率\",\n};\nlet filterShowChildrenColumn = [];\n// 切换环比分析和同比分析\nconst handleTab = val => {\n  tabsActive.value = val;\n  inintTableData()\n};\nonMounted(() => {\n  if (tableRef.value) {\n    let head = tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      tableInfo.maxHeight = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\n// 初始化\nconst seltColumns = () => {\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"环比分析\") || [];\n  if (currentPageColumn.length) {\n    currentPageColumn[0].tier.forEach((item, index) => {\n      let tabs = [];\n      let columnTabs = [];\n      let columnHasSonTabs = [];\n      let noHiddenColumn = [];\n      let defaultColumHasSonTabs = [];\n      let defaultColumnTabs = [];\n      item.tags.forEach(jtem => {\n        tabs.push(jtem.tag);\n        jtem.columns.forEach(ktem => {\n          let { col, conf, title } = ktem;\n          conf = conf || {};\n          let columnItemConfig = {\n            title,\n            dataIndex: col,\n            align: conf.align,\n            cellStyle: { \"text-align\": conf.cellAlign },\n            width: conf.width,\n            ellipsis: true,\n            headerCellClass: \"noEllipsis\",\n            slotName: col,\n            bodyCellClass: \"bodyCell\",\n            fixed : conf.fixed\n          };\n          columnItemConfig.isShow = conf.isShow;\n          columnItemConfig.render = ({ record, column }) => {\n            let cellVal = record[column.dataIndex];\n            if (!Array.isArray(cellVal)) {\n              if (column.slotName === \"title\") {\n                return (\n                  <a-popover\n                    content-style={{ background: \"rgba(0,0,0,.8)\", color: \"#fff\" }}\n                    arrow-style={{ background: \"rgba(0,0,0,.8)\" }}\n                  >\n                    {{\n                      default: () =>\n                        record.leafNode == \"1\" ? (\n                          <span class=\"pointer\" style={{ color: \"#165dff\" }} onclick={() => jump(record)}>\n                            {record.title}\n                          </span>\n                        ) : (\n                          <span class=\"pointer\">{record.title}</span>\n                        ),\n                      content: () => record.title,\n                    }}\n                  </a-popover>\n                );\n              }\n              return <span innerHTML={getRedNum(cellVal)}></span>;\n            } else {\n              let route = chartColumMap[chartColumnNameMap[column.dataIndex]].map((item, i) => ({\n                tip: item.month + record[item.col],\n                value: cellVal[i],\n              }));\n              return <echartContainer route={route} height={74} width={100} />;\n            }\n          };\n          if (conf.canHide === 1) {\n            if (conf.parentCol === 0) {\n              columnTabs.push(columnItemConfig);\n            } else {\n              columnHasSonTabs.push(columnItemConfig);\n            }\n          } else {\n            noHiddenColumn.push(columnItemConfig);\n          }\n          if (conf.parentCol === 1) {\n            defaultColumHasSonTabs.push(columnItemConfig);\n          } else {\n            defaultColumnTabs.push(columnItemConfig);\n          }\n        });\n      });  \n      console.log(columnHasSonTabs,'columnHasSonTabs');\n      columConfig[\"level\" + (index + 1)] = {\n        tabs,\n        params: item.params || [],\n        columnTabs,\n        columnHasSonTabs,\n        noHiddenColumn,\n        defaultColumnTabs,\n        defaultColumHasSonTabs,\n      };\n    });\n  }\n  tabChangeColumInfo.columnTabs = columConfig.level2.columnHasSonTabs;\n};\n// 更换表头\nconst analysiisColumn = () => {\n  let { columnTabs, noHiddenColumn, defaultColumHasSonTabs } = columConfig.level2;\n  let num = 4;\n  switch (selectMonth.value) {\n    case \"3\":\n      let months1 = getNMonthsAgo(3, true);\n      let children1 = [];\n      let filterHasSonShowColumn1 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months1.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn1.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children1.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children1;\n      break;\n    case \"6\":\n      let months2 = getNMonthsAgo(6, true);\n      let children2 = [];\n      let filterHasSonShowColumn2 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months2.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn2.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children2.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children2;\n      break;\n    case \"12\":\n      let months3 = getNMonthsAgo(12, true);\n      months3 = months3.filter(item=>item[0]!==2022)\n      let children3 = [];\n      let filterHasSonShowColumn3 = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n      months3.forEach((item, i) => {\n        let columnHasSonConfig = {};\n        columnHasSonConfig.title = `${item[0]}年${item[1]}月`;\n        columnHasSonConfig.children = filterHasSonShowColumn3.map((jtem, j) => {\n          num++;\n          return {\n            ...jtem,\n            dataIndex: `colNo${num}`,\n            slotName: `colNo${num}`,\n          };\n        });\n        children3.push(columnHasSonConfig);\n      });\n      num = 4;\n      filterShowChildrenColumn = children3;\n      break;\n    default:\n      break;\n  }\n  Object.keys(chartColumMap).forEach(key => {\n    chartColumMap[key] = [];\n  });\n  filterShowChildrenColumn.forEach(item => {\n    if (item.children?.length) {\n      let filterShowColumns = [];\n      item.children.forEach(jtem => {\n        if (jtem.isShow === 1) {\n          filterShowColumns.push(jtem);\n        }\n        if (chartColumMap.hasOwnProperty(jtem.title)) {\n          chartColumMap[jtem.title].push({\n            month: item.title,\n            col: jtem.dataIndex,\n          });\n        }\n      });\n      item.children = filterShowColumns;\n    }\n  });\n  Object.keys(chartColumMap).forEach(key => chartColumMap[key].reverse());\n let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goRingContrastChart(record,'customer')}}>看图</a>\n    }\n  }\n  let filterAllShowColumn = [...columnTabs.filter(item => item.isShow === 1), ...noHiddenColumn, ...filterShowChildrenColumn,actionColumn];\n  tableInfo.columns = filterAllShowColumn;\n};\n//部门折叠\nconst expandedChange = rowKeys => {\n  tableInfo.defaultExpandedKeys = rowKeys;\n};\n// 切换时间区间\nconst handleMonthChange = month => {\n  selectMonth.value = month;\n  analysiisColumn();\n  getList();\n};\nonBeforeMount(() => {\n  seltColumns();\n  inintTableData()\n  if(deptId && deptName && tab){\n    deptGoCustomer()\n  }\n});\nconst inintTableData = ()=>{\n  if(tabsActive.value === '1'){\n    if(tableInfo.data.length === 0){\n      analysiisColumn();\n      getList();\n    }\n  }else {\n    if(raidoGroupType.value === 'total' && sameTotalTableInfo.data.length === 0){\n      initTotalColumns();\n    }\n    if(raidoGroupType.value === 'detail' && sameDetailTableInfo.data.length === 0){\n      initTotalColumns();\n    }\n  }\n}\n// 点击标签\nconst handleTabChange = tab => {\n  switch (tab.isShow) {\n    case 0:\n      tab.isShow = 1;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 1,\n        tab,\n      });\n      break;\n    case 1:\n      tab.isShow = 0;\n      changeShowStatus({\n        type: \"self\",\n        title: tab.title,\n        val: 0,\n        tab,\n      });\n      break;\n    default:\n      break;\n  }\n};\n// 更改高亮状态并更换表头\nconst changeShowStatus = obj => {\n  let { columnTabs, defaultColumHasSonTabs } = columConfig.level2;\n  let filterHasSonShowColumn = defaultColumHasSonTabs.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    obj.tab.isShow = obj.tab.isShow === 0 ? 1 : 0;\n    return;\n  }\n  if (obj.type === \"parent\") {\n    columnTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  if (obj.type === \"self\") {\n    defaultColumHasSonTabs.forEach(item => {\n      if (obj.title === item.title) {\n        item.isShow = obj.val;\n      }\n    });\n  }\n  analysiisColumn();\n  handleAbortRequest();\n  getList();\n};\n// 处理趋势数据\nconst construcLine = arr => {\n  arr.forEach(item => {\n    item.colNo2 = JSON.parse(item.colNo2);\n    item.colNo3 = JSON.parse(item.colNo3);\n    item.colNo4 = JSON.parse(item.colNo4);\n    if (item.children) {\n      construcLine(item.children);\n    }\n  });\n};\n// 获取列表数据\nconst getList = () => {\n  tableInfo.data = [];\n  tableInfo.loading = true;\n  let arr = [];\n  var newColumns = JSON.parse(JSON.stringify(tableInfo.columns));\n  const mappings = {\n    发薪人数: \"colNo1\",\n    营业收入: \"colNo2\",\n    销售毛利: \"colNo3\",\n    销售毛利率: \"colNo4\",\n    直接成本: \"colNo5\",\n    人均营业收入: \"colNo6\",\n    人均直接成本: \"colNo7\",\n    未完工项目成本: \"colNo8\",\n    招聘费用: \"colNo9\",\n    销售费用: \"colNo10\",\n    管理费用: \"colNo11\",\n  };\n  newColumns.forEach(item => {\n    if (mappings[item.title]) {\n      arr.push(mappings[item.title]);\n    }\n    if (item.children) {\n      item.children.forEach(jtem => {\n        if (mappings[jtem.title]) {\n          arr.push(mappings[jtem.title]);\n        }\n      });\n    }\n  });\n  \n  var params = {\n    interval: Number(selectMonth.value),\n      dynamicHeaderParam: Array.from(new Set(arr)),\n      xAxis: 50,\n      yAxis: 20,\n      tagKey: \"linkAnalysis2\",\n      deptId : deptId || \"\",\n  };\n  getCustomerRingList(params)\n    .then(res => {\n      if (res.code == \"200\") {\n        construcLine(res.data);\n        let data = dataAddKey(res.data, \"key\", \"title\");\n        let keys = [];\n        res.data.forEach(item => keys.push(item.title));\n        tableInfo.defaultExpandedKeys = keys;\n        tableInfo.data = data;\n      } else {\n        Message.error(res.message);\n      }\n      tableInfo.loading = false;\n    })\n    .catch(err => {\n      if (err?.code === \"ERR_CANCELED\") {\n        tableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        tableInfo.loading = false;\n      }\n    });\n};\n// 跳转\nconst jump = record => {\n  router.push({\n    path: \"/projectRingSame\",\n    query: {\n      customerId: record.customerId,\n      deptId,\n      deptName,\n      groupCustomerName : record.groupCustomerName,\n      title : record.title,\n      tab : tabsActive.value,\n      radiotype : raidoGroupType.value\n    },\n  });\n  \n};\n\n//同比分析\nconst raidoGroupType = ref(\"total\");\nconst allHeadTagList = ref([]); // 所有的标签\nconst allTableList = ref([]); // 表头数据\nconst notShowList = shallowRef([]); // 初始没显示的表头数据\nconst sameDetailTableRef = ref(null) //同比明细表格dom\nconst sameTotalTableRef = ref(null)//同比汇总表格dom\n\n// 点击标签\nconst handleSameContrastTabChange = value => {\n  value.isShow = value.isShow === 0 ? 1 : 0;\n  let filterHasSonShowColumn = allHeadTagList.value.filter(item => item.isShow === 1);\n  if (filterHasSonShowColumn.length === 0) {\n    Message.error(\"至少选择一项\");\n    value.isShow = value.isShow === 0 ? 1 : 0;\n    return;\n  }\n  handleAbortRequest()\n  if (raidoGroupType.value === \"total\") {\n    constructSameTotalColumns(allHeadTagList.value);\n  } else {\n    constructSameDetailColumns(allHeadTagList.value);\n  }\n};\n// 更改汇总/明细\nconst constructSameTabChange = value => {\n  raidoGroupType.value = value;\n  initTotalColumns();\n};\n\n// 初始化表头和标签数据\nconst initTotalColumns = () => {\n  allHeadTagList.value = [];\n  allTableList.value = [];\n  notShowList.value = [];\n  let tagColumns = toRaw(tagColumnList.getTagColumnList) || [];\n  let currentPageColumn = tagColumns.filter(item => item.report === \"同比分析\") || [];\n  if (currentPageColumn.length) {\n    const currentColumnList = currentPageColumn[0].tier[1].tags[0].columns;\n    currentColumnList.forEach(item => {\n      const { col, conf, title } = item;\n      let columnItemConfig = {\n        title,\n        dataIndex: col,\n        align: conf.align,\n        cellStyle: { \"text-align\": conf.cellAlign },\n        width: conf.width,\n        ellipsis: true,\n        headerCellClass: \"noEllipsis\",\n        slotName: col,\n        bodyCellClass: \"bodyCell\",\n        isShow: conf.isShow,\n      };\n      if (conf.canHide == 1) {\n        allHeadTagList.value.push(columnItemConfig);\n      } else {\n        notShowList.value.push(columnItemConfig);\n      }\n      if(conf.fixed !== undefined){\n        columnItemConfig.fixed = conf.fixed\n      }\n      if (conf.parentCol == 1) {\n        allTableList.value.push(columnItemConfig);\n      }\n    });\n    if (raidoGroupType.value == \"total\") {\n      constructSameTotalColumns(allHeadTagList.value);\n    } else {\n      constructSameDetailColumns(allHeadTagList.value);\n    }\n  }\n};\n\n//同比汇总表格数据\nconst sameTotalTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n});\n\nconst sameTotalTableExpandedChange = keys=>{\n  sameTotalTableInfo.defaultExpandedKeys = keys\n}\n// 构造同比汇总的表头\nconst constructSameTotalColumns = list => {\n  let tableList = list.filter(item => item.isShow === 1);\n  let createColumns = []\n  let childrenColumns = [\n        {\n          title: lastYear + \"/1-12\",\n        },\n        {\n          title: lastYear + `/1-${lastMonth}`,\n        },\n        {\n          title: year + `/1-${lastMonth}`,\n        },\n        {\n          title: \"同比\",\n        },\n  ]\n  let colNo = 5\n  tableList.forEach(item => {\n    let columnConfig = {\n      title : item.title,\n      children : childrenColumns.map((jtem,i)=>{\n        let childrenColumnItemConfig = {\n          title : jtem.title,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: 110,\n          cellStyle: {textAlign : 'right'},\n        }\n        if(i === (childrenColumns.length -1)){\n          childrenColumnItemConfig.title = item.title.endsWith('率')?'偏离':jtem.title\n        }\n        colNo++\n        return childrenColumnItemConfig\n      })\n    }\n    createColumns.push(columnConfig)\n  });\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'customer')}}>看图</a>\n    }\n  }\n  sameTotalTableInfo.columns = [...notShowList.value,...createColumns,actionColumn]\n  getConstructSameTotalList()\n};\n\n//同比分析汇总接口\nconst getConstructSameTotalList = ()=>{\n  let params = {\n    interval:lastMonth,\n    dynamicHeaderParam:allTableList.value.filter(item=>item.isShow ===1).map(item=>item.dataIndex),\n    xAxis:74,\n    yAxis:100,\n    tagKey:\"yoyAnalysis2\",\n    deptId : deptId || \"\",\n    type : '1'\n  }\n  if(!deptId){\n    Reflect.deleteProperty(params,'deptId')\n  }\n  sameTotalTableInfo.loading = true\n  getCustomerYoyAnalysis(params).then(res=>{\n    if(res.code === '200'){\n      dataAddKey(res.data,'key','deptId')\n      let expandKeys = []\n      res.data.forEach(item=>expandKeys.push(item.key))\n      sameTotalTableInfo.defaultExpandedKeys = expandKeys\n      sameTotalTableInfo.data = res.data\n      //计算表格不出滚动条的最大高度\n      if(sameTotalTableInfo.maxHeight === '600px'){\n        nextTick(() => {\n              if (sameTotalTableRef.value) {\n                let head = sameTotalTableRef.value.$el;\n                let innerHeight = window.innerHeight;\n                let elHeight = head.getBoundingClientRect().top;\n                sameTotalTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n            }\n          });\n        }\n    }else {\n      Message.error(res.message || '请求数据失败')\n    }\n    sameTotalTableInfo.loading = false;\n  }).catch(err=>{\n    if (err?.code === \"ERR_CANCELED\") {\n      sameTotalTableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        sameTotalTableInfo.loading = false;\n      }\n  })\n}\n\n//同比明细表格数据\nconst sameDetailTableInfo = reactive({\n  columns: [],\n  data: [],\n  defaultExpandedKeys: [],\n  maxHeight: \"600px\",\n  loading: false,\n});\n//同比分析明细表格展开/折叠\nconst detailTableExpandedChange = rowKeys => {\n  sameDetailTableInfo.defaultExpandedKeys = rowKeys;\n};\n// 构造同比明细的表头结构\nconst constructSameDetailColumns = list => {\n  const timeData = [];\n  let activeTableList = list.filter(item => item.isShow === 1);\n  if (month == 1) {\n    for (var i = 1; i <= 12; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  } else {\n    for (var i = 1; i <= lastMonth; i++) {\n      timeData.push({\n        title: i + \"月\",\n        children: [],\n      });\n    }\n  }\n  const years = [lastYear, year];\n  let colNo = 5\n  timeData.forEach(item=>{\n    let childrenColumns = []\n    activeTableList.forEach(jtem=>{\n      years.forEach(ktem=>{\n        let contrastColumnConfig = {\n          title: `${jtem.title}${ktem}`,\n          dataIndex: `colNo${colNo}`,\n          slotName: `colNo${colNo}`,\n          width: jtem.width,\n          cellStyle: toRaw(jtem.cellStyle),\n        }\n        childrenColumns.push(contrastColumnConfig)\n        colNo++\n      })\n    })\n    item.children = childrenColumns\n  })\n  let actionColumn = {\n    title : '操作',\n    dataIndex : 'action',\n    width : 80,\n    fixed : 'right',\n    cellStyle : {textAlign : 'center'},\n    render({record}){\n      return <a href=\"javaScript:void(0)\" onClick={()=>{goLookChat(record,'customer')}}>看图</a>\n    }\n  }\n  sameDetailTableInfo.columns = [...notShowList.value,...timeData,actionColumn]\n  getConstructSameDetailList()\n};\n\n//同比分析集团客户维度明细接口\nconst getConstructSameDetailList = ()=>{\n  let params = {\n    interval:lastMonth,\n    dynamicHeaderParam:allTableList.value.filter(item=>item.isShow ===1).map(item=>item.dataIndex),\n    xAxis:74,\n    yAxis:100,\n    tagKey:\"yoyAnalysis2\",\n    deptId : deptId || \"\",\n    type : '2'\n  }\n  sameDetailTableInfo.loading = true\n  getCustomerYoyAnalysis(params).then(res=>{\n    if(res.code === '200'){\n      dataAddKey(res.data,'key','deptId')\n      let expandKeys = []\n      res.data.forEach(item=>expandKeys.push(item.key))\n      sameDetailTableInfo.defaultExpandedKeys = expandKeys\n      sameDetailTableInfo.data = res.data\n      //计算表格不出滚动条的最大高度\n      if(sameDetailTableInfo.maxHeight === '600px'){\n        nextTick(() => {\n              if (sameDetailTableRef.value) {\n              let head = sameDetailTableRef.value.$el;\n              let innerHeight = window.innerHeight;\n              let elHeight = head.getBoundingClientRect().top;\n              sameDetailTableInfo.maxHeight = Math.round(innerHeight - elHeight - 32) + \"px\";\n            }\n          });\n        }\n    }else {\n      Message.error(res.message || '请求数据失败')\n    }\n    sameDetailTableInfo.loading = false;\n  }).catch(err=>{\n    if (err?.code === \"ERR_CANCELED\") {\n      sameDetailTableInfo.loading = true;\n      } else {\n        Message.error(err?.message || \"数据请求错误\");\n        sameDetailTableInfo.loading = false;\n      }\n  })\n}\n\n//跳转同比分析看图页\nconst goLookChat = (record,type)=>{\n  router.push({\n    name : 'lookChart',\n    state : {\n      barChartOptions : JSON.stringify(allHeadTagList.value),\n      deptId : record.deptId,\n      title : record.title,\n      sourceType:type,\n      taxRate : record.taxRate,\n      projectId : record.finPcode,\n      groupCustomerName : record.groupCustomerName,\n      customerName : record.customerName,\n      projectName : record.projectName,\n      deptName\n    }\n  })\n}\n\n//跳转环比分析看图页\nconst goRingContrastChart = (record,type)=>{\n  router.push({\n    name : 'ringContrastChart',\n    state : {\n      interval:selectMonth.value,\n      deptId : deptId?record.deptId:\"\",\n      sourceType : type,\n      title : record.title,\n      deptName,\n      customerId: record.customerId,\n    }\n  })\n}\n//echarts缩略图的路径信息\nconst createEchartsRoute = (record,column)=>{\n  return record[column.dataIndex].map((item,i)=>({value:record[column.dataIndex][i]}))\n}\n\nconst deptGoCustomer = ()=>{\n  let breadList\n    switch (tab) {\n        case '1':\n            breadList = [\n                {\n                    type: \"button\",\n                    color: \"#5370FD\",\n                    msg: '环比分析列表',\n                    isBack : true\n                },\n                { type: \"text\", color: \"#333\", msg: deptName },\n            ]\n          break;\n          case '2':\n            breadList = [\n                { type: \"text\", color: \"#333\", msg: '同比分析列表' },\n                {\n                    type: \"button\",\n                    color: \"#5370FD\",\n                    msg: deptName,\n                    isBack : true\n                },\n            ]\n          break;\n          default:\n            break;\n    }\n    $bus.emit(\"updateStructure\", breadList);\n}\n\n</script>\n\n<style lang=\"scss\" scoped>\n.p-t-10 {\n  padding-top: 10px;\n}\n:deep(.tabs .arco-tabs-nav-type-line .arco-tabs-tab-title) {\n  font-size: 15px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}