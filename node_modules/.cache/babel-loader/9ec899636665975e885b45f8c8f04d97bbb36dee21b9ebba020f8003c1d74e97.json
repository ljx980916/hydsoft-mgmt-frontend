{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.oneHot = exports.getDistance = exports.getAllKeyValueMap = exports.default = void 0;\nvar _util = require(\"@antv/util\");\nvar _types = require(\"../types\");\nvar _vector = _interopRequireDefault(require(\"./vector\"));\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\n/**\n * 获取数据中所有的属性及其对应的值\n * @param dataList 数据集\n * @param involvedKeys 参与计算的key集合\n * @param uninvolvedKeys 不参与计算的key集合\n */\nvar getAllKeyValueMap = function getAllKeyValueMap(dataList, involvedKeys, uninvolvedKeys) {\n  var keys = []; // 指定了参与计算的keys时，使用指定的keys\n\n  if (involvedKeys === null || involvedKeys === void 0 ? void 0 : involvedKeys.length) {\n    keys = involvedKeys;\n  } else {\n    // 未指定抽取的keys时，提取数据中所有的key\n    dataList.forEach(function (data) {\n      keys = keys.concat(Object.keys(data));\n    });\n    keys = (0, _util.uniq)(keys);\n  } // 获取所有值非空的key的value数组\n\n  var allKeyValueMap = {};\n  keys.forEach(function (key) {\n    var value = [];\n    dataList.forEach(function (data) {\n      if (data[key] !== undefined && data[key] !== '') {\n        value.push(data[key]);\n      }\n    });\n    if (value.length && !(uninvolvedKeys === null || uninvolvedKeys === void 0 ? void 0 : uninvolvedKeys.includes(key))) {\n      allKeyValueMap[key] = (0, _util.uniq)(value);\n    }\n  });\n  return allKeyValueMap;\n};\n/**\n * one-hot编码：数据特征提取\n * @param dataList 数据集\n * @param involvedKeys 参与计算的的key集合\n * @param uninvolvedKeys 不参与计算的key集合\n */\n\nexports.getAllKeyValueMap = getAllKeyValueMap;\nvar oneHot = function oneHot(dataList, involvedKeys, uninvolvedKeys) {\n  // 获取数据中所有的属性/特征及其对应的值\n  var allKeyValueMap = getAllKeyValueMap(dataList, involvedKeys, uninvolvedKeys);\n  var oneHotCode = [];\n  if (!Object.keys(allKeyValueMap).length) {\n    return oneHotCode;\n  } // 获取所有的属性/特征值\n\n  var allValue = Object.values(allKeyValueMap); // 是否所有属性/特征的值都是数值型\n\n  var isAllNumber = allValue.every(function (value) {\n    return value.every(function (item) {\n      return typeof item === 'number';\n    });\n  }); // 对数据进行one-hot编码\n\n  dataList.forEach(function (data, index) {\n    var code = [];\n    Object.keys(allKeyValueMap).forEach(function (key) {\n      var keyValue = data[key];\n      var allKeyValue = allKeyValueMap[key];\n      var valueIndex = allKeyValue.findIndex(function (value) {\n        return keyValue === value;\n      });\n      var subCode = []; // 如果属性/特征所有的值都能转成数值型，不满足分箱，则直接用值（todo: 为了收敛更快，需做归一化处理）\n\n      if (isAllNumber) {\n        subCode.push(keyValue);\n      } else {\n        // 进行one-hot编码\n        for (var i = 0; i < allKeyValue.length; i++) {\n          if (i === valueIndex) {\n            subCode.push(1);\n          } else {\n            subCode.push(0);\n          }\n        }\n      }\n      code = code.concat(subCode);\n    });\n    oneHotCode[index] = code;\n  });\n  return oneHotCode;\n};\n/**\n * getDistance：获取两个元素之间的距离\n * @param item\n * @param otherItem\n * @param distanceType 距离类型\n * @param graphData 图数据\n */\n\nexports.oneHot = oneHot;\nvar getDistance = function getDistance(item, otherItem, distanceType, graphData) {\n  if (distanceType === void 0) {\n    distanceType = _types.DistanceType.EuclideanDistance;\n  }\n  var distance = 0;\n  switch (distanceType) {\n    case _types.DistanceType.EuclideanDistance:\n      distance = new _vector.default(item).euclideanDistance(new _vector.default(otherItem));\n      break;\n    default:\n      break;\n  }\n  return distance;\n};\nexports.getDistance = getDistance;\nvar _default = {\n  getAllKeyValueMap: getAllKeyValueMap,\n  oneHot: oneHot,\n  getDistance: getDistance\n};\nexports.default = _default;","map":{"version":3,"names":["Object","defineProperty","exports","value","oneHot","getDistance","getAllKeyValueMap","default","_util","require","_types","_vector","_interopRequireDefault","obj","__esModule","dataList","involvedKeys","uninvolvedKeys","keys","length","forEach","data","concat","uniq","allKeyValueMap","key","undefined","push","includes","oneHotCode","allValue","values","isAllNumber","every","item","index","code","keyValue","allKeyValue","valueIndex","findIndex","subCode","i","otherItem","distanceType","graphData","DistanceType","EuclideanDistance","distance","euclideanDistance","_default"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/node_modules/@antv/algorithm/lib/utils/data-preprocessing.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.oneHot = exports.getDistance = exports.getAllKeyValueMap = exports.default = void 0;\n\nvar _util = require(\"@antv/util\");\n\nvar _types = require(\"../types\");\n\nvar _vector = _interopRequireDefault(require(\"./vector\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * 获取数据中所有的属性及其对应的值\n * @param dataList 数据集\n * @param involvedKeys 参与计算的key集合\n * @param uninvolvedKeys 不参与计算的key集合\n */\nvar getAllKeyValueMap = function getAllKeyValueMap(dataList, involvedKeys, uninvolvedKeys) {\n  var keys = []; // 指定了参与计算的keys时，使用指定的keys\n\n  if (involvedKeys === null || involvedKeys === void 0 ? void 0 : involvedKeys.length) {\n    keys = involvedKeys;\n  } else {\n    // 未指定抽取的keys时，提取数据中所有的key\n    dataList.forEach(function (data) {\n      keys = keys.concat(Object.keys(data));\n    });\n    keys = (0, _util.uniq)(keys);\n  } // 获取所有值非空的key的value数组\n\n\n  var allKeyValueMap = {};\n  keys.forEach(function (key) {\n    var value = [];\n    dataList.forEach(function (data) {\n      if (data[key] !== undefined && data[key] !== '') {\n        value.push(data[key]);\n      }\n    });\n\n    if (value.length && !(uninvolvedKeys === null || uninvolvedKeys === void 0 ? void 0 : uninvolvedKeys.includes(key))) {\n      allKeyValueMap[key] = (0, _util.uniq)(value);\n    }\n  });\n  return allKeyValueMap;\n};\n/**\n * one-hot编码：数据特征提取\n * @param dataList 数据集\n * @param involvedKeys 参与计算的的key集合\n * @param uninvolvedKeys 不参与计算的key集合\n */\n\n\nexports.getAllKeyValueMap = getAllKeyValueMap;\n\nvar oneHot = function oneHot(dataList, involvedKeys, uninvolvedKeys) {\n  // 获取数据中所有的属性/特征及其对应的值\n  var allKeyValueMap = getAllKeyValueMap(dataList, involvedKeys, uninvolvedKeys);\n  var oneHotCode = [];\n\n  if (!Object.keys(allKeyValueMap).length) {\n    return oneHotCode;\n  } // 获取所有的属性/特征值\n\n\n  var allValue = Object.values(allKeyValueMap); // 是否所有属性/特征的值都是数值型\n\n  var isAllNumber = allValue.every(function (value) {\n    return value.every(function (item) {\n      return typeof item === 'number';\n    });\n  }); // 对数据进行one-hot编码\n\n  dataList.forEach(function (data, index) {\n    var code = [];\n    Object.keys(allKeyValueMap).forEach(function (key) {\n      var keyValue = data[key];\n      var allKeyValue = allKeyValueMap[key];\n      var valueIndex = allKeyValue.findIndex(function (value) {\n        return keyValue === value;\n      });\n      var subCode = []; // 如果属性/特征所有的值都能转成数值型，不满足分箱，则直接用值（todo: 为了收敛更快，需做归一化处理）\n\n      if (isAllNumber) {\n        subCode.push(keyValue);\n      } else {\n        // 进行one-hot编码\n        for (var i = 0; i < allKeyValue.length; i++) {\n          if (i === valueIndex) {\n            subCode.push(1);\n          } else {\n            subCode.push(0);\n          }\n        }\n      }\n\n      code = code.concat(subCode);\n    });\n    oneHotCode[index] = code;\n  });\n  return oneHotCode;\n};\n/**\n * getDistance：获取两个元素之间的距离\n * @param item\n * @param otherItem\n * @param distanceType 距离类型\n * @param graphData 图数据\n */\n\n\nexports.oneHot = oneHot;\n\nvar getDistance = function getDistance(item, otherItem, distanceType, graphData) {\n  if (distanceType === void 0) {\n    distanceType = _types.DistanceType.EuclideanDistance;\n  }\n\n  var distance = 0;\n\n  switch (distanceType) {\n    case _types.DistanceType.EuclideanDistance:\n      distance = new _vector.default(item).euclideanDistance(new _vector.default(otherItem));\n      break;\n\n    default:\n      break;\n  }\n\n  return distance;\n};\n\nexports.getDistance = getDistance;\nvar _default = {\n  getAllKeyValueMap: getAllKeyValueMap,\n  oneHot: oneHot,\n  getDistance: getDistance\n};\nexports.default = _default;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}