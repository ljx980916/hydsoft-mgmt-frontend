{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar SPEED_DIVISOR = 800;\nvar RadialNonoverlapForce = /** @class */function () {\n  function RadialNonoverlapForce(params) {\n    this.disp = [];\n    this.positions = params.positions;\n    this.adjMatrix = params.adjMatrix;\n    this.focusID = params.focusID;\n    this.radii = params.radii;\n    this.iterations = params.iterations || 10;\n    this.height = params.height || 10;\n    this.width = params.width || 10;\n    this.speed = params.speed || 100;\n    this.gravity = params.gravity || 10;\n    this.nodeSizeFunc = params.nodeSizeFunc;\n    this.k = params.k || 5;\n    this.strictRadial = params.strictRadial;\n    this.nodes = params.nodes;\n  }\n  RadialNonoverlapForce.prototype.layout = function () {\n    var self = this;\n    var positions = self.positions;\n    var disp = [];\n    var iterations = self.iterations;\n    var maxDisplace = self.width / 10;\n    self.maxDisplace = maxDisplace;\n    self.disp = disp;\n    for (var i = 0; i < iterations; i++) {\n      positions.forEach(function (_, k) {\n        disp[k] = {\n          x: 0,\n          y: 0\n        };\n      });\n      // 给重叠的节点增加斥力\n      self.getRepulsion();\n      self.updatePositions();\n    }\n    return positions;\n  };\n  RadialNonoverlapForce.prototype.getRepulsion = function () {\n    var self = this;\n    var positions = self.positions;\n    var nodes = self.nodes;\n    var disp = self.disp;\n    var k = self.k;\n    var radii = self.radii || [];\n    positions.forEach(function (v, i) {\n      disp[i] = {\n        x: 0,\n        y: 0\n      };\n      positions.forEach(function (u, j) {\n        if (i === j) {\n          return;\n        }\n        // v and u are not on the same circle, return\n        if (radii[i] !== radii[j]) {\n          return;\n        }\n        var vecx = v[0] - u[0];\n        var vecy = v[1] - u[1];\n        var vecLength = Math.sqrt(vecx * vecx + vecy * vecy);\n        if (vecLength === 0) {\n          vecLength = 1;\n          var sign = i > j ? 1 : -1;\n          vecx = 0.01 * sign;\n          vecy = 0.01 * sign;\n        }\n        // these two nodes overlap\n        if (vecLength < self.nodeSizeFunc(nodes[i]) / 2 + self.nodeSizeFunc(nodes[j]) / 2) {\n          var common = k * k / vecLength;\n          disp[i].x += vecx / vecLength * common;\n          disp[i].y += vecy / vecLength * common;\n        }\n      });\n    });\n  };\n  RadialNonoverlapForce.prototype.updatePositions = function () {\n    var self = this;\n    var positions = self.positions;\n    var disp = self.disp;\n    var speed = self.speed;\n    var strictRadial = self.strictRadial;\n    var f = self.focusID;\n    var maxDisplace = self.maxDisplace || self.width / 10;\n    if (strictRadial) {\n      disp.forEach(function (di, i) {\n        var vx = positions[i][0] - positions[f][0];\n        var vy = positions[i][1] - positions[f][1];\n        var vLength = Math.sqrt(vx * vx + vy * vy);\n        var vpx = vy / vLength;\n        var vpy = -vx / vLength;\n        var diLength = Math.sqrt(di.x * di.x + di.y * di.y);\n        var alpha = Math.acos((vpx * di.x + vpy * di.y) / diLength);\n        if (alpha > Math.PI / 2) {\n          alpha -= Math.PI / 2;\n          vpx *= -1;\n          vpy *= -1;\n        }\n        var tdispLength = Math.cos(alpha) * diLength;\n        di.x = vpx * tdispLength;\n        di.y = vpy * tdispLength;\n      });\n    }\n    // move\n    var radii = self.radii;\n    positions.forEach(function (n, i) {\n      if (i === f) {\n        return;\n      }\n      var distLength = Math.sqrt(disp[i].x * disp[i].x + disp[i].y * disp[i].y);\n      if (distLength > 0 && i !== f) {\n        var limitedDist = Math.min(maxDisplace * (speed / SPEED_DIVISOR), distLength);\n        n[0] += disp[i].x / distLength * limitedDist;\n        n[1] += disp[i].y / distLength * limitedDist;\n        if (strictRadial) {\n          var vx = n[0] - positions[f][0];\n          var vy = n[1] - positions[f][1];\n          var nfDis = Math.sqrt(vx * vx + vy * vy);\n          vx = vx / nfDis * radii[i];\n          vy = vy / nfDis * radii[i];\n          n[0] = positions[f][0] + vx;\n          n[1] = positions[f][1] + vy;\n        }\n      }\n    });\n  };\n  return RadialNonoverlapForce;\n}();\nexports.default = RadialNonoverlapForce;","map":{"version":3,"mappings":"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","names":["SPEED_DIVISOR","params","positions","adjMatrix","focusID","radii","iterations","height","width","speed","gravity","nodeSizeFunc","k","strictRadial","nodes","RadialNonoverlapForce","self","disp","maxDisplace","i","forEach","_","x","y","getRepulsion","updatePositions","v","u","j","vecx","vecy","vecLength","Math","sqrt","sign","common","f","di","vx","vy","vLength","vpx","vpy","diLength","alpha","acos","PI","tdispLength","cos","n","distLength","limitedDist","min","nfDis"],"sourceRoot":"","sources":["../../../src/layout/radial/radialNonoverlapForce.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}