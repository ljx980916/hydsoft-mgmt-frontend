{"ast":null,"code":"\"use strict\";\n\n/**\n * @fileOverview Combo force layout\n * @author shiwu.wyy@antfin.com\n */\nrequire(\"core-js/modules/es.error.cause.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ComboCombinedLayout = void 0;\nvar constants_1 = require(\"./constants\");\nvar base_1 = require(\"./base\");\nvar util_1 = require(\"../util\");\nvar _1 = require(\".\");\n/**\n * combined two layouts (inner and outer) for graph with combos\n */\nvar ComboCombinedLayout = /** @class */function (_super) {\n  __extends(ComboCombinedLayout, _super);\n  function ComboCombinedLayout(options) {\n    var _this = _super.call(this) || this;\n    /** 布局中心 */\n    _this.center = [0, 0];\n    /** 内部计算参数 */\n    _this.nodes = [];\n    _this.edges = [];\n    _this.combos = [];\n    _this.comboEdges = [];\n    /** Combo 内部的 padding */\n    _this.comboPadding = 10;\n    _this.comboTrees = [];\n    _this.updateCfg(options);\n    return _this;\n  }\n  ComboCombinedLayout.prototype.getDefaultCfg = function () {\n    return {};\n  };\n  /**\n   * 执行布局\n   */\n  ComboCombinedLayout.prototype.execute = function () {\n    var self = this;\n    var nodes = self.nodes;\n    var center = self.center;\n    if (!nodes || nodes.length === 0) {\n      if (self.onLayoutEnd) self.onLayoutEnd();\n      return;\n    }\n    if (nodes.length === 1) {\n      nodes[0].x = center[0];\n      nodes[0].y = center[1];\n      if (self.onLayoutEnd) self.onLayoutEnd();\n      return;\n    }\n    self.initVals();\n    // layout\n    self.run();\n    if (self.onLayoutEnd) self.onLayoutEnd();\n  };\n  ComboCombinedLayout.prototype.run = function () {\n    var _a;\n    var self = this;\n    var nodes = self.nodes,\n      edges = self.edges,\n      combos = self.combos,\n      comboEdges = self.comboEdges,\n      center = self.center;\n    var nodeMap = {};\n    nodes.forEach(function (node) {\n      nodeMap[node.id] = node;\n    });\n    var comboMap = {};\n    combos.forEach(function (combo) {\n      comboMap[combo.id] = combo;\n    });\n    var innerGraphs = self.getInnerGraphs(nodeMap);\n    // 每个 innerGraph 作为一个节点，带有大小，参与 force 计算\n    var outerNodeIds = [];\n    var outerNodes = [];\n    var nodeAncestorIdMap = {};\n    var allHaveNoPosition = true;\n    this.comboTrees.forEach(function (cTree) {\n      var innerNode = innerGraphs[cTree.id];\n      if (!innerNode) {\n        return;\n      }\n      // 代表 combo 的节点\n      var oNode = __assign(__assign({}, cTree), {\n        x: innerNode.x || comboMap[cTree.id].x,\n        y: innerNode.y || comboMap[cTree.id].y,\n        fx: innerNode.fx || comboMap[cTree.id].fx,\n        fy: innerNode.fy || comboMap[cTree.id].fy,\n        mass: innerNode.mass || comboMap[cTree.id].mass,\n        size: innerNode.size\n      });\n      outerNodes.push(oNode);\n      if (!isNaN(oNode.x) && oNode.x !== 0 && !isNaN(oNode.y) && oNode.y !== 0) {\n        allHaveNoPosition = false;\n      } else {\n        oNode.x = Math.random() * 100;\n        oNode.y = Math.random() * 100;\n      }\n      outerNodeIds.push(cTree.id);\n      (0, util_1.traverseTreeUp)(cTree, function (child) {\n        if (child.id !== cTree.id) nodeAncestorIdMap[child.id] = cTree.id;\n        return true;\n      });\n    });\n    nodes.forEach(function (node) {\n      if (node.comboId && comboMap[node.comboId]) return;\n      // 代表节点的节点\n      var oNode = __assign({}, node);\n      outerNodes.push(oNode);\n      if (!isNaN(oNode.x) && oNode.x !== 0 && !isNaN(oNode.y) && oNode.y !== 0) {\n        allHaveNoPosition = false;\n      } else {\n        oNode.x = Math.random() * 100;\n        oNode.y = Math.random() * 100;\n      }\n      outerNodeIds.push(node.id);\n    });\n    var outerEdges = [];\n    edges.concat(comboEdges).forEach(function (edge) {\n      var sourceAncestorId = nodeAncestorIdMap[edge.source] || edge.source;\n      var targetAncestorId = nodeAncestorIdMap[edge.target] || edge.target;\n      // 若两个点的祖先都在力导图的节点中，且是不同的节点，创建一条链接两个祖先的边到力导图的边中\n      if (sourceAncestorId !== targetAncestorId && outerNodeIds.includes(sourceAncestorId) && outerNodeIds.includes(targetAncestorId)) {\n        outerEdges.push({\n          source: sourceAncestorId,\n          target: targetAncestorId\n        });\n      }\n    });\n    // 若有需要最外层的 combo 或节点，则对最外层执行力导向\n    if (outerNodes === null || outerNodes === void 0 ? void 0 : outerNodes.length) {\n      if (outerNodes.length === 1) {\n        outerNodes[0].x = center[0];\n        outerNodes[0].y = center[1];\n      } else {\n        var outerData = {\n          nodes: outerNodes,\n          edges: outerEdges\n        };\n        // 需要使用一个同步的布局\n        // @ts-ignore\n        var outerLayout = this.outerLayout || new _1.GForceLayout({\n          gravity: 1,\n          factor: 4,\n          linkDistance: function (edge, source, target) {\n            var _a, _b;\n            var nodeSize = ((((_a = source.size) === null || _a === void 0 ? void 0 : _a[0]) || 30) + (((_b = target.size) === null || _b === void 0 ? void 0 : _b[0]) || 30)) / 2;\n            return Math.min(nodeSize * 1.5, 700);\n          }\n        });\n        var outerLayoutType = (_a = outerLayout.getType) === null || _a === void 0 ? void 0 : _a.call(outerLayout);\n        outerLayout.updateCfg({\n          center: center,\n          kg: 5,\n          preventOverlap: true,\n          animate: false\n        });\n        // 若所有 outerNodes 都没有位置，且 outerLayout 是力导家族的布局，则先执行 preset mds 或 grid\n        if (allHaveNoPosition && constants_1.FORCE_LAYOUT_TYPE_MAP[outerLayoutType]) {\n          var outerLayoutPreset = outerNodes.length < 100 ? new _1.MDSLayout() : new _1.GridLayout();\n          outerLayoutPreset.layout(outerData);\n        }\n        outerLayout.layout(outerData);\n      }\n      // 根据外部布局结果，平移 innerGraphs 中的节点（第一层）\n      outerNodes.forEach(function (outerNode) {\n        var innerGraph = innerGraphs[outerNode.id];\n        if (!innerGraph) {\n          var node = nodeMap[outerNode.id];\n          if (node) {\n            node.x = outerNode.x;\n            node.y = outerNode.y;\n          }\n          return;\n        }\n        innerGraph.visited = true;\n        innerGraph.x = outerNode.x;\n        innerGraph.y = outerNode.y;\n        innerGraph.nodes.forEach(function (node) {\n          node.x += outerNode.x;\n          node.y += outerNode.y;\n        });\n      });\n    }\n    // 至上而下遍历树处理下面各层节点位置\n    var innerGraphIds = Object.keys(innerGraphs);\n    var _loop_1 = function (i) {\n      var id = innerGraphIds[i];\n      var innerGraph = innerGraphs[id];\n      if (!innerGraph) return \"continue\";\n      innerGraph.nodes.forEach(function (node) {\n        if (!innerGraph.visited) {\n          node.x += innerGraph.x || 0;\n          node.y += innerGraph.y || 0;\n        }\n        if (nodeMap[node.id]) {\n          nodeMap[node.id].x = node.x;\n          nodeMap[node.id].y = node.y;\n        }\n      });\n      if (comboMap[id]) {\n        comboMap[id].x = innerGraph.x;\n        comboMap[id].y = innerGraph.y;\n      }\n    };\n    for (var i = innerGraphIds.length - 1; i >= 0; i--) {\n      _loop_1(i);\n    }\n    return {\n      nodes: nodes,\n      edges: edges,\n      combos: combos,\n      comboEdges: comboEdges\n    };\n  };\n  ComboCombinedLayout.prototype.getInnerGraphs = function (nodeMap) {\n    var self = this;\n    var comboTrees = self.comboTrees,\n      nodeSize = self.nodeSize,\n      edges = self.edges,\n      comboPadding = self.comboPadding,\n      spacing = self.spacing;\n    var innerGraphs = {};\n    // @ts-ignore\n    var innerGraphLayout = this.innerLayout || new _1.ConcentricLayout({\n      type: 'concentric',\n      sortBy: 'id'\n    });\n    innerGraphLayout.center = [0, 0];\n    innerGraphLayout.preventOverlap = true;\n    innerGraphLayout.nodeSpacing = spacing;\n    (comboTrees || []).forEach(function (ctree) {\n      (0, util_1.traverseTreeUp)(ctree, function (treeNode) {\n        var _a;\n        // @ts-ignore\n        var padding = (comboPadding === null || comboPadding === void 0 ? void 0 : comboPadding(treeNode)) || 10; // 返回的最大值\n        if ((0, util_1.isArray)(padding)) padding = Math.max.apply(Math, padding);\n        if (!((_a = treeNode.children) === null || _a === void 0 ? void 0 : _a.length)) {\n          // 空 combo\n          if (treeNode.itemType === 'combo') {\n            var treeNodeSize = padding ? [padding * 2, padding * 2] : [30, 30];\n            innerGraphs[treeNode.id] = {\n              id: treeNode.id,\n              nodes: [],\n              size: treeNodeSize\n            };\n          }\n        } else {\n          // 非空 combo\n          var innerGraphNodes = treeNode.children.map(function (child) {\n            if (child.itemType === 'combo') return innerGraphs[child.id];\n            var oriNode = nodeMap[child.id] || {};\n            return __assign(__assign({}, oriNode), child);\n          });\n          var innerGraphNodeIds_1 = innerGraphNodes.map(function (node) {\n            return node.id;\n          });\n          var innerGraphData = {\n            nodes: innerGraphNodes,\n            edges: edges.filter(function (edge) {\n              return innerGraphNodeIds_1.includes(edge.source) && innerGraphNodeIds_1.includes(edge.target);\n            })\n          };\n          var minNodeSize_1 = Infinity;\n          innerGraphNodes.forEach(function (node) {\n            var _a;\n            // @ts-ignore\n            if (!node.size) node.size = ((_a = innerGraphs[node.id]) === null || _a === void 0 ? void 0 : _a.size) || (nodeSize === null || nodeSize === void 0 ? void 0 : nodeSize(node)) || [30, 30];\n            if ((0, util_1.isNumber)(node.size)) node.size = [node.size, node.size];\n            if (minNodeSize_1 > node.size[0]) minNodeSize_1 = node.size[0];\n            if (minNodeSize_1 > node.size[1]) minNodeSize_1 = node.size[1];\n          });\n          // 根据节点数量、spacing，调整布局参数\n          innerGraphLayout.layout(innerGraphData);\n          var _b = (0, util_1.getLayoutBBox)(innerGraphNodes),\n            minX = _b.minX,\n            minY = _b.minY,\n            maxX = _b.maxX,\n            maxY = _b.maxY;\n          // move the innerGraph to [0, 0],for later controled by parent layout\n          var center_1 = {\n            x: (maxX + minX) / 2,\n            y: (maxY + minY) / 2\n          };\n          innerGraphData.nodes.forEach(function (node) {\n            node.x -= center_1.x;\n            node.y -= center_1.y;\n          });\n          var innerGraphWidth = Math.max(maxX - minX, minNodeSize_1) + padding * 2;\n          var innerGraphHeight = Math.max(maxY - minY, minNodeSize_1) + padding * 2;\n          innerGraphs[treeNode.id] = {\n            id: treeNode.id,\n            nodes: innerGraphNodes,\n            size: [innerGraphWidth, innerGraphHeight]\n          };\n        }\n        return true;\n      });\n    });\n    return innerGraphs;\n  };\n  ComboCombinedLayout.prototype.initVals = function () {\n    var self = this;\n    var nodeSize = self.nodeSize;\n    var spacing = self.spacing;\n    var nodeSizeFunc;\n    var spacingFunc;\n    // nodeSpacing to function\n    if ((0, util_1.isNumber)(spacing)) {\n      spacingFunc = function () {\n        return spacing;\n      };\n    } else if ((0, util_1.isFunction)(spacing)) {\n      spacingFunc = spacing;\n    } else {\n      spacingFunc = function () {\n        return 0;\n      };\n    }\n    this.spacing = spacingFunc;\n    // nodeSize to function\n    if (!nodeSize) {\n      nodeSizeFunc = function (d) {\n        var spacing = spacingFunc(d);\n        if (d.size) {\n          if ((0, util_1.isArray)(d.size)) {\n            var res = d.size[0] > d.size[1] ? d.size[0] : d.size[1];\n            return (res + spacing) / 2;\n          }\n          if ((0, util_1.isObject)(d.size)) {\n            var res = d.size.width > d.size.height ? d.size.width : d.size.height;\n            return (res + spacing) / 2;\n          }\n          return (d.size + spacing) / 2;\n        }\n        return 10 + spacing / 2;\n      };\n    } else if ((0, util_1.isFunction)(nodeSize)) {\n      nodeSizeFunc = function (d) {\n        var size = nodeSize(d);\n        var spacing = spacingFunc(d);\n        if ((0, util_1.isArray)(d.size)) {\n          var res = d.size[0] > d.size[1] ? d.size[0] : d.size[1];\n          return (res + spacing) / 2;\n        }\n        return ((size || 10) + spacing) / 2;\n      };\n    } else if ((0, util_1.isArray)(nodeSize)) {\n      var larger = nodeSize[0] > nodeSize[1] ? nodeSize[0] : nodeSize[1];\n      var radius_1 = larger / 2;\n      nodeSizeFunc = function (d) {\n        return radius_1 + spacingFunc(d) / 2;\n      };\n    } else {\n      // number type\n      var radius_2 = nodeSize / 2;\n      nodeSizeFunc = function (d) {\n        return radius_2 + spacingFunc(d) / 2;\n      };\n    }\n    this.nodeSize = nodeSizeFunc;\n    // comboPadding to function\n    var comboPadding = self.comboPadding;\n    var comboPaddingFunc;\n    if ((0, util_1.isNumber)(comboPadding)) {\n      comboPaddingFunc = function () {\n        return comboPadding;\n      };\n    } else if ((0, util_1.isArray)(comboPadding)) {\n      comboPaddingFunc = function () {\n        return Math.max.apply(null, comboPadding);\n      };\n    } else if ((0, util_1.isFunction)(comboPadding)) {\n      comboPaddingFunc = comboPadding;\n    } else {\n      // null type\n      comboPaddingFunc = function () {\n        return 0;\n      };\n    }\n    this.comboPadding = comboPaddingFunc;\n  };\n  ComboCombinedLayout.prototype.getType = function () {\n    return 'comboCombined';\n  };\n  return ComboCombinedLayout;\n}(base_1.Base);\nexports.ComboCombinedLayout = ComboCombinedLayout;","map":{"version":3,"mappings":"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","names":["__extends","options","_super","_this","updateCfg","ComboCombinedLayout","self","nodes","center","length","onLayoutEnd","x","y","initVals","run","edges","combos","comboEdges","nodeMap","forEach","node","id","comboMap","combo","innerGraphs","getInnerGraphs","outerNodeIds","outerNodes","nodeAncestorIdMap","allHaveNoPosition","comboTrees","cTree","innerNode","oNode","fx","fy","mass","size","push","isNaN","Math","random","child","comboId","outerEdges","concat","edge","sourceAncestorId","source","targetAncestorId","target","includes","outerData","outerLayout","_1","gravity","factor","linkDistance","nodeSize","min","outerLayoutType","getType","kg","preventOverlap","animate","constants_1","outerLayoutPreset","layout","outerNode","innerGraph","visited","innerGraphIds","Object","keys","i","comboPadding","spacing","innerGraphLayout","innerLayout","type","sortBy","nodeSpacing","ctree","treeNode","padding","max","children","itemType","treeNodeSize","innerGraphNodes","map","oriNode","innerGraphNodeIds_1","innerGraphData","filter","minNodeSize_1","Infinity","minX","minY","maxX","maxY","center_1","innerGraphWidth","innerGraphHeight","nodeSizeFunc","spacingFunc","d","res","width","height","larger","radius_1","radius_2","comboPaddingFunc","apply","base_1","exports"],"sourceRoot":"","sources":["../../src/layout/comboCombined.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}