{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport $ from 'jquery';\nimport V from '../V/index.mjs';\nimport { config } from '../config/index.mjs';\nimport { isBoolean, isObject, isNumber, isString, mixin, deepMixin, supplement, defaults, defaultsDeep, deepSupplement, assign, invoke, invokeProperty, sortedIndex, uniq, clone, cloneDeep, isEmpty, isEqual, isFunction, isPlainObject, toArray, debounce, groupBy, sortBy, flattenDeep, without, difference, intersection, union, has, result, omit, pick, bindAll, forIn, camelCase, uniqueId, merge } from './utilHelpers.mjs';\nexport const addClassNamePrefix = function (className) {\n  if (!className) return className;\n  return className.toString().split(' ').map(function (_className) {\n    if (_className.substr(0, config.classNamePrefix.length) !== config.classNamePrefix) {\n      _className = config.classNamePrefix + _className;\n    }\n    return _className;\n  }).join(' ');\n};\nexport const removeClassNamePrefix = function (className) {\n  if (!className) return className;\n  return className.toString().split(' ').map(function (_className) {\n    if (_className.substr(0, config.classNamePrefix.length) === config.classNamePrefix) {\n      _className = _className.substr(config.classNamePrefix.length);\n    }\n    return _className;\n  }).join(' ');\n};\nexport const parseDOMJSON = function (json, namespace) {\n  const selectors = {};\n  const groupSelectors = {};\n  const svgNamespace = V.namespace.svg;\n  const ns = namespace || svgNamespace;\n  const fragment = document.createDocumentFragment();\n  const parseNode = function (siblingsDef, parentNode, ns) {\n    for (let i = 0; i < siblingsDef.length; i++) {\n      const nodeDef = siblingsDef[i];\n\n      // Text node\n      if (typeof nodeDef === 'string') {\n        const textNode = document.createTextNode(nodeDef);\n        parentNode.appendChild(textNode);\n        continue;\n      }\n\n      // TagName\n      if (!nodeDef.hasOwnProperty('tagName')) throw new Error('json-dom-parser: missing tagName');\n      const tagName = nodeDef.tagName;\n      let node;\n\n      // Namespace URI\n      if (nodeDef.hasOwnProperty('namespaceURI')) ns = nodeDef.namespaceURI;\n      node = document.createElementNS(ns, tagName);\n      const svg = ns === svgNamespace;\n      const wrapper = svg ? V : $;\n      // Attributes\n      const attributes = nodeDef.attributes;\n      if (attributes) wrapper(node).attr(attributes);\n      // Style\n      const style = nodeDef.style;\n      if (style) $(node).css(style);\n      // ClassName\n      if (nodeDef.hasOwnProperty('className')) {\n        const className = nodeDef.className;\n        if (svg) {\n          node.className.baseVal = className;\n        } else {\n          node.className = className;\n        }\n      }\n      // TextContent\n      if (nodeDef.hasOwnProperty('textContent')) {\n        node.textContent = nodeDef.textContent;\n      }\n      // Selector\n      if (nodeDef.hasOwnProperty('selector')) {\n        const nodeSelector = nodeDef.selector;\n        if (selectors[nodeSelector]) throw new Error('json-dom-parser: selector must be unique');\n        selectors[nodeSelector] = node;\n        wrapper(node).attr('joint-selector', nodeSelector);\n      }\n      // Groups\n      if (nodeDef.hasOwnProperty('groupSelector')) {\n        let nodeGroups = nodeDef.groupSelector;\n        if (!Array.isArray(nodeGroups)) nodeGroups = [nodeGroups];\n        for (let j = 0; j < nodeGroups.length; j++) {\n          const nodeGroup = nodeGroups[j];\n          let group = groupSelectors[nodeGroup];\n          if (!group) group = groupSelectors[nodeGroup] = [];\n          group.push(node);\n        }\n      }\n      parentNode.appendChild(node);\n\n      // Children\n      const childrenDef = nodeDef.children;\n      if (Array.isArray(childrenDef)) {\n        parseNode(childrenDef, node, ns);\n      }\n    }\n  };\n  parseNode(json, fragment, ns);\n  return {\n    fragment: fragment,\n    selectors: selectors,\n    groupSelectors: groupSelectors\n  };\n};\n\n// Return a simple hash code from a string. See http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/.\nexport const hashCode = function (str) {\n  let hash = 0;\n  if (str.length === 0) return hash;\n  for (let i = 0; i < str.length; i++) {\n    const c = str.charCodeAt(i);\n    hash = (hash << 5) - hash + c;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n\n  return hash;\n};\nexport const getByPath = function (obj, path, delimiter) {\n  var keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  var key;\n  var i = 0;\n  var length = keys.length;\n  while (i < length) {\n    key = keys[i++];\n    if (Object(obj) === obj && key in obj) {\n      obj = obj[key];\n    } else {\n      return undefined;\n    }\n  }\n  return obj;\n};\nconst isGetSafe = function (obj, key) {\n  // Prevent prototype pollution\n  // https://snyk.io/vuln/SNYK-JS-JSON8MERGEPATCH-1038399\n  if (typeof key !== 'string' && typeof key !== 'number') {\n    key = String(key);\n  }\n  if (key === 'constructor' && typeof obj[key] === 'function') {\n    return false;\n  }\n  if (key === '__proto__') {\n    return false;\n  }\n  return true;\n};\nexport const setByPath = function (obj, path, value, delimiter) {\n  const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  const last = keys.length - 1;\n  let diver = obj;\n  let i = 0;\n  for (; i < last; i++) {\n    const key = keys[i];\n    if (!isGetSafe(diver, key)) return obj;\n    const value = diver[key];\n    // diver creates an empty object if there is no nested object under such a key.\n    // This means that one can populate an empty nested object with setByPath().\n    diver = value || (diver[key] = {});\n  }\n  diver[keys[last]] = value;\n  return obj;\n};\nexport const unsetByPath = function (obj, path, delimiter) {\n  const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  const last = keys.length - 1;\n  let diver = obj;\n  let i = 0;\n  for (; i < last; i++) {\n    const key = keys[i];\n    if (!isGetSafe(diver, key)) return obj;\n    const value = diver[key];\n    if (!value) return obj;\n    diver = value;\n  }\n  delete diver[keys[last]];\n  return obj;\n};\nexport const flattenObject = function (obj, delim, stop) {\n  delim = delim || '/';\n  var ret = {};\n  for (var key in obj) {\n    if (!obj.hasOwnProperty(key)) continue;\n    var shouldGoDeeper = typeof obj[key] === 'object';\n    if (shouldGoDeeper && stop && stop(obj[key])) {\n      shouldGoDeeper = false;\n    }\n    if (shouldGoDeeper) {\n      var flatObject = flattenObject(obj[key], delim, stop);\n      for (var flatKey in flatObject) {\n        if (!flatObject.hasOwnProperty(flatKey)) continue;\n        ret[key + delim + flatKey] = flatObject[flatKey];\n      }\n    } else {\n      ret[key] = obj[key];\n    }\n  }\n  return ret;\n};\nexport const uuid = function () {\n  // credit: http://stackoverflow.com/posts/2117523/revisions\n\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0;\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n};\n\n// Generates global unique id and stores it as a property of the object, if provided.\nexport const guid = function (obj) {\n  guid.id = guid.id || 1;\n  if (obj === undefined) {\n    return 'j_' + guid.id++;\n  }\n  obj.id = obj.id === undefined ? 'j_' + guid.id++ : obj.id;\n  return obj.id;\n};\nexport const toKebabCase = function (string) {\n  return string.replace(/[A-Z]/g, '-$&').toLowerCase();\n};\nexport const normalizeEvent = function (evt) {\n  if (evt.normalized) return evt;\n  const {\n    originalEvent,\n    target\n  } = evt;\n\n  // If the event is a touch event, normalize it to a mouse event.\n  const touch = originalEvent && originalEvent.changedTouches && originalEvent.changedTouches[0];\n  if (touch) {\n    for (let property in touch) {\n      // copy all the properties from the first touch that are not\n      // defined on TouchEvent (clientX, clientY, pageX, pageY, screenX, screenY, identifier, ...)\n      if (evt[property] === undefined) {\n        evt[property] = touch[property];\n      }\n    }\n  }\n  // IE: evt.target could be set to SVGElementInstance for SVGUseElement\n  if (target) {\n    const useElement = target.correspondingUseElement;\n    if (useElement) evt.target = useElement;\n  }\n  evt.normalized = true;\n  return evt;\n};\nexport const normalizeWheel = function (evt) {\n  // Sane values derived empirically\n  const PIXEL_STEP = 10;\n  const LINE_HEIGHT = 40;\n  const PAGE_HEIGHT = 800;\n  let sX = 0,\n    sY = 0,\n    pX = 0,\n    pY = 0;\n\n  // Legacy\n  if ('detail' in evt) {\n    sY = evt.detail;\n  }\n  if ('wheelDelta' in evt) {\n    sY = -evt.wheelDelta / 120;\n  }\n  if ('wheelDeltaY' in evt) {\n    sY = -evt.wheelDeltaY / 120;\n  }\n  if ('wheelDeltaX' in evt) {\n    sX = -evt.wheelDeltaX / 120;\n  }\n\n  // side scrolling on FF with DOMMouseScroll\n  if ('axis' in evt && evt.axis === evt.HORIZONTAL_AXIS) {\n    sX = sY;\n    sY = 0;\n  }\n  pX = 'deltaX' in evt ? evt.deltaX : sX * PIXEL_STEP;\n  pY = 'deltaY' in evt ? evt.deltaY : sY * PIXEL_STEP;\n  if ((pX || pY) && evt.deltaMode) {\n    if (evt.deltaMode == 1) {\n      pX *= LINE_HEIGHT;\n      pY *= LINE_HEIGHT;\n    } else {\n      pX *= PAGE_HEIGHT;\n      pY *= PAGE_HEIGHT;\n    }\n  }\n\n  // macOS switches deltaX and deltaY automatically when scrolling with shift key, so this is needed in other cases\n  if (evt.deltaX === 0 && evt.deltaY !== 0 && evt.shiftKey) {\n    pX = pY;\n    pY = 0;\n    sX = sY;\n    sY = 0;\n  }\n\n  // Fall-back if spin cannot be determined\n  if (pX && !sX) {\n    sX = pX < 1 ? -1 : 1;\n  }\n  if (pY && !sY) {\n    sY = pY < 1 ? -1 : 1;\n  }\n  return {\n    spinX: sX,\n    spinY: sY,\n    deltaX: pX,\n    deltaY: pY\n  };\n};\nexport const cap = function (val, max) {\n  return val > max ? max : val < -max ? -max : val;\n};\nexport const nextFrame = function () {\n  var raf;\n  if (typeof window !== 'undefined') {\n    raf = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame;\n  }\n  if (!raf) {\n    var lastTime = 0;\n    raf = function (callback) {\n      var currTime = new Date().getTime();\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n      var id = setTimeout(function () {\n        callback(currTime + timeToCall);\n      }, timeToCall);\n      lastTime = currTime + timeToCall;\n      return id;\n    };\n  }\n  return function (callback, context, ...rest) {\n    return context !== undefined ? raf(callback.bind(context, ...rest)) : raf(callback);\n  };\n}();\nexport const cancelFrame = function () {\n  var caf;\n  var client = typeof window != 'undefined';\n  if (client) {\n    caf = window.cancelAnimationFrame || window.webkitCancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.msCancelAnimationFrame || window.msCancelRequestAnimationFrame || window.oCancelAnimationFrame || window.oCancelRequestAnimationFrame || window.mozCancelAnimationFrame || window.mozCancelRequestAnimationFrame;\n  }\n  caf = caf || clearTimeout;\n  return client ? caf.bind(window) : caf;\n}();\n\n/**\n * @deprecated\n */\nexport const shapePerimeterConnectionPoint = function (linkView, view, magnet, reference) {\n  var bbox;\n  var spot;\n  if (!magnet) {\n    // There is no magnet, try to make the best guess what is the\n    // wrapping SVG element. This is because we want this \"smart\"\n    // connection points to work out of the box without the\n    // programmer to put magnet marks to any of the subelements.\n    // For example, we want the function to work on basic.Path elements\n    // without any special treatment of such elements.\n    // The code below guesses the wrapping element based on\n    // one simple assumption. The wrapping elemnet is the\n    // first child of the scalable group if such a group exists\n    // or the first child of the rotatable group if not.\n    // This makese sense because usually the wrapping element\n    // is below any other sub element in the shapes.\n    var scalable = view.$('.scalable')[0];\n    var rotatable = view.$('.rotatable')[0];\n    if (scalable && scalable.firstChild) {\n      magnet = scalable.firstChild;\n    } else if (rotatable && rotatable.firstChild) {\n      magnet = rotatable.firstChild;\n    }\n  }\n  if (magnet) {\n    spot = V(magnet).findIntersection(reference, linkView.paper.cells);\n    if (!spot) {\n      bbox = V(magnet).getBBox({\n        target: linkView.paper.cells\n      });\n    }\n  } else {\n    bbox = view.model.getBBox();\n    spot = bbox.intersectionWithLineFromCenterToPoint(reference);\n  }\n  return spot || bbox.center();\n};\nexport const isPercentage = function (val) {\n  return isString(val) && val.slice(-1) === '%';\n};\nexport const parseCssNumeric = function (val, restrictUnits) {\n  function getUnit(validUnitExp) {\n    // one or more numbers, followed by\n    // any number of (\n    //  `.`, followed by\n    //  one or more numbers\n    // ), followed by\n    // `validUnitExp`, followed by\n    // end of string\n    var matches = new RegExp('(?:\\\\d+(?:\\\\.\\\\d+)*)(' + validUnitExp + ')$').exec(val);\n    if (!matches) return null;\n    return matches[1];\n  }\n  var number = parseFloat(val);\n\n  // if `val` cannot be parsed as a number, return `null`\n  if (Number.isNaN(number)) return null;\n\n  // else: we know `output.value`\n  var output = {};\n  output.value = number;\n\n  // determine the unit\n  var validUnitExp;\n  if (restrictUnits == null) {\n    // no restriction\n    // accept any unit, as well as no unit\n    validUnitExp = '[A-Za-z]*';\n  } else if (Array.isArray(restrictUnits)) {\n    // if this is an empty array, top restriction - return `null`\n    if (restrictUnits.length === 0) return null;\n\n    // else: restriction - an array of valid unit strings\n    validUnitExp = restrictUnits.join('|');\n  } else if (isString(restrictUnits)) {\n    // restriction - a single valid unit string\n    validUnitExp = restrictUnits;\n  }\n  var unit = getUnit(validUnitExp);\n\n  // if we found no matches for `restrictUnits`, return `null`\n  if (unit === null) return null;\n\n  // else: we know the unit\n  output.unit = unit;\n  return output;\n};\nconst NO_SPACE = 0;\nfunction splitWordWithEOL(word, eol) {\n  const eolWords = word.split(eol);\n  let n = 1;\n  for (let j = 0, jl = eolWords.length - 1; j < jl; j++) {\n    const replacement = [];\n    if (j > 0 || eolWords[0] !== '') replacement.push(NO_SPACE);\n    replacement.push(eol);\n    if (j < jl - 1 || eolWords[jl] !== '') replacement.push(NO_SPACE);\n    eolWords.splice(n, 0, ...replacement);\n    n += replacement.length + 1;\n  }\n  return eolWords.filter(word => word !== '');\n}\nfunction getLineHeight(heightValue, textElement) {\n  if (heightValue === null) {\n    // Default 1em lineHeight\n    return textElement.getBBox().height;\n  }\n  switch (heightValue.unit) {\n    case 'em':\n      return textElement.getBBox().height * heightValue.value;\n    case 'px':\n    case '':\n      return heightValue.value;\n  }\n}\nexport const breakText = function (text, size, styles = {}, opt = {}) {\n  var width = size.width;\n  var height = size.height;\n  var svgDocument = opt.svgDocument || V('svg').node;\n  var textSpan = V('tspan').node;\n  var textElement = V('text').attr(styles).append(textSpan).node;\n  var textNode = document.createTextNode('');\n\n  // Prevent flickering\n  textElement.style.opacity = 0;\n  // Prevent FF from throwing an uncaught exception when `getBBox()`\n  // called on element that is not in the render tree (is not measurable).\n  // <tspan>.getComputedTextLength() returns always 0 in this case.\n  // Note that the `textElement` resp. `textSpan` can become hidden\n  // when it's appended to the DOM and a `display: none` CSS stylesheet\n  // rule gets applied.\n  textElement.style.display = 'block';\n  textSpan.style.display = 'block';\n  textSpan.appendChild(textNode);\n  svgDocument.appendChild(textElement); // lgtm [js/xss-through-dom]\n\n  if (!opt.svgDocument) {\n    document.body.appendChild(svgDocument);\n  }\n  const preserveSpaces = opt.preserveSpaces;\n  const space = ' ';\n  var separator = opt.separator || space;\n  var eol = opt.eol || '\\n';\n  var hyphen = opt.hyphen ? new RegExp(opt.hyphen) : /[^\\w\\d]/;\n  var maxLineCount = opt.maxLineCount;\n  if (!isNumber(maxLineCount)) maxLineCount = Infinity;\n  var words = text.split(separator);\n  var full = [];\n  var lines = [];\n  var p, h;\n  var lineHeight;\n  if (preserveSpaces) {\n    V(textSpan).attr('xml:space', 'preserve');\n  }\n  for (var i = 0, l = 0, len = words.length; i < len; i++) {\n    var word = words[i];\n    if (!word && !preserveSpaces) continue;\n    if (typeof word !== 'string') continue;\n    var isEol = false;\n    if (eol && word.indexOf(eol) >= 0) {\n      // word contains end-of-line character\n      if (word.length > 1) {\n        // separate word and continue cycle\n        const eolWords = splitWordWithEOL(words[i], eol);\n        words.splice(i, 1, ...eolWords);\n        i--;\n        len = words.length;\n        continue;\n      } else {\n        // creates a new line\n        if (preserveSpaces && typeof words[i - 1] === 'string') {\n          words.splice(i, NO_SPACE, '', NO_SPACE);\n          len += 2;\n          i--;\n          continue;\n        }\n        lines[++l] = !preserveSpaces || typeof words[i + 1] === 'string' ? '' : undefined;\n        isEol = true;\n      }\n    }\n    if (!isEol) {\n      let data;\n      if (preserveSpaces) {\n        data = lines[l] !== undefined ? lines[l] + space + word : word;\n      } else {\n        data = lines[l] ? lines[l] + space + word : word;\n      }\n      textNode.data = data;\n      if (textSpan.getComputedTextLength() <= width) {\n        // the current line fits\n        lines[l] = data;\n        if (p || h) {\n          // We were partitioning. Put rest of the word onto next line\n          full[l++] = true;\n\n          // cancel partitioning and splitting by hyphens\n          p = 0;\n          h = 0;\n        }\n      } else {\n        if (!lines[l] || p) {\n          var partition = !!p;\n          p = word.length - 1;\n          if (partition || !p) {\n            // word has only one character.\n            if (!p) {\n              if (!lines[l]) {\n                // we won't fit this text within our rect\n                lines = [];\n                break;\n              }\n\n              // partitioning didn't help on the non-empty line\n              // try again, but this time start with a new line\n\n              // cancel partitions created\n              words.splice(i, 2, word + words[i + 1]);\n\n              // adjust word length\n              len--;\n              full[l++] = true;\n              i--;\n              continue;\n            }\n\n            // move last letter to the beginning of the next word\n            words[i] = word.substring(0, p);\n            words[i + 1] = word.substring(p) + (words[i + 1] === undefined ? '' : words[i + 1]);\n          } else {\n            if (h) {\n              // cancel splitting and put the words together again\n              words.splice(i, 2, words[i] + words[i + 1]);\n              h = 0;\n            } else {\n              var hyphenIndex = word.search(hyphen);\n              if (hyphenIndex > -1 && hyphenIndex !== word.length - 1 && hyphenIndex !== 0) {\n                h = hyphenIndex + 1;\n                p = 0;\n              }\n\n              // We initiate partitioning or splitting\n              // split the long word into two words\n              words.splice(i, 1, word.substring(0, h || p), word.substring(h || p));\n              // adjust words length\n              len++;\n            }\n            if (l && !full[l - 1]) {\n              // if the previous line is not full, try to fit max part of\n              // the current word there\n              l--;\n            }\n          }\n          if (!preserveSpaces || lines[l] !== '') {\n            i--;\n          }\n          continue;\n        }\n        l++;\n        i--;\n      }\n    }\n    var lastL = null;\n    if (lines.length > maxLineCount) {\n      lastL = maxLineCount - 1;\n    } else if (height !== undefined) {\n      // if size.height is defined we have to check whether the height of the entire\n      // text exceeds the rect height\n\n      if (lineHeight === undefined && textNode.data !== '') {\n        // use the same defaults as in V.prototype.text\n        if (styles.lineHeight === 'auto') {\n          lineHeight = getLineHeight({\n            value: 1.5,\n            unit: 'em'\n          }, textElement);\n        } else {\n          const parsed = parseCssNumeric(styles.lineHeight, ['em', 'px', '']);\n          lineHeight = getLineHeight(parsed, textElement);\n        }\n      }\n      if (lineHeight * lines.length > height) {\n        // remove overflowing lines\n        lastL = Math.floor(height / lineHeight) - 1;\n      }\n    }\n    if (lastL !== null) {\n      lines.splice(lastL + 1);\n\n      // add ellipsis\n      var ellipsis = opt.ellipsis;\n      if (!ellipsis || lastL < 0) break;\n      if (typeof ellipsis !== 'string') ellipsis = '\\u2026';\n      var lastLine = lines[lastL];\n      if (!lastLine && !isEol) break;\n      var k = lastLine.length;\n      var lastLineWithOmission, lastChar, separatorChar;\n      do {\n        lastChar = lastLine[k];\n        lastLineWithOmission = lastLine.substring(0, k);\n        if (!lastChar) {\n          separatorChar = typeof separator === 'string' ? separator : ' ';\n          lastLineWithOmission += separatorChar;\n        } else if (lastChar.match(separator)) {\n          lastLineWithOmission += lastChar;\n        }\n        lastLineWithOmission += ellipsis;\n        textNode.data = lastLineWithOmission;\n        if (textSpan.getComputedTextLength() <= width) {\n          lines[lastL] = lastLineWithOmission;\n          break;\n        }\n        k--;\n      } while (k >= 0);\n      break;\n    }\n  }\n  if (opt.svgDocument) {\n    // svg document was provided, remove the text element only\n    svgDocument.removeChild(textElement);\n  } else {\n    // clean svg document\n    document.body.removeChild(svgDocument);\n  }\n  return lines.join(eol);\n};\n\n// Sanitize HTML\n// Based on https://gist.github.com/ufologist/5a0da51b2b9ef1b861c30254172ac3c9\n// Parses a string into an array of DOM nodes.\n// Then outputs it back as a string.\nexport const sanitizeHTML = function (html) {\n  // Ignores tags that are invalid inside a <div> tag (e.g. <body>, <head>)\n\n  // If documentContext (second parameter) is not specified or given as `null` or `undefined`, a new document is used.\n  // Inline events will not execute when the HTML is parsed; this includes, for example, sending GET requests for images.\n\n  // If keepScripts (last parameter) is `false`, scripts are not executed.\n  var output = $($.parseHTML('<div>' + html + '</div>', null, false));\n  output.find('*').each(function () {\n    // for all nodes\n    var currentNode = this;\n    $.each(currentNode.attributes, function () {\n      // for all attributes in each node\n      var currentAttribute = this;\n      var attrName = currentAttribute.name;\n      var attrValue = currentAttribute.value;\n\n      // Remove attribute names that start with \"on\" (e.g. onload, onerror...).\n      // Remove attribute values that start with \"javascript:\" pseudo protocol (e.g. `href=\"javascript:alert(1)\"`).\n      if (attrName.startsWith('on') || attrValue.startsWith('javascript:') || attrValue.startsWith('data:') || attrValue.startsWith('vbscript:')) {\n        $(currentNode).removeAttr(attrName);\n      }\n    });\n  });\n  return output.html();\n};\n\n// Download `blob` as file with `fileName`.\n// Does not work in IE9.\nexport const downloadBlob = function (blob, fileName) {\n  if (window.navigator.msSaveBlob) {\n    // requires IE 10+\n    // pulls up a save dialog\n    window.navigator.msSaveBlob(blob, fileName);\n  } else {\n    // other browsers\n    // downloads directly in Chrome and Safari\n\n    // presents a save/open dialog in Firefox\n    // Firefox bug: `from` field in save dialog always shows `from:blob:`\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1053327\n\n    var url = window.URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = url;\n    link.download = fileName;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url); // mark the url for garbage collection\n  }\n};\n\n// Download `dataUri` as file with `fileName`.\n// Does not work in IE9.\nexport const downloadDataUri = function (dataUri, fileName) {\n  const blob = dataUriToBlob(dataUri);\n  downloadBlob(blob, fileName);\n};\n\n// Convert an uri-encoded data component (possibly also base64-encoded) to a blob.\nexport const dataUriToBlob = function (dataUri) {\n  // first, make sure there are no newlines in the data uri\n  dataUri = dataUri.replace(/\\s/g, '');\n  dataUri = decodeURIComponent(dataUri);\n  var firstCommaIndex = dataUri.indexOf(','); // split dataUri as `dataTypeString`,`data`\n\n  var dataTypeString = dataUri.slice(0, firstCommaIndex); // e.g. 'data:image/jpeg;base64'\n  var mimeString = dataTypeString.split(':')[1].split(';')[0]; // e.g. 'image/jpeg'\n\n  var data = dataUri.slice(firstCommaIndex + 1);\n  var decodedString;\n  if (dataTypeString.indexOf('base64') >= 0) {\n    // data may be encoded in base64\n    decodedString = atob(data); // decode data\n  } else {\n    // convert the decoded string to UTF-8\n    decodedString = unescape(encodeURIComponent(data));\n  }\n  // write the bytes of the string to a typed array\n  var ia = new Uint8Array(decodedString.length);\n  for (var i = 0; i < decodedString.length; i++) {\n    ia[i] = decodedString.charCodeAt(i);\n  }\n  return new Blob([ia], {\n    type: mimeString\n  }); // return the typed array as Blob\n};\n\n// Read an image at `url` and return it as base64-encoded data uri.\n// The mime type of the image is inferred from the `url` file extension.\n// If data uri is provided as `url`, it is returned back unchanged.\n// `callback` is a method with `err` as first argument and `dataUri` as second argument.\n// Works with IE9.\nexport const imageToDataUri = function (url, callback) {\n  if (!url || url.substr(0, 'data:'.length) === 'data:') {\n    // No need to convert to data uri if it is already in data uri.\n\n    // This not only convenient but desired. For example,\n    // IE throws a security error if data:image/svg+xml is used to render\n    // an image to the canvas and an attempt is made to read out data uri.\n    // Now if our image is already in data uri, there is no need to render it to the canvas\n    // and so we can bypass this error.\n\n    // Keep the async nature of the function.\n    return setTimeout(function () {\n      callback(null, url);\n    }, 0);\n  }\n\n  // chrome, IE10+\n  var modernHandler = function (xhr, callback) {\n    if (xhr.status === 200) {\n      var reader = new FileReader();\n      reader.onload = function (evt) {\n        var dataUri = evt.target.result;\n        callback(null, dataUri);\n      };\n      reader.onerror = function () {\n        callback(new Error('Failed to load image ' + url));\n      };\n      reader.readAsDataURL(xhr.response);\n    } else {\n      callback(new Error('Failed to load image ' + url));\n    }\n  };\n  var legacyHandler = function (xhr, callback) {\n    var Uint8ToString = function (u8a) {\n      var CHUNK_SZ = 0x8000;\n      var c = [];\n      for (var i = 0; i < u8a.length; i += CHUNK_SZ) {\n        c.push(String.fromCharCode.apply(null, u8a.subarray(i, i + CHUNK_SZ)));\n      }\n      return c.join('');\n    };\n    if (xhr.status === 200) {\n      var bytes = new Uint8Array(xhr.response);\n      var suffix = url.split('.').pop() || 'png';\n      var map = {\n        'svg': 'svg+xml'\n      };\n      var meta = 'data:image/' + (map[suffix] || suffix) + ';base64,';\n      var b64encoded = meta + btoa(Uint8ToString(bytes));\n      callback(null, b64encoded);\n    } else {\n      callback(new Error('Failed to load image ' + url));\n    }\n  };\n  var xhr = new XMLHttpRequest();\n  xhr.open('GET', url, true);\n  xhr.addEventListener('error', function () {\n    callback(new Error('Failed to load image ' + url));\n  });\n  xhr.responseType = window.FileReader ? 'blob' : 'arraybuffer';\n  xhr.addEventListener('load', function () {\n    if (window.FileReader) {\n      modernHandler(xhr, callback);\n    } else {\n      legacyHandler(xhr, callback);\n    }\n  });\n  xhr.send();\n};\nexport const getElementBBox = function (el) {\n  var $el = $(el);\n  if ($el.length === 0) {\n    throw new Error('Element not found');\n  }\n  var element = $el[0];\n  var doc = element.ownerDocument;\n  var clientBBox = element.getBoundingClientRect();\n  var strokeWidthX = 0;\n  var strokeWidthY = 0;\n\n  // Firefox correction\n  if (element.ownerSVGElement) {\n    var vel = V(element);\n    var bbox = vel.getBBox({\n      target: vel.svg()\n    });\n\n    // if FF getBoundingClientRect includes stroke-width, getBBox doesn't.\n    // To unify this across all browsers we need to adjust the final bBox with `stroke-width` value.\n    strokeWidthX = clientBBox.width - bbox.width;\n    strokeWidthY = clientBBox.height - bbox.height;\n  }\n  return {\n    x: clientBBox.left + window.pageXOffset - doc.documentElement.offsetLeft + strokeWidthX / 2,\n    y: clientBBox.top + window.pageYOffset - doc.documentElement.offsetTop + strokeWidthY / 2,\n    width: clientBBox.width - strokeWidthX,\n    height: clientBBox.height - strokeWidthY\n  };\n};\n\n// Highly inspired by the jquery.sortElements plugin by Padolsey.\n// See http://james.padolsey.com/javascript/sorting-elements-with-jquery/.\nexport const sortElements = function (elements, comparator) {\n  var $elements = $(elements);\n  var placements = $elements.map(function () {\n    var sortElement = this;\n    var parentNode = sortElement.parentNode;\n    // Since the element itself will change position, we have\n    // to have some way of storing it's original position in\n    // the DOM. The easiest way is to have a 'flag' node:\n    var nextSibling = parentNode.insertBefore(document.createTextNode(''), sortElement.nextSibling);\n    return function () {\n      if (parentNode === this) {\n        throw new Error('You can\\'t sort elements if any one is a descendant of another.');\n      }\n\n      // Insert before flag:\n      parentNode.insertBefore(this, nextSibling);\n      // Remove flag:\n      parentNode.removeChild(nextSibling);\n    };\n  });\n  return Array.prototype.sort.call($elements, comparator).each(function (i) {\n    placements[i].call(this);\n  });\n};\n\n// Sets attributes on the given element and its descendants based on the selector.\n// `attrs` object: { [SELECTOR1]: { attrs1 }, [SELECTOR2]: { attrs2}, ... } e.g. { 'input': { color : 'red' }}\nexport const setAttributesBySelector = function (element, attrs) {\n  var $element = $(element);\n  forIn(attrs, function (attrs, selector) {\n    var $elements = $element.find(selector).addBack().filter(selector);\n    // Make a special case for setting classes.\n    // We do not want to overwrite any existing class.\n    if (has(attrs, 'class')) {\n      $elements.addClass(attrs['class']);\n      attrs = omit(attrs, 'class');\n    }\n    $elements.attr(attrs);\n  });\n};\n\n// Return a new object with all four sides (top, right, bottom, left) in it.\n// Value of each side is taken from the given argument (either number or object).\n// Default value for a side is 0.\n// Examples:\n// normalizeSides(5) --> { top: 5, right: 5, bottom: 5, left: 5 }\n// normalizeSides({ horizontal: 5 }) --> { top: 0, right: 5, bottom: 0, left: 5 }\n// normalizeSides({ left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 10, left: 5 }) --> { top: 0, right: 10, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 0, left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\nexport const normalizeSides = function (box) {\n  if (Object(box) !== box) {\n    // `box` is not an object\n    var val = 0; // `val` left as 0 if `box` cannot be understood as finite number\n    if (isFinite(box)) val = +box; // actually also accepts string numbers (e.g. '100')\n\n    return {\n      top: val,\n      right: val,\n      bottom: val,\n      left: val\n    };\n  }\n\n  // `box` is an object\n  var top, right, bottom, left;\n  top = right = bottom = left = 0;\n  if (isFinite(box.vertical)) top = bottom = +box.vertical;\n  if (isFinite(box.horizontal)) right = left = +box.horizontal;\n  if (isFinite(box.top)) top = +box.top; // overwrite vertical\n  if (isFinite(box.right)) right = +box.right; // overwrite horizontal\n  if (isFinite(box.bottom)) bottom = +box.bottom; // overwrite vertical\n  if (isFinite(box.left)) left = +box.left; // overwrite horizontal\n\n  return {\n    top: top,\n    right: right,\n    bottom: bottom,\n    left: left\n  };\n};\nexport const timing = {\n  linear: function (t) {\n    return t;\n  },\n  quad: function (t) {\n    return t * t;\n  },\n  cubic: function (t) {\n    return t * t * t;\n  },\n  inout: function (t) {\n    if (t <= 0) return 0;\n    if (t >= 1) return 1;\n    var t2 = t * t;\n    var t3 = t2 * t;\n    return 4 * (t < .5 ? t3 : 3 * (t - t2) + t3 - .75);\n  },\n  exponential: function (t) {\n    return Math.pow(2, 10 * (t - 1));\n  },\n  bounce: function (t) {\n    for (var a = 0, b = 1; 1; a += b, b /= 2) {\n      if (t >= (7 - 4 * a) / 11) {\n        var q = (11 - 6 * a - 11 * t) / 4;\n        return -q * q + b * b;\n      }\n    }\n  },\n  reverse: function (f) {\n    return function (t) {\n      return 1 - f(1 - t);\n    };\n  },\n  reflect: function (f) {\n    return function (t) {\n      return .5 * (t < .5 ? f(2 * t) : 2 - f(2 - 2 * t));\n    };\n  },\n  clamp: function (f, n, x) {\n    n = n || 0;\n    x = x || 1;\n    return function (t) {\n      var r = f(t);\n      return r < n ? n : r > x ? x : r;\n    };\n  },\n  back: function (s) {\n    if (!s) s = 1.70158;\n    return function (t) {\n      return t * t * ((s + 1) * t - s);\n    };\n  },\n  elastic: function (x) {\n    if (!x) x = 1.5;\n    return function (t) {\n      return Math.pow(2, 10 * (t - 1)) * Math.cos(20 * Math.PI * x / 3 * t);\n    };\n  }\n};\nexport const interpolate = {\n  number: function (a, b) {\n    var d = b - a;\n    return function (t) {\n      return a + d * t;\n    };\n  },\n  object: function (a, b) {\n    var s = Object.keys(a);\n    return function (t) {\n      var i, p;\n      var r = {};\n      for (i = s.length - 1; i != -1; i--) {\n        p = s[i];\n        r[p] = a[p] + (b[p] - a[p]) * t;\n      }\n      return r;\n    };\n  },\n  hexColor: function (a, b) {\n    var ca = parseInt(a.slice(1), 16);\n    var cb = parseInt(b.slice(1), 16);\n    var ra = ca & 0x0000ff;\n    var rd = (cb & 0x0000ff) - ra;\n    var ga = ca & 0x00ff00;\n    var gd = (cb & 0x00ff00) - ga;\n    var ba = ca & 0xff0000;\n    var bd = (cb & 0xff0000) - ba;\n    return function (t) {\n      var r = ra + rd * t & 0x000000ff;\n      var g = ga + gd * t & 0x0000ff00;\n      var b = ba + bd * t & 0x00ff0000;\n      return '#' + (1 << 24 | r | g | b).toString(16).slice(1);\n    };\n  },\n  unit: function (a, b) {\n    var r = /(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;\n    var ma = r.exec(a);\n    var mb = r.exec(b);\n    var p = mb[1].indexOf('.');\n    var f = p > 0 ? mb[1].length - p - 1 : 0;\n    a = +ma[1];\n    var d = +mb[1] - a;\n    var u = ma[2];\n    return function (t) {\n      return (a + d * t).toFixed(f) + u;\n    };\n  }\n};\n\n// SVG filters.\n// (values in parentheses are default values)\nexport const filter = {\n  // `color` ... outline color ('blue')\n  // `width`... outline width (1)\n  // `opacity` ... outline opacity (1)\n  // `margin` ... gap between outline and the element (2)\n  outline: function (args) {\n    var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology in=\"SourceAlpha\" result=\"morphedOuter\" operator=\"dilate\" radius=\"${outerRadius}\" /><feMorphology in=\"SourceAlpha\" result=\"morphedInner\" operator=\"dilate\" radius=\"${innerRadius}\" /><feComposite result=\"morphedOuterColored\" in=\"colored\" in2=\"morphedOuter\" operator=\"in\"/><feComposite operator=\"xor\" in=\"morphedOuterColored\" in2=\"morphedInner\" result=\"outline\"/><feMerge><feMergeNode in=\"outline\"/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n    var margin = Number.isFinite(args.margin) ? args.margin : 2;\n    var width = Number.isFinite(args.width) ? args.width : 1;\n    return template(tpl)({\n      color: args.color || 'blue',\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n      outerRadius: margin + width,\n      innerRadius: margin\n    });\n  },\n  // `color` ... color ('red')\n  // `width`... width (1)\n  // `blur` ... blur (0)\n  // `opacity` ... opacity (1)\n  highlight: function (args) {\n    var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology result=\"morphed\" in=\"SourceGraphic\" operator=\"dilate\" radius=\"${width}\"/><feComposite result=\"composed\" in=\"colored\" in2=\"morphed\" operator=\"in\"/><feGaussianBlur result=\"blured\" in=\"composed\" stdDeviation=\"${blur}\"/><feBlend in=\"SourceGraphic\" in2=\"blured\" mode=\"normal\"/></filter>';\n    return template(tpl)({\n      color: args.color || 'red',\n      width: Number.isFinite(args.width) ? args.width : 1,\n      blur: Number.isFinite(args.blur) ? args.blur : 0,\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1\n    });\n  },\n  // `x` ... horizontal blur (2)\n  // `y` ... vertical blur (optional)\n  blur: function (args) {\n    var x = Number.isFinite(args.x) ? args.x : 2;\n    return template('<filter><feGaussianBlur stdDeviation=\"${stdDeviation}\"/></filter>')({\n      stdDeviation: Number.isFinite(args.y) ? [x, args.y] : x\n    });\n  },\n  // `dx` ... horizontal shift (0)\n  // `dy` ... vertical shift (0)\n  // `blur` ... blur (4)\n  // `color` ... color ('black')\n  // `opacity` ... opacity (1)\n  dropShadow: function (args) {\n    var tpl = 'SVGFEDropShadowElement' in window ? '<filter><feDropShadow stdDeviation=\"${blur}\" dx=\"${dx}\" dy=\"${dy}\" flood-color=\"${color}\" flood-opacity=\"${opacity}\"/></filter>' : '<filter><feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"${blur}\"/><feOffset dx=\"${dx}\" dy=\"${dy}\" result=\"offsetblur\"/><feFlood flood-color=\"${color}\"/><feComposite in2=\"offsetblur\" operator=\"in\"/><feComponentTransfer><feFuncA type=\"linear\" slope=\"${opacity}\"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n    return template(tpl)({\n      dx: args.dx || 0,\n      dy: args.dy || 0,\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n      color: args.color || 'black',\n      blur: Number.isFinite(args.blur) ? args.blur : 4\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely grayscale. A value of 0 leaves the input unchanged.\n  grayscale: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0\"/></filter>')({\n      a: 0.2126 + 0.7874 * (1 - amount),\n      b: 0.7152 - 0.7152 * (1 - amount),\n      c: 0.0722 - 0.0722 * (1 - amount),\n      d: 0.2126 - 0.2126 * (1 - amount),\n      e: 0.7152 + 0.2848 * (1 - amount),\n      f: 0.0722 - 0.0722 * (1 - amount),\n      g: 0.2126 - 0.2126 * (1 - amount),\n      h: 0.0722 + 0.9278 * (1 - amount)\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely sepia. A value of 0 leaves the input unchanged.\n  sepia: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0\"/></filter>')({\n      a: 0.393 + 0.607 * (1 - amount),\n      b: 0.769 - 0.769 * (1 - amount),\n      c: 0.189 - 0.189 * (1 - amount),\n      d: 0.349 - 0.349 * (1 - amount),\n      e: 0.686 + 0.314 * (1 - amount),\n      f: 0.168 - 0.168 * (1 - amount),\n      g: 0.272 - 0.272 * (1 - amount),\n      h: 0.534 - 0.534 * (1 - amount),\n      i: 0.131 + 0.869 * (1 - amount)\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 0 is completely un-saturated. A value of 1 (default) leaves the input unchanged.\n  saturate: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"saturate\" values=\"${amount}\"/></filter>')({\n      amount: 1 - amount\n    });\n  },\n  // `angle` ...  the number of degrees around the color circle the input samples will be adjusted (0).\n  hueRotate: function (args) {\n    return template('<filter><feColorMatrix type=\"hueRotate\" values=\"${angle}\"/></filter>')({\n      angle: args.angle || 0\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely inverted. A value of 0 leaves the input unchanged.\n  invert: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feComponentTransfer><feFuncR type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncG type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncB type=\"table\" tableValues=\"${amount} ${amount2}\"/></feComponentTransfer></filter>')({\n      amount: amount,\n      amount2: 1 - amount\n    });\n  },\n  // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n  brightness: function (args) {\n    return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\"/><feFuncG type=\"linear\" slope=\"${amount}\"/><feFuncB type=\"linear\" slope=\"${amount}\"/></feComponentTransfer></filter>')({\n      amount: Number.isFinite(args.amount) ? args.amount : 1\n    });\n  },\n  // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n  contrast: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncG type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncB type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/></feComponentTransfer></filter>')({\n      amount: amount,\n      amount2: .5 - amount / 2\n    });\n  }\n};\nexport const format = {\n  // Formatting numbers via the Python Format Specification Mini-language.\n  // See http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n  // Heavilly inspired by the D3.js library implementation.\n  number: function (specifier, value, locale) {\n    locale = locale || {\n      currency: ['$', ''],\n      decimal: '.',\n      thousands: ',',\n      grouping: [3]\n    };\n\n    // See Python format specification mini-language: http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n    // [[fill]align][sign][symbol][0][width][,][.precision][type]\n    var re = /(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i;\n    var match = re.exec(specifier);\n    var fill = match[1] || ' ';\n    var align = match[2] || '>';\n    var sign = match[3] || '';\n    var symbol = match[4] || '';\n    var zfill = match[5];\n    var width = +match[6];\n    var comma = match[7];\n    var precision = match[8];\n    var type = match[9];\n    var scale = 1;\n    var prefix = '';\n    var suffix = '';\n    var integer = false;\n    if (precision) precision = +precision.substring(1);\n    if (zfill || fill === '0' && align === '=') {\n      zfill = fill = '0';\n      align = '=';\n      if (comma) width -= Math.floor((width - 1) / 4);\n    }\n    switch (type) {\n      case 'n':\n        comma = true;\n        type = 'g';\n        break;\n      case '%':\n        scale = 100;\n        suffix = '%';\n        type = 'f';\n        break;\n      case 'p':\n        scale = 100;\n        suffix = '%';\n        type = 'r';\n        break;\n      case 'b':\n      case 'o':\n      case 'x':\n      case 'X':\n        if (symbol === '#') prefix = '0' + type.toLowerCase();\n        break;\n      case 'c':\n      case 'd':\n        integer = true;\n        precision = 0;\n        break;\n      case 's':\n        scale = -1;\n        type = 'r';\n        break;\n    }\n    if (symbol === '$') {\n      prefix = locale.currency[0];\n      suffix = locale.currency[1];\n    }\n\n    // If no precision is specified for `'r'`, fallback to general notation.\n    if (type == 'r' && !precision) type = 'g';\n\n    // Ensure that the requested precision is in the supported range.\n    if (precision != null) {\n      if (type == 'g') precision = Math.max(1, Math.min(21, precision));else if (type == 'e' || type == 'f') precision = Math.max(0, Math.min(20, precision));\n    }\n    var zcomma = zfill && comma;\n\n    // Return the empty string for floats formatted as ints.\n    if (integer && value % 1) return '';\n\n    // Convert negative to positive, and record the sign prefix.\n    var negative = value < 0 || value === 0 && 1 / value < 0 ? (value = -value, '-') : sign;\n    var fullSuffix = suffix;\n\n    // Apply the scale, computing it from the value's exponent for si format.\n    // Preserve the existing suffix, if any, such as the currency symbol.\n    if (scale < 0) {\n      var unit = this.prefix(value, precision);\n      value = unit.scale(value);\n      fullSuffix = unit.symbol + suffix;\n    } else {\n      value *= scale;\n    }\n\n    // Convert to the desired precision.\n    value = this.convert(type, value, precision);\n\n    // Break the value into the integer part (before) and decimal part (after).\n    var i = value.lastIndexOf('.');\n    var before = i < 0 ? value : value.substring(0, i);\n    var after = i < 0 ? '' : locale.decimal + value.substring(i + 1);\n    function formatGroup(value) {\n      var i = value.length;\n      var t = [];\n      var j = 0;\n      var g = locale.grouping[0];\n      while (i > 0 && g > 0) {\n        t.push(value.substring(i -= g, i + g));\n        g = locale.grouping[j = (j + 1) % locale.grouping.length];\n      }\n      return t.reverse().join(locale.thousands);\n    }\n\n    // If the fill character is not `'0'`, grouping is applied before padding.\n    if (!zfill && comma && locale.grouping) {\n      before = formatGroup(before);\n    }\n    var length = prefix.length + before.length + after.length + (zcomma ? 0 : negative.length);\n    var padding = length < width ? new Array(length = width - length + 1).join(fill) : '';\n\n    // If the fill character is `'0'`, grouping is applied after padding.\n    if (zcomma) before = formatGroup(padding + before);\n\n    // Apply prefix.\n    negative += prefix;\n\n    // Rejoin integer and decimal parts.\n    value = before + after;\n    return (align === '<' ? negative + value + padding : align === '>' ? padding + negative + value : align === '^' ? padding.substring(0, length >>= 1) + negative + value + padding.substring(length) : negative + (zcomma ? value : padding + value)) + fullSuffix;\n  },\n  // Formatting string via the Python Format string.\n  // See https://docs.python.org/2/library/string.html#format-string-syntax)\n  string: function (formatString, value) {\n    var fieldDelimiterIndex;\n    var fieldDelimiter = '{';\n    var endPlaceholder = false;\n    var formattedStringArray = [];\n    while ((fieldDelimiterIndex = formatString.indexOf(fieldDelimiter)) !== -1) {\n      var pieceFormattedString, formatSpec, fieldName;\n      pieceFormattedString = formatString.slice(0, fieldDelimiterIndex);\n      if (endPlaceholder) {\n        formatSpec = pieceFormattedString.split(':');\n        fieldName = formatSpec.shift().split('.');\n        pieceFormattedString = value;\n        for (var i = 0; i < fieldName.length; i++) pieceFormattedString = pieceFormattedString[fieldName[i]];\n        if (formatSpec.length) pieceFormattedString = this.number(formatSpec, pieceFormattedString);\n      }\n      formattedStringArray.push(pieceFormattedString);\n      formatString = formatString.slice(fieldDelimiterIndex + 1);\n      endPlaceholder = !endPlaceholder;\n      fieldDelimiter = endPlaceholder ? '}' : '{';\n    }\n    formattedStringArray.push(formatString);\n    return formattedStringArray.join('');\n  },\n  convert: function (type, value, precision) {\n    switch (type) {\n      case 'b':\n        return value.toString(2);\n      case 'c':\n        return String.fromCharCode(value);\n      case 'o':\n        return value.toString(8);\n      case 'x':\n        return value.toString(16);\n      case 'X':\n        return value.toString(16).toUpperCase();\n      case 'g':\n        return value.toPrecision(precision);\n      case 'e':\n        return value.toExponential(precision);\n      case 'f':\n        return value.toFixed(precision);\n      case 'r':\n        return (value = this.round(value, this.precision(value, precision))).toFixed(Math.max(0, Math.min(20, this.precision(value * (1 + 1e-15), precision))));\n      default:\n        return value + '';\n    }\n  },\n  round: function (value, precision) {\n    return precision ? Math.round(value * (precision = Math.pow(10, precision))) / precision : Math.round(value);\n  },\n  precision: function (value, precision) {\n    return precision - (value ? Math.ceil(Math.log(value) / Math.LN10) : 1);\n  },\n  prefix: function (value, precision) {\n    var prefixes = ['y', 'z', 'a', 'f', 'p', 'n', '', 'm', '', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'].map(function (d, i) {\n      var k = Math.pow(10, Math.abs(8 - i) * 3);\n      return {\n        scale: i > 8 ? function (d) {\n          return d / k;\n        } : function (d) {\n          return d * k;\n        },\n        symbol: d\n      };\n    });\n    var i = 0;\n    if (value) {\n      if (value < 0) value *= -1;\n      if (precision) value = this.round(value, this.precision(value, precision));\n      i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);\n      i = Math.max(-24, Math.min(24, Math.floor((i <= 0 ? i + 1 : i - 1) / 3) * 3));\n    }\n    return prefixes[8 + i / 3];\n  }\n};\n\n/*\n    Pre-compile the HTML to be used as a template.\n*/\nexport const template = function (html) {\n  /*\n      Must support the variation in templating syntax found here:\n      https://lodash.com/docs#template\n  */\n  var regex = /<%= ([^ ]+) %>|\\$\\{ ?([^{} ]+) ?\\}|\\{\\{([^{} ]+)\\}\\}/g;\n  return function (data) {\n    data = data || {};\n    return html.replace(regex, function (match) {\n      var args = Array.from(arguments);\n      var attr = args.slice(1, 4).find(function (_attr) {\n        return !!_attr;\n      });\n      var attrArray = attr.split('.');\n      var value = data[attrArray.shift()];\n      while (value !== undefined && attrArray.length) {\n        value = value[attrArray.shift()];\n      }\n      return value !== undefined ? value : '';\n    });\n  };\n};\n\n/**\n * @param {Element} el Element, which content is intent to display in full-screen mode, 'window.top.document.body' is default.\n */\nexport const toggleFullScreen = function (el) {\n  var topDocument = window.top.document;\n  el = el || topDocument.body;\n  function prefixedResult(el, prop) {\n    var prefixes = ['webkit', 'moz', 'ms', 'o', ''];\n    for (var i = 0; i < prefixes.length; i++) {\n      var prefix = prefixes[i];\n      var propName = prefix ? prefix + prop : prop.substr(0, 1).toLowerCase() + prop.substr(1);\n      if (el[propName] !== undefined) {\n        return isFunction(el[propName]) ? el[propName]() : el[propName];\n      }\n    }\n  }\n  if (prefixedResult(topDocument, 'FullscreenElement') || prefixedResult(topDocument, 'FullScreenElement')) {\n    prefixedResult(topDocument, 'ExitFullscreen') ||\n    // Spec.\n    prefixedResult(topDocument, 'CancelFullScreen'); // Firefox\n  } else {\n    prefixedResult(el, 'RequestFullscreen') ||\n    // Spec.\n    prefixedResult(el, 'RequestFullScreen'); // Firefox\n  }\n};\n\nexport { isBoolean, isObject, isNumber, isString, mixin, deepMixin, supplement, defaults, deepSupplement, defaultsDeep, assign, invoke, invokeProperty, sortedIndex, uniq, clone, cloneDeep, isEmpty, isEqual, isFunction, isPlainObject, toArray, debounce, groupBy, sortBy, flattenDeep, without, difference, intersection, union, has, result, omit, pick, bindAll, forIn, camelCase, uniqueId, merge };\nexport const noop = function () {};","map":{"version":3,"names":["$","V","config","isBoolean","isObject","isNumber","isString","mixin","deepMixin","supplement","defaults","defaultsDeep","deepSupplement","assign","invoke","invokeProperty","sortedIndex","uniq","clone","cloneDeep","isEmpty","isEqual","isFunction","isPlainObject","toArray","debounce","groupBy","sortBy","flattenDeep","without","difference","intersection","union","has","result","omit","pick","bindAll","forIn","camelCase","uniqueId","merge","addClassNamePrefix","className","toString","split","map","_className","substr","classNamePrefix","length","join","removeClassNamePrefix","parseDOMJSON","json","namespace","selectors","groupSelectors","svgNamespace","svg","ns","fragment","document","createDocumentFragment","parseNode","siblingsDef","parentNode","i","nodeDef","textNode","createTextNode","appendChild","hasOwnProperty","Error","tagName","node","namespaceURI","createElementNS","wrapper","attributes","attr","style","css","baseVal","textContent","nodeSelector","selector","nodeGroups","groupSelector","Array","isArray","j","nodeGroup","group","push","childrenDef","children","hashCode","str","hash","c","charCodeAt","getByPath","obj","path","delimiter","keys","key","Object","undefined","isGetSafe","String","setByPath","value","last","diver","unsetByPath","flattenObject","delim","stop","ret","shouldGoDeeper","flatObject","flatKey","uuid","replace","r","Math","random","v","guid","id","toKebabCase","string","toLowerCase","normalizeEvent","evt","normalized","originalEvent","target","touch","changedTouches","property","useElement","correspondingUseElement","normalizeWheel","PIXEL_STEP","LINE_HEIGHT","PAGE_HEIGHT","sX","sY","pX","pY","detail","wheelDelta","wheelDeltaY","wheelDeltaX","axis","HORIZONTAL_AXIS","deltaX","deltaY","deltaMode","shiftKey","spinX","spinY","cap","val","max","nextFrame","raf","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","lastTime","callback","currTime","Date","getTime","timeToCall","setTimeout","context","rest","bind","cancelFrame","caf","client","cancelAnimationFrame","webkitCancelAnimationFrame","webkitCancelRequestAnimationFrame","msCancelAnimationFrame","msCancelRequestAnimationFrame","oCancelAnimationFrame","oCancelRequestAnimationFrame","mozCancelAnimationFrame","mozCancelRequestAnimationFrame","clearTimeout","shapePerimeterConnectionPoint","linkView","view","magnet","reference","bbox","spot","scalable","rotatable","firstChild","findIntersection","paper","cells","getBBox","model","intersectionWithLineFromCenterToPoint","center","isPercentage","slice","parseCssNumeric","restrictUnits","getUnit","validUnitExp","matches","RegExp","exec","number","parseFloat","Number","isNaN","output","unit","NO_SPACE","splitWordWithEOL","word","eol","eolWords","n","jl","replacement","splice","filter","getLineHeight","heightValue","textElement","height","breakText","text","size","styles","opt","width","svgDocument","textSpan","append","opacity","display","body","preserveSpaces","space","separator","hyphen","maxLineCount","Infinity","words","full","lines","p","h","lineHeight","l","len","isEol","indexOf","data","getComputedTextLength","partition","substring","hyphenIndex","search","lastL","parsed","floor","ellipsis","lastLine","k","lastLineWithOmission","lastChar","separatorChar","match","removeChild","sanitizeHTML","html","parseHTML","find","each","currentNode","currentAttribute","attrName","name","attrValue","startsWith","removeAttr","downloadBlob","blob","fileName","navigator","msSaveBlob","url","URL","createObjectURL","link","createElement","href","download","click","revokeObjectURL","downloadDataUri","dataUri","dataUriToBlob","decodeURIComponent","firstCommaIndex","dataTypeString","mimeString","decodedString","atob","unescape","encodeURIComponent","ia","Uint8Array","Blob","type","imageToDataUri","modernHandler","xhr","status","reader","FileReader","onload","onerror","readAsDataURL","response","legacyHandler","Uint8ToString","u8a","CHUNK_SZ","fromCharCode","apply","subarray","bytes","suffix","pop","meta","b64encoded","btoa","XMLHttpRequest","open","addEventListener","responseType","send","getElementBBox","el","$el","element","doc","ownerDocument","clientBBox","getBoundingClientRect","strokeWidthX","strokeWidthY","ownerSVGElement","vel","x","left","pageXOffset","documentElement","offsetLeft","y","top","pageYOffset","offsetTop","sortElements","elements","comparator","$elements","placements","sortElement","nextSibling","insertBefore","prototype","sort","call","setAttributesBySelector","attrs","$element","addBack","addClass","normalizeSides","box","isFinite","right","bottom","vertical","horizontal","timing","linear","t","quad","cubic","inout","t2","t3","exponential","pow","bounce","a","b","q","reverse","f","reflect","clamp","back","s","elastic","cos","PI","interpolate","d","object","hexColor","ca","parseInt","cb","ra","rd","ga","gd","ba","bd","g","ma","mb","u","toFixed","outline","args","tpl","margin","template","color","outerRadius","innerRadius","highlight","blur","stdDeviation","dropShadow","dx","dy","grayscale","amount","e","sepia","saturate","hueRotate","angle","invert","amount2","brightness","contrast","format","specifier","locale","currency","decimal","thousands","grouping","re","fill","align","sign","symbol","zfill","comma","precision","scale","prefix","integer","min","zcomma","negative","fullSuffix","convert","lastIndexOf","before","after","formatGroup","padding","formatString","fieldDelimiterIndex","fieldDelimiter","endPlaceholder","formattedStringArray","pieceFormattedString","formatSpec","fieldName","shift","toUpperCase","toPrecision","toExponential","round","ceil","log","LN10","prefixes","abs","regex","from","arguments","_attr","attrArray","toggleFullScreen","topDocument","prefixedResult","prop","propName","noop"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-mgmt-frontend/node_modules/jointjs/src/util/util.mjs"],"sourcesContent":["import $ from 'jquery';\nimport V from '../V/index.mjs';\nimport { config } from '../config/index.mjs';\nimport { \n    isBoolean,\n    isObject,\n    isNumber,\n    isString,\n    mixin,\n    deepMixin,\n    supplement,\n    defaults,\n    defaultsDeep,\n    deepSupplement,\n    assign,\n    invoke,\n    invokeProperty,\n    sortedIndex,\n    uniq,\n    clone,\n    cloneDeep,\n    isEmpty,\n    isEqual,\n    isFunction,\n    isPlainObject,\n    toArray,\n    debounce,\n    groupBy,\n    sortBy,\n    flattenDeep,\n    without,\n    difference,\n    intersection,\n    union,\n    has,\n    result,\n    omit,\n    pick,\n    bindAll,\n    forIn,\n    camelCase,\n    uniqueId,\n    merge\n} from './utilHelpers.mjs';\n\nexport const addClassNamePrefix = function(className) {\n\n    if (!className) return className;\n\n    return className.toString().split(' ').map(function(_className) {\n\n        if (_className.substr(0, config.classNamePrefix.length) !== config.classNamePrefix) {\n            _className = config.classNamePrefix + _className;\n        }\n\n        return _className;\n\n    }).join(' ');\n};\n\nexport const removeClassNamePrefix = function(className) {\n\n    if (!className) return className;\n\n    return className.toString().split(' ').map(function(_className) {\n\n        if (_className.substr(0, config.classNamePrefix.length) === config.classNamePrefix) {\n            _className = _className.substr(config.classNamePrefix.length);\n        }\n\n        return _className;\n\n    }).join(' ');\n};\n\nexport const parseDOMJSON = function(json, namespace) {\n\n    const selectors = {};\n    const groupSelectors = {};\n    const svgNamespace = V.namespace.svg;\n\n    const ns = namespace || svgNamespace;\n    const fragment = document.createDocumentFragment();\n\n    const parseNode = function(siblingsDef, parentNode, ns) {\n        for (let i = 0; i < siblingsDef.length; i++) {\n            const nodeDef = siblingsDef[i];\n\n            // Text node\n            if (typeof nodeDef === 'string') {\n                const textNode = document.createTextNode(nodeDef);\n                parentNode.appendChild(textNode);\n                continue;\n            }\n\n            // TagName\n            if (!nodeDef.hasOwnProperty('tagName')) throw new Error('json-dom-parser: missing tagName');\n            const tagName = nodeDef.tagName;\n\n            let node;\n\n            // Namespace URI\n            if (nodeDef.hasOwnProperty('namespaceURI')) ns = nodeDef.namespaceURI;\n            node = document.createElementNS(ns, tagName);\n            const svg = (ns === svgNamespace);\n\n            const wrapper = (svg) ? V : $;\n            // Attributes\n            const attributes = nodeDef.attributes;\n            if (attributes) wrapper(node).attr(attributes);\n            // Style\n            const style = nodeDef.style;\n            if (style) $(node).css(style);\n            // ClassName\n            if (nodeDef.hasOwnProperty('className')) {\n                const className = nodeDef.className;\n                if (svg) {\n                    node.className.baseVal = className;\n                } else {\n                    node.className = className;\n                }\n            }\n            // TextContent\n            if (nodeDef.hasOwnProperty('textContent')) {\n                node.textContent = nodeDef.textContent;\n            }\n            // Selector\n            if (nodeDef.hasOwnProperty('selector')) {\n                const nodeSelector = nodeDef.selector;\n                if (selectors[nodeSelector]) throw new Error('json-dom-parser: selector must be unique');\n                selectors[nodeSelector] = node;\n                wrapper(node).attr('joint-selector', nodeSelector);\n            }\n            // Groups\n            if (nodeDef.hasOwnProperty('groupSelector')) {\n                let nodeGroups = nodeDef.groupSelector;\n                if (!Array.isArray(nodeGroups)) nodeGroups = [nodeGroups];\n                for (let j = 0; j < nodeGroups.length; j++) {\n                    const nodeGroup = nodeGroups[j];\n                    let group = groupSelectors[nodeGroup];\n                    if (!group) group = groupSelectors[nodeGroup] = [];\n                    group.push(node);\n                }\n            }\n\n            parentNode.appendChild(node);\n\n            // Children\n            const childrenDef = nodeDef.children;\n            if (Array.isArray(childrenDef)) {\n                parseNode(childrenDef, node, ns);\n            }\n        }\n    };\n    parseNode(json, fragment, ns);\n    return {\n        fragment: fragment,\n        selectors: selectors,\n        groupSelectors: groupSelectors\n    };\n};\n\n// Return a simple hash code from a string. See http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/.\nexport const hashCode = function(str) {\n\n    let hash = 0;\n    if (str.length === 0) return hash;\n    for (let i = 0; i < str.length; i++) {\n        const c = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + c;\n        hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n};\n\nexport const getByPath = function(obj, path, delimiter) {\n\n    var keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    var key;\n    var i = 0;\n    var length = keys.length;\n    while (i < length) {\n        key = keys[i++];\n        if (Object(obj) === obj && key in obj) {\n            obj = obj[key];\n        } else {\n            return undefined;\n        }\n    }\n    return obj;\n};\n\nconst isGetSafe = function(obj, key) {\n    // Prevent prototype pollution\n    // https://snyk.io/vuln/SNYK-JS-JSON8MERGEPATCH-1038399\n    if (typeof key !== 'string' && typeof key !== 'number') {\n        key = String(key);\n    }\n    if (key === 'constructor' && typeof obj[key] === 'function') {\n        return false;\n    }\n    if (key === '__proto__') {\n        return false;\n    }\n    return true;\n};\n\nexport const setByPath = function(obj, path, value, delimiter) {\n\n    const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    const last = keys.length - 1;\n    let diver = obj;\n    let i = 0;\n\n    for (; i < last; i++) {\n        const key = keys[i];\n        if (!isGetSafe(diver, key)) return obj;\n        const value = diver[key];\n        // diver creates an empty object if there is no nested object under such a key.\n        // This means that one can populate an empty nested object with setByPath().\n        diver = value || (diver[key] = {});\n    }\n\n    diver[keys[last]] = value;\n\n    return obj;\n};\n\nexport const unsetByPath = function(obj, path, delimiter) {\n\n    const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    const last = keys.length - 1;\n    let diver = obj;\n    let i = 0;\n\n    for (; i < last; i++) {\n        const key = keys[i];\n        if (!isGetSafe(diver, key)) return obj;\n        const value = diver[key];\n        if (!value) return obj;\n        diver = value;\n    }\n\n    delete diver[keys[last]];\n\n    return obj;\n};\n\nexport const flattenObject = function(obj, delim, stop) {\n\n    delim = delim || '/';\n    var ret = {};\n\n    for (var key in obj) {\n\n        if (!obj.hasOwnProperty(key)) continue;\n\n        var shouldGoDeeper = typeof obj[key] === 'object';\n        if (shouldGoDeeper && stop && stop(obj[key])) {\n            shouldGoDeeper = false;\n        }\n\n        if (shouldGoDeeper) {\n\n            var flatObject = flattenObject(obj[key], delim, stop);\n\n            for (var flatKey in flatObject) {\n                if (!flatObject.hasOwnProperty(flatKey)) continue;\n                ret[key + delim + flatKey] = flatObject[flatKey];\n            }\n\n        } else {\n\n            ret[key] = obj[key];\n        }\n    }\n\n    return ret;\n};\n\nexport const uuid = function() {\n\n    // credit: http://stackoverflow.com/posts/2117523/revisions\n\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (Math.random() * 16) | 0;\n        var v = (c === 'x') ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n};\n\n// Generates global unique id and stores it as a property of the object, if provided.\nexport const guid = function(obj) {\n\n    guid.id = guid.id || 1;\n\n    if (obj === undefined) {\n        return 'j_' + guid.id++;\n    }\n\n    obj.id = (obj.id === undefined ? 'j_' + guid.id++ : obj.id);\n    return obj.id;\n};\n\nexport const toKebabCase = function(string) {\n\n    return string.replace(/[A-Z]/g, '-$&').toLowerCase();\n};\n\nexport const normalizeEvent = function(evt) {\n\n    if (evt.normalized) return evt;\n\n    const { originalEvent, target } = evt;\n\n    // If the event is a touch event, normalize it to a mouse event.\n    const touch = originalEvent && originalEvent.changedTouches && originalEvent.changedTouches[0];\n    if (touch) {\n        for (let property in touch) {\n            // copy all the properties from the first touch that are not\n            // defined on TouchEvent (clientX, clientY, pageX, pageY, screenX, screenY, identifier, ...)\n            if (evt[property] === undefined) {\n                evt[property] = touch[property];\n            }\n        }\n    }\n    // IE: evt.target could be set to SVGElementInstance for SVGUseElement\n    if (target) {\n        const useElement = target.correspondingUseElement;\n        if (useElement) evt.target = useElement;\n    }\n\n    evt.normalized = true;\n\n    return evt;\n};\n\nexport const normalizeWheel = function(evt) {\n    // Sane values derived empirically\n    const PIXEL_STEP  = 10;\n    const LINE_HEIGHT = 40;\n    const PAGE_HEIGHT = 800;\n\n    let sX = 0, sY = 0, pX = 0, pY = 0;\n\n    // Legacy\n    if ('detail'      in evt) { sY = evt.detail; }\n    if ('wheelDelta'  in evt) { sY = -evt.wheelDelta / 120; }\n    if ('wheelDeltaY' in evt) { sY = -evt.wheelDeltaY / 120; }\n    if ('wheelDeltaX' in evt) { sX = -evt.wheelDeltaX / 120; }\n\n    // side scrolling on FF with DOMMouseScroll\n    if ( 'axis' in evt && evt.axis === evt.HORIZONTAL_AXIS ) {\n        sX = sY;\n        sY = 0;\n    }\n\n    pX = 'deltaX' in evt ? evt.deltaX : sX * PIXEL_STEP;\n    pY = 'deltaY' in evt ? evt.deltaY : sY * PIXEL_STEP;\n\n    if ((pX || pY) && evt.deltaMode) {\n        if (evt.deltaMode == 1) {\n            pX *= LINE_HEIGHT;\n            pY *= LINE_HEIGHT;\n        } else {\n            pX *= PAGE_HEIGHT;\n            pY *= PAGE_HEIGHT;\n        }\n    }\n\n    // macOS switches deltaX and deltaY automatically when scrolling with shift key, so this is needed in other cases\n    if (evt.deltaX === 0 && evt.deltaY !== 0 && evt.shiftKey) {\n        pX = pY;\n        pY = 0;\n        sX = sY;\n        sY = 0;\n    }\n\n    // Fall-back if spin cannot be determined\n    if (pX && !sX) { sX = (pX < 1) ? -1 : 1; }\n    if (pY && !sY) { sY = (pY < 1) ? -1 : 1; }\n\n    return {\n        spinX  : sX,\n        spinY  : sY,\n        deltaX : pX,\n        deltaY : pY,\n    };\n};\n\nexport const cap = function(val, max) {\n    return val > max ? max : val < -max ? -max : val;\n};\n\nexport const nextFrame = (function() {\n\n    var raf;\n\n    if (typeof window !== 'undefined') {\n\n        raf = window.requestAnimationFrame ||\n            window.webkitRequestAnimationFrame ||\n            window.mozRequestAnimationFrame ||\n            window.oRequestAnimationFrame ||\n            window.msRequestAnimationFrame;\n    }\n\n    if (!raf) {\n\n        var lastTime = 0;\n\n        raf = function(callback) {\n\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = setTimeout(function() {\n                callback(currTime + timeToCall);\n            }, timeToCall);\n\n            lastTime = currTime + timeToCall;\n\n            return id;\n        };\n    }\n\n    return function(callback, context, ...rest) {\n        return (context !== undefined)\n            ? raf(callback.bind(context, ...rest))\n            : raf(callback);\n    };\n\n})();\n\nexport const cancelFrame = (function() {\n\n    var caf;\n    var client = typeof window != 'undefined';\n\n    if (client) {\n\n        caf = window.cancelAnimationFrame ||\n            window.webkitCancelAnimationFrame ||\n            window.webkitCancelRequestAnimationFrame ||\n            window.msCancelAnimationFrame ||\n            window.msCancelRequestAnimationFrame ||\n            window.oCancelAnimationFrame ||\n            window.oCancelRequestAnimationFrame ||\n            window.mozCancelAnimationFrame ||\n            window.mozCancelRequestAnimationFrame;\n    }\n\n    caf = caf || clearTimeout;\n\n    return client ? caf.bind(window) : caf;\n\n})();\n\n/**\n * @deprecated\n */\nexport const shapePerimeterConnectionPoint = function(linkView, view, magnet, reference) {\n\n    var bbox;\n    var spot;\n\n    if (!magnet) {\n\n        // There is no magnet, try to make the best guess what is the\n        // wrapping SVG element. This is because we want this \"smart\"\n        // connection points to work out of the box without the\n        // programmer to put magnet marks to any of the subelements.\n        // For example, we want the function to work on basic.Path elements\n        // without any special treatment of such elements.\n        // The code below guesses the wrapping element based on\n        // one simple assumption. The wrapping elemnet is the\n        // first child of the scalable group if such a group exists\n        // or the first child of the rotatable group if not.\n        // This makese sense because usually the wrapping element\n        // is below any other sub element in the shapes.\n        var scalable = view.$('.scalable')[0];\n        var rotatable = view.$('.rotatable')[0];\n\n        if (scalable && scalable.firstChild) {\n\n            magnet = scalable.firstChild;\n\n        } else if (rotatable && rotatable.firstChild) {\n\n            magnet = rotatable.firstChild;\n        }\n    }\n\n    if (magnet) {\n\n        spot = V(magnet).findIntersection(reference, linkView.paper.cells);\n        if (!spot) {\n            bbox = V(magnet).getBBox({ target: linkView.paper.cells });\n        }\n\n    } else {\n\n        bbox = view.model.getBBox();\n        spot = bbox.intersectionWithLineFromCenterToPoint(reference);\n    }\n    return spot || bbox.center();\n};\n\nexport const isPercentage = function(val) {\n\n    return isString(val) && val.slice(-1) === '%';\n};\n\nexport const parseCssNumeric = function(val, restrictUnits) {\n\n    function getUnit(validUnitExp) {\n\n        // one or more numbers, followed by\n        // any number of (\n        //  `.`, followed by\n        //  one or more numbers\n        // ), followed by\n        // `validUnitExp`, followed by\n        // end of string\n        var matches = new RegExp('(?:\\\\d+(?:\\\\.\\\\d+)*)(' + validUnitExp + ')$').exec(val);\n\n        if (!matches) return null;\n        return matches[1];\n    }\n\n    var number = parseFloat(val);\n\n    // if `val` cannot be parsed as a number, return `null`\n    if (Number.isNaN(number)) return null;\n\n    // else: we know `output.value`\n    var output = {};\n    output.value = number;\n\n    // determine the unit\n    var validUnitExp;\n    if (restrictUnits == null) {\n        // no restriction\n        // accept any unit, as well as no unit\n        validUnitExp = '[A-Za-z]*';\n\n    } else if (Array.isArray(restrictUnits)) {\n        // if this is an empty array, top restriction - return `null`\n        if (restrictUnits.length === 0) return null;\n\n        // else: restriction - an array of valid unit strings\n        validUnitExp = restrictUnits.join('|');\n\n    } else if (isString(restrictUnits)) {\n        // restriction - a single valid unit string\n        validUnitExp = restrictUnits;\n    }\n    var unit = getUnit(validUnitExp);\n\n    // if we found no matches for `restrictUnits`, return `null`\n    if (unit === null) return null;\n\n    // else: we know the unit\n    output.unit = unit;\n    return output;\n};\n\nconst NO_SPACE = 0;\n\nfunction splitWordWithEOL(word, eol) {\n    const eolWords = word.split(eol);\n    let n = 1;\n    for (let j = 0, jl = eolWords.length - 1; j < jl; j++) {\n        const replacement = [];\n        if (j > 0 || eolWords[0] !== '') replacement.push(NO_SPACE);\n        replacement.push(eol);\n        if (j < jl - 1 || eolWords[jl] !== '') replacement.push(NO_SPACE);\n        eolWords.splice(n, 0, ...replacement);\n        n += replacement.length + 1;\n    }\n    return eolWords.filter(word => word !== '');\n}\n\n\nfunction getLineHeight(heightValue, textElement) {\n    if (heightValue === null) {\n        // Default 1em lineHeight\n        return textElement.getBBox().height;\n    }\n\n    switch (heightValue.unit) {\n        case 'em':\n            return textElement.getBBox().height * heightValue.value;\n        case 'px':\n        case '':\n            return heightValue.value;\n    }\n}\n\nexport const breakText = function(text, size, styles = {}, opt = {}) {\n\n    var width = size.width;\n    var height = size.height;\n\n    var svgDocument = opt.svgDocument || V('svg').node;\n    var textSpan = V('tspan').node;\n    var textElement = V('text').attr(styles).append(textSpan).node;\n    var textNode = document.createTextNode('');\n\n    // Prevent flickering\n    textElement.style.opacity = 0;\n    // Prevent FF from throwing an uncaught exception when `getBBox()`\n    // called on element that is not in the render tree (is not measurable).\n    // <tspan>.getComputedTextLength() returns always 0 in this case.\n    // Note that the `textElement` resp. `textSpan` can become hidden\n    // when it's appended to the DOM and a `display: none` CSS stylesheet\n    // rule gets applied.\n    textElement.style.display = 'block';\n    textSpan.style.display = 'block';\n\n    textSpan.appendChild(textNode);\n    svgDocument.appendChild(textElement); // lgtm [js/xss-through-dom]\n\n    if (!opt.svgDocument) {\n\n        document.body.appendChild(svgDocument);\n    }\n\n    const preserveSpaces = opt.preserveSpaces;\n    const space = ' ';\n    var separator = opt.separator || space;\n    var eol = opt.eol || '\\n';\n    var hyphen = opt.hyphen ? new RegExp(opt.hyphen) : /[^\\w\\d]/;\n    var maxLineCount = opt.maxLineCount;\n    if (!isNumber(maxLineCount)) maxLineCount = Infinity;\n\n    var words = text.split(separator);\n    var full = [];\n    var lines = [];\n    var p, h;\n    var lineHeight;\n\n    if (preserveSpaces) {\n        V(textSpan).attr('xml:space', 'preserve');\n    }\n\n    for (var i = 0, l = 0, len = words.length; i < len; i++) {\n\n        var word = words[i];\n\n        if (!word && !preserveSpaces) continue;\n        if (typeof word !== 'string') continue;\n\n        var isEol = false;\n        if (eol && word.indexOf(eol) >= 0) {\n            // word contains end-of-line character\n            if (word.length > 1) {\n                // separate word and continue cycle\n                const eolWords = splitWordWithEOL(words[i], eol);\n                words.splice(i, 1, ...eolWords);\n                i--;\n                len = words.length;\n                continue;\n            } else {\n                // creates a new line\n                if (preserveSpaces && typeof words[i - 1] === 'string' ) {\n                    words.splice(i, NO_SPACE, '', NO_SPACE);\n                    len += 2;\n                    i--;\n                    continue;\n                }\n                lines[++l] = (!preserveSpaces || typeof words[i + 1] === 'string') ? '' : undefined;\n                isEol = true;\n            }\n        }\n\n        if (!isEol) {\n\n            let data;\n            if (preserveSpaces) {\n                data = lines[l] !== undefined ? lines[l] + space + word : word;\n            } else {\n                data = lines[l] ? lines[l] + space + word : word;\n            }\n\n            textNode.data = data;\n\n            if (textSpan.getComputedTextLength() <= width) {\n\n                // the current line fits\n                lines[l] = data;\n\n                if (p || h) {\n                // We were partitioning. Put rest of the word onto next line\n                    full[l++] = true;\n\n                    // cancel partitioning and splitting by hyphens\n                    p = 0;\n                    h = 0;\n                }\n\n            } else {\n\n                if (!lines[l] || p) {\n\n                    var partition = !!p;\n\n                    p = word.length - 1;\n\n                    if (partition || !p) {\n\n                        // word has only one character.\n                        if (!p) {\n\n                            if (!lines[l]) {\n\n                                // we won't fit this text within our rect\n                                lines = [];\n\n                                break;\n                            }\n\n                            // partitioning didn't help on the non-empty line\n                            // try again, but this time start with a new line\n\n                            // cancel partitions created\n                            words.splice(i, 2, word + words[i + 1]);\n\n                            // adjust word length\n                            len--;\n\n                            full[l++] = true;\n                            i--;\n\n                            continue;\n                        }\n\n                        // move last letter to the beginning of the next word\n                        words[i] = word.substring(0, p);\n                        words[i + 1] = word.substring(p) + (words[i + 1] === undefined ? '' : words[i + 1]);\n\n                    } else {\n\n                        if (h) {\n                        // cancel splitting and put the words together again\n                            words.splice(i, 2, words[i] + words[i + 1]);\n                            h = 0;\n                        } else {\n                            var hyphenIndex = word.search(hyphen);\n                            if (hyphenIndex > -1 && hyphenIndex !== word.length - 1 && hyphenIndex !== 0) {\n                                h = hyphenIndex + 1;\n                                p = 0;\n                            }\n\n                            // We initiate partitioning or splitting\n                            // split the long word into two words\n                            words.splice(i, 1, word.substring(0, h || p), word.substring(h|| p));\n                            // adjust words length\n                            len++;\n\n                        }\n\n                        if (l && !full[l - 1]) {\n                        // if the previous line is not full, try to fit max part of\n                        // the current word there\n                            l--;\n                        }\n                    }\n\n                    if (!preserveSpaces || lines[l] !== '') {\n                        i--;\n                    }\n\n                    continue;\n                }\n\n                l++;\n                i--;\n            }\n        }\n        var lastL = null;\n\n        if (lines.length > maxLineCount) {\n\n            lastL = maxLineCount - 1;\n\n        } else if (height !== undefined) {\n\n            // if size.height is defined we have to check whether the height of the entire\n            // text exceeds the rect height\n\n            if (lineHeight === undefined && textNode.data !== '') {\n\n                // use the same defaults as in V.prototype.text\n                if (styles.lineHeight === 'auto') {\n                    lineHeight = getLineHeight({ value: 1.5, unit: 'em' }, textElement);\n                } else {\n                    const parsed = parseCssNumeric(styles.lineHeight, ['em', 'px', '']);\n\n                    lineHeight = getLineHeight(parsed, textElement);\n                }\n            }\n\n            if (lineHeight * lines.length > height) {\n                // remove overflowing lines\n                lastL = Math.floor(height / lineHeight) - 1;\n            }\n        }\n\n        if (lastL !== null) {\n\n            lines.splice(lastL + 1);\n\n            // add ellipsis\n            var ellipsis = opt.ellipsis;\n            if (!ellipsis || lastL < 0) break;\n            if (typeof ellipsis !== 'string') ellipsis = '\\u2026';\n\n            var lastLine = lines[lastL];\n            if (!lastLine && !isEol) break;\n            var k = lastLine.length;\n            var lastLineWithOmission, lastChar, separatorChar;\n            do {\n                lastChar = lastLine[k];\n                lastLineWithOmission = lastLine.substring(0, k);\n                if (!lastChar) {\n                    separatorChar = (typeof separator === 'string') ? separator : ' ';\n                    lastLineWithOmission += separatorChar;\n                } else if (lastChar.match(separator)) {\n                    lastLineWithOmission += lastChar;\n                }\n                lastLineWithOmission += ellipsis;\n                textNode.data = lastLineWithOmission;\n                if (textSpan.getComputedTextLength() <= width) {\n                    lines[lastL] = lastLineWithOmission;\n                    break;\n                }\n                k--;\n            } while (k >= 0);\n            break;\n        }\n    }\n\n    if (opt.svgDocument) {\n\n        // svg document was provided, remove the text element only\n        svgDocument.removeChild(textElement);\n\n    } else {\n\n        // clean svg document\n        document.body.removeChild(svgDocument);\n    }\n\n    return lines.join(eol);\n};\n\n// Sanitize HTML\n// Based on https://gist.github.com/ufologist/5a0da51b2b9ef1b861c30254172ac3c9\n// Parses a string into an array of DOM nodes.\n// Then outputs it back as a string.\nexport const sanitizeHTML = function(html) {\n\n    // Ignores tags that are invalid inside a <div> tag (e.g. <body>, <head>)\n\n    // If documentContext (second parameter) is not specified or given as `null` or `undefined`, a new document is used.\n    // Inline events will not execute when the HTML is parsed; this includes, for example, sending GET requests for images.\n\n    // If keepScripts (last parameter) is `false`, scripts are not executed.\n    var output = $($.parseHTML('<div>' + html + '</div>', null, false));\n\n    output.find('*').each(function() { // for all nodes\n        var currentNode = this;\n\n        $.each(currentNode.attributes, function() { // for all attributes in each node\n            var currentAttribute = this;\n\n            var attrName = currentAttribute.name;\n            var attrValue = currentAttribute.value;\n\n            // Remove attribute names that start with \"on\" (e.g. onload, onerror...).\n            // Remove attribute values that start with \"javascript:\" pseudo protocol (e.g. `href=\"javascript:alert(1)\"`).\n            if (attrName.startsWith('on') || attrValue.startsWith('javascript:') || attrValue.startsWith('data:') || attrValue.startsWith('vbscript:')) {\n                $(currentNode).removeAttr(attrName);\n            }\n        });\n    });\n\n    return output.html();\n};\n\n// Download `blob` as file with `fileName`.\n// Does not work in IE9.\nexport const downloadBlob = function(blob, fileName) {\n\n    if (window.navigator.msSaveBlob) { // requires IE 10+\n        // pulls up a save dialog\n        window.navigator.msSaveBlob(blob, fileName);\n\n    } else { // other browsers\n        // downloads directly in Chrome and Safari\n\n        // presents a save/open dialog in Firefox\n        // Firefox bug: `from` field in save dialog always shows `from:blob:`\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=1053327\n\n        var url = window.URL.createObjectURL(blob);\n        var link = document.createElement('a');\n\n        link.href = url;\n        link.download = fileName;\n        document.body.appendChild(link);\n\n        link.click();\n\n        document.body.removeChild(link);\n        window.URL.revokeObjectURL(url); // mark the url for garbage collection\n    }\n};\n\n// Download `dataUri` as file with `fileName`.\n// Does not work in IE9.\nexport const downloadDataUri = function(dataUri, fileName) {\n\n    const blob = dataUriToBlob(dataUri);\n    downloadBlob(blob, fileName);\n};\n\n// Convert an uri-encoded data component (possibly also base64-encoded) to a blob.\nexport const dataUriToBlob = function(dataUri) {\n\n    // first, make sure there are no newlines in the data uri\n    dataUri = dataUri.replace(/\\s/g, '');\n    dataUri = decodeURIComponent(dataUri);\n\n    var firstCommaIndex = dataUri.indexOf(','); // split dataUri as `dataTypeString`,`data`\n\n    var dataTypeString = dataUri.slice(0, firstCommaIndex); // e.g. 'data:image/jpeg;base64'\n    var mimeString = dataTypeString.split(':')[1].split(';')[0]; // e.g. 'image/jpeg'\n\n    var data = dataUri.slice(firstCommaIndex + 1);\n    var decodedString;\n    if (dataTypeString.indexOf('base64') >= 0) { // data may be encoded in base64\n        decodedString = atob(data); // decode data\n    } else {\n        // convert the decoded string to UTF-8\n        decodedString = unescape(encodeURIComponent(data));\n    }\n    // write the bytes of the string to a typed array\n    var ia = new Uint8Array(decodedString.length);\n    for (var i = 0; i < decodedString.length; i++) {\n        ia[i] = decodedString.charCodeAt(i);\n    }\n\n    return new Blob([ia], { type: mimeString }); // return the typed array as Blob\n};\n\n// Read an image at `url` and return it as base64-encoded data uri.\n// The mime type of the image is inferred from the `url` file extension.\n// If data uri is provided as `url`, it is returned back unchanged.\n// `callback` is a method with `err` as first argument and `dataUri` as second argument.\n// Works with IE9.\nexport const imageToDataUri = function(url, callback) {\n\n    if (!url || url.substr(0, 'data:'.length) === 'data:') {\n        // No need to convert to data uri if it is already in data uri.\n\n        // This not only convenient but desired. For example,\n        // IE throws a security error if data:image/svg+xml is used to render\n        // an image to the canvas and an attempt is made to read out data uri.\n        // Now if our image is already in data uri, there is no need to render it to the canvas\n        // and so we can bypass this error.\n\n        // Keep the async nature of the function.\n        return setTimeout(function() {\n            callback(null, url);\n        }, 0);\n    }\n\n    // chrome, IE10+\n    var modernHandler = function(xhr, callback) {\n\n        if (xhr.status === 200) {\n\n            var reader = new FileReader();\n\n            reader.onload = function(evt) {\n                var dataUri = evt.target.result;\n                callback(null, dataUri);\n            };\n\n            reader.onerror = function() {\n                callback(new Error('Failed to load image ' + url));\n            };\n\n            reader.readAsDataURL(xhr.response);\n        } else {\n            callback(new Error('Failed to load image ' + url));\n        }\n    };\n\n    var legacyHandler = function(xhr, callback) {\n\n        var Uint8ToString = function(u8a) {\n            var CHUNK_SZ = 0x8000;\n            var c = [];\n            for (var i = 0; i < u8a.length; i += CHUNK_SZ) {\n                c.push(String.fromCharCode.apply(null, u8a.subarray(i, i + CHUNK_SZ)));\n            }\n            return c.join('');\n        };\n\n        if (xhr.status === 200) {\n\n            var bytes = new Uint8Array(xhr.response);\n\n            var suffix = (url.split('.').pop()) || 'png';\n            var map = {\n                'svg': 'svg+xml'\n            };\n            var meta = 'data:image/' + (map[suffix] || suffix) + ';base64,';\n            var b64encoded = meta + btoa(Uint8ToString(bytes));\n            callback(null, b64encoded);\n        } else {\n            callback(new Error('Failed to load image ' + url));\n        }\n    };\n\n    var xhr = new XMLHttpRequest();\n\n    xhr.open('GET', url, true);\n    xhr.addEventListener('error', function() {\n        callback(new Error('Failed to load image ' + url));\n    });\n\n    xhr.responseType = window.FileReader ? 'blob' : 'arraybuffer';\n\n    xhr.addEventListener('load', function() {\n        if (window.FileReader) {\n            modernHandler(xhr, callback);\n        } else {\n            legacyHandler(xhr, callback);\n        }\n    });\n\n    xhr.send();\n};\n\nexport const getElementBBox = function(el) {\n\n    var $el = $(el);\n    if ($el.length === 0) {\n        throw new Error('Element not found');\n    }\n\n    var element = $el[0];\n    var doc = element.ownerDocument;\n    var clientBBox = element.getBoundingClientRect();\n\n    var strokeWidthX = 0;\n    var strokeWidthY = 0;\n\n    // Firefox correction\n    if (element.ownerSVGElement) {\n\n        var vel = V(element);\n        var bbox = vel.getBBox({ target: vel.svg() });\n\n        // if FF getBoundingClientRect includes stroke-width, getBBox doesn't.\n        // To unify this across all browsers we need to adjust the final bBox with `stroke-width` value.\n        strokeWidthX = (clientBBox.width - bbox.width);\n        strokeWidthY = (clientBBox.height - bbox.height);\n    }\n\n    return {\n        x: clientBBox.left + window.pageXOffset - doc.documentElement.offsetLeft + strokeWidthX / 2,\n        y: clientBBox.top + window.pageYOffset - doc.documentElement.offsetTop + strokeWidthY / 2,\n        width: clientBBox.width - strokeWidthX,\n        height: clientBBox.height - strokeWidthY\n    };\n};\n\n\n// Highly inspired by the jquery.sortElements plugin by Padolsey.\n// See http://james.padolsey.com/javascript/sorting-elements-with-jquery/.\nexport const sortElements = function(elements, comparator) {\n\n    var $elements = $(elements);\n    var placements = $elements.map(function() {\n\n        var sortElement = this;\n        var parentNode = sortElement.parentNode;\n        // Since the element itself will change position, we have\n        // to have some way of storing it's original position in\n        // the DOM. The easiest way is to have a 'flag' node:\n        var nextSibling = parentNode.insertBefore(document.createTextNode(''), sortElement.nextSibling);\n\n        return function() {\n\n            if (parentNode === this) {\n                throw new Error('You can\\'t sort elements if any one is a descendant of another.');\n            }\n\n            // Insert before flag:\n            parentNode.insertBefore(this, nextSibling);\n            // Remove flag:\n            parentNode.removeChild(nextSibling);\n        };\n    });\n\n    return Array.prototype.sort.call($elements, comparator).each(function(i) {\n        placements[i].call(this);\n    });\n};\n\n// Sets attributes on the given element and its descendants based on the selector.\n// `attrs` object: { [SELECTOR1]: { attrs1 }, [SELECTOR2]: { attrs2}, ... } e.g. { 'input': { color : 'red' }}\nexport const setAttributesBySelector = function(element, attrs) {\n\n    var $element = $(element);\n\n    forIn(attrs, function(attrs, selector) {\n        var $elements = $element.find(selector).addBack().filter(selector);\n        // Make a special case for setting classes.\n        // We do not want to overwrite any existing class.\n        if (has(attrs, 'class')) {\n            $elements.addClass(attrs['class']);\n            attrs = omit(attrs, 'class');\n        }\n        $elements.attr(attrs);\n    });\n};\n\n// Return a new object with all four sides (top, right, bottom, left) in it.\n// Value of each side is taken from the given argument (either number or object).\n// Default value for a side is 0.\n// Examples:\n// normalizeSides(5) --> { top: 5, right: 5, bottom: 5, left: 5 }\n// normalizeSides({ horizontal: 5 }) --> { top: 0, right: 5, bottom: 0, left: 5 }\n// normalizeSides({ left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 10, left: 5 }) --> { top: 0, right: 10, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 0, left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\nexport const normalizeSides = function(box) {\n\n    if (Object(box) !== box) { // `box` is not an object\n        var val = 0; // `val` left as 0 if `box` cannot be understood as finite number\n        if (isFinite(box)) val = +box; // actually also accepts string numbers (e.g. '100')\n\n        return { top: val, right: val, bottom: val, left: val };\n    }\n\n    // `box` is an object\n    var top, right, bottom, left;\n    top = right = bottom = left = 0;\n\n    if (isFinite(box.vertical)) top = bottom = +box.vertical;\n    if (isFinite(box.horizontal)) right = left = +box.horizontal;\n\n    if (isFinite(box.top)) top = +box.top; // overwrite vertical\n    if (isFinite(box.right)) right = +box.right; // overwrite horizontal\n    if (isFinite(box.bottom)) bottom = +box.bottom; // overwrite vertical\n    if (isFinite(box.left)) left = +box.left; // overwrite horizontal\n\n    return { top: top, right: right, bottom: bottom, left: left };\n};\n\nexport const timing = {\n\n    linear: function(t) {\n        return t;\n    },\n\n    quad: function(t) {\n        return t * t;\n    },\n\n    cubic: function(t) {\n        return t * t * t;\n    },\n\n    inout: function(t) {\n        if (t <= 0) return 0;\n        if (t >= 1) return 1;\n        var t2 = t * t;\n        var t3 = t2 * t;\n        return 4 * (t < .5 ? t3 : 3 * (t - t2) + t3 - .75);\n    },\n\n    exponential: function(t) {\n        return Math.pow(2, 10 * (t - 1));\n    },\n\n    bounce: function(t) {\n        for (var a = 0, b = 1; 1; a += b, b /= 2) {\n            if (t >= (7 - 4 * a) / 11) {\n                var q = (11 - 6 * a - 11 * t) / 4;\n                return -q * q + b * b;\n            }\n        }\n    },\n\n    reverse: function(f) {\n        return function(t) {\n            return 1 - f(1 - t);\n        };\n    },\n\n    reflect: function(f) {\n        return function(t) {\n            return .5 * (t < .5 ? f(2 * t) : (2 - f(2 - 2 * t)));\n        };\n    },\n\n    clamp: function(f, n, x) {\n        n = n || 0;\n        x = x || 1;\n        return function(t) {\n            var r = f(t);\n            return r < n ? n : r > x ? x : r;\n        };\n    },\n\n    back: function(s) {\n        if (!s) s = 1.70158;\n        return function(t) {\n            return t * t * ((s + 1) * t - s);\n        };\n    },\n\n    elastic: function(x) {\n        if (!x) x = 1.5;\n        return function(t) {\n            return Math.pow(2, 10 * (t - 1)) * Math.cos(20 * Math.PI * x / 3 * t);\n        };\n    }\n};\n\nexport const interpolate = {\n\n    number: function(a, b) {\n        var d = b - a;\n        return function(t) {\n            return a + d * t;\n        };\n    },\n\n    object: function(a, b) {\n        var s = Object.keys(a);\n        return function(t) {\n            var i, p;\n            var r = {};\n            for (i = s.length - 1; i != -1; i--) {\n                p = s[i];\n                r[p] = a[p] + (b[p] - a[p]) * t;\n            }\n            return r;\n        };\n    },\n\n    hexColor: function(a, b) {\n\n        var ca = parseInt(a.slice(1), 16);\n        var cb = parseInt(b.slice(1), 16);\n        var ra = ca & 0x0000ff;\n        var rd = (cb & 0x0000ff) - ra;\n        var ga = ca & 0x00ff00;\n        var gd = (cb & 0x00ff00) - ga;\n        var ba = ca & 0xff0000;\n        var bd = (cb & 0xff0000) - ba;\n\n        return function(t) {\n\n            var r = (ra + rd * t) & 0x000000ff;\n            var g = (ga + gd * t) & 0x0000ff00;\n            var b = (ba + bd * t) & 0x00ff0000;\n\n            return '#' + (1 << 24 | r | g | b).toString(16).slice(1);\n        };\n    },\n\n    unit: function(a, b) {\n\n        var r = /(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;\n        var ma = r.exec(a);\n        var mb = r.exec(b);\n        var p = mb[1].indexOf('.');\n        var f = p > 0 ? mb[1].length - p - 1 : 0;\n        a = +ma[1];\n        var d = +mb[1] - a;\n        var u = ma[2];\n\n        return function(t) {\n            return (a + d * t).toFixed(f) + u;\n        };\n    }\n};\n\n// SVG filters.\n// (values in parentheses are default values)\nexport const filter = {\n\n    // `color` ... outline color ('blue')\n    // `width`... outline width (1)\n    // `opacity` ... outline opacity (1)\n    // `margin` ... gap between outline and the element (2)\n    outline: function(args) {\n\n        var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology in=\"SourceAlpha\" result=\"morphedOuter\" operator=\"dilate\" radius=\"${outerRadius}\" /><feMorphology in=\"SourceAlpha\" result=\"morphedInner\" operator=\"dilate\" radius=\"${innerRadius}\" /><feComposite result=\"morphedOuterColored\" in=\"colored\" in2=\"morphedOuter\" operator=\"in\"/><feComposite operator=\"xor\" in=\"morphedOuterColored\" in2=\"morphedInner\" result=\"outline\"/><feMerge><feMergeNode in=\"outline\"/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n\n        var margin = Number.isFinite(args.margin) ? args.margin : 2;\n        var width = Number.isFinite(args.width) ? args.width : 1;\n\n        return template(tpl)({\n            color: args.color || 'blue',\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n            outerRadius: margin + width,\n            innerRadius: margin\n        });\n    },\n\n    // `color` ... color ('red')\n    // `width`... width (1)\n    // `blur` ... blur (0)\n    // `opacity` ... opacity (1)\n    highlight: function(args) {\n\n        var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology result=\"morphed\" in=\"SourceGraphic\" operator=\"dilate\" radius=\"${width}\"/><feComposite result=\"composed\" in=\"colored\" in2=\"morphed\" operator=\"in\"/><feGaussianBlur result=\"blured\" in=\"composed\" stdDeviation=\"${blur}\"/><feBlend in=\"SourceGraphic\" in2=\"blured\" mode=\"normal\"/></filter>';\n\n        return template(tpl)({\n            color: args.color || 'red',\n            width: Number.isFinite(args.width) ? args.width : 1,\n            blur: Number.isFinite(args.blur) ? args.blur : 0,\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1\n        });\n    },\n\n    // `x` ... horizontal blur (2)\n    // `y` ... vertical blur (optional)\n    blur: function(args) {\n\n        var x = Number.isFinite(args.x) ? args.x : 2;\n\n        return template('<filter><feGaussianBlur stdDeviation=\"${stdDeviation}\"/></filter>')({\n            stdDeviation: Number.isFinite(args.y) ? [x, args.y] : x\n        });\n    },\n\n    // `dx` ... horizontal shift (0)\n    // `dy` ... vertical shift (0)\n    // `blur` ... blur (4)\n    // `color` ... color ('black')\n    // `opacity` ... opacity (1)\n    dropShadow: function(args) {\n\n        var tpl = 'SVGFEDropShadowElement' in window\n            ? '<filter><feDropShadow stdDeviation=\"${blur}\" dx=\"${dx}\" dy=\"${dy}\" flood-color=\"${color}\" flood-opacity=\"${opacity}\"/></filter>'\n            : '<filter><feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"${blur}\"/><feOffset dx=\"${dx}\" dy=\"${dy}\" result=\"offsetblur\"/><feFlood flood-color=\"${color}\"/><feComposite in2=\"offsetblur\" operator=\"in\"/><feComponentTransfer><feFuncA type=\"linear\" slope=\"${opacity}\"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n\n        return template(tpl)({\n            dx: args.dx || 0,\n            dy: args.dy || 0,\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n            color: args.color || 'black',\n            blur: Number.isFinite(args.blur) ? args.blur : 4\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely grayscale. A value of 0 leaves the input unchanged.\n    grayscale: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0\"/></filter>')({\n            a: 0.2126 + 0.7874 * (1 - amount),\n            b: 0.7152 - 0.7152 * (1 - amount),\n            c: 0.0722 - 0.0722 * (1 - amount),\n            d: 0.2126 - 0.2126 * (1 - amount),\n            e: 0.7152 + 0.2848 * (1 - amount),\n            f: 0.0722 - 0.0722 * (1 - amount),\n            g: 0.2126 - 0.2126 * (1 - amount),\n            h: 0.0722 + 0.9278 * (1 - amount)\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely sepia. A value of 0 leaves the input unchanged.\n    sepia: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0\"/></filter>')({\n            a: 0.393 + 0.607 * (1 - amount),\n            b: 0.769 - 0.769 * (1 - amount),\n            c: 0.189 - 0.189 * (1 - amount),\n            d: 0.349 - 0.349 * (1 - amount),\n            e: 0.686 + 0.314 * (1 - amount),\n            f: 0.168 - 0.168 * (1 - amount),\n            g: 0.272 - 0.272 * (1 - amount),\n            h: 0.534 - 0.534 * (1 - amount),\n            i: 0.131 + 0.869 * (1 - amount)\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 0 is completely un-saturated. A value of 1 (default) leaves the input unchanged.\n    saturate: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"saturate\" values=\"${amount}\"/></filter>')({\n            amount: 1 - amount\n        });\n    },\n\n    // `angle` ...  the number of degrees around the color circle the input samples will be adjusted (0).\n    hueRotate: function(args) {\n\n        return template('<filter><feColorMatrix type=\"hueRotate\" values=\"${angle}\"/></filter>')({\n            angle: args.angle || 0\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely inverted. A value of 0 leaves the input unchanged.\n    invert: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncG type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncB type=\"table\" tableValues=\"${amount} ${amount2}\"/></feComponentTransfer></filter>')({\n            amount: amount,\n            amount2: 1 - amount\n        });\n    },\n\n    // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n    brightness: function(args) {\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\"/><feFuncG type=\"linear\" slope=\"${amount}\"/><feFuncB type=\"linear\" slope=\"${amount}\"/></feComponentTransfer></filter>')({\n            amount: Number.isFinite(args.amount) ? args.amount : 1\n        });\n    },\n\n    // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n    contrast: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncG type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncB type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/></feComponentTransfer></filter>')({\n            amount: amount,\n            amount2: .5 - amount / 2\n        });\n    }\n};\n\nexport const format = {\n\n    // Formatting numbers via the Python Format Specification Mini-language.\n    // See http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n    // Heavilly inspired by the D3.js library implementation.\n    number: function(specifier, value, locale) {\n\n        locale = locale || {\n\n            currency: ['$', ''],\n            decimal: '.',\n            thousands: ',',\n            grouping: [3]\n        };\n\n        // See Python format specification mini-language: http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n        // [[fill]align][sign][symbol][0][width][,][.precision][type]\n        var re = /(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i;\n\n        var match = re.exec(specifier);\n        var fill = match[1] || ' ';\n        var align = match[2] || '>';\n        var sign = match[3] || '';\n        var symbol = match[4] || '';\n        var zfill = match[5];\n        var width = +match[6];\n        var comma = match[7];\n        var precision = match[8];\n        var type = match[9];\n        var scale = 1;\n        var prefix = '';\n        var suffix = '';\n        var integer = false;\n\n        if (precision) precision = +precision.substring(1);\n\n        if (zfill || fill === '0' && align === '=') {\n            zfill = fill = '0';\n            align = '=';\n            if (comma) width -= Math.floor((width - 1) / 4);\n        }\n\n        switch (type) {\n            case 'n':\n                comma = true;\n                type = 'g';\n                break;\n            case '%':\n                scale = 100;\n                suffix = '%';\n                type = 'f';\n                break;\n            case 'p':\n                scale = 100;\n                suffix = '%';\n                type = 'r';\n                break;\n            case 'b':\n            case 'o':\n            case 'x':\n            case 'X':\n                if (symbol === '#') prefix = '0' + type.toLowerCase();\n                break;\n            case 'c':\n            case 'd':\n                integer = true;\n                precision = 0;\n                break;\n            case 's':\n                scale = -1;\n                type = 'r';\n                break;\n        }\n\n        if (symbol === '$') {\n            prefix = locale.currency[0];\n            suffix = locale.currency[1];\n        }\n\n        // If no precision is specified for `'r'`, fallback to general notation.\n        if (type == 'r' && !precision) type = 'g';\n\n        // Ensure that the requested precision is in the supported range.\n        if (precision != null) {\n            if (type == 'g') precision = Math.max(1, Math.min(21, precision));\n            else if (type == 'e' || type == 'f') precision = Math.max(0, Math.min(20, precision));\n        }\n\n        var zcomma = zfill && comma;\n\n        // Return the empty string for floats formatted as ints.\n        if (integer && (value % 1)) return '';\n\n        // Convert negative to positive, and record the sign prefix.\n        var negative = value < 0 || value === 0 && 1 / value < 0 ? (value = -value, '-') : sign;\n\n        var fullSuffix = suffix;\n\n        // Apply the scale, computing it from the value's exponent for si format.\n        // Preserve the existing suffix, if any, such as the currency symbol.\n        if (scale < 0) {\n            var unit = this.prefix(value, precision);\n            value = unit.scale(value);\n            fullSuffix = unit.symbol + suffix;\n        } else {\n            value *= scale;\n        }\n\n        // Convert to the desired precision.\n        value = this.convert(type, value, precision);\n\n        // Break the value into the integer part (before) and decimal part (after).\n        var i = value.lastIndexOf('.');\n        var before = i < 0 ? value : value.substring(0, i);\n        var after = i < 0 ? '' : locale.decimal + value.substring(i + 1);\n\n        function formatGroup(value) {\n\n            var i = value.length;\n            var t = [];\n            var j = 0;\n            var g = locale.grouping[0];\n            while (i > 0 && g > 0) {\n                t.push(value.substring(i -= g, i + g));\n                g = locale.grouping[j = (j + 1) % locale.grouping.length];\n            }\n            return t.reverse().join(locale.thousands);\n        }\n\n        // If the fill character is not `'0'`, grouping is applied before padding.\n        if (!zfill && comma && locale.grouping) {\n\n            before = formatGroup(before);\n        }\n\n        var length = prefix.length + before.length + after.length + (zcomma ? 0 : negative.length);\n        var padding = length < width ? new Array(length = width - length + 1).join(fill) : '';\n\n        // If the fill character is `'0'`, grouping is applied after padding.\n        if (zcomma) before = formatGroup(padding + before);\n\n        // Apply prefix.\n        negative += prefix;\n\n        // Rejoin integer and decimal parts.\n        value = before + after;\n\n        return (align === '<' ? negative + value + padding\n            : align === '>' ? padding + negative + value\n                : align === '^' ? padding.substring(0, length >>= 1) + negative + value + padding.substring(length)\n                    : negative + (zcomma ? value : padding + value)) + fullSuffix;\n    },\n\n    // Formatting string via the Python Format string.\n    // See https://docs.python.org/2/library/string.html#format-string-syntax)\n    string: function(formatString, value) {\n\n        var fieldDelimiterIndex;\n        var fieldDelimiter = '{';\n        var endPlaceholder = false;\n        var formattedStringArray = [];\n\n        while ((fieldDelimiterIndex = formatString.indexOf(fieldDelimiter)) !== -1) {\n\n            var pieceFormattedString, formatSpec, fieldName;\n\n            pieceFormattedString = formatString.slice(0, fieldDelimiterIndex);\n\n            if (endPlaceholder) {\n                formatSpec = pieceFormattedString.split(':');\n                fieldName = formatSpec.shift().split('.');\n                pieceFormattedString = value;\n\n                for (var i = 0; i < fieldName.length; i++)\n                    pieceFormattedString = pieceFormattedString[fieldName[i]];\n\n                if (formatSpec.length)\n                    pieceFormattedString = this.number(formatSpec, pieceFormattedString);\n            }\n\n            formattedStringArray.push(pieceFormattedString);\n\n            formatString = formatString.slice(fieldDelimiterIndex + 1);\n            endPlaceholder = !endPlaceholder;\n            fieldDelimiter = (endPlaceholder) ? '}' : '{';\n        }\n        formattedStringArray.push(formatString);\n\n        return formattedStringArray.join('');\n    },\n\n    convert: function(type, value, precision) {\n\n        switch (type) {\n            case 'b':\n                return value.toString(2);\n            case 'c':\n                return String.fromCharCode(value);\n            case 'o':\n                return value.toString(8);\n            case 'x':\n                return value.toString(16);\n            case 'X':\n                return value.toString(16).toUpperCase();\n            case 'g':\n                return value.toPrecision(precision);\n            case 'e':\n                return value.toExponential(precision);\n            case 'f':\n                return value.toFixed(precision);\n            case 'r':\n                return (value = this.round(value, this.precision(value, precision))).toFixed(Math.max(0, Math.min(20, this.precision(value * (1 + 1e-15), precision))));\n            default:\n                return value + '';\n        }\n    },\n\n    round: function(value, precision) {\n\n        return precision\n            ? Math.round(value * (precision = Math.pow(10, precision))) / precision\n            : Math.round(value);\n    },\n\n    precision: function(value, precision) {\n\n        return precision - (value ? Math.ceil(Math.log(value) / Math.LN10) : 1);\n    },\n\n    prefix: function(value, precision) {\n\n        var prefixes = ['y', 'z', 'a', 'f', 'p', 'n', '', 'm', '', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'].map(function(d, i) {\n            var k = Math.pow(10, Math.abs(8 - i) * 3);\n            return {\n                scale: i > 8 ? function(d) {\n                    return d / k;\n                } : function(d) {\n                    return d * k;\n                },\n                symbol: d\n            };\n        });\n\n        var i = 0;\n        if (value) {\n            if (value < 0) value *= -1;\n            if (precision) value = this.round(value, this.precision(value, precision));\n            i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);\n            i = Math.max(-24, Math.min(24, Math.floor((i <= 0 ? i + 1 : i - 1) / 3) * 3));\n        }\n        return prefixes[8 + i / 3];\n    }\n};\n\n/*\n    Pre-compile the HTML to be used as a template.\n*/\nexport const template = function(html) {\n\n    /*\n        Must support the variation in templating syntax found here:\n        https://lodash.com/docs#template\n    */\n    var regex = /<%= ([^ ]+) %>|\\$\\{ ?([^{} ]+) ?\\}|\\{\\{([^{} ]+)\\}\\}/g;\n\n    return function(data) {\n\n        data = data || {};\n\n        return html.replace(regex, function(match) {\n\n            var args = Array.from(arguments);\n            var attr = args.slice(1, 4).find(function(_attr) {\n                return !!_attr;\n            });\n\n            var attrArray = attr.split('.');\n            var value = data[attrArray.shift()];\n\n            while (value !== undefined && attrArray.length) {\n                value = value[attrArray.shift()];\n            }\n\n            return value !== undefined ? value : '';\n        });\n    };\n};\n\n/**\n * @param {Element} el Element, which content is intent to display in full-screen mode, 'window.top.document.body' is default.\n */\nexport const toggleFullScreen = function(el) {\n\n    var topDocument = window.top.document;\n    el = el || topDocument.body;\n\n    function prefixedResult(el, prop) {\n\n        var prefixes = ['webkit', 'moz', 'ms', 'o', ''];\n        for (var i = 0; i < prefixes.length; i++) {\n            var prefix = prefixes[i];\n            var propName = prefix ? (prefix + prop) : (prop.substr(0, 1).toLowerCase() + prop.substr(1));\n            if (el[propName] !== undefined) {\n                return isFunction(el[propName]) ? el[propName]() : el[propName];\n            }\n        }\n    }\n\n    if (prefixedResult(topDocument, 'FullscreenElement') || prefixedResult(topDocument, 'FullScreenElement')) {\n        prefixedResult(topDocument, 'ExitFullscreen') || // Spec.\n        prefixedResult(topDocument, 'CancelFullScreen'); // Firefox\n    } else {\n        prefixedResult(el, 'RequestFullscreen') || // Spec.\n        prefixedResult(el, 'RequestFullScreen'); // Firefox\n    }\n};\n\nexport { \n    isBoolean,\n    isObject,\n    isNumber,\n    isString,\n    mixin,\n    deepMixin,\n    supplement,\n    defaults,\n    deepSupplement,\n    defaultsDeep,\n    assign,\n    invoke,\n    invokeProperty,\n    sortedIndex,\n    uniq,\n    clone,\n    cloneDeep,\n    isEmpty,\n    isEqual,\n    isFunction,\n    isPlainObject,\n    toArray,\n    debounce,\n    groupBy,\n    sortBy,\n    flattenDeep, \n    without,\n    difference,\n    intersection,\n    union,\n    has,\n    result,\n    omit,\n    pick,\n    bindAll,\n    forIn,\n    camelCase,\n    uniqueId,\n    merge\n};\n\nexport const noop = function() {\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}