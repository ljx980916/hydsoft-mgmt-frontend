{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.unshift.js\";\nimport { __extends } from \"tslib\";\nimport { each, head, last } from '@antv/util';\nimport Continuous from './base';\n/**\n * 分段度量\n */\nvar Quantize = /** @class */function (_super) {\n  __extends(Quantize, _super);\n  function Quantize() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.type = 'quantize';\n    return _this;\n  }\n  Quantize.prototype.invert = function (value) {\n    var ticks = this.ticks;\n    var length = ticks.length;\n    var percent = this.getInvertPercent(value);\n    var minIndex = Math.floor(percent * (length - 1));\n    // 最后一个\n    if (minIndex >= length - 1) {\n      return last(ticks);\n    }\n    // 超出左边界， 则取第一个\n    if (minIndex < 0) {\n      return head(ticks);\n    }\n    var minTick = ticks[minIndex];\n    var nextTick = ticks[minIndex + 1];\n    // 比当前值小的 tick 在度量上的占比\n    var minIndexPercent = minIndex / (length - 1);\n    var maxIndexPercent = (minIndex + 1) / (length - 1);\n    return minTick + (percent - minIndexPercent) / (maxIndexPercent - minIndexPercent) * (nextTick - minTick);\n  };\n  Quantize.prototype.initCfg = function () {\n    this.tickMethod = 'r-pretty';\n    this.tickCount = 5;\n    this.nice = true;\n  };\n  Quantize.prototype.calculateTicks = function () {\n    var ticks = _super.prototype.calculateTicks.call(this);\n    if (!this.nice) {\n      // 如果 nice = false ,补充 min, max\n      if (last(ticks) !== this.max) {\n        ticks.push(this.max);\n      }\n      if (head(ticks) !== this.min) {\n        ticks.unshift(this.min);\n      }\n    }\n    return ticks;\n  };\n  // 计算当前值在刻度中的占比\n  Quantize.prototype.getScalePercent = function (value) {\n    var ticks = this.ticks;\n    // 超出左边界\n    if (value < head(ticks)) {\n      return 0;\n    }\n    // 超出右边界\n    if (value > last(ticks)) {\n      return 1;\n    }\n    var minIndex = 0;\n    each(ticks, function (tick, index) {\n      if (value >= tick) {\n        minIndex = index;\n      } else {\n        return false;\n      }\n    });\n    return minIndex / (ticks.length - 1);\n  };\n  return Quantize;\n}(Continuous);\nexport default Quantize;","map":{"version":3,"mappings":";;;AAAA,SAASA,IAAI,EAAEC,IAAI,EAAEC,IAAI,QAAQ,YAAY;AAC7C,OAAOC,UAAU,MAAM,QAAQ;AAE/B;;;AAGA;EAAuBC;EAAvB;IAAA;IACSC,UAAI,GAAG,UAAU;;EA+D1B;EA7DSC,yBAAM,GAAb,UAAcC,KAAK;IACjB,IAAMC,KAAK,GAAG,IAAI,CAACA,KAAK;IACxB,IAAMC,MAAM,GAAGD,KAAK,CAACC,MAAM;IAC3B,IAAMC,OAAO,GAAG,IAAI,CAACC,gBAAgB,CAACJ,KAAK,CAAC;IAC5C,IAAMK,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACJ,OAAO,IAAID,MAAM,GAAG,CAAC,CAAC,CAAC;IACnD;IACA,IAAIG,QAAQ,IAAIH,MAAM,GAAG,CAAC,EAAE;MAC1B,OAAOP,IAAI,CAACM,KAAK,CAAC;;IAEpB;IACA,IAAII,QAAQ,GAAG,CAAC,EAAE;MAChB,OAAOX,IAAI,CAACO,KAAK,CAAC;;IAEpB,IAAMO,OAAO,GAAGP,KAAK,CAACI,QAAQ,CAAC;IAC/B,IAAMI,QAAQ,GAAGR,KAAK,CAACI,QAAQ,GAAG,CAAC,CAAC;IACpC;IACA,IAAMK,eAAe,GAAGL,QAAQ,IAAIH,MAAM,GAAG,CAAC,CAAC;IAC/C,IAAMS,eAAe,GAAI,CAACN,QAAQ,GAAG,CAAC,KAAKH,MAAM,GAAG,CAAC,CAAC;IACtD,OAAOM,OAAO,GAAG,CAACL,OAAO,GAAGO,eAAe,KAAKC,eAAe,GAAGD,eAAe,CAAC,IAAID,QAAQ,GAAGD,OAAO,CAAC;EAC3G,CAAC;EAEST,0BAAO,GAAjB;IACE,IAAI,CAACa,UAAU,GAAG,UAAU;IAC5B,IAAI,CAACC,SAAS,GAAG,CAAC;IAClB,IAAI,CAACC,IAAI,GAAG,IAAI;EAClB,CAAC;EAESf,iCAAc,GAAxB;IACE,IAAME,KAAK,GAAGc,iBAAMC,cAAc,WAAE;IACpC,IAAI,CAAC,IAAI,CAACF,IAAI,EAAE;MAAE;MAChB,IAAInB,IAAI,CAACM,KAAK,CAAC,KAAK,IAAI,CAACgB,GAAG,EAAE;QAC5BhB,KAAK,CAACiB,IAAI,CAAC,IAAI,CAACD,GAAG,CAAC;;MAEtB,IAAIvB,IAAI,CAACO,KAAK,CAAC,KAAK,IAAI,CAACkB,GAAG,EAAE;QAC5BlB,KAAK,CAACmB,OAAO,CAAC,IAAI,CAACD,GAAG,CAAC;;;IAG3B,OAAOlB,KAAK;EACd,CAAC;EAED;EACUF,kCAAe,GAAzB,UAA0BC,KAAK;IAC7B,IAAMC,KAAK,GAAG,IAAI,CAACA,KAAK;IACxB;IACA,IAAID,KAAK,GAAGN,IAAI,CAACO,KAAK,CAAC,EAAE;MACvB,OAAO,CAAC;;IAEV;IACA,IAAID,KAAK,GAAGL,IAAI,CAACM,KAAK,CAAC,EAAE;MACvB,OAAO,CAAC;;IAEV,IAAII,QAAQ,GAAG,CAAC;IAChBZ,IAAI,CAACQ,KAAK,EAAE,UAACoB,IAAI,EAAEC,KAAK;MACtB,IAAItB,KAAK,IAAIqB,IAAI,EAAE;QACjBhB,QAAQ,GAAGiB,KAAK;OACjB,MAAM;QACL,OAAO,KAAK;;IAEhB,CAAC,CAAC;IACF,OAAOjB,QAAQ,IAAIJ,KAAK,CAACC,MAAM,GAAG,CAAC,CAAC;EACtC,CAAC;EACH,eAAC;AAAD,CAAC,CAhEsBN,UAAU;AAkEjC,eAAeG,QAAQ","names":["each","head","last","Continuous","__extends","_this","Quantize","value","ticks","length","percent","getInvertPercent","minIndex","Math","floor","minTick","nextTick","minIndexPercent","maxIndexPercent","tickMethod","tickCount","nice","_super","calculateTicks","max","push","min","unshift","tick","index"],"sourceRoot":"","sources":["../../src/continuous/quantize.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}