{"ast":null,"code":"\"use strict\";\n\n/**\n * @fileOverview fruchterman layout\n * @author shiwu.wyy@antfin.com\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FruchtermanLayout = void 0;\nvar base_1 = require(\"./base\");\nvar util_1 = require(\"../util\");\nvar SPEED_DIVISOR = 800;\n/**\n * fruchterman 布局\n */\nvar FruchtermanLayout = /** @class */function (_super) {\n  __extends(FruchtermanLayout, _super);\n  function FruchtermanLayout(options) {\n    var _this = _super.call(this) || this;\n    /** 停止迭代的最大迭代数 */\n    _this.maxIteration = 1000;\n    /** 是否启动 worker */\n    _this.workerEnabled = false;\n    /** 重力大小，影响图的紧凑程度 */\n    _this.gravity = 10;\n    /** 速度 */\n    _this.speed = 5;\n    /** 是否产生聚类力 */\n    _this.clustering = false;\n    /** 聚类力大小 */\n    _this.clusterGravity = 10;\n    _this.nodes = [];\n    _this.edges = [];\n    _this.width = 300;\n    _this.height = 300;\n    _this.nodeMap = {};\n    _this.nodeIdxMap = {};\n    /** 迭代结束的回调函数 */\n    _this.onLayoutEnd = function () {};\n    /** 每次迭代结束的回调函数 */\n    _this.tick = function () {};\n    /** 是否使用 window.setInterval 运行迭代 */\n    _this.animate = true;\n    _this.updateCfg(options);\n    return _this;\n  }\n  FruchtermanLayout.prototype.getDefaultCfg = function () {\n    return {\n      maxIteration: 1000,\n      gravity: 10,\n      speed: 1,\n      clustering: false,\n      clusterGravity: 10,\n      animate: true\n    };\n  };\n  /**\n   * 执行布局\n   */\n  FruchtermanLayout.prototype.execute = function () {\n    var _this = this;\n    var _a, _b;\n    var self = this;\n    var nodes = self.nodes;\n    if (self.timeInterval !== undefined && typeof window !== \"undefined\") {\n      window.clearInterval(self.timeInterval);\n    }\n    if (!nodes || nodes.length === 0) {\n      (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n      return;\n    }\n    if (!self.width && typeof window !== \"undefined\") {\n      self.width = window.innerWidth;\n    }\n    if (!self.height && typeof window !== \"undefined\") {\n      self.height = window.innerHeight;\n    }\n    if (!self.center) {\n      self.center = [self.width / 2, self.height / 2];\n    }\n    var center = self.center;\n    if (nodes.length === 1) {\n      nodes[0].x = center[0];\n      nodes[0].y = center[1];\n      (_b = self.onLayoutEnd) === null || _b === void 0 ? void 0 : _b.call(self);\n      return;\n    }\n    var nodeMap = {};\n    var nodeIdxMap = {};\n    nodes.forEach(function (node, i) {\n      if (!(0, util_1.isNumber)(node.x)) node.x = Math.random() * _this.width;\n      if (!(0, util_1.isNumber)(node.y)) node.y = Math.random() * _this.height;\n      nodeMap[node.id] = node;\n      nodeIdxMap[node.id] = i;\n    });\n    self.nodeMap = nodeMap;\n    self.nodeIdxMap = nodeIdxMap;\n    // layout\n    return self.run();\n  };\n  FruchtermanLayout.prototype.run = function () {\n    var _a;\n    var self = this;\n    var nodes = self.nodes;\n    if (!nodes) return;\n    var edges = self.edges,\n      maxIteration = self.maxIteration,\n      workerEnabled = self.workerEnabled,\n      clustering = self.clustering,\n      animate = self.animate;\n    var clusterMap = {};\n    if (clustering) {\n      nodes.forEach(function (n) {\n        if (clusterMap[n.cluster] === undefined) {\n          clusterMap[n.cluster] = {\n            name: n.cluster,\n            cx: 0,\n            cy: 0,\n            count: 0\n          };\n        }\n      });\n    }\n    if (workerEnabled || !animate) {\n      for (var i = 0; i < maxIteration; i++) {\n        self.runOneStep(clusterMap);\n      }\n      (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n    } else {\n      if (typeof window === \"undefined\") return;\n      var iter_1 = 0;\n      // interval for render the result after each iteration\n      this.timeInterval = window.setInterval(function () {\n        var _a;\n        self.runOneStep(clusterMap);\n        iter_1++;\n        if (iter_1 >= maxIteration) {\n          (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n          window.clearInterval(self.timeInterval);\n        }\n      }, 0);\n    }\n    return {\n      nodes: nodes,\n      edges: edges\n    };\n  };\n  FruchtermanLayout.prototype.runOneStep = function (clusterMap) {\n    var _a;\n    var self = this;\n    var nodes = self.nodes;\n    if (!nodes) return;\n    var edges = self.edges,\n      center = self.center,\n      gravity = self.gravity,\n      speed = self.speed,\n      clustering = self.clustering;\n    var area = self.height * self.width;\n    var maxDisplace = Math.sqrt(area) / 10;\n    var k2 = area / (nodes.length + 1);\n    var k = Math.sqrt(k2);\n    var displacements = [];\n    nodes.forEach(function (_, j) {\n      displacements[j] = {\n        x: 0,\n        y: 0\n      };\n    });\n    self.applyCalculate(nodes, edges, displacements, k, k2);\n    // gravity for clusters\n    if (clustering) {\n      // re-compute the clustering centers\n      for (var key in clusterMap) {\n        clusterMap[key].cx = 0;\n        clusterMap[key].cy = 0;\n        clusterMap[key].count = 0;\n      }\n      nodes.forEach(function (n) {\n        var c = clusterMap[n.cluster];\n        if ((0, util_1.isNumber)(n.x)) {\n          c.cx += n.x;\n        }\n        if ((0, util_1.isNumber)(n.y)) {\n          c.cy += n.y;\n        }\n        c.count++;\n      });\n      for (var key in clusterMap) {\n        clusterMap[key].cx /= clusterMap[key].count;\n        clusterMap[key].cy /= clusterMap[key].count;\n      }\n      // compute the cluster gravity forces\n      var clusterGravity_1 = self.clusterGravity || gravity;\n      nodes.forEach(function (n, j) {\n        if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n        var c = clusterMap[n.cluster];\n        var distLength = Math.sqrt((n.x - c.cx) * (n.x - c.cx) + (n.y - c.cy) * (n.y - c.cy));\n        var gravityForce = k * clusterGravity_1;\n        displacements[j].x -= gravityForce * (n.x - c.cx) / distLength;\n        displacements[j].y -= gravityForce * (n.y - c.cy) / distLength;\n      });\n    }\n    // gravity\n    nodes.forEach(function (n, j) {\n      if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n      var gravityForce = 0.01 * k * gravity;\n      displacements[j].x -= gravityForce * (n.x - center[0]);\n      displacements[j].y -= gravityForce * (n.y - center[1]);\n    });\n    // move\n    nodes.forEach(function (n, j) {\n      if ((0, util_1.isNumber)(n.fx) && (0, util_1.isNumber)(n.fy)) {\n        n.x = n.fx;\n        n.y = n.fy;\n        return;\n      }\n      if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n      var distLength = Math.sqrt(displacements[j].x * displacements[j].x + displacements[j].y * displacements[j].y);\n      if (distLength > 0) {\n        // && !n.isFixed()\n        var limitedDist = Math.min(maxDisplace * (speed / SPEED_DIVISOR), distLength);\n        n.x += displacements[j].x / distLength * limitedDist;\n        n.y += displacements[j].y / distLength * limitedDist;\n      }\n    });\n    (_a = self.tick) === null || _a === void 0 ? void 0 : _a.call(self);\n  };\n  FruchtermanLayout.prototype.applyCalculate = function (nodes, edges, displacements, k, k2) {\n    var self = this;\n    self.calRepulsive(nodes, displacements, k2);\n    if (edges) self.calAttractive(edges, displacements, k);\n  };\n  FruchtermanLayout.prototype.calRepulsive = function (nodes, displacements, k2) {\n    nodes.forEach(function (v, i) {\n      displacements[i] = {\n        x: 0,\n        y: 0\n      };\n      nodes.forEach(function (u, j) {\n        if (i === j) {\n          return;\n        }\n        if (!(0, util_1.isNumber)(v.x) || !(0, util_1.isNumber)(u.x) || !(0, util_1.isNumber)(v.y) || !(0, util_1.isNumber)(u.y)) {\n          return;\n        }\n        var vecX = v.x - u.x;\n        var vecY = v.y - u.y;\n        var vecLengthSqr = vecX * vecX + vecY * vecY;\n        if (vecLengthSqr === 0) {\n          vecLengthSqr = 1;\n          var sign = i > j ? 1 : -1;\n          vecX = 0.01 * sign;\n          vecY = 0.01 * sign;\n        }\n        var common = k2 / vecLengthSqr;\n        displacements[i].x += vecX * common;\n        displacements[i].y += vecY * common;\n      });\n    });\n  };\n  FruchtermanLayout.prototype.calAttractive = function (edges, displacements, k) {\n    var _this = this;\n    edges.forEach(function (e) {\n      var source = (0, util_1.getEdgeTerminal)(e, 'source');\n      var target = (0, util_1.getEdgeTerminal)(e, 'target');\n      if (!source || !target) return;\n      var uIndex = _this.nodeIdxMap[source];\n      var vIndex = _this.nodeIdxMap[target];\n      if (uIndex === vIndex) {\n        return;\n      }\n      var u = _this.nodeMap[source];\n      var v = _this.nodeMap[target];\n      if (!(0, util_1.isNumber)(v.x) || !(0, util_1.isNumber)(u.x) || !(0, util_1.isNumber)(v.y) || !(0, util_1.isNumber)(u.y)) {\n        return;\n      }\n      var vecX = v.x - u.x;\n      var vecY = v.y - u.y;\n      var vecLength = Math.sqrt(vecX * vecX + vecY * vecY);\n      var common = vecLength * vecLength / k;\n      displacements[vIndex].x -= vecX / vecLength * common;\n      displacements[vIndex].y -= vecY / vecLength * common;\n      displacements[uIndex].x += vecX / vecLength * common;\n      displacements[uIndex].y += vecY / vecLength * common;\n    });\n  };\n  FruchtermanLayout.prototype.stop = function () {\n    if (this.timeInterval && typeof window !== \"undefined\") {\n      window.clearInterval(this.timeInterval);\n    }\n  };\n  FruchtermanLayout.prototype.destroy = function () {\n    var self = this;\n    self.stop();\n    self.tick = null;\n    self.nodes = null;\n    self.edges = null;\n    self.destroyed = true;\n  };\n  FruchtermanLayout.prototype.getType = function () {\n    return \"fruchterman\";\n  };\n  return FruchtermanLayout;\n}(base_1.Base);\nexports.FruchtermanLayout = FruchtermanLayout;","map":{"version":3,"mappings":"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","names":["SPEED_DIVISOR","__extends","options","_super","_this","updateCfg","FruchtermanLayout","maxIteration","gravity","speed","clustering","clusterGravity","animate","self","nodes","timeInterval","undefined","window","clearInterval","length","onLayoutEnd","width","innerWidth","height","innerHeight","center","x","y","nodeMap","nodeIdxMap","forEach","node","i","Math","random","id","run","workerEnabled","clusterMap","n","cluster","name","cx","cy","count","runOneStep","iter_1","setInterval","edges","area","maxDisplace","sqrt","k2","k","displacements","_","j","applyCalculate","key","c","clusterGravity_1","distLength","gravityForce","fx","fy","limitedDist","min","tick","calRepulsive","calAttractive","v","u","vecX","vecY","vecLengthSqr","sign","common","e","source","target","uIndex","vIndex","vecLength","stop","destroyed","base_1","exports"],"sourceRoot":"","sources":["../../src/layout/fruchterman.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}