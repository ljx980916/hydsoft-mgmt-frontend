{"ast":null,"code":"import router from '../router/index';\nlet currentPath = router?.currentRoute?.value?.fullPath;\nexport function __canvasWM({\n  container = document.body,\n  width = '300px',\n  height = '200px',\n  textAlign = 'center',\n  textBaseline = 'middle',\n  font = \"20px Microsoft Yahei\",\n  fillStyle = 'rgba(184, 184, 184, 0.12)',\n  content = '水印',\n  rotate = '-35',\n  zIndex = 10000\n} = {}) {\n  const args = arguments[0];\n  const canvas = document.createElement('canvas');\n  canvas.setAttribute('width', width);\n  canvas.setAttribute('height', height);\n  const ctx = canvas.getContext(\"2d\");\n  ctx.textAlign = textAlign;\n  ctx.textBaseline = textBaseline;\n  ctx.font = font;\n  ctx.fillStyle = fillStyle;\n  ctx.rotate(Math.PI / 180 * rotate);\n  ctx.fillText(content, parseFloat(width) / 2, parseFloat(height) / 1.2);\n  const base64Url = canvas.toDataURL();\n  const __wm = document.querySelector('.__wm');\n  const watermarkDiv = __wm || document.createElement(\"div\");\n  const styleStr = `\n      position:fixed;\n      top:0;\n      left:0;\n      bottom:0;\n      right:0;\n      width:100%;\n      height:100%;\n      z-index:${zIndex};\n      pointer-events:none;\n      background-repeat:repeat;\n      background-image:url('${base64Url}')`;\n  watermarkDiv.setAttribute('style', styleStr);\n  watermarkDiv.classList.add('__wm');\n  if (!__wm) {\n    container.style.position = 'relative';\n    container.appendChild(watermarkDiv);\n  }\n  const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n  if (MutationObserver && currentPath !== '/login' && currentPath !== undefined) {\n    let mo = new MutationObserver(function () {\n      const __wm = document.querySelector('.__wm');\n      // 只在__wm元素变动才重新调用 __canvasWM\n      if (__wm && __wm.getAttribute('style') !== styleStr || !__wm) {\n        // 避免一直触发\n        mo.disconnect();\n        mo = null;\n        __canvasWM(JSON.parse(JSON.stringify(args)));\n      }\n    });\n    mo.observe(container, {\n      attributes: true,\n      subtree: true,\n      childList: true\n    });\n  }\n}\nif (typeof module != 'undefined' && module.exports) {\n  //CMD\n  module.exports = __canvasWM;\n} else if (typeof define == 'function' && define.amd) {\n  // AMD\n  define(function () {\n    return __canvasWM;\n  });\n} else {\n  window.__canvasWM = __canvasWM;\n}\nexport function removeWaterMask() {\n  const __wm = document.querySelector('.__wm');\n  if (__wm) __wm.remove();\n}","map":{"version":3,"names":["router","currentPath","currentRoute","value","fullPath","__canvasWM","container","document","body","width","height","textAlign","textBaseline","font","fillStyle","content","rotate","zIndex","args","arguments","canvas","createElement","setAttribute","ctx","getContext","Math","PI","fillText","parseFloat","base64Url","toDataURL","__wm","querySelector","watermarkDiv","styleStr","classList","add","style","position","appendChild","MutationObserver","window","WebKitMutationObserver","undefined","mo","getAttribute","disconnect","JSON","parse","stringify","observe","attributes","subtree","childList","module","exports","define","amd","removeWaterMask","remove"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-oms-frontend/src/utils/watermark.js"],"sourcesContent":["import router from '../router/index'\nlet currentPath = router?.currentRoute?.value?.fullPath\n\nexport function __canvasWM({\n    container = document.body,\n    width = '300px',\n    height = '200px',\n    textAlign = 'center',\n    textBaseline = 'middle',\n    font = \"20px Microsoft Yahei\",\n    fillStyle = 'rgba(184, 184, 184, 0.12)',\n    content = '水印',\n    rotate = '-35',\n    zIndex = 10000\n  } = {}) {\n    const args = arguments[0];\n    const canvas = document.createElement('canvas');\n\n    canvas.setAttribute('width', width);\n    canvas.setAttribute('height', height);\n    const ctx = canvas.getContext(\"2d\");\n\n    ctx.textAlign = textAlign;\n    ctx.textBaseline = textBaseline;\n    ctx.font = font;\n    ctx.fillStyle = fillStyle;\n    ctx.rotate(Math.PI / 180 * rotate);\n    ctx.fillText(content, parseFloat(width) / 2, parseFloat(height) / 1.2);\n\n    const base64Url = canvas.toDataURL();\n    const __wm = document.querySelector('.__wm');\n\n    const watermarkDiv = __wm || document.createElement(\"div\");\n    const styleStr = `\n      position:fixed;\n      top:0;\n      left:0;\n      bottom:0;\n      right:0;\n      width:100%;\n      height:100%;\n      z-index:${zIndex};\n      pointer-events:none;\n      background-repeat:repeat;\n      background-image:url('${base64Url}')`;\n\n    watermarkDiv.setAttribute('style', styleStr);\n    watermarkDiv.classList.add('__wm');\n\n    if (!__wm) {\n      container.style.position = 'relative';\n      container.appendChild(watermarkDiv)\n    }\n    \n    const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n    if (MutationObserver && currentPath !=='/login' && currentPath !== undefined) {\n      let mo = new MutationObserver(function () {\n        const __wm = document.querySelector('.__wm');\n        // 只在__wm元素变动才重新调用 __canvasWM\n        if ((__wm && __wm.getAttribute('style') !== styleStr) || !__wm) {\n          // 避免一直触发\n          mo.disconnect();\n          mo = null;\n        __canvasWM(JSON.parse(JSON.stringify(args)));\n        }\n      });\n\n      mo.observe(container, {\n        attributes: true,\n        subtree: true,\n        childList: true\n      })\n    }\n\n  }\n\n  if (typeof module != 'undefined' && module.exports) {  //CMD\n    module.exports = __canvasWM;\n  } else if (typeof define == 'function' && define.amd) { // AMD\n    define(function () {\n      return __canvasWM;\n    });\n  } else {\n    window.__canvasWM = __canvasWM;\n  }\n\n  export function removeWaterMask(){\n    const __wm = document.querySelector('.__wm');\n    if(__wm)__wm.remove()\n  }"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}