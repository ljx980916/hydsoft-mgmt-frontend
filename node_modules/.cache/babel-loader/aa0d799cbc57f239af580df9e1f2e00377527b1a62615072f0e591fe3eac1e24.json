{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n// deep first search with both order low for pre, lim for post\nvar dfsBothOrder = function (g) {\n  var _a;\n  var result = {};\n  var lim = 0;\n  var dfs = function (v) {\n    var _a;\n    var low = lim;\n    (_a = g.children(v)) === null || _a === void 0 ? void 0 : _a.forEach(dfs);\n    result[v] = {\n      low: low,\n      lim: lim++\n    };\n  };\n  (_a = g.children()) === null || _a === void 0 ? void 0 : _a.forEach(dfs);\n  return result;\n};\n// Find a path from v to w through the lowest common ancestor (LCA). Return the\n// full path and the LCA.\nvar findPath = function (g, postorderNums, v, w) {\n  var vPath = [];\n  var wPath = [];\n  var low = Math.min(postorderNums[v].low, postorderNums[w].low);\n  var lim = Math.max(postorderNums[v].lim, postorderNums[w].lim);\n  var parent;\n  var lca;\n  // Traverse up from v to find the LCA\n  parent = v;\n  do {\n    parent = g.parent(parent);\n    vPath.push(parent);\n  } while (parent && (postorderNums[parent].low > low || lim > postorderNums[parent].lim));\n  lca = parent;\n  // Traverse from w to LCA\n  parent = w;\n  while (parent && parent !== lca) {\n    wPath.push(parent);\n    parent = g.parent(parent);\n  }\n  return {\n    lca: lca,\n    path: vPath.concat(wPath.reverse())\n  };\n};\nvar parentDummyChains = function (g) {\n  var _a;\n  var postorderNums = dfsBothOrder(g);\n  (_a = g.graph().dummyChains) === null || _a === void 0 ? void 0 : _a.forEach(function (startV) {\n    var _a, _b;\n    var v = startV;\n    var node = g.node(v);\n    var edgeObj = node.edgeObj;\n    if (!edgeObj) return;\n    var pathData = findPath(g, postorderNums, edgeObj.v, edgeObj.w);\n    var path = pathData.path;\n    var lca = pathData.lca;\n    var pathIdx = 0;\n    var pathV = path[pathIdx];\n    var ascending = true;\n    while (v !== edgeObj.w) {\n      node = g.node(v);\n      if (ascending) {\n        while (pathV !== lca && ((_a = g.node(pathV)) === null || _a === void 0 ? void 0 : _a.maxRank) < node.rank) {\n          pathIdx++;\n          pathV = path[pathIdx];\n        }\n        if (pathV === lca) {\n          ascending = false;\n        }\n      }\n      if (!ascending) {\n        while (pathIdx < path.length - 1 && ((_b = g.node(path[pathIdx + 1])) === null || _b === void 0 ? void 0 : _b.minRank) <= node.rank) {\n          pathIdx++;\n        }\n        pathV = path[pathIdx];\n      }\n      g.setParent(v, pathV);\n      v = g.successors(v)[0];\n    }\n  });\n};\nexports.default = parentDummyChains;","map":{"version":3,"mappings":"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","names":["dfsBothOrder","g","result","lim","dfs","v","low","children","forEach","findPath","postorderNums","w","vPath","wPath","Math","min","max","parent","lca","push","path","concat","reverse","parentDummyChains","graph","dummyChains","startV","node","edgeObj","pathData","pathIdx","pathV","ascending","maxRank","rank","length","minRank","setParent","successors","exports"],"sourceRoot":"","sources":["../../../../src/layout/dagre/src/parent-dummy-chains.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}