{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { reactive, ref, onBeforeMount, onMounted, nextTick } from \"vue\";\nimport { dataAddChecked, getCurrentDate } from \"../../utils/util\";\nimport { querytDeptConfigData, updateConfig } from \"../../api/departmentEffect\";\nimport { Message, Modal } from \"@arco-design/web-vue\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nimport moment from \"moment\";\nexport default {\n  __name: 'departmentEffect',\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    let {\n      year\n    } = getCurrentDate();\n    let currentDate = `${year}`;\n    let $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\n    onBeforeMount(() => {\n      $bus.emit(\"updateStructure\", [{\n        type: \"text\",\n        color: \"#333\",\n        msg: \"部门有效性列表\"\n      }]);\n    });\n    const maxHeight = ref(0);\n    const tableRef = ref(null);\n    onMounted(() => {\n      if (tableRef.value) {\n        let head = tableRef.value.$el;\n        nextTick(() => {\n          let innerHeight = window.innerHeight;\n          let elHeight = head.getBoundingClientRect().top;\n          maxHeight.value = innerHeight - elHeight - 30 + \"px\";\n        });\n      }\n    });\n    const isEdit = ref(false);\n    const yearNow = ref(currentDate);\n    const arr = ref([]);\n    const paramsArr = ref([]);\n    const tableKey = ref([]);\n    const dataContent = reactive({\n      columns: [{\n        title: \"部门\",\n        dataIndex: \"deptName\",\n        slotName: \"deptName\",\n        width: 280\n      }, {\n        title: \"一月\",\n        dataIndex: \"month1\",\n        slotName: \"month1\"\n      }, {\n        title: \"二月\",\n        dataIndex: \"month2\",\n        slotName: \"month2\"\n      }, {\n        title: \"三月\",\n        dataIndex: \"month3\",\n        slotName: \"month3\"\n      }, {\n        title: \"四月\",\n        dataIndex: \"month4\",\n        slotName: \"month4\"\n      }, {\n        title: \"五月\",\n        dataIndex: \"month5\",\n        slotName: \"month5\"\n      }, {\n        title: \"六月\",\n        dataIndex: \"month6\",\n        slotName: \"month6\"\n      }, {\n        title: \"七月\",\n        dataIndex: \"month7\",\n        slotName: \"month7\"\n      }, {\n        title: \"八月\",\n        dataIndex: \"month8\",\n        slotName: \"month8\"\n      }, {\n        title: \"九月\",\n        dataIndex: \"month9\",\n        slotName: \"month9\"\n      }, {\n        title: \"十月\",\n        dataIndex: \"month10\",\n        slotName: \"month10\"\n      }, {\n        title: \"十一月\",\n        dataIndex: \"month11\",\n        slotName: \"month11\"\n      }, {\n        title: \"十二月\",\n        dataIndex: \"month12\",\n        slotName: \"month12\"\n      }],\n      data: [],\n      loading: false\n      // defaultExpandedKeys: [],\n    });\n\n    const getDisabledTime = current => {\n      return current.valueOf() < moment(\"2023-01-01 00:00:00\").valueOf();\n    };\n    const getData = () => {\n      let params = {\n        year: yearNow.value\n      };\n      dataContent.loading = true;\n      querytDeptConfigData(params).then(res => {\n        if (res.code === \"200\") {\n          let data = dataAddChecked(res.data, \"key\", \"id\");\n          dataContent.data = data;\n          tableKey.value += 1;\n        } else {\n          Message.error(res.desc || \"请求数据失败\");\n        }\n      }).catch(err => {\n        Message.error(err || \"请求数据失败\");\n      }).finally(() => {\n        dataContent.loading = false;\n      });\n    };\n    getData();\n    // 行样式\n    const rowClass = record => {\n      if (record.raw.leafNode === 0) {\n        return \"row-gray\";\n      }\n    };\n    // 更改月份\n    const yearPickChange = value => {\n      yearNow.value = value;\n      getData();\n    };\n    // 编辑版本\n    const handleEdit = () => {\n      isEdit.value = true;\n      paramsArr.value = [];\n    };\n    // 更改\n    const changeChecked = (e, record) => {\n      arr.value.push(record);\n      paramsArr.value = arr.value.filter((item, index, self) => self.indexOf(item) === index);\n    };\n    // 退出编辑\n    const handleLogoutEdit = () => {\n      Modal.warning({\n        title: \"切换/退出页面会导致输入内容丢失,确定继续吗?\",\n        modalClass: \"warningModal\",\n        hideCancel: false,\n        onOk() {\n          isEdit.value = false;\n        }\n      });\n    };\n    // 保存变更\n    const handleSave = () => {\n      let arr = [];\n      paramsArr.value.forEach(item => {\n        const paramsItem = {\n          id: item.id,\n          month1: item.checked1 ? 1 : 0,\n          month2: item.checked2 ? 1 : 0,\n          month3: item.checked3 ? 1 : 0,\n          month4: item.checked4 ? 1 : 0,\n          month5: item.checked5 ? 1 : 0,\n          month6: item.checked6 ? 1 : 0,\n          month7: item.checked7 ? 1 : 0,\n          month8: item.checked8 ? 1 : 0,\n          month9: item.checked9 ? 1 : 0,\n          month10: item.checked10 ? 1 : 0,\n          month11: item.checked11 ? 1 : 0,\n          month12: item.checked12 ? 1 : 0\n        };\n        arr.push(paramsItem);\n      });\n      updateConfig(arr).then(res => {\n        if (res.code === \"200\") {\n          Message.success(\"修改成功\");\n          getData();\n          isEdit.value = false;\n        } else {\n          Message.error(res.desc);\n        }\n      });\n    };\n    const __returned__ = {\n      get year() {\n        return year;\n      },\n      set year(v) {\n        year = v;\n      },\n      get currentDate() {\n        return currentDate;\n      },\n      set currentDate(v) {\n        currentDate = v;\n      },\n      get $bus() {\n        return $bus;\n      },\n      set $bus(v) {\n        $bus = v;\n      },\n      maxHeight,\n      tableRef,\n      isEdit,\n      yearNow,\n      arr,\n      paramsArr,\n      tableKey,\n      dataContent,\n      getDisabledTime,\n      getData,\n      rowClass,\n      yearPickChange,\n      handleEdit,\n      changeChecked,\n      handleLogoutEdit,\n      handleSave,\n      reactive,\n      ref,\n      onBeforeMount,\n      onMounted,\n      nextTick,\n      get dataAddChecked() {\n        return dataAddChecked;\n      },\n      get getCurrentDate() {\n        return getCurrentDate;\n      },\n      get querytDeptConfigData() {\n        return querytDeptConfigData;\n      },\n      get updateConfig() {\n        return updateConfig;\n      },\n      get Message() {\n        return Message;\n      },\n      get Modal() {\n        return Modal;\n      },\n      get getCurrentInstance() {\n        return getCurrentInstance;\n      },\n      get moment() {\n        return moment;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["reactive","ref","onBeforeMount","onMounted","nextTick","dataAddChecked","getCurrentDate","querytDeptConfigData","updateConfig","Message","Modal","getCurrentInstance","moment","year","currentDate","$bus","appContext","config","globalProperties","emit","type","color","msg","maxHeight","tableRef","value","head","$el","innerHeight","window","elHeight","getBoundingClientRect","top","isEdit","yearNow","arr","paramsArr","tableKey","dataContent","columns","title","dataIndex","slotName","width","data","loading","getDisabledTime","current","valueOf","getData","params","then","res","code","error","desc","catch","err","finally","rowClass","record","raw","leafNode","yearPickChange","handleEdit","changeChecked","e","push","filter","item","index","self","indexOf","handleLogoutEdit","warning","modalClass","hideCancel","onOk","handleSave","forEach","paramsItem","id","month1","checked1","month2","checked2","month3","checked3","month4","checked4","month5","checked5","month6","checked6","month7","checked7","month8","checked8","month9","checked9","month10","checked10","month11","checked11","month12","checked12","success"],"sources":["/Users/lijiaxin/Documents/workspace/hydsoft-mgmt-frontend/src/views/dataManagement/departmentEffect.vue"],"sourcesContent":["<template>\n  <div class=\"defaultPadding\">\n    <div class=\"flex-between-noCenter\">\n      <a-space>\n        年份：\n        <a-year-picker\n          v-model=\"yearNow\"\n          :disabledDate=\"getDisabledTime\"\n          style=\"width: 120px; border-radius: 4px\"\n          :allow-clear=\"false\"\n          @change=\"yearPickChange\"\n        />\n      </a-space>\n      <a-space>\n        <a-button type=\"primary\" v-if=\"isEdit && paramsArr.length == 0\" @click=\"handleLogoutEdit\">退出编辑</a-button>\n        <a-button type=\"primary\" v-if=\"isEdit && paramsArr.length > 0\" @click=\"handleSave\">保存变更</a-button>\n        <a-button type=\"primary\" v-if=\"!isEdit\" @click=\"handleEdit\">编辑版本</a-button>\n      </a-space>\n    </div>\n    <a-table\n      ref=\"tableRef\"\n      :key=\"tableKey\"\n      column-resizable\n      :row-class=\"rowClass\"\n      :columns=\"dataContent.columns\"\n      :data=\"dataContent.data\"\n      :loading=\"dataContent.loading\"\n      style=\"margin-top: 20px\"\n      :scroll=\"{ maxHeight: maxHeight }\"\n      :default-expand-all-rows=\"true\"\n      :pagination=\"false\"\n    >\n      <template #deptName=\"{ record }\">\n        <span>{{ record.deptName }}</span>\n      </template>\n      <template #month1=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked1 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked1\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month2=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked2 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked2\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month3=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked3 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked3\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month4=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked4 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked4\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month5=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked5 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked5\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month6=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked6 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked6\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month7=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked7 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked7\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month8=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked8 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked8\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month9=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked9 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked9\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month10=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked10 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked10\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month11=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked11 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked11\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #month12=\"{ record }\">\n        <span v-if=\"record.leafNode === 1\">\n          <icon-check v-if=\"record.checked12 && !isEdit\" class=\"checkCss\" />\n          <a-checkbox v-if=\"isEdit\" v-model=\"record.checked12\" @change=\"changeChecked($event, record)\"></a-checkbox>\n        </span>\n      </template>\n      <template #empty>\n        <a-empty />\n      </template>\n    </a-table>\n  </div>\n</template>\n<script setup>\nimport { reactive, ref, onBeforeMount, onMounted, nextTick } from \"vue\";\nimport { dataAddChecked, getCurrentDate } from \"../../utils/util\";\nimport { querytDeptConfigData, updateConfig } from \"../../api/departmentEffect\";\nimport { Message, Modal } from \"@arco-design/web-vue\";\nimport { getCurrentInstance } from \"@vue/runtime-core\";\nlet { year } = getCurrentDate();\nimport moment from \"moment\";\nlet currentDate = `${year}`;\nlet $bus = getCurrentInstance().appContext.config.globalProperties.$bus;\nonBeforeMount(() => {\n  $bus.emit(\"updateStructure\", [{ type: \"text\", color: \"#333\", msg: \"部门有效性列表\" }]);\n});\nconst maxHeight = ref(0);\nconst tableRef = ref(null);\nonMounted(() => {\n  if (tableRef.value) {\n    let head = tableRef.value.$el;\n    nextTick(() => {\n      let innerHeight = window.innerHeight;\n      let elHeight = head.getBoundingClientRect().top;\n      maxHeight.value = innerHeight - elHeight - 30 + \"px\";\n    });\n  }\n});\nconst isEdit = ref(false);\nconst yearNow = ref(currentDate);\nconst arr = ref([]);\nconst paramsArr = ref([]);\nconst tableKey = ref([]);\nconst dataContent = reactive({\n  columns: [\n    {\n      title: \"部门\",\n      dataIndex: \"deptName\",\n      slotName: \"deptName\",\n      width: 280,\n    },\n    {\n      title: \"一月\",\n      dataIndex: \"month1\",\n      slotName: \"month1\",\n    },\n    {\n      title: \"二月\",\n      dataIndex: \"month2\",\n      slotName: \"month2\",\n    },\n    {\n      title: \"三月\",\n      dataIndex: \"month3\",\n      slotName: \"month3\",\n    },\n    {\n      title: \"四月\",\n      dataIndex: \"month4\",\n      slotName: \"month4\",\n    },\n    {\n      title: \"五月\",\n      dataIndex: \"month5\",\n      slotName: \"month5\",\n    },\n    {\n      title: \"六月\",\n      dataIndex: \"month6\",\n      slotName: \"month6\",\n    },\n    {\n      title: \"七月\",\n      dataIndex: \"month7\",\n      slotName: \"month7\",\n    },\n    {\n      title: \"八月\",\n      dataIndex: \"month8\",\n      slotName: \"month8\",\n    },\n    {\n      title: \"九月\",\n      dataIndex: \"month9\",\n      slotName: \"month9\",\n    },\n    {\n      title: \"十月\",\n      dataIndex: \"month10\",\n      slotName: \"month10\",\n    },\n    {\n      title: \"十一月\",\n      dataIndex: \"month11\",\n      slotName: \"month11\",\n    },\n    {\n      title: \"十二月\",\n      dataIndex: \"month12\",\n      slotName: \"month12\",\n    },\n  ],\n  data: [],\n  loading: false,\n  // defaultExpandedKeys: [],\n});\nconst getDisabledTime = current => {\n  return current.valueOf() < moment(\"2023-01-01 00:00:00\").valueOf();\n};\nconst getData = () => {\n  let params = {\n    year: yearNow.value,\n  };\n  dataContent.loading = true;\n  querytDeptConfigData(params)\n    .then(res => {\n      if (res.code === \"200\") {\n        let data = dataAddChecked(res.data, \"key\", \"id\");\n        dataContent.data = data;\n        tableKey.value += 1;\n      } else {\n        Message.error(res.desc || \"请求数据失败\");\n      }\n    })\n    .catch(err => {\n      Message.error(err || \"请求数据失败\");\n    })\n    .finally(() => {\n      dataContent.loading = false;\n    });\n};\ngetData();\n// 行样式\nconst rowClass = record => {\n  if (record.raw.leafNode === 0) {\n    return \"row-gray\";\n  }\n};\n// 更改月份\nconst yearPickChange = value => {\n  yearNow.value = value;\n  getData();\n};\n// 编辑版本\nconst handleEdit = () => {\n  isEdit.value = true;\n  paramsArr.value = [];\n};\n// 更改\nconst changeChecked = (e, record) => {\n  arr.value.push(record);\n  paramsArr.value = arr.value.filter((item, index, self) => self.indexOf(item) === index);\n};\n// 退出编辑\nconst handleLogoutEdit = () => {\n  Modal.warning({\n    title: \"切换/退出页面会导致输入内容丢失,确定继续吗?\",\n    modalClass: \"warningModal\",\n    hideCancel: false,\n    onOk() {\n      isEdit.value = false;\n    },\n  });\n};\n// 保存变更\nconst handleSave = () => {\n  let arr = [];\n  paramsArr.value.forEach(item => {\n    const paramsItem = {\n      id: item.id,\n      month1: item.checked1 ? 1 : 0,\n      month2: item.checked2 ? 1 : 0,\n      month3: item.checked3 ? 1 : 0,\n      month4: item.checked4 ? 1 : 0,\n      month5: item.checked5 ? 1 : 0,\n      month6: item.checked6 ? 1 : 0,\n      month7: item.checked7 ? 1 : 0,\n      month8: item.checked8 ? 1 : 0,\n      month9: item.checked9 ? 1 : 0,\n      month10: item.checked10 ? 1 : 0,\n      month11: item.checked11 ? 1 : 0,\n      month12: item.checked12 ? 1 : 0,\n    };\n    arr.push(paramsItem);\n  });\n  updateConfig(arr).then(res => {\n    if (res.code === \"200\") {\n      Message.success(\"修改成功\");\n      getData();\n      isEdit.value = false;\n    } else {\n      Message.error(res.desc);\n    }\n  });\n};\n</script>\n<style lang=\"scss\" scoped>\n.checkCss {\n  color: forestgreen;\n  font-size: 22px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}